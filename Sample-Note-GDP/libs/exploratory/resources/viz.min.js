var VizUtil=function(){var res={};var Column={};Column.OperationType={NONE:"none",SUM:"sum",GROUPBY:"groupby",GROUPBY_SUM:"gbysum",GROUPBY_SORT:"gbysort",DISTINCT:"distinct",COUNT:"count",COUNT_PCT:"count_pct",COUNT_DISTINCT:"countd",COUNT_DISTINCT_PCT:"countd_pct",AVERAGE:"ave",MEDIAN:"median",MIN:"min",MAX:"max",WEIGHTED_MEAN:"weighted_mean",MERGE_SD:"merge_sd",FIRST:"first",FIRST_EXCLUDE_NA:"first_narm",LAST:"last",LAST_EXCLUDE_NA:"last_narm",QUANTILE:"quantile",NTH:"nth",DATE_AVERAGE:"dateave",DATE_MEDIAN:"datemedian",DATE_MIN:"datemin",DATE_MAX:"datemax",DATE_FIRST:"datefirst",DATE_FIRST_EXCLUDE_NA:"datefirst_narm",DATE_LAST:"datelast",DATE_LAST_EXCLUDE_NA:"datelast_narm",DATE_MODE:"datemode",VAR:"var",SD1:"sd",SD2:"sd2",SD3:"sd3",IQR:"iqr",IQR150:"iqr150",MAD:"mad",LOG10:"log10",LOG2:"log2",LOG:"log",MODE:"mode",ABS:"abs",NORMALIZE:"normalize",NORMALIZE_NUMERIC:"normalize_numeric",UPPERCASE:"uppercase",LOWERCASE:"lowercase",TITLECASE:"titlecase",EXTRACT_ALPHABETS:"extract_alphabets",EXTRACT_NUMBERS:"extract_numbers",EXTRACT_FIRST_WORD:"extract_first_word",EXTRACT_RANGE:"extract_range",REMOVE_SPACES:"remove_spaces",REMOVE_REPEAETD_SPACES:"remove_repeated_spaces",REMOVE_ALPHABETS:"remove_alphabets",REMOVE_NUMBERS:"remove_numbers",CONSTANT:"constant",CUSTOM_GROUPBY_FUNCTION:"custom_gby",CUSTOM_SUMMARIZE_FUNCTION:"custom_sum",DATE_CONSTANT:"dateconstant",POSIXCT_CONSTANT:"posixctconstant",NA_COUNT:"nacount",NA_PCT:"napct",NA_RATIO:"na_ratio",NON_NA_COUNT:"nnacount",NON_NA_PCT:"nnapct",NON_NA_RATIO:"nna_ratio",ALL:"all",ANY:"any",ALL_PIVOT_TOTAL:"all_pivot_total",ANY_PIVOT_TOTAL:"any_pivot_total",TRUE_COUNT:"truecount",FALSE_COUNT:"falsecount",TRUE_PCT:"truepct",FALSE_PCT:"falsepct",TRUE_RATIO:"true_ratio",FALSE_RATIO:"false_ratio",ODDS:"odds",SUM_IF:"sum_if",SUM_IF_RATIO:"sum_if_ratio",MEAN_IF:"mean_if",MEDIAN_IF:"median_if",MIN_IF:"max_if",MAX_IF:"min_if",COUNT_IF:"count_if",COUNT_IF_RATIO:"count_if_ratio",COUNT_DISTINCT_IF:"count_unique_if",COUNT_DISTINCT_IF_RATIO:"count_unique_if_ratio",DATE_MIN_IF:"datemin_if",DATE_MAX_IF:"datemax_if",DATE_MEDIAN_IF:"datemedian_if",SD1_IF:"sd_if",SD2_IF:"sd2_if",SD3_IF:"sd3_if",IQR_IF:"iqr_if",STDERR_IF:"stderr_if",CONF_INTV_90_IF:"confint90_if",CONF_INTV_95_IF:"confint_if",CONF_INTV_99_IF:"confint99_if",VALUE_FOR_FIRST_LEVEL:"value_for_first_level",LM_FIT:"lmfit",LOESS_FIT:"loessfit",GAM_FIT:"gamfit",LOGISTIC_FIT:"logistic-fit",POISSON_FIT:"poisson-fit",BUCKET:"bucket",BOXPLOT:"boxplot",DENSITYPLOT:"densityplot",AS_CHAR:"aschar",AS_FACTOR:"asfactor",AS_LOGICAL_FACTOR:"aslfactor",CONVERT_NAN_TO_NA:"convert_nan_to_na",CONVERT_NAN_AND_INF_TO_NA:"convert_nan_and_inf_to_na",STDERR:"stderr",CONF_INTV_90:"confint90",CONF_INTV_95:"confint",CONF_INTV_99:"confint99",STDERR_PCT_WF:"stderrpct",CONF_INTV_PCT_90_WF:"confintpct90",CONF_INTV_PCT_95_WF:"confintpct",CONF_INTV_PCT_99_WF:"confintpct99",SD1_PCT_WF:"sdpct",SD2_PCT_WF:"sd2pct",SD3_PCT_WF:"sd3pct",IQR_PCT_WF:"iqrpct",STDERR_PCT:"stderrpct_agg",CONF_INTV_PCT_90:"confintpct90_agg",CONF_INTV_PCT_95:"confintpct_agg",CONF_INTV_PCT_99:"confintpct99_agg",SD1_PCT:"sdpct_agg",SD2_PCT:"sd2pct_agg",SD3_PCT:"sd3pct_agg",IQR_PCT:"iqrpct_agg",RATIO_BY_SAMPLE_SIZE:"ratio_by_sample_size",CALC_CONF_INTV_MEAN_90:"calc_confint_mean_90",CALC_CONF_INTV_MEAN_95:"calc_confint_mean_95",CALC_CONF_INTV_MEAN_99:"calc_confint_mean_99",CALC_CONF_INTV_RATIO_90:"calc_confint_ratio_90",CALC_CONF_INTV_RATIO_95:"calc_confint_ratio_95",CALC_CONF_INTV_RATIO_99:"calc_confint_ratio_99",IN_PCT:"inpct",FORMAT_DATE:"format",FORMAT_DATE_BEFORE_GROUBY:"format_before_gby",ROUND_TO_YEAR:"rtoyear",FLOOR_TO_YEAR:"fltoyear",ROUND_TO_HALF_YEAR:"rtohalfyear",FLOOR_TO_HALF_YEAR:"fltohalfyear",ROUND_TO_QUARTER:"rtoq",FLOOR_TO_QUARTER:"fltoquarter",ROUND_TO_BI_MONTH:"rtobimon",FLOOR_TO_BI_MONTH:"fltobimonth",ROUND_TO_MONTH:"rtomon",FLOOR_TO_MONTH:"fltomonth",ROUND_TO_WEEK:"rtoweek",FLOOR_TO_WEEK:"fltoweek",ROUND_TO_DAY:"rtoday",FLOOR_TO_DAY:"fltoday",ROUND_TO_HOUR:"rtohour",FLOOR_TO_HOUR:"fltohour",ROUND_TO_MINUTE:"rtomin",FLOOR_TO_MINUTE:"fltominute",ROUND_TO_SECOND:"rtosec",FLOOR_TO_SECOND:"fltosecond",YEAR:"year",HALF_YEAR:"halfyear",QUARTER:"quarter",BI_MONTH:"bimon",BI_MONTH_2:"bimonth",MONTH:"mon",MONTH_2:"month",MONTH_NAME:"monname",MONTH_NAME_2:"monthname",MONTH_NAME_LONG:"monnamelong",MONTH_NAME_WITH_YEAR:"monthname_with_year",WEEK:"week",WEEK_SUNDAY_START:"epiweek",WEEK_MONDAY_START:"isoweek",WEEK_OF_QUARTER:"week_of_quarter",WEEK_OF_MONTH:"week_of_month",DAY:"day",DAY_OF_YEAR:"dayofyear",DAY_OF_QUARTER:"dayofquarter",DAY_OF_WEEK:"dayofweek",WEEKDAY:"wday",WEEKEND:"weekend",WEEKDAY_LONG:"wdaylong",HOUR:"hour",MINUTE:"minute",SECOND:"second",HOUR_NUMERIC:"hour_num",MINUTE_NUMERIC:"minute_num",SECOND_NUMERIC:"second_num",AS_NUM:"asnum",AS_DISCRETE_VALUES:"asdisc",AS_INTEGER:"asint",AS_INTEGER_BY10:"asintby10",AS_CATEGORY:"ascategory",RECODE:"recode",RECODE_EMPTY_STRING:"recode_empty_str",CONVERT_NA:"convertna",RELEVEL_FACTOR_BY_NAME:"relevel_by_name",DROP_UNUSED_FACTOR_LEVELS:"fct_drop",COMPLETE:"complete",COMPLETE_EACH:"complete_each",CONVERT_US_STATE_NAME:"convstate",CONVERT_COUNTRY_NAME:"convcountry",CONVERT_ISO2C:"conviso2c",CONVERT_ISO3N:"conviso3n",UNGROUP:"ungrp",CUT:"cut",BUCKET_OUTLIER:"bucket_outlier",BUCKET_OUTLIER_IQR:"bucket_outlier_iqr",BUCKET_OUTLIER_PERCENTILE:"bucket_outlier_pct",BUCKET_OUTLIER_SD:"bucket_outlier_sd",BUCKET_EQUAL_WIDTH:"bucket_equal_width",BUCKET_EQUAL_STEP:"bucket_equal_step",BUCKET_EQUAL_FREQ:"bucket_equal_freq",BUCKET_CUSTOM:"bucket_custom",BUCKET_KMEANS:"bucket_kmeans",BUCKET_LOGICALIZE:"bucket_logicalize",GATHER:"gather",CUMSUM:"cumsum",PCT_CUMSUM:"pcumsum",PCT_CUMSUM_REV:"pcumsum_rev",CUMMEAN:"cummean",CUMMIN:"cummin",CUMMAX:"cummax",CUMPROD:"cumprod",CUMALL:"cumall",CUMANY:"cumany",DIFF_FROM_PREV:"dfprev",DIFF_FROM_NEXT:"dfnext",DIFF_FROM_FIRST:"dfirst",DIFF_FROM_LAST:"dflast",DIFF_FROM_MIN:"dfmin",DIFF_FROM_MAX:"dfmax",DIFF_FROM_MEAN:"dfmean",DIFF_FROM_MEDIAN:"dfmed",DIFF_FROM_MODE:"dfmode",DIFF_FROM_PERIOD:"dfperiod",DIFF_FROM_CONST:"dfconst",DIFF_FROM_PREV_DATE:"dfprevdate",DIFF_FROM_NEXT_DATE:"dfnextdate",DIFF_FROM_FIRST_DATE:"dfirstdate",DIFF_FROM_LAST_DATE:"dflastdate",DIFF_FROM_MIN_DATE:"dfmindate",DIFF_FROM_MAX_DATE:"dfmaxdate",DIFF_FROM_MEAN_DATE:"dfmeandate",DIFF_FROM_MEDIAN_DATE:"dfmeddate",DIFF_FROM_MODE_DATE:"dfmodedate",DIFF_FROM_CONST_DATE:"dfconstdate",PCT_DIFF_FROM_PREV:"pdfprev",PCT_DIFF_FROM_NEXT:"pdfnext",PCT_DIFF_FROM_FIRST:"pdfirst",PCT_DIFF_FROM_LAST:"pdflast",PCT_DIFF_FROM_MIN:"pdfmin",PCT_DIFF_FROM_MAX:"pdfmax",PCT_DIFF_FROM_MEAN:"pdfmean",PCT_DIFF_FROM_MEDIAN:"pdfmed",PCT_DIFF_FROM_MODE:"pdfmode",PCT_DIFF_FROM_CONST:"pdfconst",PCT_DIFF_FROM_PERIOD:"pdfperiod",RATIO_DIFF_FROM_PREV:"rdfprev",RATIO_DIFF_FROM_NEXT:"rdfnext",RATIO_DIFF_FROM_FIRST:"rdfirst",RATIO_DIFF_FROM_LAST:"rdflast",RATIO_DIFF_FROM_MIN:"rdfmin",RATIO_DIFF_FROM_MAX:"rdfmax",RATIO_DIFF_FROM_MEAN:"rdfmean",RATIO_DIFF_FROM_MEDIAN:"rdfmed",RATIO_DIFF_FROM_MODE:"rdfmode",RATIO_DIFF_FROM_CONST:"rdfconst",RATIO_DIFF_FROM_PERIOD:"rdfperiod",PCT_OF_TOTAL:"ptotal",PCT_OF_FIRST:"poffirst",PCT_OF_LAST:"poflast",PCT_OF_PREV:"pofprev",PCT_OF_NEXT:"pofnext",PCT_OF_MIN:"pofmin",PCT_OF_MAX:"pofmax",PCT_OF_MEAN:"pofmean",PCT_OF_MEDIAN:"pofmedian",PCT_OF_MODE:"pofmode",RATIO_OF_TOTAL:"rtotal",RATIO_OF_FIRST:"roffirst",RATIO_OF_LAST:"roflast",RATIO_OF_PREV:"rofprev",RATIO_OF_NEXT:"rofnext",RATIO_OF_MIN:"rofmin",RATIO_OF_MAX:"rofmax",RATIO_OF_MEAN:"rofmean",RATIO_OF_MEDIAN:"rofmedian",RATIO_OF_MODE:"rofmode",MIN_RANK:"mrank",DENSE_RANK:"drank",PCT_RANK:"prank",MIN_RANK_DESC:"mrankdesc",DENSE_RANK_DESC:"drankdesc",PCT_RANK_DESC:"prankdesc",ROLL_MIN:"rollmin",ROLL_MAX:"rollmax",ROLL_MEAN:"rollmean",ROLL_MEDIAN:"rollmed",ROLL_SD:"rollsd",ROLL_VAR:"rollvar",ROLL_SUM:"rollsum",ROLL_PROD:"rollprod",LAG_FROM_PERIOD:"lag_period",LAG:"lag",LEAD:"lead",ROWNUM:"rownum",SORT_ASC:"sortasc",SORT_DESC:"sortdesc",FCT_CREATE:"fctcreate",FCT_REV:"fctrev",FCT_DROP:"fct_drop",FCT_INFREQ:"infreq",FCT_INFREQ_ASC:"sortfreqasc",FCT_INFREQ_DESC:"sortfreqdesc",FCT_LUMP_INFREQ:"fctlump_infreq",FCT_LUMP:"fctlump",FCT_OTHER:"fctother",FCT_RELEVEL:"fct_relevel",REF_LINE:"refline",REF_LINE_WITH_CONF_INT:"refline_confint",DIAGONAL:"diagonal",OUTLIERS_GROUPBY:"outliers_groupby",REMOVE_OUTLIERS_IQR:"remove_outliers_iqr",ROUND:"round",NO_EXPORT:"no_export",POST_FILTER:"postfilter"};Column.Attribute={CUSTOM_FUNCTION_COLUMN:"customFuncCol",CUSTOM_FUNCTION_EXPRESSION:"customFuncExpr",POST_FILTER_FOR_CUSTOM_FUNCTION_COLUMN:"postFilterForCustomFuncCol",REFLINE_RANGE_SCOPE:"reflineRangeScope",REFLINE_RANGE_TYPE:"reflineRangeType",BUCKET_GROUP_BY_COLUMN:"bucketGroupByColumn",BUCKET_GROUP_BY_COLUMN_ORIGINAL_NAMES:"bucketGroupByColumnOriginalNames",BUCKET_AFTER_SUMMARIZE:"bucketAfterSummarize",BUCKET_PRIORITY:"bucketPriority",BUCKET_CONVERT_NA:"bucketConvertNa",BUCKET_CAST_TO_NUMERIC_BEFORE_BUCKETING:"bucketCastToNum",SPREAD_KEY_FOR_EXPORT:"spreadKeyForExport",SPREAD_VAL_FOR_EXPORT:"spreadValForExport",SPREAD_GROUP_FOR_EXPORT:"spreadGroupForExport",GATHER_TARGET:"gatherTarget",VALUE_PREFIX:"valuePrefix",VALUE_SUFFIX:"valueSuffix",SAMPLE_SIZE_COLUMN:"sampleSizeCol",MEAN_COLUMN:"meanCol",SD_COLUMN:"sdCol",LIKERT_SIGMA:"likert_sigma"};res.MAX_SAFE_INTEGER=9007199254740992;res.PIXEL_PER_CHAR=7;res.MIN_MARGIN=60;res.MAX_MARGIN=100;res.DEFAULT_MIN_CIRCLE_DIAMETER={scatter:6,bubble:10,map:3,scattermatrix:7};res.DEFAULT_MIN_CIRCLE_DIAMETER.easymap=res.DEFAULT_MIN_CIRCLE_DIAMETER.map;res.DEFAULT_MAX_CIRCLE_DIAMETER={scatter:30,bubble:40,map:40};res.DEFAULT_MAX_CIRCLE_DIAMETER.easymap=res.DEFAULT_MAX_CIRCLE_DIAMETER.map;res.DEFAULT_VIOLIN_POINT_OPACITY=.6;res.DEFAULT_DENSITYPLOT_NUM_DECIMAL_DIGITS=4;res.ZERO_LINE_COLOR="#cfcfcf";res.FREQ_COL_LABEL="(Number of Rows)";res.AGGREGATION_FUNCTION_OPTIONS_HASH={};res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.SUM]="Sum";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.AVERAGE]="Mean";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.MIN]="Min";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.MAX]="Max";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.DATE_MIN]="Min";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.DATE_MAX]="Max";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.FIRST]="First";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.LAST]="Last";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.COUNT]="Count";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.COUNT_DISTINCT]="Uniq.";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.MEDIAN]="Med.";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.SD1]="SD";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.SD2]="2SD";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.SD3]="3SD";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.VAR]="Var.";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.IQR]="IQR";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.IQR150]="IQR";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.MAD]="MAD";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.MODE]="Mode (Most Frequent)";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.NTH]="Nth";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.QUANTILE]="Qtile";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.NA_COUNT]="#NA";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.NA_PCT]="%NA";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.NA_RATIO]="%NA";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.NON_NA_COUNT]="#NNA";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.NON_NA_PCT]="%NNA";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.NON_NA_RATIO]="%NNA";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.TRUE_COUNT]="#True";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.FALSE_COUNT]="#False";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.TRUE_PCT]="%True";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.FALSE_PCT]="%False";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.TRUE_RATIO]="%True";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.FALSE_RATIO]="%False";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.ODDS]="Odds";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.COUNT_IF]="Count If";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.SUM_IF]="Sum If";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.SUM_IF_RATIO]="Sum If Ratio";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.MEAN_IF]="Mean If";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.MEDIAN_IF]="Med. If";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.COUNT_IF]="Count If";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.COUNT_IF_RATIO]="Count If Ratio";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.COUNT_DISTINCT_IF]="Uniq. If";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.COUNT_DISTINCT_IF_RATIO]="Uniq. If Ratio";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.DATE_MEDIAN_IF]="Med. If";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.DATE_MIN_IF]="Min If";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.DATE_MAX_IF]="Max If";res.NUMROW_FUNCTION_LABEL_HASH={};res.NUMROW_FUNCTION_LABEL_HASH[Column.OperationType.COUNT]="(Number of Rows)";res.NUMROW_FUNCTION_LABEL_HASH[Column.OperationType.NA_COUNT]="(Number of NA)";res.NUMROW_FUNCTION_LABEL_HASH[Column.OperationType.NON_NA_COUNT]="(Number of Not NA)";res.NUMROW_FUNCTION_LABEL_HASH[Column.OperationType.TRUE_COUNT]="(Number of TRUE)";res.NUMROW_FUNCTION_LABEL_HASH[Column.OperationType.FALSE_COUNT]="(Number of FALSE)";res.DEFAULT_FACET_SIZE=3;res.MAX_FACET_WIDTH=300;res.MIN_FACET_HEIGHT=300;res.ORIGINAL_ORDER_COL_NAME=".oo";res.TYPE_NUMROWS="numrows";res.NUMROWS_COL_NAME=".dummy.column.name.for.count.column";res.NUMROWS_COL_LABEL="(Number of Rows)";res.NUMROWS_COL_TEMPLATE={name:res.NUMROWS_COL_NAME,validName:res.NUMROWS_COL_NAME,isNumeric:true,isDate:false,type:res.TYPE_NUMROWS,func:Column.OperationType.COUNT,label:null,validLabel:null};res.NUMERIC_COLS_NAME=".dummy.column.name.for.numeric.columns";res.NUMERIC_COLS_LABEL="(All Numeric Columns)";res.TYPE_ROWNUM="rownum";res.ROWNUM_COL_NAME=".dummy.column.name.for.rownum.column";res.ROWNUM_COL_LABEL="(Row Number)";res.ROWNUM_COL_TEMPLATE={name:res.ROWNUM_COL_NAME,validName:res.ROWNUM_COL_NAME,isNumeric:true,isDate:false,type:res.TYPE_ROWNUM,func:Column.OperationType.ROWNUM,label:null,validLabel:null};res.TYPE_CUSTOM="custom";res.CUSTOM_COL_NAME=".dummy.column.name.for.custom.column";res.CUSTOM_COL_LABEL="(Custom)";res.CUSTOM_COL_TEMPLATE={name:res.CUSTOM_COL_NAME,validName:res.CUSTOM_COL_NAME,isNumeric:true,isDate:false,type:res.TYPE_CUSTOM,func:Column.OperationType.COUNT,label:null,validLabel:null};res.TYPE_ROWID="rowid";res.ROWID_COL_NAME=".rowid.column";res.ROWID_COL_LABEL="(Row ID)";res.ROWID_COL_TEMPLATE={name:res.ROWID_COL_NAME,validName:res.ROWID_COL_NAME,isNumeric:true,isDate:false,type:res.TYPE_ROWID,func:Column.OperationType.NONE,label:null,validLabel:null};res.TYPE_KEYPROP="keyprop";res.KEYPROP_COL_NAME=".keyprop.column";res.KEYPROP_COL_LABEL="(Key)";res.KEYPROP_COL_TEMPLATE={name:res.KEYPROP_COL_NAME,validName:res.KEYPROP_COL_NAME,isNumeric:true,isDate:false,type:res.TYPE_KEYPROP,func:Column.OperationType.CUSTOM_GROUPBY_FUNCTION,label:null,validLabel:null};res.SELECTED_COLUMNS_ALIAS_COL_NAME=".selected.columns.alias.column";res.SELECTED_COLUMNS_ALIAS_COL_LABEL="(Selected Column)";res.LAST_COL_NAME=".dummy.column.name.for.last";res.TYPE_GROUP_BY_MEASURES="group-by-measure";res.GROUP_BY_MEASURES_COL_NAME=".group.by.measure.column";res.GROUP_BY_MEASURES_COL_LABEL="(Each Y Axis)";res.GROUP_BY_MEASURES_COL_TEMPLATE={name:res.GROUP_BY_MEASURES_COL_NAME,validName:res.GROUP_BY_MEASURES_COL_NAME,isNumeric:false,isDate:false,type:res.TYPE_GROUP_BY_MEASURES,func:Column.OperationType.GATHER,label:res.GROUP_BY_MEASURES_COL_LABEL,validLabel:res.GROUP_BY_MEASURES_COL_LABEL};res.TYPE_YAXIS="yaxis-column";res.YAXIS_COL_NAME=".yaxis.column";res.YAXIS_COL_LABEL="(Y Axis Values)";res.YAXIS_COL_TEMPLATE={name:res.YAXIS_COL_NAME,validName:res.YAXIS_COL_NAME,isNumeric:true,isDate:false,type:res.TYPE_YAXIS,func:Column.OperationType.COUNT,label:res.YAXIS_COL_LABEL,validLabel:res.YAXIS_COL_LABEL};res.LONGITUDE_COL_NAME="longitude";res.LONGITUDE_COL_LABEL="Longitude";res.LATITUDE_COL_NAME="latitude";res.LATITUDE_COL_LABEL="Latitude";res.NROW_INTERNAL_COL_NAME="..nrow";res.ERRBAR_NUMERATOR_INTERNAL_COL_NAME="..ebn";res.ORIGINAL_COLOR_BUCKET_LABELS=".dqdf.orig.color.bucket.labels";res.AVAILABLE_POST_FILTER_TYPES=["none","top","bottom","condition"];var _createHash=function(definitionArr,valueProp){var obj={};definitionArr.forEach(function(item){obj[item.value]=item[valueProp||"label"]});return obj};res.POST_FILTER_OPTIONS=[{label:"None",value:"none"},{label:"Condition",value:"condition"},{label:"Top N",value:"top"},{label:"Bottom N",value:"bottom"}];res.POST_FILTER_OPTIONS_HASH=_createHash(res.POST_FILTER_OPTIONS);res.BUCKET_OPTIONS=[{label:"Automatic",value:0},{label:"5",value:5},{label:"10",value:10},{label:"15",value:15},{label:"20",value:20},{label:"25",value:25},{label:"50",value:50},{label:"100",value:100},{label:"200",value:200},{label:"500",value:500},{label:"1,000",value:1e3}];res.BUCKET_OPTIONS_HASH=_createHash(res.BUCKET_OPTIONS);res.PCT_TOTAL_DIRECTION_OPTIONS=[{value:"color",label:"X Axis"},{value:"x",label:"Color By"},{value:"all",label:"All"}];res.PCT_TOTAL_DIRECTION_OPTIONS.default="color";res.PCT_TOTAL_DIRECTION_OPTIONS_HASH=_createHash(res.PCT_TOTAL_DIRECTION_OPTIONS);res.TS_PERIOD_OPTIONS=[{value:"year",label:"Year"},{value:"quarter",label:"Quarter"},{value:"month",label:"Month"},{value:"week",label:"Week"},{value:"day",label:"Day"}];res.TS_PERIOD_OPTIONS_HASH=_createHash(res.TS_PERIOD_OPTIONS);res.ORDER_OPTIONS=[{value:"asc",label:"Ascending"},{value:"desc",label:"Descending"}];res.ORDER_OPTIONS_HASH=_createHash(res.ORDER_OPTIONS);res.MARKER_SHAPE_OPTIONS=[{value:"default",label:"(Default)"},{value:"circle",label:"Circle"},{value:"bar",label:"Bar"},{value:"line",label:"Line"},{value:"line+circle",label:"Line + Circle"}];res.MARKER_SHAPE_OPTIONS_HASH=_createHash(res.MARKER_SHAPE_OPTIONS);res.ERRBAR_MARKER_SHAPE_OPTIONS=[{value:"bar",label:"Bar"},{value:"circle",label:"Marker"}];res.ERRBAR_MARKER_SHAPE_OPTIONS_HASH=_createHash(res.ERRBAR_MARKER_SHAPE_OPTIONS);res.PIVOT_COLOR_OPTIONS=[{label:"None",value:"none"},{label:"All (Down then Across)",value:"table_down_across"},{label:"Row (Across)",value:"table_across"},{label:"Column (Down then Across within Group)",value:"pane_down_across"},{label:"Column (Down)",value:"table_down"},{label:"Column (Down within Group)",value:"pane_down"}];res.PIVOT_COLOR_OPTIONS_HASH=_createHash(res.PIVOT_COLOR_OPTIONS);res.PIVOT_COLOR_OPTIONS_HASH.table5="All";res.PIVOT_COLOR_OPTIONS_HASH.row5="Row";res.PIVOT_WINDOW_FUNC_DIRECTIONS=[{label:"All (Down then Across)",value:"table_down_across"},{label:"Row (Across)",value:"table_across"},{label:"Column (Down then Across within Group)",value:"pane_down_across"},{label:"Column (Down)",value:"table_down"},{label:"Column (Down within Group)",value:"pane_down"}];res.PIVOT_WINDOW_FUNC_DIRECTIONS_HASH=_createHash(res.PIVOT_WINDOW_FUNC_DIRECTIONS);res.PIVOT_DIRECTIONS_BACKWARD_COMPATIBILITY_MAP={all:"table_down_across",row:"table_across",row_group:"pane_down_across",column:"table_down"};res.TABLE_MAX_NUMROW_OPTIONS=[{label:"20",value:20},{label:"50",value:50},{label:"100",value:100},{label:"200",value:200},{label:"500",value:500},{label:"1,000",value:1e3},{label:"5,000",value:5e3}];res.TABLE_MAX_NUMROW_OPTIONS_HASH=_createHash(res.TABLE_MAX_NUMROW_OPTIONS);res.TABLE_MAX_NUMCOL_OPTIONS=[{label:"300",value:300},{label:"1,000",value:1e3},{label:"10,000",value:1e4}];res.TABLE_MAX_NUMCOL_OPTIONS_HASH=_createHash(res.TABLE_MAX_NUMCOL_OPTIONS);res.MODEL_DATA_TYPE_OPTIONS=[{label:"Coefficients",value:"tidy"},{label:"Model Quality Stats",value:"glance"},{label:"Scored Data",value:"augment"}];res.MODEL_DATA_TYPE_OPTIONS_HASH=_createHash(res.MODEL_DATA_TYPE_OPTIONS);res.ERROR_BAR_TYPE_OPTIONS=[{label:"Standard Error",hint:"Standard Error",value:Column.OperationType.STDERR},{label:"90% Conf. Interval",hint:"90% Confidence Interval",value:Column.OperationType.CONF_INTV_90},{label:"95% Conf. Interval",hint:"95% Confidence Interval",value:Column.OperationType.CONF_INTV_95},{label:"99% Conf. Interval",hint:"99% Confidence Interval",value:Column.OperationType.CONF_INTV_99},{label:"1 Standard Deviation",hint:"1 Standard Deviation",value:Column.OperationType.SD1},{label:"2 Standard Deviation",hint:"2 Standard Deviation",value:Column.OperationType.SD2},{label:"3 Standard Deviation",hint:"3 Standard Deviation",value:Column.OperationType.SD3},{label:"1.5 IQR",hint:"1.5 Interquartile Range (IQR)",value:Column.OperationType.IQR}];res.ERROR_BAR_TYPE_OPTIONS_HASH=_createHash(res.ERROR_BAR_TYPE_OPTIONS);res.REFERENCE_LINE_RANGE_TYPE_OPTIONS=[{label:"Standard Error",hint:"Standard Error",value:Column.OperationType.STDERR},{label:"90% Conf. Interval",hint:"90% Confidence Interval",value:Column.OperationType.CONF_INTV_90},{label:"95% Conf. Interval",hint:"95% Confidence Interval",value:Column.OperationType.CONF_INTV_95},{label:"99% Conf. Interval",hint:"99% Confidence Interval",value:Column.OperationType.CONF_INTV_99},{label:"1 Standard Deviation",hint:"1 Standard Deviation",value:Column.OperationType.SD1},{label:"2 Standard Deviation",hint:"2 Standard Deviation",value:Column.OperationType.SD2},{label:"3 Standard Deviation",hint:"3 Standard Deviation",value:Column.OperationType.SD3},{label:"1.5 IQR",hint:"1.5 Interquartile Range (IQR)",value:Column.OperationType.IQR}];res.REFERENCE_LINE_RANGE_TYPE_OPTIONS_HASH=_createHash(res.REFERENCE_LINE_RANGE_TYPE_OPTIONS);res.EASYMAP_TYPE_OPTIONS=[{label:"Circle",value:"circle"},{label:"Area",value:"area"}];res.EASYMAP_TYPE_OPTIONS_HASH=_createHash(res.EASYMAP_TYPE_OPTIONS);res.ERROR_BAR_GRAPH_OPTIONS=[{label:"Bar",value:"bar"},{label:"Circle",value:"marker"}];res.ERROR_BAR_GRAPH_OPTIONS_HASH=_createHash(res.ERROR_BAR_GRAPH_OPTIONS);res.ERROR_BAR_CALC_TYPE_OPTIONS=[{label:"Mean",value:"mean"},{label:"Ratio (%)",value:"ratio"}];res.ERROR_BAR_CALC_TYPE_OPTIONS_HASH=_createHash(res.ERROR_BAR_CALC_TYPE_OPTIONS);res.ERROR_BAR_RATIO_DIRECTION_OPTIONS=[{value:"color",label:"X Axis"},{value:"x",label:"Color"},{value:"all",label:"All"}];res.ERROR_BAR_RATIO_DIRECTION_OPTIONS_HASH=_createHash(res.ERROR_BAR_RATIO_DIRECTION_OPTIONS);res.WINDOW_FUNCTION_CALC_TYPES=[{label:"(None)",value:"none",items:[{label:"(None)",hint:"none",value:Column.OperationType.NONE}]},{label:"Cumulative",value:"cum",itemLabel:"Summarize Values Using",items:[{label:"Sum",hint:"Cumulative Sum",value:Column.OperationType.CUMSUM},{label:"Sum Ratio",hint:"Cumulative Sum Ratio",value:Column.OperationType.PCT_CUMSUM},{label:"Mean (Average)",hint:"Cumulative Mean",value:Column.OperationType.CUMMEAN},{label:"Min Value",hint:"Cumulative Min",value:Column.OperationType.CUMMIN},{label:"Max Value",hint:"Cumulative Max",value:Column.OperationType.CUMMAX},{label:"Product",hint:"Cumulative Product",value:Column.OperationType.CUMPROD}]},{label:"% of",value:"total",itemLabel:"Summarize Values Using",items:[{label:"Sum (Total)",hint:"Sum (Total)",value:Column.OperationType.PCT_OF_TOTAL},{label:"Mean (Average)",hint:"Mean (Average)",value:Column.OperationType.PCT_OF_MEAN},{label:"Median",hint:"Median",value:Column.OperationType.PCT_OF_MEDIAN},{label:"Mode (Most Frequent)",hint:"Mode (Most Frequent)",value:Column.OperationType.PCT_OF_MODE},{label:"Min Value",hint:"Min",value:Column.OperationType.PCT_OF_MIN},{label:"Max Value",hint:"Max",value:Column.OperationType.PCT_OF_MAX},{label:"First Value",hint:"First",value:Column.OperationType.PCT_OF_FIRST},{label:"Last Value",hint:"Last",value:Column.OperationType.PCT_OF_LAST},{label:"Previous Value",hint:"Previous",value:Column.OperationType.PCT_OF_PREV},{label:"Next Value",hint:"Next",value:Column.OperationType.PCT_OF_NEXT}]},{label:"Difference From",value:"diff",itemLabel:"Difference from",items:[{label:"Mean (Average)",hint:"Difference from Mean",value:Column.OperationType.DIFF_FROM_MEAN},{label:"Median",hint:"Difference from Median",value:Column.OperationType.DIFF_FROM_MEDIAN},{label:"Mode (Most Frequent)",hint:"Difference from Mode",value:Column.OperationType.DIFF_FROM_MODE},{label:"Min Value",hint:"Difference from Min",value:Column.OperationType.DIFF_FROM_MIN},{label:"Max Value",hint:"Difference from Max",value:Column.OperationType.DIFF_FROM_MAX},{label:"First Value",hint:"Difference from First",value:Column.OperationType.DIFF_FROM_FIRST},{label:"Last Value",hint:"Difference from Last",value:Column.OperationType.DIFF_FROM_LAST},{label:"Previous Value",hint:"Difference from Previous",value:Column.OperationType.DIFF_FROM_PREV},{label:"Next Value",hint:"Difference from Next",value:Column.OperationType.DIFF_FROM_NEXT},{label:"Period Ago",hint:"Difference from Period Ago",value:Column.OperationType.DIFF_FROM_PERIOD},{label:"Specific Value",hint:"Difference from Specific Value",value:Column.OperationType.DIFF_FROM_CONST}]},{label:"% Difference From",value:"pdiff",itemLabel:"% Difference from",items:[{label:"Mean (Average)",hint:"% Difference from Mean",value:Column.OperationType.PCT_DIFF_FROM_MEAN},{label:"Median",hint:"% Difference from Median",value:Column.OperationType.PCT_DIFF_FROM_MEDIAN},{label:"Mode (Most Frequent)",hint:"% Difference from Mode",value:Column.OperationType.PCT_DIFF_FROM_MODE},{label:"Min Value",hint:"% Difference from Min",value:Column.OperationType.PCT_DIFF_FROM_MIN},{label:"Max Value",hint:"% Difference from Max",value:Column.OperationType.PCT_DIFF_FROM_MAX},{label:"First Value",hint:"% Difference from First",value:Column.OperationType.PCT_DIFF_FROM_FIRST},{label:"Last Value",hint:"% Difference from Last",value:Column.OperationType.PCT_DIFF_FROM_LAST},{label:"Previous Value",hint:"% Difference from Previous",value:Column.OperationType.PCT_DIFF_FROM_PREV},{label:"Next Value",hint:"% Difference from Next",value:Column.OperationType.PCT_DIFF_FROM_NEXT},{label:"Period Ago",hint:"% Difference from Period Ago",value:Column.OperationType.PCT_DIFF_FROM_PERIOD},{label:"Specific Value",hint:"% Difference from Specific Value",value:Column.OperationType.PCT_DIFF_FROM_CONST}]},{label:"Value Of",value:"valueof",itemLabel:"Value Of",items:[{label:"Previous Value",hint:"Previous Value",value:Column.OperationType.LAG},{label:"Next Value",hint:"Next Value",value:Column.OperationType.LEAD},{label:"Period Ago",hint:"Period Ago",value:Column.OperationType.LAG_FROM_PERIOD}]},{label:"Moving Calculation",value:"roll",itemLabel:"Summarize Values Using",items:[{label:"Sum",hint:"Moving Sum",value:Column.OperationType.ROLL_SUM},{label:"Mean (Average)",hint:"Moving Average",value:Column.OperationType.ROLL_MEAN},{label:"Median",hint:"Moving Median",value:Column.OperationType.ROLL_MEDIAN},{label:"Min Value",hint:"Moving Min",value:Column.OperationType.ROLL_MIN},{label:"Max Value",hint:"Moving Max",value:Column.OperationType.ROLL_MAX},{label:"Standard Deviation",hint:"Moving Standard Deviation",value:Column.OperationType.ROLL_SD},{label:"Variance",hint:"Moving Variance",value:Column.OperationType.ROLL_VAR},{label:"Product",hint:"Moving Product",value:Column.OperationType.ROLL_PROD}]},{label:"Rank",value:"rank",itemLabel:"Rank Type",items:[{label:"Min Rank (1,2,2,4)",hint:"Min Rank",value:Column.OperationType.MIN_RANK},{label:"Dense Rank (1,2,2,3)",hint:"Dense Rank",value:Column.OperationType.DENSE_RANK},{label:"Percent Rank (10,20,20,30)",hint:"Percent Rank",value:Column.OperationType.PCT_RANK}]}];res.OTHER_GROUP_OPTION_TYPE={NONE:"off",FCT_LUMP:"on",FCT_OTHER_KEEP_VALUES:"keep_values",FCT_OTHER_DROP_VALUES:"drop_values"};res.OTHER_GROUP_OPTIONS=[{label:"(None)",value:res.OTHER_GROUP_OPTION_TYPE.NONE},{label:"Less Frequent Values",value:res.OTHER_GROUP_OPTION_TYPE.FCT_LUMP},{label:"Selected Values",value:res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_DROP_VALUES},{label:"Not Selected Values",value:res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_KEEP_VALUES}];res.WINDOW_FUNCTION_CALC_TYPES_HIST=[res.WINDOW_FUNCTION_CALC_TYPES[0],res.WINDOW_FUNCTION_CALC_TYPES[2]];res.WINDOW_FUNCTION_CALC_TYPES_ERRBAR=[res.WINDOW_FUNCTION_CALC_TYPES[0],res.WINDOW_FUNCTION_CALC_TYPES[2]];res.WINDOW_FUNCTION_CALC_TYPES_PIVOT=[res.WINDOW_FUNCTION_CALC_TYPES[0],res.WINDOW_FUNCTION_CALC_TYPES[1],res.WINDOW_FUNCTION_CALC_TYPES[2],res.WINDOW_FUNCTION_CALC_TYPES[3],res.WINDOW_FUNCTION_CALC_TYPES[4],res.WINDOW_FUNCTION_CALC_TYPES[5],res.WINDOW_FUNCTION_CALC_TYPES[6]];res.DEFAULT_CATEG_COLOR_NUM_GROUPS=100;res.DEFAULT_FACET_NUM_GROUPS=20;res.DEFAULT_GROUP_BY_NUM_GROUPS=1e3;res.DEFAULT_PIVOT_NUM_GROUPS=1e3;res.DEFAULT_SCATTER_X_NUM_GROUPS=200;res.DEFAULT_SCATTER_Y_NUM_GROUPS=200;res.DEFAULT_SCATTER_Z_NUM_GROUPS=200;res.DEFAULT_HEATMAP_X_NUM_GROUPS=200;res.DEFAULT_HEATMAP_Y_NUM_GROUPS=200;res.DEFAULT_BUBBLE_X_NUM_GROUPS=200;res.DEFAULT_BUBBLE_Y_NUM_GROUPS=200;res.DEFAULT_BAR_X_NUM_GROUPS=100;res.DEFAULT_BAR_X_NUM_GROUPS_FOR_WARNING_DIALOG=1e3;res.DEFAULT_LINE_X_NUM_GROUPS=100;res.DEFAULT_AREA_X_NUM_GROUPS=100;res.DEFAULT_ERRBAR_X_NUM_GROUPS=100;res.DEFAULT_BOXPLOT_X_NUM_GROUPS=200;res.DEFAULT_VIOLIN_X_NUM_GROUPS=200;res.DEFAULT_WORDCLOUD_WORD_NUM_GROUPS=500;res.DEFAULT_NUM_GROUPS_GENERIC=20;res.getDefaultNumberOfGroups=function(marker,option){if(/^(color|categColor)$/.test(option)){return res.DEFAULT_CATEG_COLOR_NUM_GROUPS}else if(option==="facet"){return res.DEFAULT_FACET_NUM_GROUPS}else if(option==="groupby"){return res.DEFAULT_GROUP_BY_NUM_GROUPS}else if(/^(rowh|colh)/.test(option)){return res.DEFAULT_PIVOT_NUM_GROUPS}else if(option==="x"){switch(marker){case"heatmap":case"contour":return res.DEFAULT_HEATMAP_X_NUM_GROUPS;case"bubble":return res.DEFAULT_BUBBLE_X_NUM_GROUPS;case"scatter":return res.DEFAULT_SCATTER_X_NUM_GROUPS;case"bar":return res.DEFAULT_BAR_X_NUM_GROUPS;case"line":return res.DEFAULT_LINE_X_NUM_GROUPS;case"area":return res.DEFAULT_AREA_X_NUM_GROUPS;case"errbar":case"errbar-agg":return res.DEFAULT_ERRBAR_X_NUM_GROUPS;case"boxplot":return res.DEFAULT_BOXPLOT_X_NUM_GROUPS;case"violin":return res.DEFAULT_VIOLIN_X_NUM_GROUPS;case"r-wordcloud":return res.DEFAULT_WORDCLOUD_WORD_NUM_GROUPS}}else if(/^(y)/.test(option)){switch(marker){case"heatmap":case"contour":return res.DEFAULT_HEATMAP_Y_NUM_GROUPS;case"bubble":return res.DEFAULT_BUBBLE_Y_NUM_GROUPS;case"scatter":return res.DEFAULT_SCATTER_Y_NUM_GROUPS}}else if(option==="z"){return res.DEFAULT_SCATTER_Z_NUM_GROUPS}return res.DEFAULT_NUM_GROUPS_GENERIC};res.getDefaultNumberOfGroupsForUniqueValuesCheck=function(marker,option){if(["bar","errbar","errbar-agg"].includes(marker)&&option==="x"){return res.DEFAULT_BAR_X_NUM_GROUPS_FOR_WARNING_DIALOG}else{return res.getDefaultNumberOfGroups(marker,option)}};res.requireNumberOfUniqueValuesCheck=function(col,option,marker){if(col.func===Column.OperationType.AS_CATEGORY){return false}switch(option){case"color":switch(marker){case"heatmap":case"contour":case"map":case"geojson":case"scatter":case"violin":case"bubble":return true;default:return!/^r-/.test(marker)}case"x":switch(marker){case"r-wordcloud":return true;case"bubble":return VizUtil.returnsCharacterValue(col);default:return!/^(map$|maphmap$|hist$|densityplot$|scatter$|r-)/.test(marker)}case"y":switch(marker){case"heatmap":case"contour":return true;case"bubble":return VizUtil.returnsCharacterValue(col);default:return false}case"z":return false;case"facet":return true;case"groupby":return true}if(/^(pivot|summarytable)$/.test(marker)&&/^(rowh|colh)/.test(option)){return true}return false};res.getPostFilterDefaultNumberOfGroups=res.getDefaultNumberOfGroups;var _createCalcTypesHash=function(definitionArr){var obj={};definitionArr.forEach(function(item){obj[item.value]=item});return obj};res.WINDOW_FUNCTION_CALC_TYPES_HASH=_createCalcTypesHash(res.WINDOW_FUNCTION_CALC_TYPES);var _createCalcDetailTypesHash=function(definitionArr){var ht={};definitionArr.forEach(function(item){var detailHt={};item.items.forEach(function(x){detailHt[_getAggFuncNameFromWinFuncName(x.value)]=x.value});ht[item.value]=detailHt});return ht};var _getAggFuncNameFromWinFuncName=function(windowFuncValue){var aggFuncName=windowFuncValue==="ptotal"?"sum":windowFuncValue==="dfirst"?"first":windowFuncValue==="pdfirst"?"first":windowFuncValue==="pofmedian"?"med":/^roll/.test(windowFuncValue)?windowFuncValue.replace(/^roll/,""):/^pof/.test(windowFuncValue)?windowFuncValue.replace(/^pof/,""):/^df/.test(windowFuncValue)?windowFuncValue.replace(/^df/,""):/^pdf/.test(windowFuncValue)?windowFuncValue.replace(/^pdf/,""):/^cum/.test(windowFuncValue)?windowFuncValue.replace(/^cum/,""):windowFuncValue;return aggFuncName};res.getAggFuncNameFromWinFuncName=_getAggFuncNameFromWinFuncName;res.WINDOW_FUNCTION_CALC_DETAIL_TYPES_HASH=_createCalcDetailTypesHash(res.WINDOW_FUNCTION_CALC_TYPES);res.WINDOW_FUNCTION_OPTIONS=[{label:"(None)",value:Column.OperationType.NONE},{label:"Cumulative Sum",value:Column.OperationType.CUMSUM},{label:"Cumulative Sum Ratio",value:Column.OperationType.PCT_CUMSUM},{label:"Cumulative Mean",value:Column.OperationType.CUMMEAN},{label:"Cumulative Min",value:Column.OperationType.CUMMIN},{label:"Cumulative Max",value:Column.OperationType.CUMMAX},{label:"Cumulative Prod",value:Column.OperationType.CUMPROD},{label:"Cumulative All",value:Column.OperationType.CUMALL},{label:"Cumulative Any",value:Column.OperationType.CUMANY},{label:"% of Total",value:Column.OperationType.PCT_OF_TOTAL},{label:"% of First",value:Column.OperationType.PCT_OF_FIRST},{label:"% of Last",value:Column.OperationType.PCT_OF_LAST},{label:"% of Previous",value:Column.OperationType.PCT_OF_PREV},{label:"% of Next",value:Column.OperationType.PCT_OF_NEXT},{label:"% of Min",value:Column.OperationType.PCT_OF_MIN},{label:"% of Max",value:Column.OperationType.PCT_OF_MAX},{label:"% of Mean",value:Column.OperationType.PCT_OF_MEAN},{label:"% of Median",value:Column.OperationType.PCT_OF_MEDIAN},{label:"% of Mode",value:Column.OperationType.PCT_OF_MODE},{label:"Ratio of Total",value:Column.OperationType.RATIO_OF_TOTAL},{label:"Ratio of First",value:Column.OperationType.RATIO_OF_FIRST},{label:"Ratio of Last",value:Column.OperationType.RATIO_OF_LAST},{label:"Ratio of Previous",value:Column.OperationType.RATIO_OF_PREV},{label:"Ratio of Next",value:Column.OperationType.RATIO_OF_NEXT},{label:"Ratio of Min",value:Column.OperationType.RATIO_OF_MIN},{label:"Ratio of Max",value:Column.OperationType.RATIO_OF_MAX},{label:"Ratio of Mean",value:Column.OperationType.RATIO_OF_MEAN},{label:"Ratio of Median",value:Column.OperationType.RATIO_OF_MEDIAN},{label:"Ratio of Mode",value:Column.OperationType.RATIO_OF_MODE},{label:"Diff from Previous",value:Column.OperationType.DIFF_FROM_PREV},{label:"Diff from Next",value:Column.OperationType.DIFF_FROM_NEXT},{label:"Diff from First",value:Column.OperationType.DIFF_FROM_FIRST},{label:"Diff from Last",value:Column.OperationType.DIFF_FROM_LAST},{label:"Diff from Min",value:Column.OperationType.DIFF_FROM_MIN},{label:"Diff from Max",value:Column.OperationType.DIFF_FROM_MAX},{label:"Diff from Mean",value:Column.OperationType.DIFF_FROM_MEAN},{label:"Diff from Median",value:Column.OperationType.DIFF_FROM_MEDIAN},{label:"Diff from Mode",value:Column.OperationType.DIFF_FROM_MODE},{label:"Diff from Period Ago",value:Column.OperationType.DIFF_FROM_PERIOD},{label:"Diff from Constant",value:Column.OperationType.DIFF_FROM_CONST},{label:"Diff from Previous",value:Column.OperationType.DIFF_FROM_PREV_DATE},{label:"Diff from Next",value:Column.OperationType.DIFF_FROM_NEXT_DATE},{label:"Diff from First Row",value:Column.OperationType.DIFF_FROM_FIRST_DATE},{label:"Diff from Last Row",value:Column.OperationType.DIFF_FROM_LAST_DATE},{label:"Diff from First Date",value:Column.OperationType.DIFF_FROM_MIN_DATE},{label:"Diff from Last Date",value:Column.OperationType.DIFF_FROM_MAX_DATE},{label:"Diff from Mean",value:Column.OperationType.DIFF_FROM_MEAN_DATE},{label:"Diff from Median",value:Column.OperationType.DIFF_FROM_MEDIAN_DATE},{label:"Diff from Mode",value:Column.OperationType.DIFF_FROM_MODE_DATE},{label:"Diff from Constant",value:Column.OperationType.DIFF_FROM_CONST_DATE},{label:"% Diff from Previous",value:Column.OperationType.PCT_DIFF_FROM_PREV},{label:"% Diff from Next",value:Column.OperationType.PCT_DIFF_FROM_NEXT},{label:"% Diff from First",value:Column.OperationType.PCT_DIFF_FROM_FIRST},{label:"% Diff from Last",value:Column.OperationType.PCT_DIFF_FROM_LAST},{label:"% Diff from Min",value:Column.OperationType.PCT_DIFF_FROM_MIN},{label:"% Diff from Max",value:Column.OperationType.PCT_DIFF_FROM_MAX},{label:"% Diff from Mean",value:Column.OperationType.PCT_DIFF_FROM_MEAN},{label:"% Diff from Median",value:Column.OperationType.PCT_DIFF_FROM_MEDIAN},{label:"% Diff from Mode",value:Column.OperationType.PCT_DIFF_FROM_MODE},{label:"% Diff from Period Ago",value:Column.OperationType.PCT_DIFF_FROM_PERIOD},{label:"% Diff from Constant",value:Column.OperationType.PCT_DIFF_FROM_CONST},{label:"Diff from Previous (Ratio)",value:Column.OperationType.RATIO_DIFF_FROM_PREV},{label:"Diff from Next (Ratio)",value:Column.OperationType.RATIO_DIFF_FROM_NEXT},{label:"Diff from First (Ratio)",value:Column.OperationType.RATIO_DIFF_FROM_FIRST},{label:"Diff from Last (Ratio)",value:Column.OperationType.RATIO_DIFF_FROM_LAST},{label:"Diff from Min (Ratio)",value:Column.OperationType.RATIO_DIFF_FROM_MIN},{label:"Diff from Max (Ratio)",value:Column.OperationType.RATIO_DIFF_FROM_MAX},{label:"Diff from Mean (Ratio)",value:Column.OperationType.RATIO_DIFF_FROM_MEAN},{label:"Diff from Median (Ratio)",value:Column.OperationType.RATIO_DIFF_FROM_MEDIAN},{label:"Diff from Mode (Ratio)",value:Column.OperationType.RATIO_DIFF_FROM_MODE},{label:"Diff from Period Ago (Ratio)",value:Column.OperationType.RATIO_DIFF_FROM_PERIOD},{label:"Diff from Constant (Ratio)",value:Column.OperationType.RATIO_DIFF_FROM_CONST},{label:"Moving Average",value:Column.OperationType.ROLL_MEAN},{label:"Moving Min",value:Column.OperationType.ROLL_MIN},{label:"Moving Max",value:Column.OperationType.ROLL_MAX},{label:"Moving Median",value:Column.OperationType.ROLL_MEDIAN},{label:"Moving Standard Deviation",value:Column.OperationType.ROLL_SD},{label:"Moving Variance",value:Column.OperationType.ROLL_VAR},{label:"Moving Sum",value:Column.OperationType.ROLL_SUM},{label:"Moving Prod",value:Column.OperationType.ROLL_PROD},{label:"Min Rank",value:Column.OperationType.MIN_RANK},{label:"Dense Rank",value:Column.OperationType.DENSE_RANK},{label:"Percent Rank",value:Column.OperationType.PCT_RANK},{label:"Previous Value",value:Column.OperationType.LAG},{label:"Next Value",value:Column.OperationType.LEAD},{label:"Period Ago",value:Column.OperationType.LAG_FROM_PERIOD}];res.WINDOW_FUNCTION_OPTIONS_HASH=_createHash(res.WINDOW_FUNCTION_OPTIONS);res.REFERENCE_LINE_OPTIONS=[{label:"Sum",value:Column.OperationType.SUM},{label:"Mean",value:Column.OperationType.AVERAGE},{label:"Med.",value:Column.OperationType.MEDIAN},{label:"Mode (Most Frequent)",value:Column.OperationType.MODE},{label:"Min",value:Column.OperationType.MIN},{label:"Max",value:Column.OperationType.MAX},{label:"First",value:Column.OperationType.FIRST_EXCLUDE_NA},{label:"Last",value:Column.OperationType.LAST_EXCLUDE_NA},{label:"First",value:Column.OperationType.FIRST},{label:"Last",value:Column.OperationType.LAST},{label:"Diagonal",value:Column.OperationType.DIAGONAL},{label:"Specific Value",value:Column.OperationType.CONSTANT}];res.REFERENCE_LINE_OPTIONS_HASH=_createHash(res.REFERENCE_LINE_OPTIONS);res.TREND_LINE_OPTIONS=[{value:Column.OperationType.LM_FIT,label:"Linear Regression"},{value:Column.OperationType.LOESS_FIT,label:"Polynomial (Loess)"},{value:Column.OperationType.GAM_FIT,label:"Polynomial (GAM)"},{value:Column.OperationType.LOGISTIC_FIT,label:"Logistic Regression"},{value:Column.OperationType.POISSON_FIT,label:"Poisson Regression"}];res.TREND_LINE_OPTIONS_HASH=_createHash(res.TREND_LINE_OPTIONS);res.PIVOT_TOTAL_AGGREGATION_OPTIONS=[{value:"",label:"AUTO",shortLabel:"AUTO"},{value:Column.OperationType.SUM,label:"Sum",shortLabel:"SUM"},{value:Column.OperationType.AVERAGE,label:"Mean (Average)",shortLabel:"MEAN"},{value:Column.OperationType.MEDIAN,label:"Median",shortLabel:"MED"},{value:Column.OperationType.MODE,label:"Mode (Most Frequent)",shortLabel:"MODE"},{value:Column.OperationType.MIN,label:"Min Value",shortLabel:"MIN"},{value:Column.OperationType.MAX,label:"Max Value",shortLabel:"MAX"},{value:Column.OperationType.COUNT_DISTINCT,label:"Unique Count",shortLabel:"UNQ"},{value:Column.OperationType.COUNT,label:"Number of Rows",shortLabel:"CNT"}];res.PIVOT_TOTAL_AGGREGATION_OPTIONS_SHORT_NAME_HASH=_createHash(res.PIVOT_TOTAL_AGGREGATION_OPTIONS,"shortLabel");res.PIVOT_TOTAL_AGGREGATION_OPTIONS_HASH=_createHash(res.PIVOT_TOTAL_AGGREGATION_OPTIONS);res.PIVOT_MULTIPLE_TOTAL_AGGREGATION_OPTIONS=[{value:Column.OperationType.COUNT,label:"Number of Rows",plotLabel:"# Rows"},{value:Column.OperationType.COUNT_DISTINCT,label:"Unique Count",plotLabel:"Uniq."},{value:Column.OperationType.SUM,label:"Sum",plotLabel:"Sum"},{value:Column.OperationType.AVERAGE,label:"Mean (Average)",plotLabel:"Mean"},{value:Column.OperationType.MEDIAN,label:"Median",plotLabel:"Med."},{value:Column.OperationType.MODE,label:"Mode (Most Frequent)",plotLabel:"Mode"},{value:Column.OperationType.MIN,label:"Min Value",plotLabel:"Min"},{value:Column.OperationType.MAX,label:"Max Value",plotLabel:"Max"},{value:Column.OperationType.TRUE_RATIO,label:"TRUE Ratio",plotLabel:"TRUE Ratio"},{value:Column.OperationType.FALSE_RATIO,label:"FALSE Ratio",plotLabel:"FALSE Ratio"},{value:Column.OperationType.NA_RATIO,label:"NA Ratio",plotLabel:"NA Ratio"},{value:Column.OperationType.NON_NA_RATIO,label:"Not NA Ratio",plotLabel:"Not NA Ratio"}];res.PIVOT_MULTIPLE_TOTAL_AGGREGATION_OPTIONS_HASH=_createHash(res.PIVOT_MULTIPLE_TOTAL_AGGREGATION_OPTIONS);res.PIVOT_MULTIPLE_TOTAL_AGGREGATION_OPTIONS_PLOT_LABEL_HASH=_createHash(res.PIVOT_MULTIPLE_TOTAL_AGGREGATION_OPTIONS,"plotLabel");res.PIVOT_TOTAL_CALC_TIMING_OPTIONS=[{value:"before_aggregation",label:"Data Before Aggregation"},{value:"after_aggregation",label:"Data After Aggregation"}];res.PIVOT_TOTAL_CALC_TIMING_OPTIONS_HASH=_createHash(res.PIVOT_TOTAL_CALC_TIMING_OPTIONS);res.getDefaultPivotTotalCalcTiming=function(){return"after_aggregation"};res.POST_FILTER_AGGREGATION_MAP={};res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.SUM]=Column.OperationType.SUM;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.AVERAGE]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.MEDIAN]=Column.OperationType.MEDIAN;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.COUNT]=Column.OperationType.SUM;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.COUNT_DISTINCT]=Column.OperationType.SUM;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.MIN]=Column.OperationType.MIN;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.MAX]=Column.OperationType.MAX;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.DATE_MIN]=Column.OperationType.DATE_MIN;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.DATE_MAX]=Column.OperationType.DATE_MAX;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.FIRST]=Column.OperationType.FIRST;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.FIRST_EXCLUDE_NA]=Column.OperationType.FIRST_EXCLUDE_NA;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.LAST]=Column.OperationType.LAST;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.LAST_EXCLUDE_NA]=Column.OperationType.LAST_EXCLUDE_NA;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.SD1]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.SD2]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.SD3]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.VAR]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.IQR]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.MAD]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.MODE]=Column.OperationType.MODE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.NA_COUNT]=Column.OperationType.SUM;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.NA_PCT]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.NA_RATIO]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.NON_NA_COUNT]=Column.OperationType.SUM;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.NON_NA_PCT]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.NON_NA_RATIO]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.TRUE_COUNT]=Column.OperationType.SUM;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.FALSE_COUNT]=Column.OperationType.SUM;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.TRUE_PCT]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.FALSE_PCT]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.TRUE_RATIO]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.FALSE_RATIO]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.ODDS]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_OPTIONS=[{value:Column.OperationType.FIRST_EXCLUDE_NA,label:"First Value",shortLabel:"1ST"},{value:Column.OperationType.LAST_EXCLUDE_NA,label:"Last Value",shortLabel:"LAST"}];res.getDefaultPostFilterAggregationFunction=function(){return Column.OperationType.LAST_EXCLUDE_NA};var MAX_NUMBER_OF_CONTROLS={rowh:30,colh:1,meas:30,y:30,tcol:300,scattermatrix:50};res.MAX_NUMBER_OF_CONTROLS=MAX_NUMBER_OF_CONTROLS;res.AXIS_DIRECTION_OPTIONS=[{label:"Normal",value:"normal"},{label:"Reversed",value:"reversed"},{label:"Default",value:""}];res.BUCKET_TYPE_OPTIONS_HASH={};res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_EQUAL_WIDTH]="Equal Width";res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_EQUAL_STEP]="Equal Step";res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_EQUAL_FREQ]="Equal Frequency";res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_CUSTOM]="Manual";res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_OUTLIER]="Outliers";res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_LOGICALIZE]="Logical Condition";res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_OUTLIER_IQR]="1.5 IQR";res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_OUTLIER_PERCENTILE]="Percentile";res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_OUTLIER_SD]="Standard Deviation";res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.NONE]="None";res.BUCKET_TYPE_OPTIONS_NO_LOGICALIZE=[{value:Column.OperationType.BUCKET_EQUAL_WIDTH,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_EQUAL_WIDTH]},{value:Column.OperationType.BUCKET_EQUAL_FREQ,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_EQUAL_FREQ]},{value:Column.OperationType.BUCKET_EQUAL_STEP,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_EQUAL_STEP]},{value:Column.OperationType.BUCKET_CUSTOM,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_CUSTOM]},{value:Column.OperationType.BUCKET_OUTLIER,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_OUTLIER]}];res.BUCKET_TYPE_OPTIONS_NO_LOGICALIZE_EQUAL_STEP_DISABLED_WITH_NONE=[{value:Column.OperationType.NONE,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.NONE]},{value:Column.OperationType.BUCKET_EQUAL_WIDTH,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_EQUAL_WIDTH]},{value:Column.OperationType.BUCKET_EQUAL_FREQ,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_EQUAL_FREQ]},{value:Column.OperationType.BUCKET_EQUAL_STEP,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_EQUAL_STEP],disabled:true},{value:Column.OperationType.BUCKET_CUSTOM,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_CUSTOM]},{value:Column.OperationType.BUCKET_OUTLIER,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_OUTLIER]}];res.BUCKET_TYPE_OPTIONS=[{value:Column.OperationType.BUCKET_EQUAL_WIDTH,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_EQUAL_WIDTH]},{value:Column.OperationType.BUCKET_EQUAL_FREQ,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_EQUAL_FREQ]},{value:Column.OperationType.BUCKET_EQUAL_STEP,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_EQUAL_STEP]},{value:Column.OperationType.BUCKET_CUSTOM,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_CUSTOM]},{value:Column.OperationType.BUCKET_OUTLIER,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_OUTLIER]},{value:Column.OperationType.BUCKET_LOGICALIZE,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_LOGICALIZE]}];res.BUCKET_TYPE_OPTIONS_YAXIS=[{value:Column.OperationType.BUCKET_EQUAL_WIDTH,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_EQUAL_WIDTH]},{value:Column.OperationType.BUCKET_EQUAL_FREQ,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_EQUAL_FREQ]},{value:Column.OperationType.BUCKET_EQUAL_STEP,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_EQUAL_STEP],disabled:true},{value:Column.OperationType.BUCKET_CUSTOM,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_CUSTOM]},{value:Column.OperationType.BUCKET_OUTLIER,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_OUTLIER]},{value:Column.OperationType.BUCKET_LOGICALIZE,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_LOGICALIZE]}];res.BUCKET_TYPE_OPTIONS_CATEGORY=[{value:Column.OperationType.NONE,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.NONE]},{value:Column.OperationType.BUCKET_LOGICALIZE,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_LOGICALIZE]}];res.BUCKET_TYPE_OPTIONS_CATEGORY_HASH=_createHash(res.BUCKET_TYPE_OPTIONS_CATEGORY);res.BUCKET_TYPE_OPTIONS_DISCRETE_NUMERIC=[{value:Column.OperationType.NONE,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.NONE]},{value:Column.OperationType.BUCKET_CUSTOM,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_CUSTOM]},{value:Column.OperationType.BUCKET_LOGICALIZE,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_LOGICALIZE]}];res.BUCKET_TYPE_OPTIONS_DISCRETE_NUMERIC_HASH=_createHash(res.BUCKET_TYPE_OPTIONS_DISCRETE_NUMERIC);res.BUCKET_TYPE_OPTIONS_DISCRETE_NUMERIC_NO_LOGICALIZE=[{value:Column.OperationType.NONE,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.NONE]},{value:Column.OperationType.BUCKET_CUSTOM,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_CUSTOM]}];res.BUCKET_TYPE_OPTIONS_DISCRETE_NUMERIC_NO_LOGICALIZE_HASH=_createHash(res.BUCKET_TYPE_OPTIONS_DISCRETE_NUMERIC_NO_LOGICALIZE);res.BUCKET_OUTLIER_OPTIONS=[{value:Column.OperationType.BUCKET_OUTLIER_IQR,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_OUTLIER_IQR]},{value:Column.OperationType.BUCKET_OUTLIER_PERCENTILE,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_OUTLIER_PERCENTILE]},{value:Column.OperationType.BUCKET_OUTLIER_SD,label:res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_OUTLIER_SD]}];res.BUCKET_OUTLIER_OPTIONS_HASH=_createHash(res.BUCKET_OUTLIER_OPTIONS);res.LOGICALIZE_OPERATOR={EQUAL_TO:"equalTo",NOT_EQUAL_TO:"notEqualTo",IS_IN:"in",IS_NOT_IN:"notIn",LESS_THAN:"lessThan",LESS_THAN_OR_EQUAL_TO:"lessThanOrEqualTo",GREATER_THAN:"greaterThan",GREATER_THAN_OR_EQUAL_TO:"greaterThanOrEqualTo",BETWEEN:"between",NOT_BETWEEN:"notBetween",IS_NA:"isNA",IS_NOT_NA:"isNotNA",IS_OUTLIER:"isOutlier",IS_OUTLIER_SD:"isOutlier_sd",IS_OUTLIER_PERCENTILE:"isOutlier_pct",IS_OUTLIER_IQR:"isOutlier_iqr",IS_NOT_OUTLIER:"isNotOutlier",IS_NOT_OUTLIER_SD:"isNotOutlier_sd",IS_NOT_OUTLIER_PERCENTILE:"isNotOutlier_pct",IS_NOT_OUTLIER_IQR:"isNotOutlier_iqr",START_WITH:"startsWith",NOT_START_WITH:"notStartWith",END_WITH:"endsWith",NOT_END_WITH:"notEndWith",CONTAIN:"contains",NOT_CONTAIN:"notContain",IS_EMPTY:"isEmpty",IS_NOT_EMPTY:"isNotEmpty",IS_STOPWORD:"isStopword",IS_NOT_STOPWORD:"isNotStopword",IS_ALPHABET:"isAlphabet",IS_NOT_ALPHABET:"isNotAlphabet",RELATIVE_DATES:"relativeDates",IS_TRUE:"isTRUE",IS_FALSE:"isFALSE"};res.BUCKET_LOGICAL_OPTIONS_FOR_NUMERIC=[{label:"Equal To",value:res.LOGICALIZE_OPERATOR.EQUAL_TO},{label:"Not Equal To",value:res.LOGICALIZE_OPERATOR.NOT_EQUAL_TO},{label:"Is In (Multiple Values)",value:res.LOGICALIZE_OPERATOR.IS_IN},{label:"Is Not In (Multiple Values)",value:res.LOGICALIZE_OPERATOR.IS_NOT_IN},{label:"Less Than",value:res.LOGICALIZE_OPERATOR.LESS_THAN},{label:"Less Than or Equal To",value:res.LOGICALIZE_OPERATOR.LESS_THAN_OR_EQUAL_TO},{label:"Greater Than",value:res.LOGICALIZE_OPERATOR.GREATER_THAN},{label:"Greater Than or Equal To",value:res.LOGICALIZE_OPERATOR.GREATER_THAN_OR_EQUAL_TO},{label:"Between",value:res.LOGICALIZE_OPERATOR.BETWEEN},{label:"Not Between",value:res.LOGICALIZE_OPERATOR.NOT_BETWEEN},{label:"Not NA",value:res.LOGICALIZE_OPERATOR.IS_NOT_NA},{label:"Is NA",value:res.LOGICALIZE_OPERATOR.IS_NA},{label:"Not Outliers",value:res.LOGICALIZE_OPERATOR.IS_NOT_OUTLIER},{label:"Is Outliers",value:res.LOGICALIZE_OPERATOR.IS_OUTLIER}];res.BUCKET_LOGICAL_OPTIONS_FOR_NUMERIC_HASH=_createHash(res.BUCKET_LOGICAL_OPTIONS_FOR_NUMERIC);res.BUCKET_LOGICAL_OPTIONS_FOR_CHARACTER=[{label:"Equal To",value:res.LOGICALIZE_OPERATOR.EQUAL_TO},{label:"Not Equal To",value:res.LOGICALIZE_OPERATOR.NOT_EQUAL_TO},{label:"Is In (Multiple Values)",value:res.LOGICALIZE_OPERATOR.IS_IN},{label:"Is Not In (Multiple Values)",value:res.LOGICALIZE_OPERATOR.IS_NOT_IN},{label:"Starts With",value:res.LOGICALIZE_OPERATOR.START_WITH},{label:"Not Start With",value:res.LOGICALIZE_OPERATOR.NOT_START_WITH},{label:"Ends With",value:res.LOGICALIZE_OPERATOR.END_WITH},{label:"Not End With",value:res.LOGICALIZE_OPERATOR.NOT_END_WITH},{label:"Contains",value:res.LOGICALIZE_OPERATOR.CONTAIN},{label:"Not Contain",value:res.LOGICALIZE_OPERATOR.NOT_CONTAIN},{label:"Is NA",value:res.LOGICALIZE_OPERATOR.IS_NA},{label:"Not NA",value:res.LOGICALIZE_OPERATOR.IS_NOT_NA},{label:"Keep Only Empty",value:res.LOGICALIZE_OPERATOR.IS_EMPTY},{label:"Remove Empty",value:res.LOGICALIZE_OPERATOR.IS_NOT_EMPTY},{label:"Keep Only Stopword",value:res.LOGICALIZE_OPERATOR.IS_STOPWORD},{label:"Remove Stopword",value:res.LOGICALIZE_OPERATOR.IS_NOT_STOPWORD},{label:"Keep Only Alphabet",value:res.LOGICALIZE_OPERATOR.IS_ALPHABET},{label:"Remove Alphabet",value:res.LOGICALIZE_OPERATOR.IS_NOT_ALPHABET}];res.BUCKET_LOGICAL_OPTIONS_FOR_CHARACTER_HASH=_createHash(res.BUCKET_LOGICAL_OPTIONS_FOR_CHARACTER);res.BUCKET_LOGICAL_OPTIONS_FOR_DATE=[{label:"<Relative Dates>",value:res.LOGICALIZE_OPERATOR.RELATIVE_DATES},{label:"Equal To",value:res.LOGICALIZE_OPERATOR.EQUAL_TO},{label:"Not Equal To",value:res.LOGICALIZE_OPERATOR.NOT_EQUAL_TO},{label:"Is In (Multiple Values)",value:res.LOGICALIZE_OPERATOR.IS_IN},{label:"Is Not In (Multiple Values)",value:res.LOGICALIZE_OPERATOR.IS_NOT_IN},{label:"Earlier Than",value:res.LOGICALIZE_OPERATOR.LESS_THAN},{label:"Earlier Than or Equal To",value:res.LOGICALIZE_OPERATOR.LESS_THAN_OR_EQUAL_TO},{label:"Later Than",value:res.LOGICALIZE_OPERATOR.GREATER_THAN},{label:"Later Than or Equal To",value:res.LOGICALIZE_OPERATOR.GREATER_THAN_OR_EQUAL_TO},{label:"Between",value:res.LOGICALIZE_OPERATOR.BETWEEN},{label:"Not Between",value:res.LOGICALIZE_OPERATOR.NOT_BETWEEN},{label:"Is NA",value:res.LOGICALIZE_OPERATOR.IS_NA},{label:"Not NA",value:res.LOGICALIZE_OPERATOR.IS_NOT_NA}];res.BUCKET_LOGICAL_OPTIONS_FOR_DATE_HASH=_createHash(res.BUCKET_LOGICAL_OPTIONS_FOR_DATE);res.BUCKET_LOGICAL_OPTIONS_FOR_LOGICAL=[{label:"Is TRUE",value:res.LOGICALIZE_OPERATOR.IS_TRUE},{label:"Is FALSE",value:res.LOGICALIZE_OPERATOR.IS_FALSE},{label:"Not NA",value:res.LOGICALIZE_OPERATOR.IS_NOT_NA},{label:"Is NA",value:res.LOGICALIZE_OPERATOR.IS_NA}];res.BUCKET_LOGICAL_OPTIONS_FOR_LOGICAL_HASH=_createHash(res.BUCKET_LOGICAL_OPTIONS_FOR_LOGICAL);res.STOPWORD_LANG_LIST=[{label:"English",value:"english"},{label:"Arabic",value:"arabic"},{label:"Catalan",value:"catalan"},{label:"Czech",value:"czech"},{label:"Chinese",value:"chinese"},{label:"Danish",value:"danish"},{label:"Dutch",value:"dutch"},{label:"Estonian",value:"estonian"},{label:"Finnish",value:"finnish"},{label:"French",value:"french"},{label:"German",value:"german"},{label:"Greek",value:"greek"},{label:"Hebrew",value:"hebrew"},{label:"Hindi",value:"hindi"},{label:"Hungarian",value:"hungarian"},{label:"Indonesian",value:"indonesian"},{label:"Italian",value:"italian"},{label:"Japanese",value:"japanese"},{label:"Korean",value:"korean"},{label:"Latvian",value:"latvian"},{label:"Norwegian",value:"norwegian"},{label:"Polish",value:"polish"},{label:"Portuguese",value:"portuguese"},{label:"Romanian",value:"romanian"},{label:"Russian",value:"russian"},{label:"Slovak",value:"slovak"},{label:"Slovenian",value:"slovenian"},{label:"Spanish",value:"spanish"},{label:"Swedish",value:"swedish"},{label:"Tamil",value:"tamil"},{label:"Turkish",value:"turkish"},{label:"Ukrainian",value:"ukrainian"},{label:"Vietnamese",value:"vietnamese"}];res.STOPWORD_LANG_LIST_HT=_createHash(res.STOPWORD_LANG_LIST);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_YEAR=[{label:"Previous Year",value:"previous"},{label:"This Year",value:"this"},{label:"Next Year",value:"next"},{label:"Last N Years",value:"last_n"},{label:"Last N Years (Exclude This Year)",value:"last_n_exclude_this_year"},{label:"Last N Years (Exclude This Quarter)",value:"last_n_exclude_this_quarter"},{label:"Last N Years (Exclude This Month)",value:"last_n_exclude_this_month"},{label:"Last N Years (Exclude This Week)",value:"last_n_exclude_this_week"},{label:"Last N Years (Exclude Today)",value:"last_n_exclude_today"},{label:"Next N Years",value:"next_n"},{label:"Year To Date",value:"x_to_date"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_YEAR_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_YEAR);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_QUARTER=[{label:"Previous Quarter",value:"previous"},{label:"This Quarter",value:"this"},{label:"Next Quarter",value:"next"},{label:"Last N Quarters",value:"last_n"},{label:"Last N Quarters (Exclude This Quarter)",value:"last_n_exclude_this_quarter"},{label:"Last N Quarters (Exclude This Month)",value:"last_n_exclude_this_month"},{label:"Last N Quarters (Exclude This Week)",value:"last_n_exclude_this_week"},{label:"Last N Quarters (Exclude Today)",value:"last_n_exclude_today"},{label:"Next N Quarters",value:"next_n"},{label:"Quarter To Date",value:"x_to_date"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_QUARTER_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_QUARTER);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_MONTH=[{label:"Previous Month",value:"previous"},{label:"This Month",value:"this"},{label:"Next Month",value:"next"},{label:"Last N Months",value:"last_n"},{label:"Last N Months (Exclude This Month)",value:"last_n_exclude_this_month"},{label:"Last N Months (Exclude This Week)",value:"last_n_exclude_this_week"},{label:"Last N Months (Exclude Today)",value:"last_n_exclude_today"},{label:"Next N Months",value:"next_n"},{label:"Month To Date",value:"x_to_date"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_MONTH_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_MONTH);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_WEEK=[{label:"Previous Week",value:"previous"},{label:"This Week",value:"this"},{label:"Next Week",value:"next"},{label:"Last N Weeks",value:"last_n"},{label:"Last N Weeks (Exclude This Week)",value:"last_n_exclude_this_week"},{label:"Last N Weeks (Exclude Today)",value:"last_n_exclude_today"},{label:"Next N Weeks",value:"next_n"},{label:"Week To Date",value:"x_to_date"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_WEEK_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_WEEK);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_DAY=[{label:"Yesterday",value:"previous"},{label:"Today",value:"this"},{label:"Tomorrow",value:"next"},{label:"Last N Days",value:"last_n"},{label:"Last N Days (Exclude Today)",value:"last_n_exclude_today"},{label:"Next N Days",value:"next_n"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_DAY_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_DAY);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_HOUR=[{label:"Previous Hour",value:"previous"},{label:"This Hour",value:"this"},{label:"Next Hour",value:"next"},{label:"Last N Hours",value:"last_n"},{label:"Next N Hours",value:"next_n"},{label:"Hour To Date",value:"x_to_date"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_HOUR_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_HOUR);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_MINUTE=[{label:"Previous Minute",value:"previous"},{label:"This Minute",value:"this"},{label:"Next Minute",value:"next"},{label:"Last N Minutes",value:"last_n"},{label:"Next N Minutes",value:"next_n"},{label:"Minute To Date",value:"x_to_date"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_MINUTE_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_MINUTE);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_DATE=[{label:"Date (e.g. 2020-10-15)",value:"specificDate"},{label:"Year (e.g. 2020)",value:"specificYear"},{label:"Half Year (1-2)",value:"specificHalfYear"},{label:"Quarter (1-4)",value:"specificQuarter"},{label:"Bi-Month (1-6)",value:"specificBiMonth"},{label:"Month - Number (1-12)",value:"specificMonth"},{label:"Month Name - Short (Jan-Dec)",value:"specificMonthName"},{label:"Week of Year (1-52) - 1st Day Start",value:"specificWeek"},{label:"Week of Year (1-52) - Sunday Start",value:"specificWeekSundayStart"},{label:"Week of Year (1-52) - Monday Start",value:"specificWeekMondayStart"},{label:"Day of Year (1-365)",value:"specificYearDay"},{label:"Day of Quarter (1-92)",value:"specificQuarterDay"},{label:"Day of Month (1-31)",value:"specificDay"},{label:"Day of Week - Number (1-7)",value:"specificDayNumber"},{label:"Day of Week - Short Name (Mon-Sun)",value:"specificDayName"},{label:"Year / Month",value:"specificYearMonth"},{label:"This Year",value:"currentYear"},{label:"This Quarter",value:"currentQuarter"},{label:"This Month",value:"currentMonth"},{label:"This Week",value:"currentWeek"},{label:"Today",value:"today"},{label:"Days Ago",value:"nDaysAgo"},{label:"Weeks Ago",value:"nWeeksAgo"},{label:"Months Ago",value:"nMonthsAgo"},{label:"Years Ago",value:"nYearsAgo"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_DATE_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_DATE);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_POSIXCT=[{label:"Date (e.g. 2020-10-15)",value:"specificDate"},{label:"Year (e.g. 2020)",value:"specificYear"},{label:"Half Year (1-2)",value:"specificHalfYear"},{label:"Quarter (1-4)",value:"specificQuarter"},{label:"Bi-Month (1-6)",value:"specificBiMonth"},{label:"Month - Number (1-12)",value:"specificMonth"},{label:"Month Name - Short (Jan-Dec)",value:"specificMonthName"},{label:"Week of Year (1-52) - 1st Day Start",value:"specificWeek"},{label:"Week of Year (1-52) - Sunday Start",value:"specificWeekSundayStart"},{label:"Week of Year (1-52) - Monday Start",value:"specificWeekMondayStart"},{label:"Day of Year (1-365)",value:"specificYearDay"},{label:"Day of Quarter (1-92)",value:"specificQuarterDay"},{label:"Day of Month (1-31)",value:"specificDay"},{label:"Day of Week - Number (1-7)",value:"specificDayNumber"},{label:"Day of Week - Short Name (Mon-Sun)",value:"specificDayName"},{label:"Hour",value:"specificHour"},{label:"Minute",value:"specificMinute"},{label:"Second",value:"specificSecond"},{label:"Year / Month",value:"specificYearMonth"},{label:"This Year",value:"currentYear"},{label:"This Quarter",value:"currentQuarter"},{label:"This Month",value:"currentMonth"},{label:"This Week",value:"currentWeek"},{label:"Today",value:"today"},{label:"Current Hour",value:"currentHour"},{label:"Current Minute",value:"currentMinute"},{label:"Previous Period",value:"previousPeriod"},{label:"Days Ago",value:"nDaysAgo"},{label:"Weeks Ago",value:"nWeeksAgo"},{label:"Months Ago",value:"nMonthsAgo"},{label:"Years Ago",value:"nYearsAgo"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_POSIXCT_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_POSIXCT);res.LOGICALIZE_DATE_TYPE_LIST_FOR_MULTI_DATE=[{label:"Year (e.g. 2020)",value:"years"},{label:"Quarter (1-4)",value:"quarters"},{label:"Bi-Month (1-6)",value:"bi_months"},{label:"Month - Number (1-12)",value:"months"},{label:"Month - Short Name (Jan-Dec)",value:"month_names"},{label:"Week of Year (1-52) - 1st Day Start",value:"weeks"},{label:"Week of Year (1-52) - Sunday Start",value:"specificWeekSundayStart"},{label:"Week of Year (1-52) - Monday Start",value:"specificWeekMondayStart"},{label:"Day of Year (1-365)",value:"year_days"},{label:"Day of Quarter (1-92)",value:"quarter_days"},{label:"Day of Month (1-31)",value:"days"},{label:"Day of Week - Number (1-7)",value:"day_numbers"},{label:"Day of Week - Short Name (Mon-Sun)",value:"weekdays"},{label:"Year / Month",value:"month_year"},{label:"Dates",value:"individual_days"}];res.LOGICALIZE_DATE_TYPE_LIST_FOR_MULTI_DATE_HT=_createHash(res.LOGICALIZE_DATE_TYPE_LIST_FOR_MULTI_DATE);res.LOGICALIZE_DATE_TYPE_LIST_FOR_MULTI_POSIXCT=[{label:"Year (e.g. 2020)",value:"years"},{label:"Quarter (1-4)",value:"quarters"},{label:"Bi-Month (1-6)",value:"bi_months"},{label:"Month - Number (1-12)",value:"months"},{label:"Month - Short Name (Jan-Dec)",value:"month_names"},{label:"Week of Year (1-52) - 1st Day Start",value:"weeks"},{label:"Week of Year (1-52) - Sunday Start",value:"specificWeekSundayStart"},{label:"Week of Year (1-52) - Monday Start",value:"specificWeekMondayStart"},{label:"Day of Year (1-365)",value:"year_days"},{label:"Day of Quarter (1-92)",value:"quarter_days"},{label:"Day of Month (1-31)",value:"days"},{label:"Day of Week - Number (1-7)",value:"day_numbers"},{label:"Day of Week - Short Name (Mon-Sun)",value:"weekdays"},{label:"Year / Month",value:"month_year"},{label:"Hour",value:"hours"},{label:"Minute",value:"minutes"},{label:"Second",value:"seconds"},{label:"Dates",value:"individual_days"}];res.LOGICALIZE_DATE_TYPE_LIST_FOR_MULTI_POSIXCT_HT=_createHash(res.LOGICALIZE_DATE_TYPE_LIST_FOR_MULTI_POSIXCT);res.LOGICALIZE_DATE_TYPE_LIST_FOR_RELATIVE_DATE=[{label:"Year",value:"year"},{label:"Quarter",value:"quarter"},{label:"Month",value:"month"},{label:"Week",value:"week"},{label:"Day",value:"day"}];res.LOGICALIZE_DATE_TYPE_LIST_FOR_RELATIVE_DATE_HT=_createHash(res.LOGICALIZE_DATE_TYPE_LIST_FOR_RELATIVE_DATE);res.LOGICALIZE_DATE_TYPE_LIST_FOR_RELATIVE_POSIXCT=[{label:"Year",value:"year"},{label:"Quarter",value:"quarter"},{label:"Month",value:"month"},{label:"Week",value:"week"},{label:"Day",value:"day"},{label:"Hour",value:"hour"},{label:"Minute",value:"minute"}];res.LOGICALIZE_DATE_TYPE_LIST_FOR_RELATIVE_POSIXCT_HT=_createHash(res.LOGICALIZE_DATE_TYPE_LIST_FOR_RELATIVE_POSIXCT);res.CONDITIONAL_AGGREGATIONS=[Column.OperationType.SUM_IF,Column.OperationType.SUM_IF_RATIO,Column.OperationType.MEAN_IF,Column.OperationType.MEDIAN_IF,Column.OperationType.MIN_IF,Column.OperationType.MAX_IF,Column.OperationType.COUNT_IF,Column.OperationType.COUNT_IF_RATIO,Column.OperationType.COUNT_DISTINCT_IF,Column.OperationType.COUNT_DISTINCT_IF_RATIO,Column.OperationType.DATE_MEDIAN_IF,Column.OperationType.DATE_MIN_IF,Column.OperationType.DATE_MAX_IF];res.isConditionalAggregation=function(func){return res.CONDITIONAL_AGGREGATIONS.indexOf(func)>-1};res.getBucketType=function(opId,options){var bucketType=options[opId+"BucketType"];var col=options[opId];if(!bucketType){if(!opId){bucketType=Column.OperationType.BUCKET_EQUAL_WIDTH}else{if(!col){bucketType=Column.OperationType.NONE}else{if(opId==="color"&&VizUtil.isNumericAsDiscreteValueOnColor(options)){bucketType=Column.OperationType.NONE}else if(VizUtil.returnsNumericValue(col)&&col.func===Column.OperationType.AS_CATEGORY){bucketType=Column.OperationType.BUCKET_EQUAL_WIDTH}else if(VizUtil.returnsNumericValue(col)&&options.colorbucket){bucketType=Column.OperationType.BUCKET_EQUAL_WIDTH}else{bucketType=Column.OperationType.NONE}}}}else{if(opId&&col){if(VizUtil.returnsNumericValue(col)&&col.func===Column.OperationType.AS_CATEGORY||VizUtil.returnsNumericValue(col)&&options.colorbucket){}else if(opId==="color"&&VizUtil.isNumericAsDiscreteValueOnColor(options)){if(!VizUtil.BUCKET_TYPE_OPTIONS_DISCRETE_NUMERIC_HASH[bucketType]){bucketType=Column.OperationType.NONE}}else{switch(bucketType){case Column.OperationType.BUCKET_EQUAL_WIDTH:case Column.OperationType.BUCKET_EQUAL_STEP:case Column.OperationType.BUCKET_EQUAL_FREQ:case Column.OperationType.BUCKET_CUSTOM:case Column.OperationType.BUCKET_OUTLIER:case Column.OperationType.BUCKET_KMEANS:bucketType=Column.OperationType.NONE;break;case Column.OperationType.BUCKET_LOGICALIZE:default:break}}}}if(bucketType===Column.OperationType.BUCKET_OUTLIER){bucketType=options[opId+"BucketOutlierType"]||Column.OperationType.BUCKET_OUTLIER_IQR}return bucketType};res.useExtraBucketsForOutsideRangeValues=function(vizOptions,opId){if(res.getBucketType(opId,vizOptions)==="bucket_equal_width"&&vizOptions[opId+"BucketIncludeOutsideRange"]!=="off"&&(vizOptions[opId+"BucketLowerRange"]||vizOptions[opId+"BucketUpperRange"])){return true}return false};res.getOptions=function(vizOptionsJson,option){var i=0,res=[],max=MAX_NUMBER_OF_CONTROLS[option];if(option==="tcol"){max=vizOptionsJson.tableMaxNumCol?parseInt(vizOptionsJson.tableMaxNumCol):MAX_NUMBER_OF_CONTROLS.tcol}if(vizOptionsJson.marker==="scattermatrix"&&option==="y"){max=MAX_NUMBER_OF_CONTROLS["scattermatrix"]}if(max===undefined){throw new Error("not supported case")}else{for(i=0;i<max;i++){if(i===0&&option==="y"){res.push(vizOptionsJson[option])}else{res.push(vizOptionsJson[option+i])}}while(res.length>0&&!res[res.length-1]){res.pop()}return res}};res.getValidFunctionListForPivotMultipleTotal=function(measOps,pivotTotalCalcTiming){var isAllLogical=!measOps.some(function(m){return m.type!=="logical"});var includeCategory=measOps.some(function(m){if(pivotTotalCalcTiming==="before_aggregation"){return!res.isNumeric(m.type)&&m.type!=="numrows"}else{return!res.returnsNumericValue(m)}});var includeCustsom=measOps.some(function(m){return m.type==="custom"});var isRatioApplicable=pivotTotalCalcTiming==="before_aggregation";if(includeCustsom){return pivotTotalCalcTiming==="before_aggregation"?[Column.OperationType.COUNT]:[Column.OperationType.COUNT,Column.OperationType.COUNT_DISTINCT,Column.OperationType.MODE,Column.OperationType.SUM,Column.OperationType.AVERAGE,Column.OperationType.MEDIAN,Column.OperationType.MIN,Column.OperationType.MAX]}var list=[Column.OperationType.COUNT,Column.OperationType.COUNT_DISTINCT,Column.OperationType.MODE];if(isRatioApplicable){list.push(Column.OperationType.NA_RATIO);list.push(Column.OperationType.NON_NA_RATIO)}if(!includeCategory){list.push(Column.OperationType.SUM);list.push(Column.OperationType.AVERAGE);list.push(Column.OperationType.MEDIAN);list.push(Column.OperationType.MIN);list.push(Column.OperationType.MAX)}if(isAllLogical&&isRatioApplicable){list.push(Column.OperationType.TRUE_RATIO);list.push(Column.OperationType.FALSE_RATIO)}return list};res.validatePivotMultipleTotalOptions=function(pivotColTotalAggregations,measOps,pivotTotalCalcTiming){if(!pivotColTotalAggregations){return null}var list=res.getValidFunctionListForPivotMultipleTotal(measOps,pivotTotalCalcTiming);var newValue=pivotColTotalAggregations.filter(function(f){return list.includes(f.value)});return newValue};var _createNameHash=function(arr){var obj={};arr.forEach(function(item){obj[item.value]=item});return obj};res.QUANT_COLOR_PALETTES_BASE=[{value:"Blues",label:"Blue",color:["#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],textColor:["","","","#fff","#fff"],sampleColor:["#c6dbef","#afd0e7","#98c5e1","#82badb","#6baed6","#4292c6","#2171b5","#08519c","#084594","#08306b"]},{value:"Greens",label:"Green",color:["#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],textColor:["","","","#fff","#fff"],sampleColor:["#c7e9c0","#b2e0ac","#9ed799","#89ce87","#74c476","#41ab5d","#238b45","#006d2c","#005a32","#00441b"]},{value:"Oranges",label:"Orange",color:["#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],textColor:["","","","#fff","#fff"],sampleColor:["#fdd0a2","#fec088","#feb06f","#fe9f56","#fd8d3c","#f16913","#d94801","#a63603","#8c2d04","#7f2704"]},{value:"Purples",label:"Purple",color:["#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],textColor:["","","","#fff","#fff"],sampleColor:["#dadaeb","#cacae3","#bbbada","#acaad1","#9e9ac8","#807dba","#6a51a3","#54278f","#4a1486","#3f007d"]},{value:"Reds",label:"Red",color:["#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],textColor:["","","","#fff","#fff"],sampleColor:["#fcbba1","#fda88b","#fd9575","#fc8060","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#99000d","#67000d"]},{value:"Greys",label:"Gray",color:["#d9d9d9","#bdbdbd","#969696","#636363","#252525"],textColor:["","","","#fff","#fff"],sampleColor:["#d9d9d9","#d2d2d2","#cbcbcb","#c4c4c4","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},{value:"Viridis",label:"Viridis",color:["#FDE725","#5DC863","#21908C","#3B528B","#440154"],textColor:["","","#fff","#fff","#fff"],sampleColor:["#FDE725","#B4DE2C","#6DCD59","#35B779","#1F9E89","#26828E","#31688E","#3E4A89","#482878","#440154"]},{value:"YlGn",label:"Yellow-Green",color:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],textColor:["","","","#fff","#fff"],sampleColor:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#005a32","#004529"]},{value:"YlGnBu",label:"Yellow-Green-Blue",color:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],textColor:["","","","#fff","#fff"],sampleColor:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#0c2c84","#081d58"]},{value:"YlOrBr",label:"Yellow-Orange-Brown",color:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],textColor:["","","","#fff","#fff"],sampleColor:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#8c2d04","#662506"]},{value:"YlOrRd",label:"Yellow-Orange-Red",color:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],textColor:["","","","#fff","#fff"],sampleColor:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#b10026","#800026"]},{value:"RdBu",label:"Red-Blue",color:["#050bac","#6a89f7","#bebebe","#e6925a","#b20a1b"],textColor:["#fff","","","","#fff"]},{value:"RdLb",label:"Red-Light Blue",color:["#4A90E2","#b3cae4","#e1e1e1","#de919e","#e7430c"],textColor:["#fff","","","","#fff"]},{value:"RdYlBu",label:"Red-Yellow-Blue Diverging",color:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],textColor:["#fff","","","","#fff"]},{value:"RdYlGn",label:"Red-Yellow Green Diverging",color:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],textColor:["#fff","","","","#fff"]}];res.CATEG_COLOR_PALETTES_BASE=[{value:"default",label:"Palette 1",color:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Paired",label:"Palette 2",color:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Pastel1",label:"Palette 3",color:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],textColor:["#000","#000","#000","#000","#000","#000","#000","#000"]},{value:"Pastel2",label:"Palette 4",color:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],textColor:["#000","#000","#000","#000","#000","#000","#000","#000"]},{value:"Set1",label:"Palette 5",color:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#000","#fff","#fff"]},{value:"Set2",label:"Palette 6",color:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],textColor:["#000","#000","#000","#000","#000","#000","#000","#000","#000"]},{value:"Set3",label:"Palette 7",color:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],textColor:["#000","#000","#000","#000","#000","#000","#000","#000","#000"]},{value:"Accent",label:"Palette 8",color:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],textColor:["","","","","#fff","#fff","#fff","#fff"]},{value:"Dark2",label:"Palette 9",color:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Milano",label:"Palette 10",color:["#F1632C","#FAA234","#AB9A84","#6B6258","#B2B148","#507B52","#91C699","#718BA3","#CEC58B","#3E556E"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Cat10",label:"Palette 11",color:["#3C6398","#EF7B13","#DA3E44","#63AAA3","#47953A","#E9C12C","#A06291","#FC8795","#8A624B","#ACA09C"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Cat25",label:"Palette 12",color:["#3C6398","#8EBFE4","#EF7B13","#FEB165","#47953A","#7ACC66","#A88A17","#EEC748","#398882","#73B0A7","#7ACC66","#A88A17","#EEC748","#398882","#73B0A7","#DA3E44","#FD8886","#665D5B","#ACA09C","#C95983","#F9AEC8","#A06291","#CA91BD","#8C634C","#CEA694"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Cat12",label:"Palette 13",color:["#3E923C","#75CC69","#EB7807","#FCBC53","#2D98AF","#86D1DF","#82970D","#B7C921","#8F7303","#F5CF0A","#1C786B","#7AB497"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"B1",label:"Palette 14 (Color Blind)",color:["#0B5A9C","#FB6708","#929BAB","#454D58","#4C8FC5","#BC3D05","#68707D","#92C0E5","#FDAF61","#BCC5D1"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Logi1",label:"Palette 15 (Logical)",color:["rgba(98,165,21,1)","rgba(231,66,12,1)","#cccccc"],textColor:["#fff","#fff","#fff"],deprecated:true},{value:"Logi2",label:"Palette 16 (Logical)",color:["#1f77b4","#DCDEE0","#DCDFE0"],textColor:["#fff","#000","#000"],deprecated:true},{value:"Logi3",label:"Palette 15 (Logical)",color:["#1f77b4","#DCDEE0"],textColor:["#fff","#000"]},{value:"Logi4",label:"Palette 16 (Logical)",color:["rgba(98,165,21,1)","rgba(231,66,12,1)"],textColor:["#fff","#fff"]},{value:"Outlier1",label:"Palette 17 (Outlier)",color:["rgba(231,66,12,1)","rgba(225,225,225,1)","rgba(231,66,12,1)","rgba(225,225,225,1)"],textColor:["#fff","#000","#fff","#000"],deprecated:true},{value:"Outlier2",label:"Palette 18 (Outlier)",color:["rgba(231,66,12,1)","rgba(225,225,225,1)","rgba(98,165,21,1)","rgba(225,225,225,1)"],textColor:["#fff","#000","#fff","#000"],deprecated:true},{value:"Outlier3",label:"Palette 17 (Outlier)",color:["rgba(231,66,12,1)","rgba(225,225,225,1)","rgba(98,165,21,1)"],textColor:["#fff","#000","#fff"]},{value:"Outlier4",label:"Palette 18 (Outlier)",color:["rgba(231,66,12,1)","rgba(225,225,225,1)","rgba(231,66,12,1)"],textColor:["#fff","#000","#fff"]},{value:"Analytics1",label:"Palette 19 (Analytics)",color:["#4A90E2","#e7420c","#CCCCCC"],textColor:["#fff","#fff","#fff"]},{value:"Analytics1r",label:"Palette 20 (Analytics)",color:["#e7420c","#4A90E2","##CCCCCC"],textColor:["#fff","#fff","#fff"]},{value:"Analytics2",label:"Palette 21 (Analytics)",color:["#4A90E2","rgba(231,66,12,1)"],textColor:["#fff","#fff"]},{value:"Analytics3",label:"Palette 22 (Analytics)",color:["rgba(40,110,175,1)","rgba(225,225,225,1)"],textColor:["#fff","#fff"]},{value:"Analytics4",label:"Palette 23 (Analytics)",color:["#4A90E2","rgba(98,165,21,1)","rgba(231,66,12,1)"],textColor:["#fff","#fff","#fff"]},{value:"Analytics4r",label:"Palette 24 (Analytics)",color:["#4A90E2","rgba(231,66,12,1)","rgba(98,165,21,1)"],textColor:["#fff","#fff","#fff"]},{value:"Analytics5",label:"Palette 25 (Analytics)",color:["#4A90E2","#dcdee0","rgba(98,165,21,1)","rgba(231,66,12,1)"],textColor:["#fff","#fff","#fff","#fff"]},{value:"Analytics5r",label:"Palette 26 (Analytics)",color:["#4A90E2","#dcdee0","rgba(231,66,12,1)","rgba(98,165,21,1)"],textColor:["#fff","#fff","#fff","#fff"]},{value:"Analytics6",label:"Palette 27 (Analytics)",color:["#dcdee0","#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Analytics6r",label:"Palette 28 (Analytics)",color:["#dcdee0","#17becf","#bcbd22","#7f7f7f","#e377c2","#8c564b","#9467bd","#d62728","#2ca02c","#ff7f0e","#1f77b4"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Analytics7",label:"Palette 29 (Analytics)",color:["#1f77b4","#ff7f0e","#2ca02c"],textColor:["#fff","#fff"]},{value:"Analytics8",label:"Palette 30 (Analytics)",color:["rgba(225,225,225,1)"],textColor:["#fff"]},{value:"Analytics9",label:"Palette 31 (Analytics)",color:["#1f77b4","rgba(225,225,225,1)"],textColor:["#fff","#fff"]},{value:"Analytics10",label:"Palette 32 (Analytics)",color:["#1f77b4","#51A7F9","#ff7f0e","#2ca02c"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Analytics11",label:"Palette 33 (Analytics)",color:["#84BC54","#F0D351","rgba(225,225,225,1)"],textColor:["#fff"]},{value:"Analytics12",label:"Palette 34 (Analytics)",color:["#4A90E2","rgba(231,66,12,1)"],textColor:["#fff","#fff","#fff"]},{value:"Analytics13",label:"Palette 35 (Analytics)",color:["#4A90E2","#dcdee0","rgba(231,66,12,1)"],textColor:["#fff","#fff","#fff","#fff"]},{value:"Analytics14",label:"Palette 36 (Analytics)",color:["#BBBBBB","#1f77b4"],textColor:["#fff","#fff","#fff","#fff"]},{value:"Analytics15",label:"Palette 37 (Analytics)",color:["#1f77b4","#33a02c","#d62728"],textColor:["#fff","#fff","#fff"]},{value:"Analytics16",label:"Palette 38 (Analytics)",color:["#1f77b4","#51A7F9","#33a02c","#d62728"],textColor:["#fff","#fff","#fff"]},{value:"Analytics17",label:"Palette 39 (Analytics)",color:["#dddddd","#b2df8a","#1f77b4","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Analytics18",label:"Palette 40 (Analytics)",color:["#84BC54","rgba(225,225,225,1)"],textColor:["#fff"]},{value:"Analytics19",label:"Palette 41 (Analytics)",color:["#dcdee0","rgba(98,165,21,1)","rgba(231,66,12,1)"],textColor:["#fff","#fff","#fff"]},{value:"Analytics20",label:"Palette 42 (Analytics)",color:["#dcdee0","rgb(178,10,28)","rgb(5,10,172)"],textColor:["#fff","#fff","#fff","#fff","#fff"]},{value:"Analytics21",label:"Palette 43 (Analytics)",color:["#e7420c","#4A90E2","#CCCCCC"],textColor:["#fff","#fff","#fff"]},{value:"Analytics22",label:"Palette 44 (Analytics)",color:["#EC5D57","#70BF41"],textColor:["#fff","#fff"]}];res.CATEG_COLOR_PALETTES=res.CATEG_COLOR_PALETTES_BASE.concat(res.QUANT_COLOR_PALETTES_BASE);res.CATEG_COLOR_PALETTES_NO_CUSTOM=res.CATEG_COLOR_PALETTES_BASE.concat(res.QUANT_COLOR_PALETTES_BASE);res.QUANT_COLOR_PALETTES=res.QUANT_COLOR_PALETTES_BASE.concat(res.CATEG_COLOR_PALETTES_BASE);res.CATEG_COLOR_PALETTES.push({value:"custom",label:"User Palette",color:["#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]});res.QUANT_COLOR_PALETTES.push({value:"custom",label:"User Palette",color:["#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]});res.QUANT_COLOR_PALETTES_BASE_HASH=_createNameHash(res.QUANT_COLOR_PALETTES_BASE);res.QUANT_COLOR_PALETTES_HASH=_createNameHash(res.QUANT_COLOR_PALETTES);res.CATEG_COLOR_PALETTES_HASH=_createNameHash(res.CATEG_COLOR_PALETTES);res.CATEG_COLOR_PALETTES=res.CATEG_COLOR_PALETTES.filter(function(c){return!c.deprecated});res.CATEG_COLOR_PALETTES_NO_CUSTOM=res.CATEG_COLOR_PALETTES_NO_CUSTOM.filter(function(c){return!c.deprecated});res.QUANT_COLOR_PALETTES=res.QUANT_COLOR_PALETTES.filter(function(c){return!c.deprecated});res.CATEG_COLOR_PALETTES_NO_ANALYTICS=res.CATEG_COLOR_PALETTES.filter(function(c){return!/^Analytics|custom$/.test(c.value)});res.QUANT_COLOR_PALETTES_NO_ANALYTICS=res.QUANT_COLOR_PALETTES.filter(function(c){return!/^Analytics|custom$/.test(c.value)});var _highlight={value:"highlight",label:"Highlight",color:["#dcdde0","#dcdde0","#dcdde0","#dcdde0","#dcdde0","#dcdde0","#dcdde0","#dcdde0","#dcdde0"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]};res.CATEG_COLOR_PALETTES_HIGHLIGHT=res.CATEG_COLOR_PALETTES.filter(function(c){return!/^(Analytics|custom$)/.test(c.value)});res.CATEG_COLOR_PALETTES_HIGHLIGHT.splice(14,0,_highlight);res.CATEG_COLOR_PALETTES_HASH["highlight"]=_highlight;res.QUANT_COLOR_PALETTES_HIGHLIGHT=res.QUANT_COLOR_PALETTES.filter(function(c){return!/^(Analytics|custom$)/.test(c.value)});res.QUANT_COLOR_PALETTES_HIGHLIGHT.splice(15,0,_highlight);res.QUANT_COLOR_PALETTES_HASH["highlight"]=_highlight;res.onKeyHandlerGenerator=function(cb){var pressed=false;var onKeyPressHandler=function(ev){pressed=ev.keyCode===13};var onKeyUpHandler=function(ev){if(ev.keyCode===13&&pressed){cb(ev)}pressed=false};return{onKeyPressHandler:onKeyPressHandler,onKeyUpHandler:onKeyUpHandler}};res.makeArrayUnique=function(arr){var h={},res=[];arr.forEach(function(i){if(!h[i]){res.push(i);h[i]=true}});return res};res.areObjectsEqual=function(objA,objB){var keysA=Object.keys(objA);var keysB=Object.keys(objB);if(keysA.length!==keysB.length){return false}return!keysA.find(function(key){return objA[key]!==objB[key]})};var hexToRgb=function(hex){var result,base;if(/^rgb/.test(hex.trim())){result=/([\d]+)[, ]*([\d]+)[, ]*([\d]+)/.exec(hex.trim());base=10}else{result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex.trim());base=16}return result?{r:parseInt(result[1],base),g:parseInt(result[2],base),b:parseInt(result[3],base)}:null};var hexToRgba=function(hex,opacity){var rgb=hexToRgb(hex);if(rgb===null){rgb={r:204,g:204,b:204}}return"rgba("+rgb.r+","+rgb.g+","+rgb.b+","+opacity+")"};var rgbaToHex=function(orig){var a,isPercent,rgb=orig.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+),?([^,\s)]+)?/i),alpha=(rgb&&rgb[4]||"").trim(),hex=rgb?(rgb[1]|1<<8).toString(16).slice(1)+(rgb[2]|1<<8).toString(16).slice(1)+(rgb[3]|1<<8).toString(16).slice(1):orig;if(alpha!==""){a=alpha}else{a=parseInt("01",8)}a=(a*255|1<<8).toString(16).slice(1);hex=hex+a;return"#"+hex};var rgbToHex=function(color){color=""+color;if(!color||color.indexOf("rgb")<0){return}if(color.charAt(0)=="#"){return color}var nums=/(.*?)rgb\((\d+),\s*(\d+),\s*(\d+)\)/i.exec(color),r=parseInt(nums[2],10).toString(16),g=parseInt(nums[3],10).toString(16),b=parseInt(nums[4],10).toString(16);return"#"+((r.length==1?"0"+r:r)+(g.length==1?"0"+g:g)+(b.length==1?"0"+b:b))};res.hexToRgb=hexToRgb;res.hexToRgba=hexToRgba;res.rgbaToHex=rgbaToHex;res.rgbToHex=rgbToHex;res.escapeHTMLTags=function(value){if(typeof value!=="string"){return value}return value.replace(/[&'`"<>]/g,function(match){return{"&":"&amp;","'":"&#x27;","`":"&#x60;",'"':"&quot;","<":"&lt;",">":"&gt;"}[match]})};res.isNumericAsDiscreteValueOnColor=function(options){return options.color&&options.color.isNumeric&&options.color.func==="none"};res.isShowLabelOnPlotSupported=function(marker){return/^(scatter|bubble)$/.test(marker)};res.isShowValueOnPlotSupported=function(marker){return/^(bar|line|area|hist|errbar|errbar-agg|radar)$/.test(marker)};res.isShowSummarizedValueOnPlotSupported=function(marker,barStyle){return marker==="area"||marker==="bar"&&barStyle==="stack"};res.getDefaultGridLines=function(marker,opId){if(opId==="y2"){return"off"}else if(/^(bar|hist|boxplot|violin|errbar|errbar-agg)$/.test(marker)){return opId==="x"?"off":"on"}else if(marker==="heatmap"){return"off"}else if(marker==="contour"){return"off"}else if(marker==="parcats"){return"off"}else{return"on"}};res.getDefaultZeroLine=function(marker,opId){return opId==="y2"?"off":"on"};res.isSyncZeroLineEnabled=function(vizOptions){var y1IncludeZero=vizOptions.yAxisIncludeZero||VizUtil.getDefaultAxisIncludeZero(vizOptions.marker,vizOptions.errbarGraph);var y2IncludeZero=vizOptions.y2AxisIncludeZero||VizUtil.getDefaultAxisIncludeZero(vizOptions.marker,vizOptions.errbarGraph);return y1IncludeZero==="on"&&y2IncludeZero==="on"};res.isShowValueOnPlotFontSizeAutoAdjustmentSupported=function(yOp,vizOptions){var marker=vizOptions.marker;var markerShape=vizOptions[yOp+"MarkerShape"];if(marker==="bar"&&(!markerShape||markerShape==="bar")){return true}else if(markerShape==="bar"){return true}return false};res.getDefaultValueOnPlotPosition=function(marker){return marker==="radar"?"top":"bottom"};res.getDefaultQuantColorPalette=function(vizOptions){if(/^(heatmap|contour|parcats)$/.test(vizOptions.marker)){return"RdBu"}else if(vizOptions.marker==="r-wordcloud"){return vizOptions._defaultQuantColorPalette||"Blues"}else{var v=res.getDefaultColorPalette(VizUtil.getBucketType("color",vizOptions),vizOptions);if(v==="Blues"){return vizOptions._defaultQuantColorPalette||v}else{return v}}};res.getDefaultColorPalette=function(bucketType,vizOptions){switch(bucketType){case Column.OperationType.BUCKET_EQUAL_FREQ:case Column.OperationType.BUCKET_EQUAL_WIDTH:case Column.OperationType.BUCKET_EQUAL_STEP:return"Blues";case Column.OperationType.BUCKET_OUTLIER_IQR:case Column.OperationType.BUCKET_OUTLIER_PERCENTILE:case Column.OperationType.BUCKET_OUTLIER_SD:return"Outlier3";case Column.OperationType.BUCKET_CUSTOM:return"Blues";case Column.OperationType.BUCKET_LOGICALIZE:return"Logi3";case Column.OperationType.NONE:default:if(!vizOptions){return"default"}else if(VizUtil.isNumericAsDiscreteValueOnColor(vizOptions)){return vizOptions._defaultQuantColorPalette||"Blues"}else{return vizOptions._defaultCategColorPalette||"default"}}};res.getDefaultReversePaletteOrder=function(options){return"off"};res.getColorScale=function(colorArr){return d3.scale.ordinal().range(colorArr)},res.getColorScaleByPaletteName=function(paletteName,reversed,numCategories){var scale;if(!paletteName||!res.CATEG_COLOR_PALETTES_HASH[paletteName]||paletteName==="default"){scale=numCategories<=10?d3.scale.category10():d3.scale.category20()}else{var colorarr;if(numCategories>0&&VizUtil.colorbrewer[paletteName]&&VizUtil.colorbrewer[paletteName][numCategories]){colorarr=VizUtil.colorbrewer[paletteName][numCategories].slice()}else{colorarr=res.CATEG_COLOR_PALETTES_HASH[paletteName].color}scale=res.getColorScale(colorarr)}if(reversed){var colors=scale.range().slice();colors.reverse();scale=d3.scale.ordinal().range(colors)}return scale},res.getDefaultOpacity=function(options){switch(options.marker){case"scatter":case"scattermatrix":case"bubble":case"area":return.8;case"hist":return!options.color&&(options.histType==="ratio"||!options.histCumDistType)?.9:.6;case"densityplot":return.2;case"map":return.3;case"geojson":return.65;case"easymap":return options.easymapType==="area"?.65:.3;default:return null}};res.getDefaultColorStackDirection=function(options,isAnalytics){if(isAnalytics){return"normal"}else if((!options._desktopVersion||res.compareVersionStr(options._desktopVersion,"6.11.0")<0)&&res.isColorStackDirectionSupported(options)){return options.marker==="pie"&&options.color&&options.color.type==="character"&&options.pieSortByValue!=="off"?"descByValue":"normal"}if(res.isColorStackDirectionEnabled(options)&&options.color&&["bar","area"].includes(options.marker)&&(options.colorBucketType==="bucket_logicalize"||options.color.type==="logical")){return"reversed"}if(res.getAvailableColorStackDirectionByValueOptions(options).length===0){var bucketType=res.getBucketType("color",options);if([Column.OperationType.BUCKET_EQUAL_WIDTH,Column.OperationType.BUCKET_EQUAL_FREQ,Column.OperationType.BUCKET_EQUAL_STEP,Column.OperationType.BUCKET_CUSTOM].includes(bucketType)&&options.color&&VizUtil.returnsNumericValue(options.color)&&(options.marker==="bar"&&options.barstyle!=="group"||["line","area","radar"].includes(options.marker))){return"reversed"}return"normal"}else if(options.marker==="bubble"){return"normal"}else{return options.marker==="area"||options.marker==="bar"&&options.barstyle!=="group"?"ascByValue":"descByValue"}};res.getDefaultColorLegendDirection=function(options,isAnalytics){var stackDir=res.getDefaultColorStackDirection(options,isAnalytics);if((!options._desktopVersion||res.compareVersionStr(options._desktopVersion,"6.11.0")<0)&&["bar","area"].includes(options.marker)&&options.color&&options.colorStackDirection==="reversed"){return"reversed"}switch(stackDir){case"ascByValue":case"ascByLabel":case"reversed":return"reversed";default:return"normal"}};res.getDefaultAxisIncludeZero=function(marker,errbarGraph){if(marker==="errbar"||marker==="errbar-agg"){return errbarGraph==="marker"?"off":"on"}return/^(bar|line|area|hist|densityplot|radar)$/.test(marker)?"on":"off"};res.isIncludeZeroOnAxisSupported=function(marker,targetAxis){return targetAxis==="x"?/^(scatter|bubble)$/.test(marker):targetAxis==="y"?/^(scatter|bubble|bar|line)$/.test(marker):targetAxis==="y2"?/^(scatter|bar|line)$/.test(marker):/^(scatter)$/.test(marker)};res.getAxisIncludeZero=function(vizOptions,targetAxis){if(/^(area|hist|densityplot|radar)$/.test(vizOptions.marker)){return true}else if(/^(errbar|errbar-agg)$/.test(vizOptions.marker)){return vizOptions.errbarGraph!=="marker"}else if(/^(bar|line|scatter)$/.test(vizOptions.marker)){if((targetAxis==="y"||targetAxis==="y2")&&res.hasBarMarkerOnYAxis(vizOptions,targetAxis)){return true}return(vizOptions[targetAxis+"AxisIncludeZero"]||res.getDefaultAxisIncludeZero(vizOptions.marker,vizOptions.errbarGraph))==="on"}else if(/^(bubble)$/.test(vizOptions.marker)){return(vizOptions[targetAxis+"AxisIncludeZero"]||res.getDefaultAxisIncludeZero(vizOptions.marker,vizOptions.errbarGraph))==="on"}else{return false}};res.hasBarMarkerOnYAxis=function(vizOptions,targetAxis){var hasBarMarker=false;if(/^(errbar|errbar-agg)$/.test(vizOptions.marker)){return vizOptions.errbarGraph!=="marker"}var isBar=vizOptions.marker==="bar";Object.keys(vizOptions).forEach(function(k){if(/^y\d*$/.test(k)){var onY2=vizOptions[k+"Use2ndAxis"]==="on";if(targetAxis==="y"&&!onY2||targetAxis==="y2"&&onY2){hasBarMarker=hasBarMarker||(isBar?!vizOptions[k+"MarkerShape"]||vizOptions[k+"MarkerShape"]==="default"||vizOptions[k+"MarkerShape"]==="bar":vizOptions[k+"MarkerShape"]==="bar")}}});return hasBarMarker};res.isCategoricalColorPalette=function(paletteName){return!res.QUANT_COLOR_PALETTES_BASE_HASH[paletteName]};res.isCategoricalColorScale=function(options){switch(options.marker){case"pie":case"ring":return true;case"heatmap":case"contour":case"maphmap":return false;case"bar":case"errbar":case"errbar-agg":case"line":case"area":case"boxplot":case"violin":case"densityplot":case"scattermatrix":case"hist":case"scatter":case"map":case"bubble":case"radar":case"parcats":case"r-wordcloud":case"geojson":case"easymap":return!(options.color&&VizUtil.isContinuousValue(options.color,options.marker,"color"));default:return true}};res.getDefaultSingleValueValue=function(){return"<NA>"};res.getDefaultNumberFormattingOption=function(marker,func,winfunc){if(winfunc&&/(^ptotal$|^pdf|^pof|^pcumsum$|^prank$)/.test(winfunc)){return"percentage"}if(marker==="singlevalue"&&winfunc&&/^rdf/.test(winfunc)){return"percentage"}return marker&&func&&["pivot","summarytable","singlevalue"].includes(marker)&&["na_ratio","nna_ratio","true_ratio","false_ratio","sum_if_ratio","count_if_ratio","count_unique_if_ratio"].includes(func)?"percentage":""};res.isNumeric=function(type){return/numeric|integer|double/.test(type)};res.isDate=function(type){return/Date|POSIX/.test(type)};res.getPivotTotalAggregationFunc=function(columnFunc,pivotAggFunc,isNumeric){if(!pivotAggFunc){switch(columnFunc){case Column.OperationType.SUM:case Column.OperationType.AVERAGE:case Column.OperationType.MEDIAN:case Column.OperationType.MIN:case Column.OperationType.MAX:case Column.OperationType.DATE_MIN:case Column.OperationType.DATE_MAX:case Column.OperationType.DATE_MEDIAN:return columnFunc;case Column.OperationType.DATE_MIN_IF:return Column.OperationType.DATE_MIN;case Column.OperationType.DATE_MAX_IF:return Column.OperationType.DATE_MAX;case Column.OperationType.DATE_MEDIAN_IF:return Column.OperationType.DATE_MEDIAN;case Column.OperationType.ALL:return Column.OperationType.ALL_PIVOT_TOTAL;case Column.OperationType.ANY:return Column.OperationType.ANY_PIVOT_TOTAL;case Column.OperationType.FIRST:case Column.OperationType.LAST:case Column.OperationType.MODE:return isNumeric?Column.OperationType.AVERAGE:columnFunc;case Column.OperationType.COUNT:case Column.OperationType.COUNT_DISTINCT:return Column.OperationType.SUM;case Column.OperationType.NA_COUNT:case Column.OperationType.NON_NA_COUNT:case Column.OperationType.TRUE_COUNT:case Column.OperationType.FALSE_COUNT:return Column.OperationType.SUM;case Column.OperationType.SUM_IF:return Column.OperationType.SUM;case Column.OperationType.MEAN_IF:return Column.OperationType.AVERAGE;case Column.OperationType.MEDIAN_IF:return Column.OperationType.MEDIAN;case Column.OperationType.MIN_IF:return Column.OperationType.MIN;case Column.OperationType.MAX_IF:return Column.OperationType.MAX;case Column.OperationType.COUNT_IF:case Column.OperationType.COUNT_DISTINCT_IF:return Column.OperationType.SUM;case Column.OperationType.SUM_IF_RATIO:case Column.OperationType.COUNT_IF_RATIO:case Column.OperationType.COUNT_DISTINCT_IF_RATIO:return Column.OperationType.AVERAGE;default:return Column.OperationType.AVERAGE}}else{return pivotAggFunc}};res.getTimeSeriesColumn=function(options){if(!res.isWindowFunctionSupported(options.marker)){return null}else if(res.isPivot(options.marker)){return res.getTimeSeriesColumnForPivot(res.getOptions(options,"rowh"),res.getOptions(options,"colh"))}else{return res.isColumnObject(options.x)&&res.returnsDateValue(options.x)?"x":null}};res.getTimeSeriesColumnForPivot=function(rowhCols,colhCols){var col=null;if(rowhCols.length>0&&res.isColumnObject(rowhCols[rowhCols.length-1])&&res.returnsDateValue(rowhCols[rowhCols.length-1])){col="rowh"+(rowhCols.length-1)}if(col){return col}if(colhCols.length>0&&res.isColumnObject(colhCols[colhCols.length-1])&&res.returnsDateValue(colhCols[colhCols.length-1])){col="colh"+(colhCols.length-1)}return col};res.getDefaultHoverMode=function(marker){switch(marker){case"boxplot":return"closest";default:return"closest"}};res.getDefaultAxisDirection=function(marker,option){return"normal"};res.isAxisDateFormatEnabled=function(opId,vizOptions){var marker=vizOptions.marker;var col=vizOptions[opId];return col&&res.returnsDateValue(col)&&res.isPlotly(marker)&&!/^(pie|hist|densityplot|heatmap)$/.test(marker)};res.isDisablingAxisTickAutoScalingSupported=function(vizOptions){return/^(bar|errbar|errbar-agg|line|area)$/.test(vizOptions.marker)&&!vizOptions.facet};res.isAxisDirectionEnabled=function(marker){return res.isPlotly(marker)&&!/^(pie|hist|densityplot|radar)$/.test(marker)};res.isColorStackDirectionSupported=function(vizOptions){switch(vizOptions.marker){case"bar":case"errbar":case"errbar-agg":case"line":case"area":case"bubble":case"pie":case"radar":return true;default:return false}};res.isColorStackDirectionEnabled=function(vizOptions){if(!vizOptions.color){return false}return res.isColorStackDirectionSupported(vizOptions)};res.isColorLegendDirectionEnabled=function(vizOptions){res.isColorStackDirectionEnabled(vizOptions)};res.getAvailableColorStackDirectionByValueOptions=function(vizOptions){var v=[];var enabled=vizOptions.color&&res.isColorStackDirectionEnabled(vizOptions)&&/character/.test(vizOptions.color.type)&&vizOptions.colorBucketType!=="bucket_logicalize"&&vizOptions.marker!=="radar"&&!VizUtil.isContinuousValue(vizOptions.color,vizOptions.marker,"color");if(!enabled){return v}v.push("by-name");v.push("by-display-name");if(vizOptions.marker==="bubble"){if(vizOptions.x&&VizUtil.isContinuousValue(vizOptions.x,vizOptions.marker,"x")&&vizOptions.x.func!==Column.OperationType.AS_CATEGORY){v.push("xaxis")}if(vizOptions.y&&VizUtil.isContinuousValue(vizOptions.y,vizOptions.marker,"y")&&vizOptions.y.func!==Column.OperationType.AS_CATEGORY){v.push("yaxis")}}else{v.push("yaxis")}return v};res.isColorHighlightSupported=function(marker){return res.isPlotly(marker)&&!/^(heatmap|contour)$/.test(marker)||/^(geojson|map|easymap)$/.test(marker)};res.isHighlightCreateOthersSupported=function(vizOptions){return/^(scatter|bubble)$/.test(vizOptions.marker)&&vizOptions.color&&res.returnsCharacterValue(vizOptions.color)&&(!vizOptions.yMarkerShape||vizOptions.yMarkerShape==="circle")};res.isHighlightCreateOthersEnabled=function(vizOptions){return res.isHighlightCreateOthersSupported(vizOptions)&&vizOptions.enableHighlight==="on"&&vizOptions.highlightCreateOthers==="on"};res.getHighlightDefaultColor=function(vizOptions){return vizOptions.highlightDefaultColor||"#DCDEE0"};res.isGroupHandlingControlSupported=function(option,vizOptions){switch(vizOptions.marker){case"bar":case"line":case"area":case"boxplot":case"violin":case"errbar":case"errbar-agg":return/^(x|color)$/.test(option);case"densityplot":case"hist":case"pie":return/^(color)$/.test(option);case"map":return/^(color)$/.test(option);case"scatter":return/^(x$|y|z$|color$)/.test(option);case"bubble":return/^(x|y|color)$/.test(option);case"heatmap":return/^(x|y)$/.test(option)}return false};res.isShowHideUnusedLevelsSupported=function(option,vizOptions){if(!res.isGroupHandlingControlSupported(option,vizOptions)){return false}var col=vizOptions[option];if(!col){return false}if(col.func===Column.OperationType.AS_CATEGORY){return false}if(res.returnsCharacterValue(col)&&/(factor|Date|POSIXct)/.test(col.type)){return true}return false};res.isCustomFunctionSupported=function(marker,option){switch(marker){case"pivot":case"singlevalue":case"summarytable":return/^meas/.test(option);case"bar":case"line":case"area":return/^y/.test(option);case"bubble":case"map":return/^(x|y|color$|size$)/.test(option);case"geojson":case"easymap":return/^(color|size)$/.test(option);case"pie":return option==="y";case"heatmap":case"contour":return option==="color";default:return false}};res.isRecodeSupported=function(marker,option){if(/^(geojson|r-wordcloud)$/.test(marker)&&option==="x"){return false}return true};res.isRecodeEnabled=function(marker,option,vizOptions){return res.isRecodeSupported(marker,option)&&vizOptions[option]&&!VizUtil.isContinuousValue(vizOptions[option],marker,option)&&VizUtil.returnsCharacterValue(vizOptions[option])&&!(option==="facet"&&vizOptions[option].type===res.TYPE_GROUP_BY_MEASURES)};res.getBucketInfo=function(data,bucketProp){var hash={};data.forEach(function(d){if(!!d[bucketProp]&&!hash[d[bucketProp]]){hash[d[bucketProp]]=1}});var exts=Object.keys(hash).map(function(key){var ext=key.replace(/[\[\(\]]/g,"").split(",");ext=ext.map(function(m){return parseFloat(m)});return{key:key,extent:ext}});exts=exts.sort(function(a,b){return a.extent[0]-b.extent[0]});exts=exts.map(function(m,idx){m.id=idx+1;return m});var h={};exts.forEach(function(m){h[m.key]=m.id});var isNew=true;Object.keys(hash).forEach(function(key){isNew=isNew&&/\]/.test(key)});return{legend:isNew?exts:null,map:h}};res.formatColorBucketData=function(data,colorBucketCol,formatter){var v;data.forEach(function(d){v=d[colorBucketCol];if(typeof v==="number"){return}else if(v){v=v.trim();if(/^[\[\(].*[\)\]]$/.test(v)){v=v.replace(/[\[\]\(\)]/g,"");v=v.split(",");v=formatter(v[0])+" - "+formatter(v[1]);d[colorBucketCol]=v}}else{d[colorBucketCol]=null}})};var escapeForQuotedStringInR=function(exp){return exp.replace(/\\/g,"\\\\").replace(/"/g,'\\"')};res.isRepeatByYAxisColumns=function(vizOptions){return vizOptions.facet&&vizOptions.facet.type===res.TYPE_GROUP_BY_MEASURES};res.isBucketingOnAggregatedValuesSupported=function(vizOptions,opId){if(vizOptions.marker!=="bar"||opId!=="color"||!vizOptions.y){return false}var ys=VizUtil.getOptions(vizOptions,"y");if(ys.length>1){return false}return true};res.requireOriginalBucketLabels=function(vizOptions,opId){return res.isBucketZeroToCenterEnabled(vizOptions,opId)&&vizOptions[opId+"BucketLabels"]};res.isBucketZeroToCenterEnabled=function(vizOptions,opId){return res.getBucketType(opId,vizOptions)===Column.OperationType.BUCKET_EQUAL_WIDTH&&vizOptions[opId+"SetZeroToCenter"]==="on"};res.addBucketInfo=function(vizOptions,opId,attrs,ops){var bucketType=res.getBucketType(opId,vizOptions);var bucketAttrs=res.constructBucketAttributes(opId,vizOptions,bucketType);if(bucketAttrs){var type=vizOptions[opId+"BucketType"];if(type===Column.OperationType.BUCKET_OUTLIER||type===Column.OperationType.BUCKET_EQUAL_WIDTH||type===Column.OperationType.BUCKET_EQUAL_FREQ){var x=vizOptions["x"],facet=vizOptions["facet"];switch(vizOptions[opId+"BucketGroup"]){case"facet":bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN]=facet?facet.validLabel:null;bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN_ORIGINAL_NAMES]=facet?facet.validName:null;break;case"xaxis":bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN]=x?x.validLabel:null;bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN_ORIGINAL_NAMES]=x?x.validName:null;break;case"xaxis+facet":bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN]=x&&facet?facet.validLabel+","+x.validLabel:null;bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN_ORIGINAL_NAMES]=x&&facet?facet.validName+","+x.validName:null;break;case"all":default:break}}Object.keys(bucketAttrs).forEach(function(key){attrs[key]=bucketAttrs[key]});if(vizOptions[opId]&&/difftime/.test(vizOptions[opId].type)){attrs[Column.Attribute.BUCKET_CAST_TO_NUMERIC_BEFORE_BUCKETING]=true}ops.push(Column.OperationType.CUT);ops.push(bucketType)}};res.addCategoryHandlingInfo=function(vizOptions,opId,attrs,ops){if(res.isShowHideUnusedLevelsSupported(opId,vizOptions)){var showUnusedLevels=vizOptions[opId+"ShowUnusedFactorLevels"]||"on";attrs.dropUnusedFactorLevels=showUnusedLevels==="off"?"TRUE":"FALSE";if(vizOptions.marker==="scatter"&&/^(x|y\d*|z)$/.test(opId)&&showUnusedLevels==="off"){ops.push(Column.OperationType.DROP_UNUSED_FACTOR_LEVELS)}}if(opId==="color"&&vizOptions.x&&vizOptions.y&&vizOptions.color){var isXAxisContinuous=res.returnsNumericValue(vizOptions.x)&&vizOptions.x.func!==Column.OperationType.AS_CATEGORY||res.returnsDateValue(vizOptions.x);var isYAxisContinuous=res.returnsNumericValue(vizOptions.y)&&vizOptions.y.func!==Column.OperationType.AS_CATEGORY||res.returnsDateValue(vizOptions.y);if((isXAxisContinuous||isYAxisContinuous&&vizOptions.marker==="bubble")&&vizOptions.color.type==="character"&&res.getBucketType(opId,vizOptions)===Column.OperationType.NONE){if(/^(line|area|bubble|bar)$/.test(vizOptions.marker)){attrs._refreshFactorLevel=true}}}};res.constructBucketAttributes=function(opId,vizOptions,bucketType){var attrs={};var useIndexForDefaultLabels=vizOptions[opId+"BucketGroup"]&&vizOptions[opId+"BucketGroup"]!=="all";var numDecimalDigits=vizOptions["numDecimalDigits"]||2;var useThousandSeparator=vizOptions["useThousandSeparator"]!=="off";if(opId==="x"){numDecimalDigits=vizOptions[opId+"BucketNumDecimalDigits"]||vizOptions["xAxisNumDecimalDigits"]||numDecimalDigits;useThousandSeparator=vizOptions["xAxisUseThousandSeparator"]?vizOptions["xAxisUseThousandSeparator"]!=="off":useThousandSeparator}else if(/^y[\d]*$/.test(opId)){if(vizOptions[opId+"Use2ndAxis"]==="on"){numDecimalDigits=vizOptions[opId+"BucketNumDecimalDigits"]||vizOptions["y2AxisNumDecimalDigits"]||numDecimalDigits}else{numDecimalDigits=vizOptions[opId+"BucketNumDecimalDigits"]||vizOptions["y1AxisNumDecimalDigits"]||numDecimalDigits}useThousandSeparator=vizOptions["y1AxisUseThousandSeparator"]?vizOptions["y1AxisUseThousandSeparator"]!=="off":useThousandSeparator}else if(opId==="z"){numDecimalDigits=vizOptions[opId+"BucketNumDecimalDigits"]||vizOptions["zAxisNumDecimalDigits"]||numDecimalDigits;useThousandSeparator=vizOptions["zAxisUseThousandSeparator"]?vizOptions["zAxisUseThousandSeparator"]!=="off":useThousandSeparator}else if(opId==="color"){numDecimalDigits=vizOptions[opId+"BucketNumDecimalDigits"]||vizOptions["colorNumDecimalDigits"]||numDecimalDigits}else if(opId.startsWith("rowh")||opId.startsWith("colh")){numDecimalDigits=vizOptions[opId+"BucketNumDecimalDigits"]||vizOptions[opId].numDecimalDigits||numDecimalDigits}else{numDecimalDigits=vizOptions[opId+"BucketNumDecimalDigits"]||numDecimalDigits}var includeRightEdge=vizOptions[opId+"BucketIncludeRightEdge"];if(!includeRightEdge&&vizOptions.marker&&(!vizOptions._desktopVersion||res.compareVersionStr(vizOptions._desktopVersion,"6.12.3")<0)){includeRightEdge="on"}switch(bucketType){case Column.OperationType.NONE:return null;case Column.OperationType.BUCKET_EQUAL_WIDTH:attrs.numOfBuckets=vizOptions[opId+"BucketNumOfBuckets"]||5;attrs.numDecimalDigits=numDecimalDigits;attrs.thousandSeparator=useThousandSeparator?'","':'""';attrs.cutZeroToCenter=vizOptions[opId+"SetZeroToCenter"]==="on"&&opId!=="color"?"TRUE":"FALSE";attrs.useIndexForDefaultLabels=useIndexForDefaultLabels;attrs.lowerRange=vizOptions[opId+"BucketLowerRange"];attrs.upperRange=vizOptions[opId+"BucketUpperRange"];attrs.includeOutsideRange=vizOptions[opId+"BucketIncludeOutsideRange"]==="off"?"FALSE":"TRUE";attrs.labelsExp=res.constructBucketLabels(vizOptions[opId+"BucketLabels"],attrs.numOfBuckets,useIndexForDefaultLabels,attrs.includeOutsideRange==="TRUE",attrs.lowerRange,attrs.upperRange);attrs.includeRightEdge=includeRightEdge==="on"?"TRUE":"FALSE";if(opId==="color"&&res.requireOriginalBucketLabels(vizOptions,opId)){attrs.requireOriginalBucketLabels=true}break;case Column.OperationType.BUCKET_EQUAL_FREQ:attrs.numOfBuckets=vizOptions[opId+"BucketNumOfBuckets"]||5;attrs.numDecimalDigits=numDecimalDigits;attrs.thousandSeparator=useThousandSeparator?'","':'""';attrs.useIndexForDefaultLabels=useIndexForDefaultLabels;attrs.labelsExp=res.constructBucketLabels(vizOptions[opId+"BucketLabels"],attrs.numOfBuckets,useIndexForDefaultLabels);attrs.includeRightEdge=includeRightEdge==="on"?"TRUE":"FALSE";break;case Column.OperationType.BUCKET_EQUAL_STEP:attrs.bucketStep=vizOptions[opId+"BucketStep"];if(attrs.bucketStep!==null&&attrs.bucketStep!==undefined&&!isNaN(attrs.bucketStep)&&parseFloat(attrs.bucketStep)<=0){delete attrs.bucketStep}attrs.lowerRange=vizOptions[opId+"BucketLowerRange"];attrs.upperRange=vizOptions[opId+"BucketUpperRange"];attrs.numDecimalDigits=numDecimalDigits;attrs.thousandSeparator=useThousandSeparator?'","':'""';attrs.labelsExp=res.constructBucketLabels(vizOptions[opId+"BucketLabels"],attrs.numOfBuckets,useIndexForDefaultLabels);attrs.includeOutsideRange=vizOptions[opId+"BucketIncludeOutsideRange"]==="off"?"FALSE":"TRUE";attrs.includeRightEdge=includeRightEdge==="on"?"TRUE":"FALSE";break;case Column.OperationType.BUCKET_OUTLIER_IQR:attrs.labelsExp=res.constructBucketLabels(vizOptions[opId+"BucketOutlierLabels"],3,false);break;case Column.OperationType.BUCKET_OUTLIER_PERCENTILE:var pctThreshold=vizOptions[opId+"BucketPctThreshold"]||.95;var isPctInvalid=pctThreshold&&(pctThreshold<=0||pctThreshold>=1);attrs.outlierPctThreshold=isPctInvalid?.95:pctThreshold;attrs.labelsExp=res.constructBucketLabels(vizOptions[opId+"BucketOutlierLabels"],3,false);break;case Column.OperationType.BUCKET_OUTLIER_SD:var sdThreshold=vizOptions[opId+"BucketSdThreshold"]||2;var isSdInvalid=sdThreshold&&sdThreshold<=0;attrs.outlierSdThreshold=isSdInvalid?2:sdThreshold;attrs.labelsExp=res.constructBucketLabels(vizOptions[opId+"BucketOutlierLabels"],3,false);break;case Column.OperationType.BUCKET_KMEANS:attrs.kmeansNumOfBuckets=vizOptions[opId+"BucketKmeansNumOfBuckets"]||3;break;case Column.OperationType.BUCKET_CUSTOM:var cpValue=vizOptions[opId+"BucketCuttingPoints"];var isCpInvalid=!VizUtil.isCuttingPointValuesValid(cpValue);attrs=res.constructCustomBucketAttributes(isCpInvalid?"":cpValue,vizOptions[opId+"BucketLabels"],vizOptions[opId+"BucketIncludeOutsideRange"]!=="off",includeRightEdge==="on",vizOptions[opId+"BucketIncludeLowest"]!=="off",10);attrs.numDecimalDigits=numDecimalDigits;attrs.thousandSeparator=useThousandSeparator?'","':'""';break}var color=vizOptions["color"],marker=vizOptions["marker"];attrs[Column.Attribute.BUCKET_PRIORITY]=opId==="x"||opId==="y"?1:2;if(color&&opId==="color"){var valuePrefix=res.getValuePrefix(vizOptions["colorNumberFormatting"],vizOptions["colorCurrencySymbol"],marker);attrs[Column.Attribute.VALUE_PREFIX]=valuePrefix;var valueSuffix=res.getValueSuffix(vizOptions["colorWindowFunc"],color.func,vizOptions["colorNumberFormatting"],marker);attrs[Column.Attribute.VALUE_SUFFIX]=valueSuffix}var col=vizOptions[opId];var ycol=vizOptions.y;if(col&&col.type===res.TYPE_YAXIS&&ycol){attrs[Column.Attribute.BUCKET_AFTER_SUMMARIZE]=ycol.validLabel}return attrs};res.isCuttingPointValuesValid=function(val){if(!val){return true}var arr=val.split(",").map(function(v){return parseFloat(v)});var res=arr.filter(function(v,idx){if(isNaN(v)){return false}if(idx>0&&arr[idx-1]>=v){return false}return true});return res.length===arr.length};res.isReferenceLineConstantValuesValid=function(val){if(!val){return true}var arr=val.split(",").map(function(x){return x.trim()});var res=arr.filter(function(v,idx){if(/[^0-9,\. \-]/.test(v)){return false}if(isNaN(parseFloat(v))){return false}return idx===arr.indexOf(v)});return res.length===arr.length};res.constructCustomBucketAttributes=function(breaksTxt,labelsTxt,includeOutsideRange,includeRightEdge,includeLowest,digLab){var breaksExp,labelsExp,breaks,labels;if(!breaksTxt){breaks=["-Inf","Inf"];breaksExp="c("+breaks.join(",")+")"}else{breaksTxt=breaksTxt.trim().replace(/^,/,"").replace(/,$/,"");breaks=breaksTxt.split(",");if(includeOutsideRange){breaks.push("Inf");breaks.unshift("-Inf")}}breaksExp="c("+breaks.map(function(x){return x.endsWith("Inf")?x:parseFloat(x)}).join(",")+")";labelsExp=res.constructBucketLabels(labelsTxt,breaks.length-1,false);return{breaksExp:breaksExp,expectedNumberOfLabels:breaks.length-1,labelsExp:labelsExp,includeLowest:includeLowest?"TRUE":"FALSE",includeRightEdge:includeRightEdge?"TRUE":"FALSE",digLab:digLab}};res.constructBucketLabels=function(labelsTxt,numOfLabels,useIndexForDefaultLabels,includeOutsideRange,lowerRange,upperRange){if(!labelsTxt&&!useIndexForDefaultLabels){return"NULL"}if(includeOutsideRange){if(lowerRange){numOfLabels++}if(upperRange){numOfLabels++}}var labels=[],i;if(labelsTxt){labels=labelsTxt.trim().split(",");labels=labels.map(function(x){return x.trim()})}if(labels.length<numOfLabels){for(i=labels.length;i<numOfLabels;i++){labels.push(null)}}else if(labels.length>numOfLabels){labels=labels.slice(0,numOfLabels)}if(includeOutsideRange&&useIndexForDefaultLabels){if(upperRange&&!labels[labels.length-1]){labels[labels.length-1]=upperRange+" <"}if(lowerRange&&!labels[0]){labels[0]="<= "+lowerRange;labels=labels.map(function(x,idx){return!x?String(idx):x})}}if(useIndexForDefaultLabels){labels=labels.map(function(x,idx){return!x?String(idx+1):x})}return"c("+labels.map(function(x){return!x?"NA":'"'+escapeForQuotedStringInR(x.trim())+'"'}).join(",")+")"};res.getOtherGroupType=function(op,viz){return viz[op+"EnableOtherGroup"]||res.getDefaultOtherGroupType(op,viz)};res.getDefaultOtherGroupType=function(op,viz){if(!viz._desktopVersion||res.compareVersionStr(viz._desktopVersion,"6.5.1")<0){if(op==="x"&&/^(bar|line|area|errbar|boxplot|violin)$/.test(viz.marker)){return VizUtil.OTHER_GROUP_OPTION_TYPE.NONE}return VizUtil.OTHER_GROUP_OPTION_TYPE.FCT_LUMP}else{return VizUtil.OTHER_GROUP_OPTION_TYPE.NONE}};res.addOtherGroupInfo=function(vizOptions,opId,attrs,ops,lang){attrs.removeOtherGroup=!vizOptions[opId+"ShowOtherGroup"]&&!!vizOptions[opId+"HideOtherGroup"]?vizOptions[opId+"HideOtherGroup"]==="on":vizOptions[opId+"ShowOtherGroup"]==="off";attrs.labelForOtherGroup=vizOptions[opId+"OtherGroupLabel"]||res.getMessage(lang||"en","Others");var type=res.getOtherGroupType(opId,vizOptions);switch(type){case res.OTHER_GROUP_OPTION_TYPE.FCT_LUMP:default:ops.push(Column.OperationType.FCT_LUMP);attrs.numGroupsToPreserve=vizOptions[opId+"NumGroupsToPreserve"];if(!attrs.numGroupsToPreserve){attrs.numGroupsToPreserve=res.getDefaultNumberOfGroups(vizOptions.marker,opId)}break;case res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_DROP_VALUES:case res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_KEEP_VALUES:ops.push(Column.OperationType.FCT_OTHER);var otherGroupValues=vizOptions[opId+"OtherGroupValues"]||[];attrs.otherGroupValues="c("+(otherGroupValues.length===0?"as.character(NA)":otherGroupValues.map(function(col){return'"'+col.value+'"'}).join(","))+")";attrs.otherGroupValuesHandling=type===res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_DROP_VALUES?"drop":"keep";break}};res.getDefaultRecodeOthersLabel=function(){return"Others"};res.getDefaultWindowFunctionSize=function(){return 7};res.getDefaultWindowFunctionDirection=function(){return"color"};res.getDefaultRecodeNaLabel=function(){return"(NA)"};res.getNaLabel=function(vizOptions,opId){var naLabel=res.getDefaultRecodeNaLabel();if(res.isRecodeEnabled(vizOptions.marker,opId,vizOptions)&&vizOptions[opId+"Recode"]&&Object.keys(vizOptions[opId+"Recode"]).indexOf(naLabel)>-1&&!!vizOptions[opId+"Recode"][naLabel]){naLabel=vizOptions[opId+"Recode"][naLabel]}return naLabel};res.escapeForQuotedStringInR=function(exp){return exp.replace(/\\/g,"\\\\").replace(/"/g,'\\"')};res.addRecodeInfo=function(vizOptions,opId,attrs,ops){if(res.isRecodeEnabled(vizOptions.marker,opId,vizOptions)&&vizOptions[opId+"Recode"]&&Object.keys(vizOptions[opId+"Recode"]).length>0){ops.push(Column.OperationType.RECODE);var values=vizOptions[opId+"Recode"];attrs.recodeValues=Object.keys(values).map(function(key){return"`"+key+'` = "'+res.escapeForQuotedStringInR(values[key])+'"'}).join(", ");var enableCreateOthers=vizOptions[opId+"RecodeEnableCreateOthers"]==="on";attrs.recodeOthersLabel=enableCreateOthers?"'"+(vizOptions[opId+"RecodeOthersLabel"]||res.getDefaultRecodeOthersLabel())+"'":"NULL";var enableReplaceNa=vizOptions[opId+"RecodeEnableReplaceNa"]==="on";attrs.recodeNaLabel=enableReplaceNa?"'"+(vizOptions[opId+"RecodeNaLabel"]||res.getDefaultRecodeNaLabel())+"'":"NULL"}};res.distinct=function(arr){var u={},a=[];for(var i=0,l=arr.length;i<l;++i){if(Object.prototype.hasOwnProperty.call(u,arr[i])){continue}a.push(arr[i]);u[arr[i]]=1}return a};res.isLeaflet=function(marker){return/^(geojson|map|maphmap|easymap)$/.test(marker)};res.isPivot=function(marker){return/^(pivot|table|singlevalue|summarytable)$/.test(marker)};res.isROutput=function(marker){return/^r-/.test(marker)};res.isPlotly=function(marker){return!(res.isLeaflet(marker)||res.isPivot(marker)||res.isROutput(marker))};res.isWindowFunctionSupported=function(marker,op){if(op==="x"){return marker==="hist"}else{return/^(bar|line|area|pivot|summarytable)$/.test(marker)}};res.isTimeSeriesWindowFunction=function(winFunc){return["dfperiod","pdfperiod","rdfperiod","lag_period"].includes(winFunc)};res.isMultiYSupported=function(marker){return/^(bar|line|scatter|scattermatrix|radar)$/.test(marker)};res.isTrendLineSupported=function(marker){return/^(line|scatter|bubble)$/.test(marker)};res.isTrendLineIgnoreColorSupported=function(marker){return/^(line|scatter|bubble)$/.test(marker)};res.getTrendLineDefaultColor=function(){return"#A6AAA9"};res.isTrendLineShowMetricsEnabled=function(opId,vizOptions){var disabled=vizOptions[opId+"TrendLine"]!==Column.OperationType.LM_FIT||vizOptions.color&&vizOptions["yTrendLineIgnoreColor"]!=="on";if(!disabled&&!(vizOptions.facet&&vizOptions.facet.type===VizUtil.TYPE_GROUP_BY_MEASURES)){var targetIndex=parseInt(opId.replace("y","")||"0");disabled=Object.keys(vizOptions).some(function(key){if(key.endsWith("TrendLineEnableShowMetrics")){var id=key.replace("TrendLineEnableShowMetrics","");var index=parseInt(id.replace("y","")||"0");return vizOptions[id]&&vizOptions[id+"TrendLine"]===Column.OperationType.LM_FIT&&index<targetIndex&&vizOptions[key]==="on"}else{return false}})}return!disabled};res.isSyncAxisSupported=function(marker){return!/^(pie|ring|heatmap)$/.test(marker)};res.isHoverModeSupported=function(marker){return/^(bar|line|area|hist|densityplot|scatter|bubble|errbar|errbar-agg)$/.test(marker)};res.isNumberOfRowsInPopupSupported=function(marker){return/^(bar|line|area|bubble|pie|map|geojson|easymap|heatmap|contour)$/.test(marker)};res.isColorBucketSupported=function(marker){return/^(bar|line|area|hist|densityplot|violin|boxplot|scatter|bubble|errbar|errbar-agg|map|geojson|easymap|radar|parcats)$/.test(marker)};res.getErrorBarCalcType=function(vizOptions){if(!vizOptions._desktopVersion||res.compareVersionStr(vizOptions._desktopVersion,"6.11.3")<0){return vizOptions.errbarCalcType||"mean"}if(vizOptions.marker==="errbar"){return vizOptions.y&&vizOptions.y.isNumeric&&(vizOptions.y.func===Column.OperationType.AVERAGE||vizOptions.y.func===Column.OperationType.MEAN_IF)?"mean":"ratio"}else{return vizOptions.errbarCalcType||"mean"}};res.getDefaultErrorBarDirection=function(vizOptions){if(!vizOptions._desktopVersion||res.compareVersionStr(vizOptions._desktopVersion,"6.11.3")<0){return"all"}if(vizOptions&&vizOptions.y&&/^(truecount|falsecount|nacount|nnacount)$/.test(vizOptions.y.func)){return"color"}return"all"};res.getErrorBarDirection=function(vizOptions){return vizOptions.marker==="errbar-agg"?"all":vizOptions.errbarDirection||res.getDefaultErrorBarDirection(vizOptions)};res.isOtherGroupSupported=function(opId,vizOptions){var marker=vizOptions.marker;var isColorContinuous=vizOptions.color&&res.isContinuousValue(vizOptions.color,marker,"color");switch(opId){case"categColor":return!isColorContinuous&&/^(bar|line|area|pie|hist|densityplot|scatter|bubble|boxplot|violin|errbar|errbar-agg|map|geojson|easymap|radar|parcats)$/.test(marker);case"facet":return/^(bar|line|area|pie|hist|densityplot|scatter|bubble|boxplot|violin|errbar|errbar-agg|heatmap|contour|radar|parcats)$/.test(marker)&&!(vizOptions.facet&&vizOptions.facet.type===res.TYPE_GROUP_BY_MEASURES);case"x":switch(marker){case"bar":case"line":case"area":case"errbar":case"errbar-agg":case"boxplot":case"violin":case"bubble":case"parcats":return res.returnsCharacterValue(vizOptions[opId]);case"heatmap":return true;default:return false}case"z":return false;case"groupby":switch(marker){case"bubble":return true;case"map":return vizOptions.groupby.type!==res.TYPE_ROWID;default:return false}default:if(/^y/.test(opId)){switch(marker){case"bubble":case"parcats":return res.returnsCharacterValue(vizOptions[opId]);case"heatmap":return true;default:return false}}else if(/^colh/.test(opId)){return true}else if(/^rowh/.test(opId)){return true}else{return false}}};res.isOtherGroupEnabled=function(opId,vizOptions){if(res.getOtherGroupType(opId,vizOptions)===res.OTHER_GROUP_OPTION_TYPE.NONE){return false}return res.isOtherGroupSupported(opId,vizOptions)};res.isManualSelectOtherGroupEnabled=function(opId,vizOptions){return res.isOtherGroupEnabled(opId,vizOptions)&&(vizOptions[opId+"EnableOtherGroup"]===VizUtil.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_KEEP_VALUES||vizOptions[opId+"EnableOtherGroup"]===VizUtil.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_DROP_VALUES)};res.isLogicalizeSupported=function(marker,opId,col){return opId==="color"&&/^(bar|line|area)$/.test(marker)&&col&&col.type!=="logical"};res.isLogicalizeEnabled=function(vizOptions,opId){if(!res.isLogicalizeSupported(vizOptions.marker,opId,vizOptions[opId])){return false}if(vizOptions[opId+"BucketType"]!==Column.OperationType.BUCKET_LOGICALIZE){return false}var cmd=vizOptions[opId+"BucketLogicalizeCommand"];return cmd&&cmd.conditions&&cmd.conditions.length>0};res.getBucketOptions=function(vizOptions,opId){var marker=vizOptions.marker;var col=vizOptions[opId];if(col&&col.type===VizUtil.TYPE_YAXIS){return VizUtil.BUCKET_TYPE_OPTIONS_YAXIS}else if(opId==="color"&&VizUtil.isNumericAsDiscreteValueOnColor(vizOptions)){return res.isLogicalizeSupported(marker,opId,col)?VizUtil.BUCKET_TYPE_OPTIONS_DISCRETE_NUMERIC:VizUtil.BUCKET_TYPE_OPTIONS_DISCRETE_NUMERIC_NO_LOGICALIZE}else if(res.isLogicalizeSupported(marker,opId,col)){return VizUtil.BUCKET_TYPE_OPTIONS}else if(opId==="color"&&/^(geojson|bubble|easymap|map)$/.test(marker)){return VizUtil.BUCKET_TYPE_OPTIONS_NO_LOGICALIZE_EQUAL_STEP_DISABLED_WITH_NONE}else{return VizUtil.BUCKET_TYPE_OPTIONS_NO_LOGICALIZE}};res.applyColorBucketAfterSummarize=function(marker){return/^(scatter|bubble|map|geojson|easymap)$/.test(marker)};res.useIndexForColorHighlighting=function(bucketType,noColor,isCategorical){return!noColor&&!isCategorical&&bucketType!=="none"},res.isIncludeOutlierEnabled=function(marker,includeOutlierPropValue){if(!includeOutlierPropValue){return!/^(violin|boxplot)$/.test(marker)}return includeOutlierPropValue==="on"};res.POST_FILTER_COLUMN_NAME=".postfilter";res.getDefaultPostFilterType=function(){return"none"};res.getDefaultPostFilterTargetColumn=function(vizOptions,option){switch(vizOptions.marker){case"r-wordcloud":case"parcats":return"size";case"geojson":return"colorbucket";case"violin":case"boxplot":case"errbar":case"errbar-agg":case"bar":case"line":case"area":return"y";case"bubble":if(option==="y"){return"x"}else{return"y"}default:return null}};res.getPostFilterDefaultTargetColumn=function(vizOptions,option){var defaultTarget=res.getDefaultPostFilterTargetColumn(vizOptions,option);return defaultTarget&&vizOptions[defaultTarget]&&res.returnsNumericValue(vizOptions[defaultTarget])?vizOptions[defaultTarget]:null};res.isPostFilterSupported=function(vizOptions,option){option=option==="categColor"?"color":option;if(option==="facet"&&vizOptions[option]&&vizOptions[option].type===res.TYPE_GROUP_BY_MEASURES){return false}switch(vizOptions.marker){case"geojson":case"r-wordcloud":return option==="x";case"bar":case"errbar":case"errbar-agg":case"violin":case"boxplot":return/^(x|color|facet)$/.test(option);case"line":case"area":case"hist":case"densityplot":case"radar":return/^(color|facet)$/.test(option);case"bubble":return/^(x|y|color|facet|groupby)$/.test(option);case"parcats":return/^(x|y|color|facet)$/.test(option);case"pivot":case"summarytable":return/^(rowh|colh)/.test(option);default:return false}};res.isPostFilterEnabled=function(vizOptions,option){option=option==="categColor"?"color":option;if(!vizOptions[option]){return false}switch(vizOptions.marker){case"geojson":return option==="x"&&!res.returnsNumericValue(vizOptions[option]);case"r-wordcloud":return option==="x"&&vizOptions.size&&vizOptions[option].type!=="logical";case"bar":case"errbar":case"errbar-agg":return option==="x"&&res.returnsCharacterValue(vizOptions[option])||/^(color|facet)$/.test(option)&&!res.returnsNumericValue(vizOptions[option]);case"violin":case"boxplot":return/^(x|color|facet)$/.test(option)&&!res.returnsNumericValue(vizOptions[option]);case"line":case"area":case"hist":case"densityplot":case"radar":return/^(color|facet)$/.test(option)&&!res.returnsNumericValue(vizOptions[option]);case"parcats":return/^(x|y|color|facet)$/.test(option)&&!res.returnsNumericValue(vizOptions[option]);case"bubble":return/^(x|y|color|facet|groupby)$/.test(option)&&!res.returnsNumericValue(vizOptions[option]);case"pivot":case"summarytable":return/^(rowh|colh)/.test(option);default:return false}};res.POST_FILTER_PRIORITY_HASH={x:2,y:2,groupby:3,color:4,facet:1};res.POST_FILTER_TARGET_OPTIONS=Object.keys(res.POST_FILTER_PRIORITY_HASH).sort(function(a,b){return res.POST_FILTER_PRIORITY_HASH[b]-res.POST_FILTER_PRIORITY_HASH[a]});res.getPostFilterPriority=function(opId){return res.POST_FILTER_PRIORITY_HASH[opId]||999};res.isDualYSupported=function(marker,barstyle){return/^(bar|scatter|line)$/.test(marker)};res.getValueSuffix=function(winfunc,colfunc,numberFormatting,marker,errbarCalcType,errbarDirection){if(numberFormatting==="percentage"&&/^(bar|line|area|scatter|bubble|pivot|singlevalue|table|summarytable|errbar|errbar-agg|radar|hist|densityplot|boxplot|violin|map|geojson|easymap|heatmap|contour|pie)$/.test(marker)){return"%"}if(colfunc&&/^(truepct|falsepct|napct|nnapct)$/.test(colfunc)){return"%"}if(marker==="errbar"&&errbarCalcType==="ratio"&&errbarDirection==="color"&&colfunc&&/^(truecount|falsecount|nacount|nnacount|countd|count)$/.test(colfunc)){return"%"}if(marker==="errbar-agg"&&errbarCalcType==="ratio"){return"%"}if(!winfunc){return""}else{return/(^ptotal$|^pdf|^pof|^pcumsum$|^prank$)/.test(winfunc)?"%":""}};res.getValuePrefix=function(numberFormatting,prefix,marker){if(numberFormatting==="currency"&&/^(bar|line|area|scatter|bubble|pivot|singlevalue|table|summarytable|errbar|errbar-agg|radar|hist|densityplot|boxplot|violin|map|geojson|easymap|heatmap|contour|pie)$/.test(marker)){return prefix||"$"}return""};res.isColumnObject=function(col){return col&&col.name&&col.func},res.returnsNumericValue=function(col){if(!res.isColumnObject(col)){throw new Error("Invalid argument was passed to returnsNumericValue: "+JSON.stringify(col||"col is empty."))}return col.isNumeric&&col.func!=="aschar"||/^(sum|count|countd|ave|mean|median|min|max|var|sd|iqr|mad|nacount|nnacount|napct|nnapct|na_ratio|nna_ratio|truecount|falsecount|truepct|falsepct|true_ratio|false_ratio|odds|asint|asintby10|ascategory|asnum)/.test(col.func)||col.isDate&&/^(year|halfyear|quarter|bimon|mon|day|hour|minute|second|week|epiweek|isoweek|week_of_quarter|week_of_month|dayofyear|dayofquarter|dayofweek|hour_num|minute_num|second_num)$/.test(col.func)||/difftime/.test(col.type)&&/(nth|quantile|mode|first|last)/.test(col.func)};var HANDLE_OUTPUT_AS_CATEGORICAL=[Column.OperationType.AS_INTEGER,Column.OperationType.AS_INTEGER_BY10,Column.OperationType.ABS,Column.OperationType.LOG,Column.OperationType.LOG2,Column.OperationType.LOG10,Column.OperationType.YEAR,Column.OperationType.HALF_YEAR,Column.OperationType.QUARTER,Column.OperationType.BI_MONTH,Column.OperationType.MONTH,Column.OperationType.WEEK,Column.OperationType.WEEK_SUNDAY_START,Column.OperationType.WEEK_MONDAY_START,Column.OperationType.WEEK_OF_QUARTER,Column.OperationType.WEEK_OF_MONTH,Column.OperationType.DAY,Column.OperationType.DAY_OF_YEAR,Column.OperationType.DAY_OF_QUARTER,Column.OperationType.DAY_OF_WEEK,Column.OperationType.HOUR,Column.OperationType.MINUTE,Column.OperationType.SECOND,Column.OperationType.AS_CHAR,Column.OperationType.AS_LOGICAL_FACTOR,Column.OperationType.AS_DISCRETE_VALUES];var HANDLE_OUTPUT_AS_CATEGORICAL_AT_COLOR=[Column.OperationType.YEAR,Column.OperationType.HALF_YEAR,Column.OperationType.QUARTER,Column.OperationType.BI_MONTH,Column.OperationType.MONTH,Column.OperationType.WEEK,Column.OperationType.WEEK_SUNDAY_START,Column.OperationType.WEEK_MONDAY_START,Column.OperationType.WEEK_OF_QUARTER,Column.OperationType.WEEK_OF_MONTH,Column.OperationType.DAY,Column.OperationType.DAY_OF_YEAR,Column.OperationType.DAY_OF_QUARTER,Column.OperationType.DAY_OF_WEEK,Column.OperationType.HOUR,Column.OperationType.MINUTE,Column.OperationType.SECOND,Column.OperationType.AS_CHAR,Column.OperationType.AS_LOGICAL_FACTOR,Column.OperationType.AS_DISCRETE_VALUES];res.isContinuousValue=function(col,marker,option){if(option==="color"){if(marker==="bubble"){return res.returnsNumericValue(col)&&HANDLE_OUTPUT_AS_CATEGORICAL.indexOf(col.func)===-1&&col.func!==Column.OperationType.AS_NUM}else if(marker==="maphmap"){return res.returnsNumericValue(col)}else if(marker==="pie"){return false}else if(marker==="scatter"){return res.returnsNumericValue(col)&&HANDLE_OUTPUT_AS_CATEGORICAL_AT_COLOR.indexOf(col.func)===-1&&col.func!==Column.OperationType.NONE}else{return res.returnsNumericValue(col)&&HANDLE_OUTPUT_AS_CATEGORICAL_AT_COLOR.indexOf(col.func)===-1}}else{var v=res.returnsNumericValue(col)&&HANDLE_OUTPUT_AS_CATEGORICAL.indexOf(col.func)===-1;if(marker==="bubble"&&/^(x$|y)/.test(option)&&col.func===Column.OperationType.AS_NUM){v=false}return v}};res.returnsDateValue=function(col){if(!res.isColumnObject(col)){throw new Error("Invalid argument was passed to returnsDateValue.")}return col.isDate&&(!col.func||/^(rto|none$|mode$|datemin$|datemax$|first$|last$|nth$)/.test(col.func))};res.returnsCharacterValue=function(col){if(!res.isColumnObject(col)){throw new Error("Invalid argument was passed to returnsCharacterValue.")}return!res.returnsNumericValue(col)&&!res.returnsDateValue(col)};res.isEmpty=function(val,handleEmptyStringAsEmpty){if(handleEmptyStringAsEmpty){return typeof val==="undefined"||val===null||val===""}else{return typeof val==="undefined"||val===null}};res.isUndefined=function(val){return typeof val==="undefined"};res.shouldRenderNoData=function(data,options){if(options._lastQueryErrorMessage){return true}switch(options.marker){case"geojson":return!options.geojson;case"easymap":return!options.easymapMap;case"singlevalue":return false;case"pivot":case"summarytable":return!data||data.length===0||!data[0]||data[0].length===0;default:if(/^r-/.test(options.marker)){return!data||!data.outputFile}else{return!data||data.length===0}}};var BalloonItemList=function(){this.top=[];this.main=[];this.bottom=[];this.indexed=[]};BalloonItemList.prototype.toArray=function(){if(this.indexed.length>0){return this.indexed.sort(function(a,b){return a.index-b.index}).map(function(x){return x.item})}else{return this.top.concat(this.main).concat(this.bottom)}};BalloonItemList.prototype.add=function(item,marker,option,isNumeric,section,index,addBrackets,invisible){if(invisible){return}if(typeof item==="string"&&addBrackets){item="("+item+")"}if(typeof index==="number"){this.indexed.push({index:index,item:item});return}if(typeof item==="string"){var _idx=this.top.indexOf(item);if(_idx>-1){return}_idx=this.bottom.indexOf(item);if(_idx>-1){return}_idx=this.main.indexOf(item);if(_idx>-1){this.main.splice(_idx,1)}}if(section==="bottom"){this.bottom.unshift(item);return}if(/^label/.test(option)||section==="top"){this.top.push(item);return}switch(marker){case"bar":case"errbar":case"errbar-agg":case"line":case"area":case"boxplot":case"violin":if(/^(x)$/.test(option)){this.top.push(item)}else{this.main.push(item)}break;case"heatmap":case"contour":if(/^(x|y)$/.test(option)){this.top.push(item)}else{this.main.push(item)}break;case"hist":case"densityplot":this.main.push(item);break;default:if(/^(x$|y|z|groupby)/.test(option)&&!isNumeric){this.top.push(item)}else{this.main.push(item)}break}};res.BalloonItemList=BalloonItemList;res.generateHighlightOnPaletteColorScale=function(baseColorScale,highlightValues,recodeValues){if(!highlightValues){return baseColorScale}if(recodeValues){highlightValues=JSON.parse(JSON.stringify(highlightValues));highlightValues.forEach(function(v){if(!res.isEmpty(recodeValues[v.value])){v.value=recodeValues[v.value]}})}var hash={};highlightValues.forEach(function(v){hash[v.value]=v.color});var scaleFunc=function(val){var color=baseColorScale(val);return res.isEmpty(hash[val])?color:hash[val]};scaleFunc.domain=function(x){return x===null||x===undefined?baseColorScale.domain():baseColorScale.domain(x)};scaleFunc.isCustomColorScale=true;return scaleFunc};res.generateHighlightColorScale=function(defaultColor,highlightValues,recodeValues){if(recodeValues){highlightValues=JSON.parse(JSON.stringify(highlightValues));highlightValues.forEach(function(v){if(!res.isEmpty(recodeValues[v.value])){v.value=recodeValues[v.value]}})}var hash={};var ohash={};var ovhash={};highlightValues.forEach(function(v,idx,arr){hash[v.value]=v.color;ohash[v.color]=arr.length-idx;ovhash[v.value]=arr.length-idx});var scaleFunc=function(val){return!hash[val]?defaultColor:hash[val]};scaleFunc.domain=function(){return[]};scaleFunc.getOrderByColor=function(val){return!ohash[val]?0:ohash[val]};scaleFunc.getOrderByValue=function(val){return!ovhash[val]?0:ovhash[val]};scaleFunc.isHighlightColorScale=true;return scaleFunc};res.renderNoData=function(div,msg,borderCss,hintText,lang){if(!div){return}var h="100%";var rect=div.getBoundingClientRect();if(rect&&rect.height&&rect.height>0){h=rect.height+"px"}div.innerHTML='<div style="width:100%; height:'+h+'; display:table;" class="viz-rendering-error">'+'<div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; padding:0 40px; '+(borderCss?"border:"+borderCss:"")+'">'+"<div>"+VizUtil.getMessage(lang,msg?msg:"There is no data to display.")+"</div>"+(hintText?'<div style="width:360px; margin:auto; margin-top:15px">'+VizUtil.getMessage(lang,hintText)+"</div>":"")+"</div>"+"</div>"};res.COLOR_PALETTE_REGEX=/((rgb[a]*\([0-9 \,\.]*\))|\#[0-9a-fA-F]+)/g;res.isInColumnarFormat=function(data){return Object.prototype.toString.call(data)!=="[object Array]"};res.convertColumnarData=function(data){if(!data||!res.isInColumnarFormat(data)){return data}var cols=Object.keys(data),rows=[],idx=0,row=null;if(cols.length===0){return rows}while(idx<data[cols[0]].length){row={};cols.forEach(function(col){row[col]=data[col][idx]});rows.push(row);idx++}return rows};res.translateColumnData=function(data,viz,lang,enableRegexTranslation){if(!data||!viz||viz.translate!=="on"){return data}var cols=viz.translateTargetColumns;if(viz.translateTargetColumnsString){cols=viz.translateTargetColumnsString.split(",")}if(!cols){return data}var idxs;if(viz.marker==="table"&&data.length>1){idxs=[];var tcols=res.getOptions(viz,"tcol");tcols.forEach(function(col,idx){if(col&&cols.indexOf(col.name)>-1){idxs.push(idx)}});if(idxs.length===0){return data}data[0].forEach(function(row){idxs.forEach(function(idx){row[idx]=VizUtil.getMessage(lang,row[idx],enableRegexTranslation)})})}else if(/^(pivot|summarytable)$/.test(viz.marker)&&data.length>1){idxs=[];var rowhs=res.getOptions(viz,"rowh").filter(function(col){return!!col}).forEach(function(col,idx){if(cols.indexOf(col.name)>-1){idxs.push(idx)}});if(idxs.length===0){return data}data[0].forEach(function(row){idxs.forEach(function(idx){row[idx]=VizUtil.getMessage(lang,row[idx],enableRegexTranslation)})})}else if(res.isPlotly(viz.marker)){var labels=[];Object.keys(viz).forEach(function(key){if(viz[key]&&viz[key].name&&viz[key].func&&cols.indexOf(viz[key].name)>-1){labels.push(viz[key].label)}});if(labels.length===0){return data}data.forEach(function(row){labels.forEach(function(label){if(row&&label&&row[label]){row[label]=VizUtil.getMessage(lang,row[label],enableRegexTranslation)}})})}return data};res.translateBucketLabels=function(data,viz,lang){var ht={},v;if(!data||!viz){return data}if(/^(pivot|summarytable)$/.test(viz.marker)&&data.length>1){var rowIdxs=[],colIdxs=[];res.getOptions(viz,"rowh").forEach(function(col,idx){if(col&&res.isColumnObject(col)&&res.getBucketType("rowh"+idx,viz)!=="none"){rowIdxs.push(idx)}});res.getOptions(viz,"colh").forEach(function(col,idx){if(col&&res.isColumnObject(col)&&res.getBucketType("colh"+idx,viz)!=="none"){colIdxs.push(idx)}});if(rowIdxs.length>0){rowIdxs.forEach(function(idx){ht["rowh"+idx]={};data[0].forEach(function(row){v=VizUtil.getMessage(lang,row[idx],true,"_regexBucketLabelMessages");if(row[idx]!==v){ht["rowh"+idx][v]=row[idx];row[idx]=v}})})}if(colIdxs.length>0){colIdxs.forEach(function(idx){ht["colh"+idx]={};data[1]=data[1].map(function(label){v=VizUtil.getMessage(lang,label,true,"_regexBucketLabelMessages");if(label!==v){ht["colh"+idx][v]=label}return v})})}}else{var targets=[];Object.keys(viz).forEach(function(key){if(res.isColumnObject(viz[key])&&res.returnsNumericValue(viz[key])&&!/^(rowh|colh|meas)/.test(key)&&res.getBucketType(key,viz)!=="none"){targets.push({option:key,label:viz[key].label})}});if(targets.length===0){return ht}var label,op;targets.forEach(function(target){op=target.option;label=target.label;ht[op]={};data.forEach(function(row){if(row&&label&&row[label]){v=VizUtil.getMessage(lang,row[label],true,"_regexBucketLabelMessages");if(row[label]!==v){ht[op][v]=row[label];row[label]=v}}})})}return ht};var decimalAdjust=function(type,value,exp){if(typeof exp==="undefined"||+exp===0){return Math[type](value)}value=+value;exp=+exp;if(value===null||isNaN(value)||!(typeof exp==="number"&&exp%1===0)){return NaN}if(value<0){return-decimalAdjust(type,-value,exp)}value=value.toString().split("e");value=Math[type](+(value[0]+"e"+(value[1]?+value[1]-exp:-exp)));value=value.toString().split("e");return+(value[0]+"e"+(value[1]?+value[1]+exp:exp))};res.round10=function(value,exp){return decimalAdjust("round",value,-exp)};res.floor10=function(value,exp){return decimalAdjust("floor",value,-exp)};res.ceil10=function(value,exp){return decimalAdjust("ceil",value,-exp)};res.isInSameCategory=function(dataType,targetDataType){dataType=/^(integer|double)/.test(dataType)?"numeric":/^(POSIX)/.test(dataType)?"Date":dataType;targetDataType=/^(integer|double)/.test(targetDataType)?"numeric":/^(POSIX)/.test(targetDataType)?"Date":targetDataType;return dataType===targetDataType};res.valueFormatterGenerator=function(numDecimalDigits,useThousandSeparator,truncateTrailingZeros,useUnitName){var fmtstr=useThousandSeparator===false?"":",";if(!res.isEmpty(numDecimalDigits,true)){fmtstr+="."+numDecimalDigits+"f"}var ufmtr=null;if(useUnitName&&!res.isEmpty(numDecimalDigits,true)){ufmtr=d3.format("."+(parseInt(numDecimalDigits)+4)+"s")}var fmtr=d3.format(fmtstr);var addEllipsis=function(v){var s=v.toString();return s.length>60?s.substr(0,60)+"...":s};return function(v,skipNumberFormatting){var s,unitstr="";if(v===undefined||v===null||v==="")return"";if(skipNumberFormatting){return addEllipsis(v)}if(ufmtr){s=ufmtr(v);if(s!=="NaN"&&!/[\d]$/.test(s)){unitstr=s[s.length-1];v=s.substr(0,s.length-1)}}s=fmtr(v);if(s==="NaN"&&v.replace){s=fmtr(v.replace(/,/g,""))}if(s!=="NaN"){if(truncateTrailingZeros&&s.indexOf(".")!==-1&&s.indexOf("e")===-1){s=s.replace(/[0]+$/,"");s=s.replace(/[\.]$/,"")}return s+unitstr}else{return addEllipsis(v)}}};res.addOpacity=function(str,opacity){var p=typeof ratio==="string"?parseFloat(opacity):opacity;var code=res.getRGBACode(str);return"rgba("+code.r+","+code.g+","+code.b+","+p+")"};res.getRGBACode=function(str){var s,r,g,b,a;if(/rgb/.test(str)){s=str.replace(/(rgb\(|rgba\(|\))/g,"");s=s.split(",");r=parseInt(s[0]);g=parseInt(s[1]);b=parseInt(s[2]);a=s.length>3?s[3]:1}else{s=str.replace("#","");r=parseInt(s.substring(0,2),16);g=parseInt(s.substring(2,4),16);b=parseInt(s.substring(4,6),16);a=1}return{r:r,g:g,b:b,a:a}};res.isSortable=function(options,sortTarget,sortByTarget){return!(!options||!sortTarget||!sortByTarget||!options[sortTarget]||!options[sortByTarget]||!res.returnsCharacterValue(options[sortTarget])||!res.isContinuousValue(options[sortByTarget],options.marker,sortByTarget))};res.isSortSupported=function(marker){return/^(bar|errbar|errbar-agg|bubble|boxplot|violin)$/.test(marker)};res.getDefaultSyncXAxis=function(marker){return"on"};res.getDefaultSyncYAxis=function(marker,isGroupByMeasuresEnabled){return marker==="densityplot"||isGroupByMeasuresEnabled?"off":"on"};res.getDefaultFacetHorizontalPadding=function(vizOptions){return vizOptions.marker==="radar"?120:40};res.getDefaultFacetVerticalPadding=function(vizOptions){return 80};res.getDefaultTopMargin=function(vizOptions){return!vizOptions.title?["radar","pie","parcats"].includes(vizOptions.marker)?20:10:40};res.getDefaultBottomMargin=function(vizOptions){return["radar","pie","parcats"].includes(vizOptions.marker)?20:60};res.getDefaultLeftMargin=function(vizOptions){return 60};res.getDefaultRightMargin=function(vizOptions){return res.getColsOn2ndAxis(vizOptions).length>0?70:["radar","pie","parcats"].includes(vizOptions.marker)?60:15};res.getColsOn2ndAxis=function(vizOptions){var cols=[];Object.keys(vizOptions).forEach(function(key){if(/^y[\d]*$/.test(key)){var use2ndAxis=vizOptions[key]&&vizOptions[key+"Use2ndAxis"]==="on"&&res.isDualYSupported(vizOptions.marker,vizOptions.barstyle);if(use2ndAxis){cols.push(vizOptions[key])}}});return cols};res._migratePivotVisualFormatting=function(col){if(!col){return}if(col.formattingType==="bar"){col.formattingType="posneg";col.formattingTarget="bar"}else if(!col.formattingType){delete col.formattingTarget}};res._migrateShowValueOnPlot=function(vizOptions){var yValueOnPlot=vizOptions.yValueOnPlot;if(!yValueOnPlot){return}else if(yValueOnPlot==="top"||yValueOnPlot==="bottom"||yValueOnPlot==="middle"){if(res.isShowValueOnPlotSupported(vizOptions.marker)){VizUtil.getOptions(vizOptions,"y").forEach(function(col,idx){var opId="y"+(idx===0?"":idx)+"ValueOnPlot";vizOptions[opId]="on"});vizOptions.yValueOnPlotPosition=yValueOnPlot;if(!VizUtil.isEmpty(vizOptions.yValueOnPlotThreshold,true)){vizOptions.yValueOnPlotUpperThreshold=vizOptions.yValueOnPlotThreshold;vizOptions.yValueOnPlotTarget="threshold";vizOptions.yValueOnPlotRangeType="not-between"}}else{delete vizOptions.yValueOnPlot}}else if(yValueOnPlot==="none"){delete vizOptions.yValueOnPlot}};res._migratePieShowValueOnPlot=function(vizOptions){vizOptions.pieValueOnPlotThreshold=vizOptions.pieValueOnPlotThreshold||"5";vizOptions.pieValueOnPlotRangeType="gte";vizOptions.pieValueOnPlotTarget="threshold"};res.migrateJson=function(viz){var clone=null;if(viz&&viz.marker==="r-wordcloud"&&(!viz._desktopVersion||res.compareVersionStr(viz._desktopVersion,"6.5.0.0")<0)&&viz.color){clone=JSON.parse(JSON.stringify(viz));clone.size=JSON.parse(JSON.stringify(clone.color));clone.quantColorPalette=clone.categColorPalette||"default";clone.reverseColorPaletteOrder=!clone.reverseColorPaletteOrder?"on":clone.reverseColorPaletteOrder==="on"?"off":"on"}if(viz&&viz.marker==="pivot"&&(!viz._desktopVersion||res.compareVersionStr(viz._desktopVersion,"6.7.0.1")<0)){if(!clone){clone=JSON.parse(JSON.stringify(viz))}var pivotColor=null;if(clone.pivotColor){switch(clone.pivotColor){case"row5":case"row":case"table_across":pivotColor="table_across";break;case"row_group":case"pane_down_across":pivotColor="pane_down_across";break;case"column":case"table_down":pivotColor="table_down";break;case"pane_down":pivotColor="pane_down";break;case"table5":case"all":case"table_down_across":pivotColor="table_down_across";break;default:break}}Object.keys(clone).forEach(function(x){if(/^rowh[\d]+$/.test(x)&&clone[x]){if(clone.pivotSortTarget&&clone.pivotSortTarget.name===clone[x].name){clone[x].sortOrder=clone.pivotSortOrder==="sortdesc"?"desc":"asc"}if(clone[x+"CellWidth"]){clone[x].cellWidth=clone[x+"CellWidth"];delete clone[x+"CellWidth"]}if(clone[x+"Title"]){clone[x].displayName=clone[x+"Title"];delete clone[x+"Title"]}}else if(/^colh[\d]+$/.test(x)&&clone[x]){if(clone[x+"Title"]){clone[x].displayName=clone[x+"Title"];delete clone[x+"Title"]}}else if(/^meas[\d]+$/.test(x)&&clone[x]){if(pivotColor&&pivotColor!=="none"){clone[x].formattingType="color";clone[x].formattingTarget="bgcolor";clone[x].formattingDirection=pivotColor;clone[x].reverseColorPalette=clone.reverseColorPaletteOrder;clone[x].colorSetZeroToCenter=clone.colorSetZeroToCenter;if(clone.quantColorPalette&&VizUtil.returnsNumericValue(clone[x])){clone[x].colorPalette=clone.quantColorPalette}if(clone.categColorPalette&&!VizUtil.returnsNumericValue(clone[x])){clone[x].colorPalette=clone.categColorPalette}}if(clone[x+"NumberFormatting"]){clone[x].numberFormatting=clone[x+"NumberFormatting"];delete clone[x+"NumberFormatting"]}if(clone[x+"CurrencySymbol"]){clone[x].currencySymbol=clone[x+"CurrencySymbol"];delete clone[x+"CurrencySymbol"]}if(clone["meas0CellWidth"]){clone[x].cellWidth=clone["meas0CellWidth"]}if(clone[x+"UrlTemplate"]){clone[x].url=clone[x+"UrlTemplate"];delete clone[x+"UrlTemplate"]}if(clone[x+"UrlEncodeParameters"]){clone[x].urlEncodeParameters=clone[x+"UrlEncodeParameters"];delete clone[x+"UrlEncodeParameters"]}if(clone[x+"Title"]){clone[x].displayName=clone[x+"Title"];delete clone[x+"Title"]}}});delete clone.meas0CellWidth;delete clone.pivotSortTarget;delete clone.pivotSortOrder;delete clone.pivotColor;delete clone.quantColorPalette;delete clone.categColorPalette;delete clone.reverseColorPaletteOrder;delete clone.colorSetZeroToCenter}if(viz&&["pivot","summarytable"].includes(viz.marker)&&(!viz._desktopVersion||res.compareVersionStr(viz._desktopVersion,"6.10.0")<0)){if(!clone){clone=JSON.parse(JSON.stringify(viz))}var meas=VizUtil.getOptions(clone,"meas");meas.forEach(function(m){if(!m){return}switch(m.func){case Column.OperationType.TRUE_PCT:m.func=Column.OperationType.TRUE_RATIO;m.numberFormatting="percentage";break;case Column.OperationType.FALSE_PCT:m.func=Column.OperationType.FALSE_RATIO;m.numberFormatting="percentage";break;case Column.OperationType.NA_PCT:m.func=Column.OperationType.NA_RATIO;m.numberFormatting="percentage";break;case Column.OperationType.NON_NA_PCT:m.func=Column.OperationType.NON_NA_RATIO;m.numberFormatting="percentage";break}})}if(viz&&res.isColorStackDirectionSupported(viz)&&(!viz._desktopVersion||res.compareVersionStr(viz._desktopVersion,"6.11.0")<0)&&!viz.colorStackDirection){if(!clone){clone=JSON.parse(JSON.stringify(viz))}clone.colorStackDirection=clone.marker==="pie"&&clone.color&&clone.color.type==="character"&&clone.pieSortByValue!=="off"?"descByValue":"normal";clone.colorLegendDirection="normal"}if(viz&&viz.marker==="singlevalue"&&viz.meas0&&(!viz._desktopVersion||res.compareVersionStr(viz._desktopVersion,"6.12.0")<0)){if(!clone){clone=JSON.parse(JSON.stringify(viz))}if(clone.svNumberFormatting){clone.meas0.numberFormatting=clone.svNumberFormatting;delete clone.svNumberFormatting}if(clone.numDecimalDigits){clone.meas0.numDecimalDigits=clone.numDecimalDigits;delete clone.numDecimalDigits}if(clone.useThousandSeparator){clone.meas0.useThousandSeparator=clone.useThousandSeparator;delete clone.useThousandSeparator}if(clone.svCurrencySymbol){clone.meas0.currencySymbol=clone.svCurrencySymbol;delete clone.svCurrencySymbol}}if(viz&&viz.marker==="singlevalue"&&viz.meas0&&(!viz._desktopVersion||res.compareVersionStr(viz._desktopVersion,"6.12.0")<0)){if(!clone){clone=JSON.parse(JSON.stringify(viz))}if(clone.svNumberFormatting){clone.meas0.numberFormatting=clone.svNumberFormatting;delete clone.svNumberFormatting}if(clone.numDecimalDigits){clone.meas0.numDecimalDigits=clone.numDecimalDigits;delete clone.numDecimalDigits}if(clone.useThousandSeparator){clone.meas0.useThousandSeparator=clone.useThousandSeparator;delete clone.useThousandSeparator}if(clone.svCurrencySymbol){clone.meas0.currencySymbol=clone.svCurrencySymbol;delete clone.svCurrencySymbol}}if(viz&&(!viz._desktopVersion||res.compareVersionStr(viz._desktopVersion,"6.12.3")<0)){Object.keys(viz).forEach(function(key){if(key.endsWith("BucketType")&&viz[key]&&!viz[key.replace("BucketType","BucketIncludeRightEdge")]){if(!clone){clone=JSON.parse(JSON.stringify(viz))}clone[key.replace("BucketType","BucketIncludeRightEdge")]="on"}})}if(viz&&["pivot","summarytable","table"].includes(viz.marker)&&(!viz._desktopVersion||res.compareVersionStr(viz._desktopVersion,"6.13.0")<0)){if(!clone){clone=JSON.parse(JSON.stringify(viz))}var cols=null;cols=VizUtil.getOptions(clone,"rowh");cols.forEach(res._migratePivotVisualFormatting);cols=VizUtil.getOptions(clone,"colh");cols.forEach(res._migratePivotVisualFormatting);cols=VizUtil.getOptions(clone,"meas");cols.forEach(res._migratePivotVisualFormatting);cols=VizUtil.getOptions(clone,"tcol");cols.forEach(res._migratePivotVisualFormatting)}if(viz&&["singlevalue"].includes(viz.marker)&&viz.meas0&&(!viz._desktopVersion||res.compareVersionStr(viz._desktopVersion,"6.13.0")<0)){if(!clone){clone=JSON.parse(JSON.stringify(viz))}switch(clone.meas0.func){case Column.OperationType.TRUE_PCT:clone.meas0.func=Column.OperationType.TRUE_RATIO;clone.meas0.numberFormatting="percentage";break;case Column.OperationType.FALSE_PCT:clone.meas0.func=Column.OperationType.FALSE_RATIO;clone.meas0.numberFormatting="percentage";break;case Column.OperationType.NA_PCT:clone.meas0.func=Column.OperationType.NA_RATIO;clone.meas0.numberFormatting="percentage";break;case Column.OperationType.NON_NA_PCT:clone.meas0.func=Column.OperationType.NON_NA_RATIO;clone.meas0.numberFormatting="percentage";break}}if(viz&&!VizUtil.isEmpty(viz.yValueOnPlotThreshold)&&["bar","line","area","pie","hist","errbar","errbar-agg","radar"].includes(viz.marker)&&viz.y&&VizUtil.getValueSuffix(viz.yWindowFunc,viz.y.func,viz.yAxisNumberFormatting,viz.marker,VizUtil.getErrorBarCalcType(viz),VizUtil.getErrorBarDirection(viz))==="%"&&(!viz._desktopVersion||res.compareVersionStr(viz._desktopVersion,"7.1")<0)){if(!clone){clone=JSON.parse(JSON.stringify(viz))}clone.yValueOnPlotThreshold=parseFloat(clone.yValueOnPlotThreshold)/100}if(viz&&["pivot","summarytable","singlevalue","table"].includes(viz.marker)&&(!viz._desktopVersion||res.compareVersionStr(viz._desktopVersion,"7.1")<0)){if(!clone){clone=JSON.parse(JSON.stringify(viz))}var meas=clone.marker==="table"?VizUtil.getOptions(clone,"tcol"):VizUtil.getOptions(clone,"meas");meas.filter(function(m){return!!m}).forEach(function(m,idx){var winFunc=clone.marker==="singlevalue"?null:clone[(clone.marker==="table"?"tcol":"meas")+idx+"WindowFunc"];var numFormat=m.numberFormatting||VizUtil.getDefaultNumberFormattingOption(clone.marker,clone.meas0?clone.meas0.func:null);if(VizUtil.returnsNumericValue(m)&&m.conditionalFormattings&&VizUtil.getValueSuffix(winFunc,m.func,numFormat,viz.marker)==="%"){m.conditionalFormattings.forEach(function(cf){if(VizUtil.isEmpty(cf.value,true)){return}var _v=null;switch(cf.operator||"eq"){case"gt":case"gte":case"lt":case"lte":case"eq":case"ne":_v=parseFloat(cf.value)/100;if(!isNaN(_v)){cf.value=_v+""}break;case"in":case"ni":case"between":case"not-between":_v=cf.value.split(",").map(function(v){v=parseFloat(v)/100;return isNaN(v)?null:v+""}).filter(function(v){return!!v}).join(",");if(!VizUtil.isEmpty(_v,true)){cf.value=_v}break}})}})}if(viz&&viz.legendLocation==="none"&&(!viz._desktopVersion||res.compareVersionStr(viz._desktopVersion,"8.0")<0)){if(!clone){clone=JSON.parse(JSON.stringify(viz))}clone.showLegend="off";clone.legendLocation=""}if(viz&&viz.yValueOnPlot&&(!viz._desktopVersion||res.compareVersionStr(viz._desktopVersion,"8.0")<0)){if(!clone){clone=JSON.parse(JSON.stringify(viz))}VizUtil._migrateShowValueOnPlot(clone)}if(viz&&viz.marker==="table"&&(!viz._desktopVersion||res.compareVersionStr(viz._desktopVersion,"8.0")<0)){if(!clone){clone=JSON.parse(JSON.stringify(viz))}Object.keys(clone).forEach(function(x){if(/^tcol[\d]+$/.test(x)&&clone[x]){if(clone[x+"UrlTemplate"]){if(!clone[x].url){clone[x].url=clone[x+"UrlTemplate"]}delete clone[x+"UrlTemplate"]}}})}if(viz&&viz.marker==="pie"&&(!viz._desktopVersion||res.compareVersionStr(viz._desktopVersion,"8.3")<0)&&!viz.pieValueOnPlotTarget){if(!clone){clone=JSON.parse(JSON.stringify(viz))}res._migratePieShowValueOnPlot(clone)}return clone},res.analyticify=function(viz,columns){var options=viz.options?viz.options:viz;if(options.dropColorColumnIfNotExist&&!VizUtil.isColumnObject(options.color)){options.color=null}if(!options.facetEnableOtherGroup){options.facetEnableOtherGroup=res.OTHER_GROUP_OPTION_TYPE.NONE}if(!options.categColorEnableOtherGroup){options.categColorEnableOtherGroup=res.OTHER_GROUP_OPTION_TYPE.NONE}if(!options.showFacetLayoutTool){options.showFacetLayoutTool="on"}if(options.marker==="table"&&!options.disableDecimalFormatting){options.disableDecimalFormatting=true}if(options.marker==="table"&&!options.tableShowAllColumn){options.tableShowAllColumn="on"}if(options.marker==="table"&&options.tableShowAllColumn==="on"){if(!options.tableMaxNumCol){options.tableMaxNumCol=1e4}if(!options.tableMaxNumRow){options.tableMaxNumRow=-1}options.tableMaxNumColToShow=200;options.tableMaxNumRowToShow=1e3}if(options.marker==="heatmap"){options.yAxisDirection="reversed"}if(options["x"]){options["xReflineColor"]=options["xReflineColor"]||"#53585F";options["xReflineWidth"]=options["xReflineWidth"]||"2";options["xReflineStyle"]=options["xReflineStyle"]||"dot"}for(var i=0;i<MAX_NUMBER_OF_CONTROLS.y;i++){var op="y"+(i===0?"":i);if(options[op]){options[op+"ReflineColor"]=options[op+"ReflineColor"]||"#53585F";options[op+"ReflineWidth"]=options[op+"ReflineWidth"]||"2";options[op+"ReflineStyle"]=options[op+"ReflineStyle"]||"dot"}}if(options.densityBwNumber){options.densityBw="custom"}if(VizUtil.isNumericAsDiscreteValueOnColor(options)&&!options.categColorPalette){options.categColorPalette="default"}if(!options.categColorPalette&&!options.categColorPaletteDefault&&options.color&&/factor/.test(options.color.type)&&res.getBucketType("color",options)==="none"){options.categColorPaletteDefault="default"}if(options.marker==="bar"&&!options.showSyncXAxisOptionInToolbar){options.showSyncXAxisOptionInToolbar="off"}if(options.color&&options.overridingColumnForColor&&options[options.overridingColumnForColor]){options.color.name=options[options.overridingColumnForColor].name;options.color.validName=options[options.overridingColumnForColor].validName;options.color.displayName=options[options.overridingColumnForColor].displayName}return viz};res.convertAnalyticsGroupByColumnToVizObject=function(obj){var res={};Object.keys(obj).forEach(function(key){var newkey=key;if(!/^(isNumeric|isDate|name|func|type)$/.test(key)){newkey=key.charAt(0).toUpperCase()+key.slice(1)}newkey=newkey.replace(/^OtherGroupType$/,"EnableOtherGroup");res[newkey]=obj[key]});return res};res.constructFilterConditions=function(cdatalist,vizOptions,addLogicalizeInfoCb){var filterConditions=[],lang=cdatalist._lang||"en";cdatalist.forEach(function(cdata){var filterc=[];var v;var histRange=cdata&&cdata.length>0?cdata[0].histRange:null;cdata.forEach(function(d){if(d.filter){if(d.histRange){filterc.push({name:d.validName||d.name,func:"between",columnFunc:d.func,includeEdge:d.includeEdge||"end",val1:d.rawValue-d.histRange,val2:d.rawValue+d.histRange,value:d.value})}else{v={name:d.validName||d.name,value:d.rawValue,func:d.func};if(!VizUtil.isEmpty(d.numDecimalDigits)&&d.func==="round"){try{v.value=parseFloat(d.value.toString().replace(/,/g,""));v.rawValue=d.rawValue}catch(e){}if(isNaN(v.value)){v.value=d.rawValue}v.digit=d.numDecimalDigits}if(d.type===res.TYPE_ROWID){v.isRowId=true}var isColorBucketing=d.type==="color"&&vizOptions.colorbucket&&!VizUtil.applyColorBucketAfterSummarize(vizOptions.marker);var attrs;if(d.func===Column.OperationType.AS_CATEGORY||isColorBucketing){attrs={};res.addBucketInfo(vizOptions,d.type,attrs,[]);if(Object.keys(attrs).length>0){attrs.bucketType=res.getBucketType(d.type,vizOptions);v.attrs=attrs}}else{var opId=d.type==="color"?"categColor":d.type;if(res.isOtherGroupEnabled(opId,vizOptions)){attrs={};res.addOtherGroupInfo(vizOptions,opId,attrs,[],lang);if(res.isManualSelectOtherGroupEnabled(opId,vizOptions)){var type=VizUtil.getOtherGroupType(opId,vizOptions);attrs.otherGroupType=Column.OperationType.FCT_OTHER;attrs.otherGroupValuesHandling=type===res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_DROP_VALUES?"drop":"keep"}else{attrs.otherGroupType=Column.OperationType.FCT_LUMP}v.attrs=attrs}}if(addLogicalizeInfoCb&&d.type==="color"&&VizUtil.isLogicalizeEnabled(vizOptions,"color")){v.attrs={};v.attrs.bucketType=res.getBucketType(d.type,vizOptions);addLogicalizeInfoCb("color",vizOptions,v.attrs)}if(res.isRecodeEnabled(vizOptions.marker,d.type,vizOptions)){if(!v.attrs){v.attrs={}}res.addRecodeInfo(vizOptions,d.type,v.attrs,[]);if(v.attrs.recodeValues){v.attrs.recodeType=Column.OperationType.RECODE}}filterc.push(v)}}});filterConditions.push(filterc)});if(filterConditions.length===1&&Array.isArray(filterConditions[0])&&filterConditions[0].length===1){filterConditions=filterConditions[0]}return filterConditions};res.mergeFilterCondition=function(currentFilter,filter){filter.condition.forEach(function(cond,condIdx){var duplicateIndexes=[];currentFilter.condition.forEach(function(currentCond,currCondIdx){var isDifferent=currentCond.some(function(c,idx){if(idx<cond.length){return!(c.name===cond[idx].name&&c.value===cond[idx].value)}else{return false}});if(!isDifferent){duplicateIndexes.push(currCondIdx)}});if(duplicateIndexes.length===0){currentFilter.condition.push(cond);currentFilter.selectionCtxs=currentFilter.selectionCtxs.concat(filter.selectionCtxs)}else{var alreadyReplaced=false;duplicateIndexes.forEach(function(idx){if(currentFilter.condition[idx].length===cond.length){currentFilter.condition.splice(idx,1,null);currentFilter.selectionCtxs.splice(idx,1,null)}else{if(alreadyReplaced){currentFilter.condition.splice(idx,1,null);currentFilter.selectionCtxs.splice(idx,1,null)}else{currentFilter.condition.splice(idx,1,cond);currentFilter.selectionCtxs.splice(idx,1,filter.selectionCtxs[condIdx]);alreadyReplaced=true}}});currentFilter.condition=currentFilter.condition.filter(function(c){return c!==null});currentFilter.selectionCtxs=currentFilter.selectionCtxs.filter(function(c){return c!==null})}});return currentFilter};res.extractNumberOfRowsFromChartCustomData=function(cdatalist){var nrowTypeData=null,nrowData=null;cdatalist[0].forEach(function(d){if(d.type==="nrow"){nrowTypeData=d}else if(d.validName===res.NUMROWS_COL_NAME){nrowData=d}});var data=nrowTypeData||nrowData;return data?data.value:null};res.isMissingValueHandlingSupported=function(marker){return/^(line|bar|bubble|area|pivot|summarytable)$/.test(marker)};res.getDefaultMissingValueHandlingOption=function(marker,barstyle,windowFunc,facet,x,color,syncXAxis){var res=null;switch(marker){case"radar":res="zero";break;case"bar":{switch(barstyle){case"stack":res=facet?"zero":"na";break;case"group":if(x&&color&&x.name!==color.name){res="zero"}break;default:break}if(!color||color.type!==VizUtil.TYPE_YAXIS){switch(windowFunc){case Column.OperationType.CUMSUM:case Column.OperationType.PCT_CUMSUM:case Column.OperationType.PCT_CUMSUM_REV:case Column.OperationType.CUMMEAN:case Column.OperationType.CUMMIN:case Column.OperationType.CUMMAX:case Column.OperationType.CUMPROD:case Column.OperationType.CUMALL:case Column.OperationType.CUMANY:res=syncXAxis?"down":"zero";break}}break}case"errbar":case"errbar-agg":{if(x&&color&&x.name!==color.name){res="na"}break}case"area":{switch(windowFunc){case Column.OperationType.CUMSUM:case Column.OperationType.PCT_CUMSUM:case Column.OperationType.PCT_CUMSUM_REV:case Column.OperationType.CUMMEAN:case Column.OperationType.CUMMIN:case Column.OperationType.CUMMAX:case Column.OperationType.CUMPROD:case Column.OperationType.CUMALL:case Column.OperationType.CUMANY:res="down";break;case Column.OperationType.NONE:case Column.OperationType.PCT_OF_TOTAL:case Column.OperationType.PCT_OF_FIRST:case Column.OperationType.PCT_OF_LAST:case Column.OperationType.PCT_OF_PREV:case Column.OperationType.PCT_OF_NEXT:case Column.OperationType.PCT_OF_MIN:case Column.OperationType.PCT_OF_MAX:case Column.OperationType.PCT_OF_MEAN:case Column.OperationType.PCT_OF_MEDIAN:case Column.OperationType.PCT_OF_MODE:res="zero";break;case Column.OperationType.DIFF_FROM_NEXT:case Column.OperationType.DIFF_FROM_LAST:case Column.OperationType.PCT_DIFF_FROM_NEXT:case Column.OperationType.PCT_DIFF_FROM_LAST:res="up";break;case Column.OperationType.DIFF_FROM_PREV:case Column.OperationType.DIFF_FROM_FIRST:case Column.OperationType.DIFF_FROM_PERIOD:case Column.OperationType.PCT_DIFF_FROM_PREV:case Column.OperationType.PCT_DIFF_FROM_FIRST:case Column.OperationType.PCT_DIFF_FROM_PERIOD:case Column.OperationType.ROLL_MIN:case Column.OperationType.ROLL_MAX:case Column.OperationType.ROLL_MEAN:case Column.OperationType.ROLL_MEDIAN:case Column.OperationType.ROLL_SD:case Column.OperationType.ROLL_VAR:case Column.OperationType.ROLL_SUM:case Column.OperationType.ROLL_PROD:case Column.OperationType.LAG_FROM_PERIOD:res="down";break;default:break}break}case"line":break;default:break}return res};res.isReferenceLineSupported=function(marker){return/^(line|bar|scatter|bubble|hist|densityplot|errbar|errbar-agg)$/.test(marker)};res.isHorizontalReferenceLineSupported=function(marker){return/^(scatter|line|bubble|bar|errbar|errbar-agg)$/.test(marker)};res.isVerticalReferenceLineSupported=function(marker){return/^(bar|scatter|line|bubble|hist|densityplot)$/.test(marker)};res.isGroupByMeasuresColumnSupported=function(marker){return/^(bar|line)$/.test(marker)};res.isReferenceLineRangeSupported=function(marker,opId,reflineType){if(reflineType!==Column.OperationType.AVERAGE&&reflineType!==Column.OperationType.MEDIAN){return false}switch(marker){case"line":case"bar":case"scatter":case"bubble":case"errbar":case"errbar-agg":return/^y/.test(opId);case"hist":case"densityplot":return opId==="x";default:return false}};res._messages={en:{"#NA":"# of NA","%NA":"% of NA","#NNA":"# of not NA","%NNA":"% of not NA","#True":"# of TRUE","#False":"# of FALSE","%True":"% of TRUE","%False":"% of FALSE",DENSITY:"Density","pivot.metrics.rows.of":" of ","pivot.metrics.total.rows":" rows","pivot.metrics.rows":" rows","pivot.metrics.cols.of":" of ","pivot.metrics.total.cols":" columns","pivot.metrics.cols":" columns","pivot.metrics.prefix":"Showing ","pivot.metrics.suffix":"","Total Number":"Total","# of Rows":"Rows","# Rows":"# of Rows","# of Columns.short":"Columns","All Rows":"All","table.toolbar.section1":"Showing","table.toolbar.section2":"","table.toolbar.section3":"of","table.toolbar.section4":"","table.toolbar.section5":"Rows,","table.toolbar.section6":"","table.toolbar.section7":"of","table.toolbar.section8":"","table.toolbar.section9":"Columns.","table.toolbar.section10":"","table.toolbar.search":"Search","table.toolbar.search.highlight":"Highlight","POSITIVE.ANOMALIES.SHORT":"Positive","NEGATIVE.ANOMALIES.SHORT":"Negative","Pixel Ratio Hint":"The higher the pixel ratio, the larger the actual output size, but it will look clearer when viewed at the same size.","Cluster (Color)":"Color","COL.DESC.R Squared":"<strong>R Squared</strong> indicates the ratio of variance in the target variable that is explained by the model with selected predictor variables. <br><br>It ranges between 0 and 1. 1 indicates that the model perfectly predicts values in the target variable.<br><br>When there is only one input, R squared is same as the Pearson correlation square.","COL.DESC.Adj R Squared":"<strong>Adjusted R Squared</strong> indicates the ratio of variance in the target variable that is explained by the model with selected predictor variables.<br><br>Unlike <strong>R Squared</strong>, which always increases as more variables are added to the model, <strong>Adjusted R Squared</strong>attempts to correct for this overestimation. Hence, <strong>Adjusted R Squared</strong>might decrease if added variables does not have meaningful effects on the target variable.<br><br>It ranges between 0 and 1. 1 indicates that the model perfectly predicts values in the target variable.It is always less than or equal to R2.","COL.DESC.RMSE":"<strong>RMSE</strong> (Root Mean Square Error) indicates how far the predicted values are from the actual values in average. <br><br>It is the standard deviation of the residuals (the differences between the actual values and the predicted values). <br><br>It is always non-negative, and a value of 0 would indicate a perfect fit to the data. The lower the RMSE is the better the prediction quality is.","COL.DESC.AUC":"<strong>AUC</strong> indicates how efficiently the predictor variables can separate TRUE and FALSE data of the target variable.<br><br>In general, it ranges between 0.5 and 1. 1 indicates a perfect prediction while 0.5 indicates that the prediction done by the model is as good as random guess, hence the worst prediction quality.","COL.DESC.F1 Score":"<strong>F1 Score</strong> indicates how good the predicted results satisfies both <strong>Precision</strong> and <strong>Recall</strong>.<br><br>It is the <strong>harmonic mean</strong> of Precision and Recall.<br><br>It ranges between 0 and 1, and 1 indicates a perfect and and the most well-balanced prediction.","COL.DESC.Precision":"<strong>Precision</strong> indicates a probability of being correct when the model predicts TRUE.<br><br>It is calculated as a ratio of correctly predicted TRUE values (True Positives) out of all the predicted values as TRUE (True Positives and False Positives).<br><br>It ranges between 0 and 1, and 1 indicates 100% accuracy when it predicts TRUE.","COL.DESC.Recall":"<strong>Recall</strong> indicates how much the model can correctly predict TRUE for all the actual TRUE data. <br><br>It is calculated as a ratio of correctly predicted TRUE values out of all actual TRUE values. <br><br>It is commonly referred to as true positive rate or sensitivity. <br><br>It ranges between 0 and 1, and 1 indicates a perfect prediction for the TRUE data.","COL.DESC.Accuracy Rate":"<strong>Accuracy Rate</strong> indicates how much of the predicted values are correctly matching with the actual values.<br><br>It is calculated as a ratio of correctly predicted TRUE and FALSE data out of all data. <br><br>It ranges between 0 and 1, and 1 indicates a perfect prediction. ","COL.DESC.Misclass. Rate":"<strong>Misclassification Rate</strong> indicates how much of the predicted values does not match with the actual values.<br><br>It is calculated as 1 minus Accuracy Rate.<br><br>It ranges between 0 and 1, and 1 indicates that all predictions are wrong. ","COL.DESC.P Value":"<strong>P Value</strong> is a probability of observing the relationship between the target variable and this model assuming a null hypothesis that none of the predictor variables have any effect on the target variable.<br><br>If it is less than a threshold value you can reject the null hypothesis and conclude that the relationship is statistically significant. Otherwise, its not significant. The threshold is set to 0.05 (5%) by default.","COL.DESC.Difference":"<strong>Difference</strong> is the difference in two group means of the target variable.<br><br>It shows how much of the difference the mean of the non-base level group compared to the base level group.","COL.DESC.t Value":"<strong>t Value</strong> is calculated by dividing the mean difference by a pooled standard error of the two groups.<br><br>It can be interpreted as a standardized mean difference. <br><br>P Value is calculated based on where this t Value resides on a given t distribution.","TTEST.COL.DESC.P Value":"<strong>P Value</strong> indicates a probability of observing the difference between two means from the two groups if we accept a null hypothesis (assumption) that there is no difference between the two.<br><br>If it is less than a threshold value you can reject the null hypothesis and conclude that there is a statistically significant difference between the two groups. Otherwise, its not significant. The threshold is set to 0.05 (5%) by default.","COL.DESC.Cohen's D":"<strong>Cohens D</strong> indicates how big (or small) the mean difference between two groups by comparing against the overall data variability.<br><br>It is calculated by taking the difference between two means and dividing it by the pooled standard deviation (or essentially the average standard deviation) of the two groups. <br><br>Guidance: <ul><li>0.8 - Large Effect</li><li>0.5 - Medium Effect</li><li>0.2 - Small Effect</li></ul>","COL.DESC.Sum of Squares":"For the Explanatory Variable, <strong>Sum of Squares</strong> is the sum of the squared differences between each group mean and thegrand mean.<br><br>For the Residual, <strong>Sum of Squares</strong> is the sum of the squared differences between each individual observation and the mean of the group that the given observation belongs to.<br><br>For the Total, <strong>Sum of Squares</strong> is the sum of the squared differences between each individual observation and the grand mean.<br><br>Total Sum of Squares = Variables Sum of Squares + Residuals Sum of Squares","COL.DESC.Mean Square":"For the Explanatory Variable, <strong>Mean Square</strong> is the variation between the several group means.<br><br>For the Residual, <strong>Mean Square</strong> is the variation within the residuals.<br><br>It is calculated by dividing the <strong>Sum of Squares</strong> by the <strong>Degree of Freedom (DF)</strong>.","COL.DESC.F Value":"<strong>F Value</strong> is a ratio of the explained variance (due to the model) compared against the unexplained variance (residuals).<br><br>It is used to test whether the model with the selected predictor variables provides a better fit to the data than a model with no predictors that always returns the mean.<br><br>In other words, it tests whether the model explains a significant amount of the variation in the target variable, compared to a model with no predictors.<br><br>P Value is calculated based on where the F Value resides on an F distribution.","ANOVA.COL.DESC.P Value":"<strong>P Value</strong> indicates a probability of observing the difference between several means from the multiple groups if we accept a null hypothesis (assumption) that there is no difference among them.<br><br>If it is less than a threshold value you can reject the null hypothesis and conclude that there is a statistically significant difference between the two groups. Otherwise, its not significant. The threshold is set to 0.05 (5%) by default.","COL.DESC.Eta Squared":"<strong>Eta Squared</strong> is the proportion of the variability in the target variable that can be explained by the explanatory variable. <br><br>It indicates how big (or small) the explanatory variables effect is on the target variable compared to the overall variance.<br><br>It is calculated by dividing the Sum of Squares of the explanatory variable by the total Sum of Squares.<br><br>It ranges from 0 to 1. 0 means that there is no relationship at all between the two variables, whereas 1 means that the relationship is perfect.<br><br>Guidance: <ul><li>0.14 - Large Effect</li><li>0.06 - Medium Effect</li><li>0.01 - Small Effect</li></ul>","COL.DESC.Omega Squared":"<strong>Omega Squared</strong> is one of the ways to calculate the effect size. It is an estimate of the variability in the target variable that can be explained by the explanatory variable in the population. <br><br>It indicates how big (or small) the explanatory variables effect on the target variable is compared to the overall variance.<br><br>Basically, <strong>Omega Squared</strong> is calculated the same way as for <strong>Eta Squared</strong>. It divides the Sum of Squares of the explanatory variable by the total Sum of Squares. Unlike <strong>Eta Squared</strong>, which is an estimate for the <strong>sample</strong>, <strong>Omega Squared</strong> is an estimate in the <strong>population</strong>. Therefore, It applies an adjustment to two Sum of Squares (variable and total) with the Degree of Freedom (DF) of the variable and the Mean Square of the Residuals before the above calculation.<br><br>Since <strong>Omega Squared</strong> is a population estimate its value is always smaller than <strong>Eta Squared</strong>.<br><br>Guidance: <ul><li>0.14 - Large Effect</li><li>0.06 - Medium Effect</li><li>0.01 - Small Effect</li></ul>","COL.DESC.Chi-Square":"<strong>Chi-Square</strong> indicates how much difference exists between the actual counts (number of rows) in each combination of the categories and their expected counts if there were no relationship between the two categorical variables.<br><br>P Value is calculated based on where this Chi-Square value resides on a given Chi-Square distribution.","CHISQ.COL.DESC.P Value":"<strong>P Value</strong> indicates a probability of observing the relationship between the two categorical variables if we accept a null hypothesis (assumption) that there is no relationship between the two.<br><br>If it is less than a threshold value you can reject the null hypothesis and conclude that there is a statistically significant difference between the two groups. Otherwise, its not significant. The threshold is set to 0.05 (5%) by default.","COL.DESC.Phi":"<strong>Phi</strong> is an effect size measurement for the Chi-Square Test. It measures how strongly two categorical variables are associated.<br><br>It is calculated by dividing the <strong>Chi-Square</strong> value by the sample size (the number of rows) and take the square root.<br><br>Guidance: <ul><li>0.14 - Large Effect</li><li>0.06 - Medium Effect</li><li>0.01 - Small Effect</li></ul>","COL.DESC.Cramer's V":"<strong>Cramers V</strong> (Cramrs V) is an effect size measurement for the Chi-Square Test. It measures how strongly two categorical variables are associated.<br><br>The effect size is calculated in the following manner: <ol><li>Subtract 1 from the number of categories of one of the variables that has fewer categories.</li><li>Multiply the result by the number of rows.</li><li>Divide the <strong>Chi-Square</strong> by the previous result.</li><li>Take the square root.</li></ol><br>Guidance: <ul><li>0.5 - Large Effect</li><li>0.3 - Medium Effect</li><li>0.1 - Small Effect</li></ul><br>This guidance can vary depending on the degree of freedom.","KW.COL.DESC.H Value":"<strong>H Value</strong> is a ratio of the rank mean difference against the rank variance.<br><br>After assigning ranks based on the original values, it is calculated as follows:<br><ul><li>Calculate the differences between the rank mean for each group and the rank mean for all (Rank Mean Difference)</li><li>Take the weighted mean of the rank mean differences</li><li>Divide it by the rank variance of all</li></ul><br>The <strong>P Value</strong> is calculated based on where this <strong>H Value</strong> resides on a given <strong>Chi-Square distribution</strong>.","KW.COL.DESC.P Value":"<strong>P Value</strong> indicates a probability of observing the difference between several means from the multiple groups if we accept a null hypothesis (assumption) that there is no difference among them.<br><br>If it is less than a threshold value you can reject the null hypothesis and conclude that there is a statistically significant difference between the two groups. Otherwise, its not significant. The threshold is set to 0.05 (5%) by default.","KW.COL.DESC.Eta Squared":"<strong>Eta Squared</strong> is the proportion of the variability in the target variable that can be explained by the explanatory variable. <br><br>It indicates how big (or small) the explanatory variables effect is on the target variable compared to the overall variance.<br><br>It is calculated by a formula of (H - K + 1)/(N - K); whereHis the H Value;Kis the number of groups;Nis the total number of observations.<br><br>It ranges from 0 to 1. 0 means that there is no relationship at all between the two variables, whereas 1 means that the relationship is perfect.<br><br>Guidance: <br><ul><li>0.14 - Large Effect</li><li>0.06 - Medium Effect</li><li>0.01 - Small Effect</li></ul>","KW.COL.DESC.Epsilon Squared":"<strong>Epsilon Squared</strong> is a measure of effect size. It is an estimate of the variability in the target variable that can be explained by the explanatory variable. <br><br>It indicates how big (or small) the explanatory variables effect on the target variable is compared to the overall variance.<br><br>It is calculated by dividing the H Value by a calculation of (the square of N - 1) / (N + 1) ; whereNis the total number of observations.<br><br>It ranges from 0 to 1. 0 means that there is no relationship at all between the two variables, whereas 1 means that the relationship is perfect.<br><br>Guidance: <br><ul><li>0.14 - Large Effect</li><li>0.06 - Medium Effect</li><li>0.01 - Small Effect</li></ul>"},ja:{"Number of Rows":"","# of Rows":"","# Rows":"","All Rows":"",Group:"","Repeat By Group":"","Number of Columns":"","# of Columns":"","# of Columns.short":"",Longitude:"",Latitude:"","Fit in View Area":"",Fit:"","Sync X Axis":"X","Sync Y Axis":"Y","Sync Radial Axis":"","Show Range":"","Confidence Interval (95%)":" (95%)",Others:"",Auto:"",row:"",rows:"",Color:"",Size:"",Category:"",Name:"","Show Values":"","Show Label Values on Chart":"","Show Category Values":"","Autoscale Y Axis":"Y","Show Correlation Values":"","There is no data to display.":"","Color is not assigned.":"","Histogram is not generated because all the values for the X-Axis column are NA.":"XNA","Try assigning a column again.":"","You need to assign 3 or more columns to Value in order to show the Radar chart.":"3","You need to assign 3 or more columns to Variables in order to show the Radar chart.":"3","You need to assign 3 or more factors in order to show the Radar chart.":"3",Sum:"",Total:"",Subtotal:"",Mean:"",Min:"",Max:"",First:"",Last:"",Count:"","Uniq.":"","Med.":"",SD:"","2SD":"","3SD":"","Var.":"",IQR:"IQR",MAD:"MAD",Mode:"","#NA":"","%NA":"","#NNA":"","%NNA":"","#True":"TRUE","#False":"FALSE","%True":"TRUE","%False":"FALSE","Specific Value":"",Diagonal:"","Cond. Uniq.":"","Cond. Count":"","Sum If":"","Mean If":"",Exclude:"","Keep Only":"","Show Detail":"","items selected":"",Correlation:"","R Squared":"R2",Coefficient:"","P-Value":"P","Deviance Explained":"",GCV:"GCV","Scale Est.":"","Equivalent Number of Parameters":"","Residual Standard Error":"","Trace of Smoother Matrix":"","Odds Ratio":"","(Trend)":"()","Range Type":"",Range:"","Standard Error":"","90% Conf. Interval":"90%","95% Conf. Interval":"95%","99% Conf. Interval":"99%","1 Standard Deviation":"1","2 Standard Deviation":"2","3 Standard Deviation":"3","Ratio by":"",Ratio:"","X Axis":"X",All:"","Total Number":"",Upper:"",Lower:"","(Number of Rows)":"()","(Number of TRUE)":"(TRUE)","(Number of FALSE)":"(FALSE)","(Number of NA)":"()","(Number of Not NA)":"()","(Row ID)":"()","(Y Axis Values)":"(Y)",DENSITY:"","Area Ratio":"","Area Ratio (From Min)":"","Area Ratio (From Max)":"","True Positive Rate":"","False Positive Rate":"","Baseline AUC: 0.5":"AUC: 0.5",Cumulative:"","Difference From":"","% Difference From":"","Moving Calculation":"",Rank:"","% of Total":"","% of First":"","% of Last":"","% of Min":"","% of Max":"","% of Mean":"","% of Median":"","% of Mode":"","Cumulative Sum":"","Cumulative Sum Ratio":"","Cumulative Sum Ratio (%)":" (%)","Cumulative Mean":"","Cumulative Min":"","Cumulative Max":"","Cumulative Median":"","Cumulative Prod":"","Difference from Previous":"","Difference from Next":"","Difference from First":"","Difference from Last":"","Difference from Min":"","Difference from Max":"","Difference from Mean":"","Difference from Median":"","Difference from Mode":"","Difference from Constant":"","Difference from Constant Value":"","Difference from Specific Value":"","Difference from Period Ago":"","Difference from X":"{0}","% Difference from Constant":"","% Difference from Constant Value":"","% Difference from Specific Value":"","% Difference from Period Ago":"","% Difference from X":"{0}","% Difference from Mode":"","% Difference from Previous":"","% Difference from Next":"","% Difference from First":"","% Difference from Last":"","% Difference from Min":"","% Difference from Max":"","% Difference from Mean":"","% Difference from Median":"","Diff from Previous":"","Diff from Next":"","Diff from First":"","Diff from Last":"","Diff from First Row":"","Diff from Last Row":"","Diff from Min":"","Diff from Max":"","Diff from First Date":"","Diff from Last Date":"","Diff from Mean":"","Diff from Median":"","Diff from Mode":"","Diff from Constant":"","Diff from Constant Value":"","Diff from Specific Value":"","Diff from X":"{0}","Diff from Period Ago":"","% Diff from Constant":"","% Diff from Constant Value":"","% Diff from Specific Value":"","% Diff from X":"{0}","% Diff from Mode":"","% Diff from Previous":"","% Diff from Next":"","% Diff from First":"","% Diff from Last":"","% Diff from Min":"","% Diff from Max":"","% Diff from Mean":"","% Diff from Median":"","% Diff from Period Ago":"","Moving Average":"","Moving Min":"","Moving Max":"","Moving Median":"","Moving Standard Deviation":"","Moving Variance":"","Moving Sum":"","Moving Prod":"","Min Rank":"Min","Dense Rank":"Dense","Percent Rank":"","pivot.metrics.rows.of":"","pivot.metrics.total.rows":"","pivot.metrics.rows":"","pivot.metrics.cols.of":"","pivot.metrics.total.cols":"","pivot.metrics.cols":"","pivot.metrics.prefix":"","pivot.metrics.suffix":"","table.toolbar.section1":"","table.toolbar.section2":"","table.toolbar.section3":",","table.toolbar.section4":"","table.toolbar.section5":"","table.toolbar.section6":"","table.toolbar.section7":"","table.toolbar.section8":"","table.toolbar.section9":"","table.toolbar.section10":"","table.toolbar.search":"","table.toolbar.search.highlight":"","NA Ratio":"","Not NA Ratio":"","FALSE Ratio":"FALSE","TRUE Ratio":"TRUE","Show in fullscreen":"","Export Chart Data":"","Export Chart Image":"",Comment:"",Close:"","Output Format":"",Background:"","Set background transparent":"","Width (Pixel)":" ()","Height (Pixel)":" ()","Pixel Ratio":"","Pixel Ratio Hint":"",Export:"",Cancel:"","X-Axis":"X","Y-Axis":"Y","Positive Correlation":"","Negative Correlation":"","Not Significant":"",Distance:"",Positive:"",Negative:"","More Likely to Occur":"","Less Likely to Occur":"","(Intercept)":"()","(Corrected Model)":"()","(Corrected Total)":"()","(Total)":"()","(Residuals)":"()","Homogeneity assumption is valid.":"","Homogeneity assumption is not valid.":"","Normality assumption is valid.":"","Normality assumption is not valid.":"",Actual:"","Actual (Mean)":" ()","Actual (Ratio)":" ()",Prediction:"","True (Actual)":"True ()","False (Actual)":"False ()","Cut Point for True/False":"True/False","Base Level":"",Influence:"","Conf Low":"","Conf High":"","P Value":"P",Term:"","Predicted (X)":" (X)","Actual (Y)":" (Y)",Predicted:"","Predicted Values":"","Actual Values":"",Variables:"","Coefficient Estimates":"","Predicted Probability":"",Density:"",Percentage:"","Perfect Fit":"",Importance:"",Significance:"",Residual:"",Residuals:"",Type:"","Variance Inflation Factor (VIF)":" (VIF)","VIF (Variance Inflation Factor)":"VIF ()","Risk (VIF >= 10)":" (VIF >= 10)","Safe (VIF < 10)":" (VIF < 10)","Average Marginal Effect":"","Incidence Rate Ratio":"","Prediction Outcome":"","Prediction Probability":"","Data Type":"",Confirmed:"",Tentative:"",Rejected:"",Iterations:"",Validation:"",Time:"",Period:"",Observations:"",Cohort:"",Case:"",Value:"",Events:"",Censored:"","Survival Rate":"","Hazard Ratio":"","t Value":"t","t Value from This Test":"t","Degree of Freedom":"","Critical t Value":"t","U Value":"U","U Value from This Test":"U","W Value":"W","W Value from This Test":"W","H Value":"H","H Value from This Test":"H","Chi-Square":"2","Chi-Square from This Test":"2",Expected:"","Contribution (%)":" (%)","% Difference":" (%)",Difference:"","Standardized Difference":"","Difference (Std.)":" ()","Non-Centrality":"","Critical Chi-Square Value":"2","Sample Size":"",Power:"",Hypothesis:"",Alternative:"",Null:"","F Value":"F","F Value from This Test":"F","DF for (Residuals)":"","DF for Residuals":"","DF for Variable":"","Between Groups":"","Within Groups":"","Mean (Adj)":" ()","Std Deviation":"","Std Error":"","Std Error (Adj)":" ()","Conf Low (Adj)":" ()","Conf High (Adj)":" ()",Rows:"",count:"","count (y1)":" (y1)","Forecasted Value":"","Forecasted Value (y1)":" (y1)","Forecasted Value High":"","Forecasted Value Low":"",Trend:"","Trend (y1)":" (y1)","Trend Change":"","Trend Change (y2)":" (y2)","Trend Change Rate":"","Trend Change Rate (y2)":" (y2)","Trend High":"","Trend Low":"",Training:"","Training (y1)":" (y1)",Test:"","Test (y1)":" (y1)",Yearly:"","Yearly Seasonality":"","Yearly Seasonality (y2)":" (y2)",Quarterly:"","Quarterly Seasonality":"","Quarterly Seasonality (y2)":" (y2)",Monthly:"","Monthly Seasonality":"","Monthly Seasonality (y2)":" (y2)",Weekly:"","Weekly Seasonality":"","Weekly Seasonality (y2)":" (y2)",Daily:"","Daily Seasonality":"","Daily Seasonality (y2)":" (y2)",Holidays:"","Holiday Effect":"","Holiday Effect (y2)":" (y2)","Predictor 1":"1","Predictor 1 (y2)":"1 (y2)","Predictor 2":"2","Predictor 2 (y2)":"2 (y2)","Predictor 3":"3","Predictor 3 (y2)":"3 (y2)","Predictor 4":"4","Predictor 4 (y2)":"4 (y2)","Predictor 5":"5","Predictor 5 (y2)":"5 (y2)","Day of Year":"","Day of Quarter":"","Day of Month":"","Day of Week":"",Hour:"","Multiplicative Effect":"",Stationary:"",Lag:"",ACF:"",PACF:"","Change Point":"","Order of Differencing":"","Order of Seasonal Differencing":"","Period of Seasonal Differencing":"",Components:"","% Variance":" (%)","% Variance (y1)":" (%) (y1)","Variance (%)":" (%)","Variance (%) (y1)":" (%) (y1)","Cummulated % Variance":" (%)","Cummulated % Variance (y2)":" (%) (y2)","Cumulated Variance (%)":" (%)","Cumulated Variance (%) (y2)":" (%) (y2)",Weight:"",Component:"",Variable:"",Threshold:"",Dimension:"",Dimensions:"",Factor:"",Factors:"","Current Number of Factors":"",Eigenvalue:"","SS Loadings":"","Variance (SS Loadings)":" ()",Communality:"",Uniqueness:"",Word:"","Word Pair":"",Topic:"",Topics:"",Text:"",Proportion:"",Probability:"",Document:"","Number of Groups":"","Number of Rows (Weighted)":" ()","Number of Groups (Weighted)":" ()","Cluster (Color)":"",PC1:"1",PC2:"2",Cluster:"","Variable (X)":" (X)","Value (Y)":" (Y)","Number of Clusters":"","Current Number of Clusters":"","Total Within-Cluster Sum of Squares":"","% Decrease in Total Within-Cluster Sum of Squares":" (%)","Normalized Value":"","Actual Value":"","Normalized Mean":"","Ratio (%)":" (%)","Excluded Rows":"","Negative Anomaly":"","Negative Anomalies":"","Positive Anomaly":"","Positive Anomalies":"","POSITIVE.ANOMALIES.SHORT":"","NEGATIVE.ANOMALIES.SHORT":"","Expected Value":"",Rule:"","Lift (Size)":" ()",Support:"","Support (X)":" (X)",Confidence:"","Confidence (Y)":" (Y)","Improvement Rate (%)":" (%)","Chance of Being Better":"","Probability (%)":" (%)","Conversion Rate (%)":" (%)","A/B Identifier":"A/B","Probability Density":"","A is better":"A","A is not better":"A",Converted:"","Not Converted":"","Performance Improvement Rate (A - B) / B (%)":" (A - B) / B (%)",Observed:"","Theoretical Quantile (X)":" (Quantile) (X)","Actual Value (Y)":" (Y)",Normality:"",Normal:"","Not Normal":"","Value (X)":" (X)","Reference Line":"","Number of Rows (Normalized)":" ()",Status:"","Group with Enough Data":"","Group without Enough Data":"","Enough Data":"","Not Enough Data":"","Distance within Cluster":"","% Decrease in Distance within Cluster":" (%)","Excluded Groups":"","Excluded due to high NA ratio.":"","COL.DESC.R2":"<strong>R2</strong><br><br>011<br><br>12R2","COL.DESC.R2":"<strong>R2</strong><br><br><strong>R2</strong><strong>R2</strong><strong>R2</strong><br><br>011","COL.DESC.RMSE":"<strong>RMSE</strong> (Root Mean Square Error)<br><br> <br><br>00","COL.DESC.AUC":"<strong>AUC</strong>TRUEFALSE<br><br>AUC0.5110.5","COL.DESC.F1":"<strong>F1 </strong><strong>Precision</strong><strong>Recall</strong><br><br><strong>F1 </strong>2<strong></strong><br><br>011","COL.DESC. (Precision)":"<strong>Precision</strong>TRUE<br><br>TRUETRUE<br><br>011","COL.DESC. (Recall)":"<strong>Recall</strong>TRUETRUE<br><br><br><br>011<br><br>SensitivityTrue Positive Rate","COL.DESC.":"<strong></strong><br><br>TRUEFALSE<br><br>011","COL.DESC.":"<strong></strong><br><br>011","COL.DESC.P":"<strong>P</strong><br><br>P0.05 (5%) ","COL.DESC.":"2<strong></strong><br><br>","COL.DESC.t":"<strong>t</strong>2<br><br>2<br><br> tP","TTEST.COL.DESC.P":"<strong>P</strong>2<br><br>P0.05 (5%) ","COL.DESC.Cohen's D":"<strong>Cohens D</strong> 22<br><br>22<br><br>: <ul><li>0.8 < D -> </li><li>0.5 < D < 0.8 -> </li><li>0.2 < D < 0.5 -> </li></ul>","COL.DESC.2":"<strong>2</strong>2<br><br><strong>2</strong>2<br><br><strong>2</strong>2<br><br>222","COL.DESC.2":"<strong>2</strong><br><br><strong>2</strong><br><br><strong>2</strong><strong></strong>","COL.DESC.F":"<strong>F</strong><br><br><br><br><br><br> FP","ANOVA.COL.DESC.P":"<strong>P</strong><br><br>P0.05 (5%) ","COL.DESC.Eta2":"<strong>Eta2</strong><br><br><br><br>22<br><br>01021<br><br> <ul></li>0.14 - </li></li>0.06 - </li></li>0.01 - </li></ul>","COL.DESC.Omega2":"<strong>Omega2</strong>1<br><br><br><br><strong>Omega2</strong><strong>Eta2</strong>22Eta2Omega222<br><br><strong>Omega2</strong><strong>Eta2</strong><br><br>  <ul></li>0.14 - </li></li>0.06 - </li></li>0.01 - </li></ul>","COL.DESC.2":"<strong>2</strong>2<br><br>2P","CHISQ.COL.DESC.P":"<strong>P</strong>2<br><br>P0.05 (5%) ","COL.DESC.Phi":"<strong>Phi</strong>212<br><br><strong>Phi</strong><strong>2</strong><br><br> <ul><li>0.14 - </li><li>0.06 - </li><li>0.01 - </li></ul>","COL.DESC.Cramer's V":"<strong>Cramers V</strong>V212<br><br> <ol><li>21</li><li></li><li><strong>2</strong></li><li></li></ol><br>: <ul><li>0.5 - </li><li>0.3 - </li><li>0.1 - </li></ul><br>","KW.COL.DESC.H":"<strong>H</strong><br><br><br><ul><li></li><li></li><li></li></ul><br><strong>P</strong><strong>H</strong><strong>2</strong>","KW.COL.DESC.P":"<strong>P</strong><br><br>P0.05 (5%) ","KW.COL.DESC.Eta2":"<strong>Eta2</strong><br><br><br><br><strong>Eta2</strong>H1<br><br>01021<br><br><ul><li>0.14 - </li><li>0.06 - </li><li>0.01 - </li></ul>","KW.COL.DESC.Epsilon2":"<strong>Epsilon2</strong><br><br><br><br><strong>Epsilon2</strong> ( - 1) 2 ( + 1) H<br><br>01021<br><br><ul><li>0.14 - </li><li>0.06 - </li><li>0.01 - </li></ul>"}};res._regexMessages={ja:{"$1 ()":/^(.*) \(Probability\)$/,"$1 ()":/^(.*) \(Normalized\)$/,"":/^P Value >\= (.*)$/,"":/^P Value < (.*)$/," $1":/^Cluster (.*)$/," $1":/^Topic (.*)$/," $1":/^Dimension (.*)$/,"1 $1":/^PC1 \((.*)\)$/,"2 $1":/^PC2 \((.*)\)$/,"1 $1":/^Factor 1 \((.*)\)$/,"2 $1":/^Factor 2 \((.*)\)$/,"$1":/^Factor ([0-9]+)$/},en:{"Not Significant":/^P Value >\= (.*)$/,Significant:/^P Value < (.*)$/}};res._regexBucketLabelMessages={ja:{"$1 ":/^([0-9+,.\-e]+)\s*<$/,"$1 ":/^([0-9+,.\-e]+)\s*<=$/,"$1 ":/^<\s*([0-9+,.\-e]+)$/,"$1 ":/^<=\s*([0-9+,.\-e]+)$/},en:{"Greater than $1":/^([0-9+,.\-e]+)\s*<$/,"$1 or Greater":/^([0-9+,.\-e]+)\s*<=$/,"Less than $1":/^<\s*([0-9+,.\-e]+)$/,"$1 or Less":/^<=\s*([0-9+,.\-e]+)$/}};res.getMessage=function(lang,key,enableRegexTrans,regexDict){lang=lang&&lang.startsWith&&lang.startsWith("ja")?"ja":"en";return res._messages[lang]&&res._messages[lang][key]!==undefined?res._messages[lang][key]:enableRegexTrans?res.doRegexTranslation(lang,key,regexDict):key};res.doRegexTranslation=function(lang,key,regexDict){if(!key){return key}if(!key.replace){return key}var val=key;Object.keys(res[regexDict||"_regexMessages"][lang]).some(function(replacement){val=key.replace(res[regexDict||"_regexMessages"][lang][replacement],replacement);return val!==key});return val};res.compareVersionStr=function(v1,v2,options){v1=v1.replace(/_.*$/,"");v2=v2.replace(/_.*$/,"");var lexicographical=options&&options.lexicographical,zeroExtend=options&&options.zeroExtend,v1parts=v1.split("."),v2parts=v2.split(".");function isValidPart(x){return(lexicographical?/^\d+[A-Za-z]*$/:/^\d+$/).test(x)}if(!v1parts.every(isValidPart)||!v2parts.every(isValidPart)){return NaN}if(zeroExtend){while(v1parts.length<v2parts.length)v1parts.push("0");while(v2parts.length<v1parts.length)v2parts.push("0")}if(!lexicographical){v1parts=v1parts.map(Number);v2parts=v2parts.map(Number)}for(var i=0;i<v1parts.length;++i){if(v2parts.length===i){return 1}if(v1parts[i]===v2parts[i]){continue}else if(v1parts[i]>v2parts[i]){return 1}else{return-1}}if(v1parts.length!=v2parts.length){return-1}return 0};var ElemMock=function(elemName){this.name=elemName;this.textContent="";this.innerHTML="";this.style={};this.classes={};this.childNodes=[];this.attrs={};var self=this;this.classList={add:function(){for(var i=0;i<arguments.length;i++){self.classes[arguments[i]]=true}},remove:function(className){for(var i=0;i<arguments.length;i++){self.classes[arguments[i]]=null}}};this.appendChild=function(child){self.childNodes.push(child)};this.insertBefore=function(newNode,refNode){var idx=self.childNodes.length;self.childNodes.some(function(child,cidx){if(refNode===child){idx=cidx;return true}return false});self.childNodes.splice(idx,0,newNode)};this.setAttribute=function(name,value){this.attrs[name]=value};this.getAttribute=function(name){return this.attrs[name]};this.onclick=function(){};this.serialize=function(){return JSON.parse(JSON.stringify(this))}};var JQueryMock=function(){var res={balloon:function(){},click:function(){},css:function(){},outerHeight:function(){return 22}};return res};JQueryMock.balloon={defaults:{}};JQueryMock.isMock=true;var DocumentMock={createElement:function(name){return new ElemMock(name)},isMock:true};res.getDocumentMock=function(){return DocumentMock};res.getJQueryMock=function(){return JQueryMock};res.getColorPaletteForBuckets=function(vizOptions,paletteName,numberOfBuckets){var bucketType=VizUtil.getBucketType("color",vizOptions);var res=null;if(/^(bucket_kmeans|bucket_equal_width|bucket_equal_step|bucket_equal_freq|bucket_custom|bucket_logicalize|bucket_outlier_iqr|bucket_outlier_pct|bucket_outlier_sd)$/.test(bucketType)){var numBuckets=numberOfBuckets||(bucketType==="bucket_kmeans"?vizOptions.colorBucketKmeansNumOfBuckets:vizOptions.colorBucketNumOfBuckets);if(bucketType==="bucket_logicalize"){numBuckets=2}else if(/bucket_outlier_/.test(bucketType)){numBuckets=3}else if(bucketType==="bucket_custom"){var customBucketAttrs=VizUtil.constructCustomBucketAttributes(vizOptions.colorBucketCuttingPoints,vizOptions.colorBucketLabels,vizOptions.colorBucketIncludeOutsideRange!=="off",vizOptions.colorBucketIncludeRightEdge==="on",vizOptions.colorBucketIncludeLowest!=="off",10);numBuckets=customBucketAttrs.expectedNumberOfLabels}if(numBuckets&&VizUtil.colorbrewer[paletteName]&&VizUtil.colorbrewer[paletteName][numBuckets]){res=VizUtil.colorbrewer[paletteName][numBuckets].slice()}}return res};res.findIndexForBucketIncludingZero=function(data){var ret=null,prev=null,isPositive=null,isDesc=null;data.some(function(d,idx){if(!res.isEmpty(d)&&d.split){var arr=d.split(" - ").map(function(v){return parseFloat(v)});if(arr.length===2&&!isNaN(arr[0])&&!isNaN(arr[1])){isPositive=arr[0]>=0;if(prev!==null){isDesc=arr[0]<prev}prev=arr[0];if(arr[0]<=0&&arr[1]>0){ret=idx;return true}}}return false});if(ret===null){if(isPositive===null){return null}else if(isPositive){return isDesc?data.length-1:0}else{return isDesc?0:data.length-1}}else{return ret}},res.getColorPaletteForZeroCenteredBuckets=function(palette,size,centerBucketIndex){if(palette.length<=centerBucketIndex||res.isEmpty(centerBucketIndex)){return palette}var left=centerBucketIndex;var right=size-centerBucketIndex-1;var newSize=2*Math.max(left,right)+1;if(newSize===size){return palette}var newPalette=chroma.scale(palette).colors(newSize);if(left>right){newPalette.splice(newPalette.length-(left-right))}else{newPalette.splice(0,right-left)}return newPalette};res.colorbrewer={schemeGroups:{sequential:["BuGn","BuPu","GnBu","OrRd","PuBu","PuBuGn","PuRd","RdPu","YlGn","YlGnBu","YlOrBr","YlOrRd"],singlehue:["Blues","Greens","Greys","Oranges","Purples","Reds"],diverging:["BrBG","PiYG","PRGn","PuOr","RdBu","RdGy","RdYlBu","RdYlGn","Spectral"],qualitative:["Accent","Dark2","Paired","Pastel1","Pastel2","Set1","Set2","Set3"]},YlGn:{1:["#f7fcb9"],2:["#f7fcb9","#31a354"],3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],10:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#005a32","#004529"]},YlGnBu:{1:["#edf8b1"],2:["#edf8b1","#2c7fb8"],3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],10:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#0c2c84","#081d58"]},GnBu:{1:["#e0f3db"],2:["#e0f3db","#43a2ca"],3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],10:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#08589e","#084081"]},BuGn:{1:["#e5f5f9"],2:["#e5f5f9","#2ca25f"],3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],10:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#005824","#00441b"]},PuBuGn:{1:["#ece2f0"],2:["#ece2f0","#1c9099"],3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],10:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#016450","#014636"]},PuBu:{1:["#ece7f2"],2:["#ece7f2","#2b8cbe"],3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],10:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#034e7b","#023858"]},BuPu:{1:["#e0ecf4"],2:["#e0ecf4","#8856a7"],3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],10:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#6e016b","#4d004b"]},RdPu:{1:["#fde0dd"],2:["#fde0dd","#c51b8a"],3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],10:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#c51b8a","#ae017e","#7a0177","#49006a"]},PuRd:{1:["#e7e1ef"],2:["#e7e1ef","#dd1c77"],3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],10:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#91003f","#67001f"]},OrRd:{1:["#fee8c8"],2:["#fee8c8","#e34a33"],3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],10:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#990000","#7f0000"]},YlOrRd:{1:["#ffeda0"],2:["#ffeda0","#f03b20"],3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],10:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#b10026","#800026"]},YlOrBr:{1:["#fff7bc"],2:["#fff7bc","#d95f0e"],3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],10:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#8c2d04","#662506"]},Purples:{1:["#756bb1"],2:["#bcbddc","#756bb1"],3:["#cbc9e2","#9e9ac8","#6a51a3"],4:["#cbc9e2","#9e9ac8","#756bb1","#54278f"],5:["#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],6:["#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],7:["#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],8:["#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#4a1486","#3f007d"],9:["#dadaeb","#c5c5e0","#b1afd4","#9e9ac8","#807dba","#6a51a3","#54278f","#4a1486","#3f007d"],10:["#dadaeb","#cacae3","#bbbada","#acaad1","#9e9ac8","#807dba","#6a51a3","#54278f","#4a1486","#3f007d"]},Blues:{1:["#3182bd"],2:["#c6dbef","#3182bd"],3:["#c6dbef","#9ecae1","#3182bd"],4:["#c6dbef","#6baed6","#3182bd","#08519c"],5:["#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],6:["#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],7:["#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],8:["#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#084594","#08306b"],9:["#c6dbef","#a7cde5","#8abddd","#6baed6","#4292c6","#2171b5","#08519c","#084594","#08306b"],10:["#c6dbef","#afd0e7","#98c5e1","#82badb","#6baed6","#4292c6","#2171b5","#08519c","#084594","#08306b"]},Greens:{1:["#31a354"],2:["#a1d99b","#31a354"],3:["#bae4b3","#74c476","#238b45"],4:["#bae4b3","#74c476","#31a354","#006d2c"],5:["#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],6:["#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],7:["#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],8:["#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#005a32","#00441b"],9:["#c7e9c0","#abdda6","#90d18d","#74c476","#41ab5d","#238b45","#006d2c","#005a32","#00441b"],10:["#c7e9c0","#b2e0ac","#9ed799","#89ce87","#74c476","#41ab5d","#238b45","#006d2c","#005a32","#00441b"]},Oranges:{1:["#e6550d"],2:["#fdae6b","#e6550d"],3:["#fdbe85","#fd8d3c","#d94701"],4:["#fdbe85","#fd8d3c","#e6550d","#a63603"],5:["#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],6:["#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],7:["#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],8:["#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#8c2d04","#7f2704"],9:["#fdd0a2","#febb80","#fea45e","#fd8d3c","#f16913","#d94801","#a63603","#8c2d04","#7f2704"],10:["#fdd0a2","#fec088","#feb06f","#fe9f56","#fd8d3c","#f16913","#d94801","#a63603","#8c2d04","#7f2704"]},Reds:{1:["#de2d26"],2:["#fc9272","#de2d26"],3:["#fcae91","#fb6a4a","#cb181d"],4:["#fcae91","#fb6a4a","#de2d26","#a50f15"],5:["#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],6:["#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],7:["#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],8:["#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#99000d","#67000d"],9:["#fcbba1","#fda284","#fd8767","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#99000d","#67000d"],10:["#fcbba1","#fda88b","#fd9575","#fc8060","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#99000d","#67000d"]},Greys:{1:["#636363"],2:["#bdbdbd","#636363"],3:["#cccccc","#969696","#525252"],4:["#cccccc","#969696","#636363","#252525"],5:["#d9d9d9","#bdbdbd","#969696","#636363","#252525"],6:["#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],7:["#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],8:["#d9d9d9","#cccccc","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],9:["#d9d9d9","#d0d0d0","#c6c6c6","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],10:["#d9d9d9","#d2d2d2","#cbcbcb","#c4c4c4","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{1:["#f1a340"],2:["#f1a340","#998ec3"],3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{1:["#d8b365"],2:["#d8b365","#5ab4ac"],3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{1:["#af8dc3"],2:["#af8dc3","#7fbf7b"],3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{1:["#e9a3c9"],2:["#e9a3c9","#a1d76a"],3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{1:["#ef8a62"],2:["#67a9cf","#ef8a62"],3:["#67a9cf","#f7f7f7","#ef8a62"],4:["#0571b0","#92c5de","#f4a582","#ca0020"],5:["#0571b0","#92c5de","#f7f7f7","#f4a582","#ca0020"],6:["#2166ac","#67a9cf","#d1e5f0","#fddbc7","#ef8a62","#b2182b"],7:["#2166ac","#67a9cf","#d1e5f0","#f7f7f7","#fddbc7","#ef8a62","#b2182b"],8:["#2166ac","#4393c3","#92c5de","#d1e5f0","#fddbc7","#f4a582","#d6604d","#b2182b"],9:["#2166ac","#4393c3","#92c5de","#d1e5f0","#f7f7f7","#fddbc7","#f4a582","#d6604d","#b2182b"],10:["#053061","#2166ac","#4393c3","#92c5de","#d1e5f0","#fddbc7","#f4a582","#d6604d","#b2182b","#67001f"],11:["#053061","#2166ac","#4393c3","#92c5de","#d1e5f0","#f7f7f7","#fddbc7","#f4a582","#d6604d","#b2182b","#67001f"]},RdLb:{1:["#e7430c"],2:["#4A90E2","#e7430c"],3:["#4A90E2","#e1e1e1","#e7430c"],4:["#4A90E2","#b3cae4","#de919e","#e7430c"],5:["#4A90E2","#b3cae4","#e1e1e1","#de919e","#e7430c"],6:["#4a90e2","#9ebee4","#cfd8e2","#e0c1c6","#e08181","#e7430c"],7:["#4a90e2","#90b7e3","#c2d2e3","#e1e1e1","#dfacb4","#e1776d","#e7430c"],8:["#4a90e2","#86b1e3","#bacde4","#d4dae2","#e0cace","#de9ca8","#e2705f","#e7430c"],9:["#4a90e2","#7fade3","#b3cae4","#cad6e3","#e1e1e1","#e0b9c0","#de919e","#e36a55","#e7430c"],10:["#4a90e2","#79aae3","#a7c4e4","#c2d2e3","#d7dce2","#e0cfd2","#dfacb4","#df888e","#e3664d","#e7430c"],11:["#4a90e2","#74a7e3","#9ebee4","#bccfe3","#cfd8e2","#e1e1e1","#e0c1c6","#dfa1ab","#e08181","#e36246","#e7430c"]},RdGy:{1:["#ef8a62"],2:["#ef8a62","#999999"],3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{1:["#fc8d59"],2:["#fc8d59","#91bfdb"],3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{1:["#fc8d59"],2:["#fc8d59","#99d594"],3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{1:["#fc8d59"],2:["#fc8d59","#91cf60"],3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{1:["#7fc97f"],2:["#7fc97f","#fdc086"],3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{1:["#1b9e77"],2:["#1b9e77","#7570b3"],3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{1:["#a6cee3"],2:["#a6cee3","#b2df8a"],3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{1:["#fbb4ae"],2:["#fbb4ae","#ccebc5"],3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{1:["#b3e2cd"],2:["#b3e2cd","#cbd5e8"],3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{1:["#e41a1c"],2:["#e41a1c","#4daf4a"],3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{1:["#66c2a5"],2:["#66c2a5","#8da0cb"],3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{1:["#8dd3c7"],2:["#8dd3c7","#bebada"],3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]},Viridis:{1:["#FDE725"],2:["#FDE725","#440154"],3:["#FDE725","#21908C","#440154"],4:["#FDE725","#35B779","#31688E","#440154"],5:["#FDE725","#5DC863","#21908C","#3B528B","#440154"],6:["#FDE725","#7AD151","#22A884","#2A788E","#414487","#440154"],7:["#FDE725","#8FD744","#35B779","#21908C","#31688E","#443A83","#440154"],8:["#FDE725","#9FDA3A","#4AC16D","#1FA187","#277F8E","#365C8D","#46337E","#440154"],9:["#FDE725","#AADC32","#5DC863","#27AD81","#21908C","#2C728E","#3B528B","#472D7B","#440154"],10:["#FDE725","#B4DE2C","#6DCD59","#35B779","#1F9E89","#26828E","#31688E","#3E4A89","#482878","#440154"],11:["#FDE725","#BBDF27","#7AD151","#43BF71","#22A884","#21908C","#2A788E","#35608D","#414487","#482576","#440154"],12:["#FDE725","#C2DF23","#85D54A","#51C56A","#2BB07F","#1E9B8A","#25858E","#2D708E","#38598C","#433E85","#482173","#440154"]}};return res}();if(typeof module==="object"&&module.exports)module.exports=VizUtil;var PivotTableGenerator=function(){};var _sortIdx=0;var _SORT_NONE=0;var _SORT_DESC=1;var _SORT_ASC=2;var SCROLL_BAR_WIDTH=25;var SHOW_BALLOON_THRESHOLD=15;var COL_INDEX_THRESHOLD_FOR_THUMB=7;var ROW_INDEX_THRESHOLD_FOR_THUMB=10;var HIGHLIGHT_WORD_REGEX=new RegExp('<span topic="([\\d]+)">([^<]*)</span>',"g");var _getNextSortDir=function(current){return(current+1)%3};var _sortDir=_SORT_NONE;var NROW_OPTIONS=[{label:"50",value:50},{label:"100",value:100},{label:"200",value:200},{label:"500",value:500},{label:"1000",value:1e3}];var COLOR_CLASS_MAP={"#EC5D57":"light-red","#F39019":"light-orange","#F5D328":"light-yellow","#70BF41":"light-green","#51A7F9":"light-blue","#B36AE2":"light-purple","#DCDEE0":"light-gray","#C82506":"red","#DE6A10":"orange","#DCBD23":"yellow","#00882B":"green","#0365C0":"blue","#773F9B":"purple","#FFFFFF":"white","#A6AAA9":"gray","#53585F":"dark-gray","#000000":"black","#4D4D4D":"default"};var TOOLBAR_MARGIN_TOP=0;var TOOLBAR_MARGIN_BOTTOM=3;PivotTableGenerator.getSortIndex=function(){return _sortIdx};PivotTableGenerator.setSortIndex=function(idx){_sortIdx=idx};PivotTableGenerator.getSortDirection=function(){return _sortDir};PivotTableGenerator.setSortDirection=function(dir){_sortDir=dir};PivotTableGenerator.validateData=function(viz,pdata){if(viz.marker==="table"&&(!pdata.tcolColDefs||pdata.tcolColDefs.length===0)){return false}return true};var isUrl=function(str){return typeof str==="string"&&/^(http:\/\/|https:\/\/)/.test(str)};var isNumberCol=function(col){if(!col){return false}return col.isNumeric||/(difftime|Period|duration|hms|interval)/i.test(col.type)};PivotTableGenerator.applyConditionalFormatting=function(cfs,coldef,val,defaultColor){if(!cfs){return null}var res=defaultColor||coldef.defaultBarColor||"#DCDEE0",i=0,cf=null,cond,op,start,end,_cond,_val,ratio=coldef.suffix==="%"?100:1;if(VizUtil.isEmpty(val)){return res}for(i=cfs.length-1;i>=0;i--){cf=cfs[i];cond=cf.value;op=cf.operator||"eq";switch(op){case"gt":cond=VizUtil.returnsNumericValue(coldef)?parseFloat(cond)*ratio:VizUtil.returnsDateValue(coldef)?new Date(cond):null;val=VizUtil.returnsNumericValue(coldef)?parseFloat(val):VizUtil.returnsDateValue(coldef)?new Date(val):null;if(cond!==null&&cond<val){res=cf.color}break;case"gte":cond=VizUtil.returnsNumericValue(coldef)?parseFloat(cond)*ratio:VizUtil.returnsDateValue(coldef)?new Date(cond):null;val=VizUtil.returnsNumericValue(coldef)?parseFloat(val):VizUtil.returnsDateValue(coldef)?new Date(val):null;if(cond!==null&&cond<=val){res=cf.color}break;case"lt":cond=VizUtil.returnsNumericValue(coldef)?parseFloat(cond)*ratio:VizUtil.returnsDateValue(coldef)?new Date(cond):null;val=VizUtil.returnsNumericValue(coldef)?parseFloat(val):VizUtil.returnsDateValue(coldef)?new Date(val):null;if(cond!==null&&cond>val){res=cf.color}break;case"lte":cond=VizUtil.returnsNumericValue(coldef)?parseFloat(cond)*ratio:VizUtil.returnsDateValue(coldef)?new Date(cond):null;val=VizUtil.returnsNumericValue(coldef)?parseFloat(val):VizUtil.returnsDateValue(coldef)?new Date(val):null;if(cond!==null&&cond>=val){res=cf.color}break;case"eq":if(VizUtil.returnsDateValue(coldef)){_val=typeof val==="number"?null:new Date(val);_cond=new Date(cond);if(_val&&_cond&&!isNaN(_val.getTime())&&!isNaN(_cond.getTime())){if(_val.getTime()===_cond.getTime()){res=cf.color}}else if(cond===val.toString()){res=cf.color}}else if(VizUtil.returnsNumericValue(coldef)){_val=parseFloat(val);_cond=parseFloat(cond)*ratio;if(_val!==null&&!isNaN(_val)&&_cond!==null&&!isNaN(_cond)){if(_val===_cond){res=cf.color}}else if(cond===val.toString()){res=cf.color}}else if(cond===val.toString()){res=cf.color}break;case"ne":if(VizUtil.returnsDateValue(coldef)){_val=typeof val==="number"?null:new Date(val);_cond=new Date(cond);if(_val&&_cond&&!isNaN(_val.getTime())&&!isNaN(_cond.getTime())){if(_val.getTime()!==_cond.getTime()){res=cf.color}}else if(cond!==val.toString()){res=cf.color}}else if(VizUtil.returnsNumericValue(coldef)){_val=parseFloat(val);_cond=parseFloat(cond)*ratio;if(_val!==null&&!isNaN(_val)&&_cond!==null&&!isNaN(_cond)){if(_val!==_cond){res=cf.color}}else if(cond!==val.toString()){res=cf.color}}else if(cond!==val.toString()){res=cf.color}break;case"in":if(cond&&typeof cond==="string"){cond=cond.split(",").map(function(c){return c.trim()})}if(Array.isArray(cond)){if(VizUtil.returnsNumericValue(coldef)){cond=cond.map(function(c){return parseFloat(c)*ratio});if(cond.indexOf(parseFloat(val))>-1){res=cf.color}}else{if(cond.indexOf(val.toString())>-1){res=cf.color}}}break;case"ni":if(cond&&typeof cond==="string"){cond=cond.split(",").map(function(c){return c.trim()})}if(Array.isArray(cond)){if(VizUtil.returnsNumericValue(coldef)){cond=cond.map(function(c){return parseFloat(c)*ratio});if(cond.indexOf(parseFloat(val))===-1){res=cf.color}}else{if(cond.indexOf(val.toString())===-1){res=cf.color}}}break;case"sw":if(val.toString().startsWith(cond)){res=cf.color}break;case"nsw":if(!val.toString().startsWith(cond)){res=cf.color}break;case"ew":if(val.toString().endsWith(cond)){res=cf.color}break;case"new":if(!val.toString().endsWith(cond)){res=cf.color}break;case"contains":if(val.toString().indexOf(cond)>-1){res=cf.color}break;case"not-contains":if(val.toString().indexOf(cond)===-1){res=cf.color}break;case"between":if(cond&&typeof cond==="string"){cond=cond.split(",").map(function(c){return c.trim()})}if(Array.isArray(cond)&&cond.length>1){start=VizUtil.returnsNumericValue(coldef)?parseFloat(cond[0])*ratio:VizUtil.returnsDateValue(coldef)?new Date(cond[0]):null;end=VizUtil.returnsNumericValue(coldef)?parseFloat(cond[1])*ratio:VizUtil.returnsDateValue(coldef)?new Date(cond[1]):null;val=VizUtil.returnsNumericValue(coldef)?parseFloat(val):VizUtil.returnsDateValue(coldef)?new Date(val):null;if(start!==null&&end!==null&&start<=val&&end>=val){res=cf.color}}break;case"not-between":if(cond&&typeof cond==="string"){cond=cond.split(",").map(function(c){return c.trim()})}if(Array.isArray(cond)&&cond.length>1){start=VizUtil.returnsNumericValue(coldef)?parseFloat(cond[0])*ratio:VizUtil.returnsDateValue(coldef)?new Date(cond[0]):null;end=VizUtil.returnsNumericValue(coldef)?parseFloat(cond[1])*ratio:VizUtil.returnsDateValue(coldef)?new Date(cond[1]):null;val=VizUtil.returnsNumericValue(coldef)?parseFloat(val):VizUtil.returnsDateValue(coldef)?new Date(val):null;if(start!==null&&end!==null&&(start>val||end<val)){res=cf.color}}break;case"is-true":if(val.toString()==="TRUE"){res=cf.color}break;case"is-false":if(val.toString()==="FALSE"){res=cf.color}break}}return res};PivotTableGenerator.calculateDefaultCellWidthForFitToScreen=function(elTarget,viz,pdata){var hideDataCells=viz.pivotHideDataCells==="on",availableWidth=elTarget?elTarget.clientWidth:null,isTable=viz.marker==="table",isPivot=viz.marker==="pivot",ncol=0;if(availableWidth){pdata.rowhCols.forEach(function(c,cidx){if(!viz["rowh"+cidx+"HideCells"]){if(pdata.rowhColDefs[cidx].cellWidth){availableWidth-=parseInt(pdata.rowhColDefs[cidx].cellWidth)}else{ncol++}}});if(!hideDataCells){pdata.colh.forEach(function(c,idx){if(isTable){if(pdata.tcolColDefs[idx]&&pdata.tcolColDefs[idx].column.cellWidth){availableWidth-=parseInt(pdata.tcolColDefs[idx].column.cellWidth)}else{ncol++}}else{if(pdata.colhColDefs.length===1&&pdata.measColDefs.length===1){if(pdata.measColDefs[0].cellWidth){availableWidth-=parseInt(pdata.measColDefs[0].cellWidth)}else{ncol++}}else{var midx=idx;if(pdata.colgh.length>0){midx=idx%pdata.measColDefs.length}if(pdata.measColDefs[midx]&&pdata.measColDefs[midx].cellWidth){availableWidth-=parseInt(pdata.measColDefs[midx].cellWidth)}else{ncol++}}}});if(isPivot&&pdata.rowTotals&&pdata.rowTotals.length>0){pdata.measColDefs.forEach(function(col){if(col&&col.cellWidth){availableWidth-=parseInt(col.cellWidth)}else{ncol++}})}}if(ncol===0){return null}availableWidth-=16;if(elTarget&&elTarget.classList&&elTarget.classList.contains&&elTarget.classList.contains("analysis-view-area")){availableWidth-=10;if($(elTarget).parents(".platform.win32").length){availableWidth-=3}}var res=parseInt(availableWidth/ncol);if(isNaN(res)||res<=0){res=null}return res}return null};PivotTableGenerator.render=function(viz,data,elTarget,prevState,headerSyncDelay,lang,onLoadCallback,onErrorCallback,onBeforeRenderingCallback,onPivotSortCallback,onTableColumnConfigClickCallback,onPropUpdateCallback,onShowDetailCallback){if(lang){PivotTableGenerator._lang=lang}try{PivotTableGenerator._render(viz,data,elTarget,prevState,headerSyncDelay,onBeforeRenderingCallback,onPivotSortCallback,onTableColumnConfigClickCallback,onPropUpdateCallback,onShowDetailCallback)}catch(e){if(onErrorCallback&&typeof onErrorCallback==="function"){onErrorCallback(e,viz)}if(elTarget){VizUtil.renderNoData(elTarget,VizUtil.getMessage(PivotTableGenerator._lang,"Chart rendering failed."))}console.error(e)}finally{if(onLoadCallback&&typeof onLoadCallback==="function"){onLoadCallback()}}};PivotTableGenerator._render=function(viz,data,elTarget,prevState,headerSyncDelay,onBeforeRenderingCallback,onPivotSortCallback,onTableColumnConfigClickCallback,onPropUpdateCallback,onShowDetailCallback){var isPivot=viz.marker==="pivot";var isTable=viz.marker==="table";var isSummaryTable=viz.marker==="summarytable";var isSingleValue=viz.marker==="singlevalue";var newViz=VizUtil.migrateJson(viz);if(newViz){viz=newViz}data=VizUtil.translateColumnData(data,viz,PivotTableGenerator._lang);var bucketLabelMap=VizUtil.translateBucketLabels(data,viz,PivotTableGenerator._lang);while(elTarget&&elTarget.childNodes.length>0){elTarget.removeChild(elTarget.firstChild)}var isHeadless=!elTarget;var _document=typeof document==="undefined"?null:document,_$=typeof $==="undefined"?null:$;if(isHeadless){_document=VizUtil.getDocumentMock();_$=VizUtil.getJQueryMock();elTarget=_document.createElement("div")}var translateColumn=function(text,enableRegexTrans){if(viz.translate==="on"){return VizUtil.getMessage(PivotTableGenerator._lang,text,enableRegexTrans)}else{return text}};if(isSingleValue){PivotTableGenerator.renderSingleValue(viz,data,elTarget,isHeadless,onBeforeRenderingCallback);return}if(!data||data.length===0||!data[0]||data[0].length===0){VizUtil.renderNoData(elTarget,VizUtil.getMessage(PivotTableGenerator._lang,"There is no data to display."),null,VizUtil.getMessage(PivotTableGenerator._lang,"Try assigning a column again."));return}var _syncHeader=function(elTarget){var i,j,l;var headerCells=elTarget.querySelectorAll(".pivot-view .pivot-col-header-view .pivot-cell.header");var bodyCells=elTarget.querySelectorAll(".pivot-view .pivot-body-view .pivot-cell.header");for(i=0,l=bodyCells.length;i<l;i++){headerCells.item(i).style.minWidth=bodyCells.item(i).offsetWidth+"px";headerCells.item(i).style.maxWidth=bodyCells.item(i).offsetWidth+"px"}var colTitle=elTarget.querySelector(".pivot-col-title");if(colTitle){var rowHeaders=elTarget.querySelectorAll(".pivot-view .pivot-col-header-view .pivot-row:last-of-type .pivot-cell.header.row-header");if(rowHeaders.length>0){var p=0;for(i=0,l=rowHeaders.length;i<l;i++){if(bodyCells[i]){p+=bodyCells[i].clientWidth}}colTitle.style.paddingLeft=p+"px"}else{colTitle.style.paddingLeft="10px"}}var groupCells=elTarget.querySelectorAll(".pivot-view .pivot-col-header-view .pivot-row .pivot-cell.header.col-header.col-span");var c;for(i=0,l=groupCells.length;i<l;i++){c=groupCells[i];if(c){var span=parseInt(c.getAttribute("data-col-span"));if(!isNaN(span)){var _nextSibling=c;var _width=c.clientWidth-20;for(j=1;j<span;j++){_nextSibling=c.nextSibling;_width+=_nextSibling.clientWidth}}if(!isNaN(_width)){c=c.querySelector(".pivot-cell-text");if(c){c.style.width=_width+"px"}}}}};var _syncTitle=function(elTarget){var pivotTitle=elTarget.querySelector(".pivot-title");var pivotTable=elTarget.querySelector(".pivot-view .pivot-body-view .pivot-table-frame");var pivotTitleWidth=_$(pivotTitle).width();var pivotTableWidth=_$(pivotTable).width();if(pivotTitleWidth>pivotTableWidth){_$(pivotTitle).width(pivotTableWidth)}};var PIXEL_STEP=10;var LINE_HEIGHT=40;var PAGE_HEIGHT=800;var normalizeWheel=function(event){var sX=0,sY=0,pX=0,pY=0;if("detail"in event){sY=event.detail}if("wheelDelta"in event){sY=-event.wheelDelta/120}if("wheelDeltaY"in event){sY=-event.wheelDeltaY/120}if("wheelDeltaX"in event){sX=-event.wheelDeltaX/120}if("axis"in event&&event.axis===event.HORIZONTAL_AXIS){sX=sY;sY=0}pX=sX*PIXEL_STEP;pY=sY*PIXEL_STEP;if("deltaY"in event){pY=event.deltaY}if("deltaX"in event){pX=event.deltaX}if((pX||pY)&&event.deltaMode){if(event.deltaMode==1){pX*=LINE_HEIGHT;pY*=LINE_HEIGHT}else{pX*=PAGE_HEIGHT;pY*=PAGE_HEIGHT}}if(pX&&!sX){sX=pX<1?-1:1}if(pY&&!sY){sY=pY<1?-1:1}return{spinX:sX,spinY:sY,pixelX:pX,pixelY:pY}};var _scroll;var _onScrollHandler=function(ev){var left=ev.target.scrollLeft;_scroll.left=left;_scroll.headerElem.parentNode.scrollLeft=_scroll.left};var _onWheelHandler=function(ev){ev.preventDefault();var normEv=normalizeWheel(ev);if(Math.abs(normEv.pixelX)>Math.abs(normEv.pixelY)){if(_scroll.bodyElem.clientWidth>_scroll.bodyElem.parentNode.clientWidth){_scroll.left=Math.max(_scroll.left+normEv.pixelX,0);_scroll.left=Math.min(_scroll.left,_scroll.bodyElem.clientWidth-_scroll.bodyElem.parentNode.clientWidth);_scroll.headerElem.parentNode.scrollLeft=_scroll.left;_scroll.bodyElem.parentNode.scrollLeft=_scroll.left}}else{if(_scroll.bodyElem.clientHeight>_scroll.bodyElem.parentNode.clientHeight){_scroll.top=Math.max(_scroll.top+normEv.pixelY,0);_scroll.top=Math.min(_scroll.top,_scroll.bodyElem.clientHeight-_scroll.bodyElem.parentNode.clientHeight-5);_scroll.bodyElem.parentNode.scrollTop=_scroll.top}}};var _initScrollHandler=function(elTarget,prevState){var tableElem=elTarget.querySelector(".pivot-view");var bodyElem=tableElem.querySelector(".pivot-table-body-frame");var headerElem=tableElem.querySelector(".pivot-table-col-header-frame");var scroll={left:0,top:0,tableElem:tableElem,headerElem:headerElem,bodyElem:bodyElem};_scroll=scroll;if(prevState){_scroll.left=prevState.left;_scroll.headerElem.parentNode.scrollLeft=_scroll.left;_scroll.bodyElem.parentNode.scrollLeft=_scroll.left}tableElem.addEventListener("wheel",_onWheelHandler);bodyElem.parentNode.addEventListener("scroll",_onScrollHandler)};_$(".pivot-balloon-style").css("display","none");if(!prevState){_sortIdx=0;_sortDir=_SORT_NONE;var measOps=VizUtil.getOptions(viz,"meas").filter(function(m){return!!m});measOps.some(function(measOp,midx){if(measOp.sortOrder){_sortIdx=midx;_sortDir=measOp.sortOrder==="desc"?_SORT_DESC:_SORT_ASC;return true}return false});if(_sortDir===_SORT_NONE&&!VizUtil.isEmpty(viz.pivotClientSortIndex)&&!VizUtil.isEmpty(viz.pivotClientSortDirection)&&viz.pivotClientSortDirection!==_SORT_NONE){_sortIdx=parseInt(viz.pivotClientSortIndex);_sortDir=parseInt(viz.pivotClientSortDirection)}}var pdata=PivotTableGenerator.constructPivotData(viz,data,_sortIdx,_sortDir);if(!PivotTableGenerator.validateData(viz,pdata)){VizUtil.renderNoData(elTarget,VizUtil.getMessage(PivotTableGenerator._lang,"There is no data to display."));return}SHOW_BALLOON_THRESHOLD=isPivot||isSummaryTable?15:25;var pivotTextWrap=viz.pivotTextWrap||"none";var hideDataCells=viz.pivotHideDataCells==="on";var masterFontSize=viz.pivotMasterFontSize||viz._defaultPivotMasterFontSize||null;var showTotalFirst=viz.pivotTotalPosition==="left";var colh0FontSize=masterFontSize||viz.colh0FontSize;var meas0FontSize=masterFontSize||viz.meas0FontSize;var rowh0TotalFontSize=masterFontSize||viz.rowh0TotalFontSize;var meas0TotalFontSize=masterFontSize||viz.meas0TotalFontSize;var colh0ShowFuncName=viz.colh0ShowFuncName==="on";var fitToScreen=viz.pivotFitToScreen==="on";var defaultCellWidth=null;var NUMROWS_COL_LABEL=VizUtil.getMessage(PivotTableGenerator._lang,VizUtil.NUMROWS_COL_LABEL);var highlightWords=isPivot&&viz.pivotHighlightWords==="on";var calcTotalBeforeAggregation=(viz.pivotTotalCalcTiming||VizUtil.getDefaultPivotTotalCalcTiming())==="before_aggregation";var translateTargetColumns=viz.translateTargetColumns;if(viz.translateTargetColumnsString){translateTargetColumns=viz.translateTargetColumnsString.split(",")}var disableDecimalFormatting=!!viz.disableDecimalFormatting;var numDecimalDigits=viz.numDecimalDigits;if(!VizUtil.isEmpty(numDecimalDigits,true)){disableDecimalFormatting=false}var useThousandSeparator=viz.useThousandSeparator!=="off";var numFormatter=VizUtil.valueFormatterGenerator(disableDecimalFormatting?null:VizUtil.isEmpty(numDecimalDigits,true)?2:numDecimalDigits,useThousandSeparator,VizUtil.isEmpty(numDecimalDigits,true));var customNumFormatter=null;var masterColAlign=null;var colAligns=[];if(isTable){data[1].forEach(function(col,idx){colAligns.push(isNumberCol(viz["tcol"+idx])?"num-col":"text-col")})}else if(pdata.measColDefs.length>1||isSummaryTable){pdata.measColDefs.forEach(function(measColDef){colAligns.push(VizUtil.returnsNumericValue(measColDef.column)?"num-col":"text-col")})}else{masterColAlign=pdata.measColDefs[0]&&VizUtil.returnsNumericValue(pdata.measColDefs[0].column)?"num-col":"text-col"}if(fitToScreen){defaultCellWidth=PivotTableGenerator.calculateDefaultCellWidthForFitToScreen(elTarget,viz,pdata)}var bgcolorScale,fgcolorScale,wordColorScale;var reverseColorPaletteOrderOp=viz.reverseColorPaletteOrder||viz.reverseColorPalleteOrder||"off";var colorarr;if(isPivot&&!!viz.pivotColor&&viz.pivotColor!=="none"&&pdata.measColDefs.filter(function(measColDef){return VizUtil.returnsNumericValue(measColDef.column)}).length===0){var pname=viz.categColorPalette||viz._defaultCategColorPalette||"default";var customCategColorPaletteOp=viz.customCategColorPalette||viz._defaultCustomCategColorPalette;if(pname==="custom"&&customCategColorPaletteOp&&customCategColorPaletteOp.length>0){colorarr=customCategColorPaletteOp.match(VizUtil.COLOR_PALETTE_REGEX).slice();colorarr=colorarr.map(function(x){return VizUtil.hexToRgb(x)===null?"#CCCCCC":x});if(reverseColorPaletteOrderOp==="on"){colorarr.reverse()}bgcolorScale=d3.scale.ordinal().range(colorarr);fgcolorScale=d3.scale.ordinal().range(["#ffffff"])}else{var colors=VizUtil.CATEG_COLOR_PALETTES_HASH[pname].color.slice();if(reverseColorPaletteOrderOp==="on"){colors.reverse()}bgcolorScale=d3.scale.ordinal().range(colors);fgcolorScale=d3.scale.ordinal().range(VizUtil.CATEG_COLOR_PALETTES_HASH[pname].textColor)}if(pdata.measColDefs[0].column.type=="logical"){bgcolorScale("TRUE");bgcolorScale("FALSE");fgcolorScale("TRUE");fgcolorScale("TRUE")}}if(highlightWords){wordColorScale=d3.scale.ordinal().range(VizUtil.CATEG_COLOR_PALETTES_HASH[viz.pivotPaletteForHighlightWords||"default"].color.slice());pdata.colh.forEach(function(colh){wordColorScale(colh)})}var getColAlign=function(idx){return masterColAlign?masterColAlign:colAligns[idx]};_$.balloon.defaults.classname="pivot-balloon-style";_$.balloon.defaults.css=null;_$.balloon.defaults.minLifetime=0;_$.balloon.defaults.showDuration=0;_$.balloon.defaults.hideDuration=0;_$.balloon.defaults.tipSize=5;var colorPaletteOp=viz.quantColorPalette||viz.colorPallete||viz._defaultQuantColorPalette||"Blues";if(!VizUtil.QUANT_COLOR_PALETTES_HASH[colorPaletteOp]){colorPaletteOp="Blues"}var bgcolorPalette=VizUtil.QUANT_COLOR_PALETTES_HASH[colorPaletteOp].color.slice();var fgcolorPalette=VizUtil.QUANT_COLOR_PALETTES_HASH[colorPaletteOp].textColor.slice();var customQuantColorPaletteOp=viz.customQuantColorPalette||viz._defaultCustomQuantColorPalette;if(customQuantColorPaletteOp&&customQuantColorPaletteOp.length>0&&colorPaletteOp==="custom"){colorarr=customQuantColorPaletteOp.match(VizUtil.COLOR_PALETTE_REGEX).slice();colorarr=colorarr.map(function(x){return VizUtil.hexToRgb(x)===null?"#CCCCCC":x});while(colorarr.length<6){colorarr=colorarr.concat(colorarr)}bgcolorPalette=colorarr;fgcolorPalette["#ffffff"]}if(reverseColorPaletteOrderOp==="on"){bgcolorPalette.reverse();fgcolorPalette.reverse()}bgcolorPalette.unshift("#ffffff");fgcolorPalette.unshift("#4d4d4d");var elMetainfo=_document.createElement("div");elMetainfo.classList.add("pivot-metainfo");elTarget.appendChild(elMetainfo);var elToolbar=_document.createElement("div");elToolbar.classList.add("pivot-toolbar");elToolbar.style.marginTop=TOOLBAR_MARGIN_TOP+"px";elToolbar.style.marginBottom=TOOLBAR_MARGIN_BOTTOM+"px";elToolbar.style.whiteSpace="nowrap";elToolbar.style.overflow="hidden";elTarget.appendChild(elToolbar);var elTitle=_document.createElement("div");elTitle.classList.add("pivot-title");elTarget.appendChild(elTitle);var elColTitle=_document.createElement("div");elColTitle.classList.add("pivot-col-title");elColTitle.textContent="Column Title";elTarget.appendChild(elColTitle);var elPivotView=_document.createElement("div");elPivotView.classList.add("pivot-view");elPivotView.classList.add(isPivot||isSummaryTable?"type-pivot":"type-table");if(onTableColumnConfigClickCallback){elPivotView.classList.add("with-column-config-icons")}if(isTable&&viz.tableTextWrap==="on"){elPivotView.classList.add("allow-multiple-lines")}else if((isPivot||isSummaryTable)&&pivotTextWrap==="fixed"){elPivotView.classList.add("allow-multiple-lines")}if(pdata.colgh.length>0){elPivotView.classList.add("two-row-header-rows")}elTarget.appendChild(elPivotView);var elPivotColHeaderView=_document.createElement("div");elPivotColHeaderView.classList.add("pivot-col-header-view");var elPivotColHeader=_document.createElement("div");elPivotColHeader.classList.add("pivot-table-frame");elPivotColHeader.classList.add("pivot-table-col-header-frame");elPivotColHeaderView.appendChild(elPivotColHeader);var elPivotBodyView=_document.createElement("div");elPivotBodyView.classList.add("pivot-body-view");var elPivot=_document.createElement("div");elPivot.classList.add("pivot-table-frame");elPivot.classList.add("pivot-table-body-frame");elPivotBodyView.appendChild(elPivot);elPivotView.appendChild(elPivotBodyView);elPivotView.appendChild(elPivotColHeaderView);var voffset=0;var onToolbarWidgetClick=function(ev){if(ev){ev.stopPropagation()}};var onToolbarWidgetChange=function(ev){if(ev){ev.stopPropagation()}var $toolbar=_$(ev.target.parentNode);if($toolbar.find(".nrows-to-show-dropdown").length>0){var nrowsToShow=$toolbar.find(".nrows-to-show-dropdown").val();if(onPropUpdateCallback){onPropUpdateCallback("tableNRowsToShow",nrowsToShow)}viz.tableNRowsToShow=nrowsToShow}var $search=$toolbar.find(".search-field");var keyword=$search.length>0?$search.val():null;PivotTableGenerator.render(viz,data,elTarget,{top:_scroll.top,left:_scroll.left,keyword:keyword},null,PivotTableGenerator._lang,null,null,null,onPivotSortCallback,onTableColumnConfigClickCallback,onPropUpdateCallback,onShowDetailCallback)};var highlightSearchKeyword=function(searchField){var searchText=searchField.value;if(searchText){var re=new RegExp(searchText,"ig");var rows=searchField.parentNode.parentNode.parentNode.parentNode.querySelectorAll(".pivot-view > .pivot-body-view > .pivot-table-frame .pivot-row.banded");rows.forEach(function(row){if(row.style.display==="none"){return}var cells=row.querySelectorAll(".pivot-cell");cells.forEach(function(cell,cidx){var highlightedTextElem=cell.querySelector("span.hl");var textElem=cell.querySelector("span.ot");var txt=textElem.innerText;var html=[];var matched=txt.match(re);if(matched){if(!highlightedTextElem){highlightedTextElem=_document.createElement("span");highlightedTextElem.style.position="relative";highlightedTextElem.classList.add("hl");textElem.parentNode.appendChild(highlightedTextElem)}textElem.style.display="none";highlightedTextElem.style.display="inline";var splitted=txt.split(re);splitted.forEach(function(s,idx){html.push(s);if(idx<matched.length){html.push("<strong>");html.push(matched[idx]);html.push("</strong>")}});highlightedTextElem.innerHTML=html.join("")}else{textElem.style.display="inline";if(highlightedTextElem){highlightedTextElem.style.display="none"}}})})}};var filterRowsBySearchKeyword=function(searchField){var searchText=searchField.value;var rows=searchField.parentNode.parentNode.parentNode.parentNode.querySelectorAll(".pivot-view > .pivot-body-view > .pivot-table-frame .pivot-row.banded");var deleteIcon=searchField.parentNode.querySelector(".icon-close");if(searchText){if(deleteIcon){deleteIcon.style.display="inline-block"}if(rows.length>0){rows[0].parentNode.classList.add("hide-rows")}var headerCells=searchField.parentNode.parentNode.parentNode.parentNode.querySelectorAll(".pivot-view > .pivot-col-header-view > .pivot-table-frame .pivot-cell.header");var cellWidths=[];headerCells.forEach(function(hcell){cellWidths.push(hcell.style.minWidth||hcell.clientWidth+"px")});var re=new RegExp(searchText,"ig");var isWidthAdjusted=false;rows.forEach(function(row){var cells=row.querySelectorAll(".pivot-cell");var matched=false;cells.forEach(function(cell){matched=re.test(cell.innerText)||matched});if(matched){row.style.display="table-row";cells.forEach(function(cell,cidx){if(!isWidthAdjusted){cell.style.minWidth=cellWidths[cidx];cell.style.maxWidth=cellWidths[cidx]}var highlightedTextElem=cell.querySelector("span.hl");if(highlightedTextElem){highlightedTextElem.style.display="none"}var textElem=cell.querySelector("span.ot");textElem.style.display="inline"});isWidthAdjusted=true}else{row.style.display="none"}})}else{if(deleteIcon){deleteIcon.style.display=null}if(rows.length>0){rows[0].parentNode.classList.remove("hide-rows")}rows.forEach(function(row){row.style.display=null;var cells=row.querySelectorAll(".hl");cells.forEach(function(cell){cell.style.display="none";if(cell.previousElementSibling){cell.previousElementSibling.style.display="inline"}})})}};var renderToolbar=function(viz,_document,pdata){if(viz.marker!=="table"){return null}var toolbar=_document.createElement("div");if(viz.showSearchInToolbar!=="off"){renderSearch(viz,_document,pdata,toolbar)}if(viz.showNRowsToShowOptionInToolbar==="on"){renderNRowOption(viz,_document,pdata,toolbar)}return toolbar&&toolbar.childNodes&&toolbar.childNodes.length>0?toolbar:null};var renderSearch=function(viz,_document,pdata,toolbar){var searchContainer=_document.createElement("div");searchContainer.classList.add("search-container");var searchField=_document.createElement("input");searchField.setAttribute("placeholder",VizUtil.getMessage(PivotTableGenerator._lang,"table.toolbar.search"));searchField.classList.add("search-field");searchField.oninput=function(ev){if(ev.stopPropagation){ev.stopPropagation()}filterRowsBySearchKeyword(this);highlightSearchKeyword(this)};var searchIcon=_document.createElement("i");searchIcon.classList.add("icon-search");var closeIcon=_document.createElement("i");closeIcon.classList.add("icon-close");closeIcon.onclick=function(ev){if(ev.stopPropagation){ev.stopPropagation()}var searchTextField=this.parentNode.firstElementChild;searchTextField.value="";filterRowsBySearchKeyword(searchTextField)};searchContainer.appendChild(searchField);searchContainer.appendChild(searchIcon);searchContainer.appendChild(closeIcon);toolbar.appendChild(searchContainer);return toolbar};var renderNRowOption=function(viz,_document,pdata,toolbar){var showNumRowLov=pdata.originalRowSize>NROW_OPTIONS[0].value;var nrowsToShow=viz.tableNRowsToShow?parseInt(viz.tableNRowsToShow):NROW_OPTIONS[0].value;var op,section1,section2,section3,section4,section5,section6,section7,section8,section9,section10,fmtr=d3.format(","),loc=PivotTableGenerator._lang;section1=_document.createElement("span");section1.textContent=VizUtil.getMessage(loc,"table.toolbar.section1");section1.style.marginRight=section1.textContent?"3px":"0px";section1.style.verticalAlign="baseline";section1.style.display="inline-block";section1.style.fontSize="12px";if(showNumRowLov){section2=_document.createElement("select");section2.style.width="60px";section2.style.backgroundColor="white";section2.style.border="1px solid #ccc";section2.style.borderRadius="3px";section2.style.outline="none";section2.style.margin="0 6px 0 6px";section2.style.verticalAlign="baseline";section2.style.display="inline-block";section2.style.padding="2px 0 2px 5px";section2.style.fontSize="12px";section2.style.height="23px";section2.onchange=onToolbarWidgetChange;section2.onclick=onToolbarWidgetClick;section2.classList.add("nrows-to-show-dropdown");var isAllAdded=false,text;NROW_OPTIONS.forEach(function(x){text=VizUtil.getMessage(PivotTableGenerator._lang,x.label);if(pdata.rowsFetched<=x.value){if(isAllAdded){return}else{text=fmtr(pdata.rowsFetched);if(pdata.rowsFetched<nrowsToShow){nrowsToShow=x.value}isAllAdded=true}}op=_document.createElement("option");op.textContent=text;op.setAttribute("value",x.value);if(x.value===nrowsToShow){op.setAttribute("selected","selected")}section2.appendChild(op)})}else{section2=_document.createElement("span");section2.textContent=fmtr(pdata.rowsFetched);if(loc!=="ja"){section2.style.marginRight="3px"}section2.style.verticalAlign="baseline";section2.style.display="inline-block";section2.style.fontSize="12px"}section3=_document.createElement("span");section3.textContent=VizUtil.getMessage(loc,"table.toolbar.section3");section3.style.marginRight="3px";section3.style.verticalAlign="baseline";section3.style.display="inline-block";section3.style.fontSize="12px";section4=_document.createElement("span");section4.textContent=fmtr(pdata.originalRowSize);if(loc!=="ja"){section4.style.marginRight="3px"}section4.style.verticalAlign="baseline";section4.style.display="inline-block";section4.style.fontSize="12px";section5=_document.createElement("span");section5.textContent=VizUtil.getMessage(loc,"table.toolbar.section5");section5.style.marginRight="3px";section5.style.verticalAlign="baseline";section5.style.display="inline-block";section5.style.fontSize="12px";section6=_document.createElement("span");section6.textContent=fmtr(pdata.colh.length);if(loc!=="ja"){section6.style.marginRight="3px"}section6.style.verticalAlign="baseline";section6.style.display="inline-block";section6.style.fontSize="12px";section7=_document.createElement("span");section7.textContent=VizUtil.getMessage(loc,"table.toolbar.section7");if(loc!=="ja"){section7.style.marginRight="3px"}section7.style.verticalAlign="baseline";section7.style.display="inline-block";section7.style.fontSize="12px";section8=_document.createElement("span");section8.textContent=fmtr(pdata.originalColSize);if(loc!=="ja"){section8.style.marginRight="3px"}section8.style.verticalAlign="baseline";section8.style.display="inline-block";section8.style.fontSize="12px";section9=_document.createElement("span");section9.textContent=VizUtil.getMessage(loc,"table.toolbar.section9");section9.style.marginRight="3px";section9.style.verticalAlign="baseline";section9.style.display="inline-block";section9.style.fontSize="12px";section10=_document.createElement("span");section10.textContent=VizUtil.getMessage(loc,"table.toolbar.section10");section10.style.marginRight="18px";section10.style.verticalAlign="baseline";section10.style.display="inline-block";section10.style.fontSize="12px";if(loc==="ja"){toolbar.appendChild(section1);if(showNumRowLov){toolbar.appendChild(section4);toolbar.appendChild(section5)}toolbar.appendChild(section2);toolbar.appendChild(section3);if(pdata.colh.length<pdata.originalColSize){toolbar.appendChild(section8);toolbar.appendChild(section9)}toolbar.appendChild(section6);toolbar.appendChild(section7);toolbar.appendChild(section10)}else{toolbar.appendChild(section1);toolbar.appendChild(section2);if(showNumRowLov){toolbar.appendChild(section3);toolbar.appendChild(section4)}toolbar.appendChild(section5);toolbar.appendChild(section6);if(pdata.colh.length<pdata.originalColSize){toolbar.appendChild(section7);toolbar.appendChild(section8)}toolbar.appendChild(section9);toolbar.appendChild(section10)}return toolbar};var elToolbarContent=renderToolbar(viz,_document,pdata);if(elToolbarContent){elToolbar.appendChild(elToolbarContent);elToolbar.classList.remove("hidden");voffset+=elToolbar.clientHeight+TOOLBAR_MARGIN_TOP+TOOLBAR_MARGIN_BOTTOM}else{elToolbar.textContent="";elToolbar.classList.add("hidden")}var infoMsgArr=[];var tFmtr=d3.format(",");if(viz.marker!=="table"||viz.showNRowsToShowOptionInToolbar!=="on"){if(pdata.data.length<pdata.originalRowSize){infoMsgArr.push(tFmtr(pdata.data.length)+VizUtil.getMessage(PivotTableGenerator._lang,"pivot.metrics.rows.of")+tFmtr(pdata.originalRowSize)+VizUtil.getMessage(PivotTableGenerator._lang,"pivot.metrics.total.rows"))}if(pdata.colh.length<pdata.originalColSize){infoMsgArr.push(tFmtr(pdata.colh.length+pdata.numRowh)+VizUtil.getMessage(PivotTableGenerator._lang,"pivot.metrics.cols.of")+tFmtr(pdata.originalColSize+pdata.numRowh)+VizUtil.getMessage(PivotTableGenerator._lang,"pivot.metrics.total.cols"))}}var isShowDetails=viz.dataCacheId&&viz.dataCacheId===".detail.table";if(isShowDetails&&viz){var _numOfRows=viz._numOfRows;if(!_numOfRows){_numOfRows=pdata.data.length}if(_numOfRows){if(typeof _numOfRows==="string"){_numOfRows=_numOfRows.replace(/[^0-9]/g,"")}_numOfRows=d3.format(",")(_numOfRows)}infoMsgArr=[];elMetainfo.textContent=_numOfRows+" "+VizUtil.getMessage(PivotTableGenerator._lang,_numOfRows==="1"?"row":"rows");elMetainfo.style.fontSize="13px";elMetainfo.style.color="#4d4d4d";elMetainfo.style.transform="translateY(-2px)"}else if(!(isPivot||isSummaryTable)&&pdata.data.length>=pdata.originalRowSize&&pdata.colh.length>=pdata.originalColSize){infoMsgArr=[]}if(elToolbarContent){infoMsgArr=[]}if(infoMsgArr.length>0){elMetainfo.textContent=VizUtil.getMessage(PivotTableGenerator._lang,"pivot.metrics.prefix")+infoMsgArr.join(", ")+VizUtil.getMessage(PivotTableGenerator._lang,"pivot.metrics.suffix")}else{elPivotView.style.marginTop="0px";if(!isShowDetails){elMetainfo.classList.add("hidden")}}voffset+=elMetainfo.clientHeight;if(viz.title){elTitle.textContent=viz.title;if(viz.titleFontSize||viz._defaultTitleFontSize){elTitle.style.fontSize=(viz.titleFontSize||viz._defaultTitleFontSize)+"px"}if(/bold/.test(viz.titleFontWeight)){elTitle.style.fontWeight="bold"}if(/italic/.test(viz.titleFontWeight)){elTitle.style.fontStyle="italic"}elTitle.classList.remove("hidden");voffset+=45}else{elTitle.textContent="";elTitle.classList.add("hidden")}if(viz.colh0&&viz.colh0.showHeaderTitle!=="off"&&!hideDataCells){elColTitle.textContent=translateColumn(pdata.colhColDefs[0].column.displayName||viz.colh0.name);var colhStyle=pdata.colhColDefs[0].column.headerFontStyle,colhColor=pdata.colhColDefs[0].column.headerFontColor,colhBgcolor=pdata.colhColDefs[0].column.headerBackgroundColor,colhFontSize=masterFontSize;if(colhStyle){if(!/bold/.test(colhStyle)){elColTitle.style.fontWeight="normal"}if(/italic/.test(colhStyle)){elColTitle.style.fontStyle="italic"}}if(colhColor){elColTitle.style.color=colhColor}if(colhBgcolor){elColTitle.style.backgroundColor=colhBgcolor}if(colhFontSize){elColTitle.style.fontSize=colhFontSize+"px"}elColTitle.classList.remove("hidden");voffset+=20}else{elColTitle.textContent="";elColTitle.classList.add("hidden")}if(voffset>0){elPivotView.style.height=" calc( 100% - "+voffset+"px )"}else{elPivotView.style.height="100%"}var elRow,elCell,elCellText,elLink;var setupColumnFormat=function(col,idx){if(col){var isNumeric=VizUtil.returnsNumericValue(col.column);if(col.column.type===VizUtil.TYPE_CUSTOM&&col.isCategorical){isNumeric=false}var useGradientPalette=isNumeric&&!col.option.startsWith("rowh");if(isNumeric){col.column.prefix=VizUtil.getValuePrefix(col.column.numberFormatting||VizUtil.getDefaultNumberFormattingOption(viz.marker,col.column.func),col.column.currencySymbol,viz.marker)||"";col.column.totalPrefix=col.column.prefix;col.column.suffix=VizUtil.getValueSuffix(col.option.startsWith("meas")?viz["meas"+idx+"WindowFunc"]:null,col.column.func,col.column.numberFormatting||VizUtil.getDefaultNumberFormattingOption(viz.marker,col.column.func),viz.marker)||"";col.column.totalSuffix=VizUtil.getValueSuffix(col.option.startsWith("meas")&&!calcTotalBeforeAggregation?viz["meas"+idx+"WindowFunc"]:null,col.column.func,col.column.numberFormatting||VizUtil.getDefaultNumberFormattingOption(viz.marker,col.column.func),viz.marker)||""}var _decimalDigits=disableDecimalFormatting?null:!VizUtil.isEmpty(col.column.numDecimalDigits,true)?col.column.numDecimalDigits:!VizUtil.isEmpty(viz.numDecimalDigits,true)?viz.numDecimalDigits:2;var _useThousandSep=col.column.useThousandSeparator!=="off";var _truncateTrailingZeros=VizUtil.isEmpty(col.column.numDecimalDigits,true)&&VizUtil.isEmpty(viz.numDecimalDigits,true)&&col.column.func!=="ascategory";col.column.customNumFormatter=VizUtil.valueFormatterGenerator(_decimalDigits,_useThousandSep,_truncateTrailingZeros);if(col.column.formattingTarget&&col.column.formattingType==="posneg"){col.column.posColor=col.column.positiveColor||"rgb(153, 228, 245)";col.column.negColor=col.column.negativeColor||"rgb(247, 160, 153)"}else if(col.column.formattingTarget&&col.column.formattingType==="color"){var name=col.column.colorPalette||(useGradientPalette?viz._defaultQuantColorPalette||"Blues":viz._defaultCategColorPalette||"default");var cpl=VizUtil.QUANT_COLOR_PALETTES_HASH[name].color.slice();var customPalette=col.column.customColorPalette||(useGradientPalette?viz._defaultCustomQuantColorPalette:viz._defaultCustomCategColorPalette);if(name==="custom"&&customPalette){cpl=customPalette.match(VizUtil.COLOR_PALETTE_REGEX).slice()}if(col.column.reverseColorPalette==="on"){cpl.reverse()}if(useGradientPalette){col.column.scale=chroma.scale(cpl).domain([0,0])}else{col.column.scale=d3.scale.ordinal().range(cpl);if(col.column.type=="logical"){col.column.scale("TRUE");col.column.scale("FALSE")}else if(col.categories){if(name==="default"&&col.categories.length>9){cpl=d3.scale.category20().range().slice();if(col.column.reverseColorPalette==="on"){cpl.reverse()}col.column.scale=d3.scale.ordinal().range(cpl)}col.categories.forEach(function(x){col.column.scale(x)})}}}}};if(isTable){pdata.tcolColDefs.forEach(setupColumnFormat)}else if(isSummaryTable||isPivot){pdata.measColDefs.forEach(setupColumnFormat);pdata.rowhColDefs.forEach(setupColumnFormat);pdata.colhColDefs.forEach(setupColumnFormat)}var getMeasureStr=function(coldef){if(!coldef){return""}else{var s=!coldef.column?NUMROWS_COL_LABEL:translateColumn(coldef.column.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:coldef.column.name);if(coldef.title){s=coldef.title}if(colh0ShowFuncName&&s!==NUMROWS_COL_LABEL&&coldef.column.type!==VizUtil.TYPE_CUSTOM){s+=" ("+VizUtil.getMessage(PivotTableGenerator._lang,VizUtil.AGGREGATION_FUNCTION_OPTIONS_HASH[coldef.column.func]||coldef.column.func)+")"}return s}};var onColumnHeaderClickHandler=function(idx){if(_sortIdx===idx){_sortDir=_getNextSortDir(_sortDir)}else{_sortIdx=idx;_sortDir=_SORT_DESC}if(onPivotSortCallback){onPivotSortCallback(_sortIdx,_sortDir)}var $search=$(elTarget).find(".search-field");var keyword=$search.length>0?$search.val():null;PivotTableGenerator.render(viz,data,elTarget,{top:_scroll.top,left:_scroll.left,keyword:keyword},null,PivotTableGenerator._lang,null,null,null,onPivotSortCallback,onTableColumnConfigClickCallback,onPropUpdateCallback,onShowDetailCallback)};var formatValue=function(v,prefix,suffix){if(!numFormatter&&!customNumFormatter){return v}if(v==="Inf"||v==="-Inf"){return v}else if(VizUtil.isEmpty(v)||v===""||v==="NaN"){return""}var s=customNumFormatter?customNumFormatter(v):numFormatter(v);if(prefix===null||prefix===undefined){prefix=""}if(suffix===null||suffix===undefined){suffix=""}if(!/\d/.test(s)){prefix="";suffix=""}if(s.startsWith("-")){return"-"+prefix+s.replace(/^-/,"")+suffix}else{return prefix+s+suffix}};var formatHeaderValue=function(v,prefix,suffix){if(/ - /.test(v)){return v.split(" - ").map(function(x){return formatValue(x,prefix,suffix)}).join(" - ")}else{return formatValue(v,prefix,suffix)}};var renderHeader=function(targetElem,addRightPaddingForScollbar){if(pdata.colgh.length>0){var style,color,bgcolor;var ccol=pdata.colhColDefs[0].column;elRow=_document.createElement("div");elRow.classList.add("pivot-row");targetElem.appendChild(elRow);pdata.rowhCols.forEach(function(c,cidx){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","header","row-header");if(viz["rowh"+cidx+"HideCells"]){elCell.style.display="none"}bgcolor=ccol.backgroundColor;if(bgcolor){elCell.style.backgroundColor=bgcolor;if(bgcolor!=="#FFFFFF"){elCell.style.borderColor="transparent"}}elRow.appendChild(elCell)});if(!hideDataCells){var _renderGroupHeader=function(){pdata.colgh.forEach(function(c,cidx){pdata.measColDefs.forEach(function(m,midx,measColDefs){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","header","col-header","no-pointer-cursor");elCellText=_document.createElement("div");elCellText.classList.add("pivot-cell-text");elCell.appendChild(elCellText);if(ccol.groupHeaderAlign&&midx===0){elCell.classList.add("col-span");elCell.setAttribute("data-col-span",measColDefs.length);elCell.style.textAlign=ccol.groupHeaderAlign}var prefix=ccol.prefix||"",suffix=ccol.suffix||"";var isCcolNumeric=VizUtil.returnsNumericValue(ccol);customNumFormatter=ccol.customNumFormatter;style=ccol.fontStyle;if(style){if(!/bold/.test(style)){elCell.style.fontWeight="normal"}if(/italic/.test(style)){elCell.style.fontStyle="italic"}}color=ccol.fontColor;if(color){elCell.style.color=color}bgcolor=ccol.backgroundColor;if(bgcolor){elCell.style.backgroundColor=bgcolor;if(bgcolor!=="#FFFFFF"){elCell.style.borderColor="transparent"}}elCellText.textContent=midx===0?translateColumn(c):null;if(isCcolNumeric){elCellText.textContent=formatHeaderValue(elCellText.textContent,prefix,suffix)}elRow.appendChild(elCell);if(elCell.textContent.length>SHOW_BALLOON_THRESHOLD||viz.pivotShowColumnHeaderBalloon==="on"){_$(elCell).balloon({contents:elCell.textContent})}})})};var _renderGroupTotalHeader=function(){if((isPivot||isSummaryTable)&&pdata.rowTotals&&pdata.rowTotals.length>0){pdata.measColDefs.forEach(function(m,midx,measColDefs){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","header","col-header");elCellText=_document.createElement("div");elCellText.classList.add("pivot-cell-text");if(ccol.groupHeaderAlign&&midx===0){elCell.classList.add("col-span");elCell.setAttribute("data-col-span",measColDefs.length);elCell.style.textAlign=ccol.groupHeaderAlign}style=ccol.fontStyle;if(style){if(!/bold/.test(style)){elCell.style.fontWeight="normal"}if(/italic/.test(style)){elCell.style.fontStyle="italic"}}color=ccol.fontColor;if(color){elCell.style.color=color}bgcolor=ccol.backgroundColor;if(bgcolor){elCell.style.backgroundColor=bgcolor;if(bgcolor!=="#FFFFFF"){elCell.style.borderColor="transparent"}}elCell.appendChild(elCellText);elCellText.textContent=midx===0?translateColumn(viz.pivotTotalTitle)||VizUtil.getMessage(PivotTableGenerator._lang,"Total"):null;elRow.appendChild(elCell)})}};if(showTotalFirst){_renderGroupTotalHeader();_renderGroupHeader()}else{_renderGroupHeader();_renderGroupTotalHeader()}}}elRow=_document.createElement("div");elRow.classList.add("pivot-row");targetElem.appendChild(elRow);var style=null,color=null,bgcolor=null;pdata.rowhCols.forEach(function(c,cidx){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","header","row-header");if(viz["rowh"+cidx+"HideCells"]){elCell.style.display="none"}if(colh0FontSize){elCell.style.fontSize=colh0FontSize+"px"}if(isSummaryTable||isPivot){style=pdata.rowhColDefs[cidx].column.headerFontStyle;if(style){if(!/bold/.test(style)){elCell.style.fontWeight="normal"}if(/italic/.test(style)){elCell.style.fontStyle="italic"}}color=pdata.rowhColDefs[cidx].column.headerFontColor;if(color){elCell.style.color=color}bgcolor=pdata.rowhColDefs[cidx].column.headerBackgroundColor;if(bgcolor){elCell.style.backgroundColor=bgcolor;if(bgcolor!=="#FFFFFF"){elCell.style.borderColor="transparent"}}}var w=pdata.rowhColDefs?pdata.rowhColDefs[cidx].cellWidth:null;w=w||defaultCellWidth;if(w){elCell.style.minWidth=w+"px";elCell.style.maxWidth=w+"px"}elCellText=_document.createElement("div");elCellText.classList.add("pivot-cell-text");elCell.appendChild(elCellText);elCellText.textContent=translateColumn(pdata.rowhColDefs[cidx].title||c);elRow.appendChild(elCell);if(elCell.textContent.length>SHOW_BALLOON_THRESHOLD||viz.pivotShowColumnHeaderBalloon==="on"){_$(elCell).balloon({contents:elCell.textContent})}});if(!hideDataCells){var _renderHeader=function(){pdata.colh.forEach(function(c,_idx){var idx=_idx;if(pdata.colgh.length>0){idx=idx%pdata.measColDefs.length}var sortEnabled=_sortDir!==_SORT_NONE&&_idx===_sortIdx;elCell=_document.createElement("div");elCell.classList.add("pivot-cell","header","col-header");if(idx>COL_INDEX_THRESHOLD_FOR_THUMB){elCell.setAttribute("data-html2canvas-ignore","true")}if(sortEnabled){elCell.classList.add("with-sort")}elCell.classList.add(getColAlign(idx));var _midx=pdata.colhColDefs.length>0&&pdata.measColDefs.length===1?0:idx;var w=_midx<pdata.measColDefs.length?pdata.measColDefs[_midx].cellWidth:null;if(isTable){w=_idx<pdata.tcolColDefs.length?pdata.tcolColDefs[_idx].column.cellWidth:null}w=w||defaultCellWidth;if(w){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}var colhFontSize=masterFontSize;if(colhFontSize){elCell.style.fontSize=colhFontSize+"px"}if(isSummaryTable){if(!pdata.measColDefs||pdata.measColDefs.length<=idx){console.log("measColDefs is unexpectedly empty. #21981: \n"+JSON.stringify(pdata.measColDefs));style=null;color=null;bgcolor=null}else{style=pdata.measColDefs[idx].column.headerFontStyle;color=pdata.measColDefs[idx].column.headerFontColor;bgcolor=pdata.measColDefs[idx].column.headerBackgroundColor}}else if(isPivot){if(pdata.colhColDefs.length>0&&pdata.measColDefs.length===1){var ccol=pdata.colhColDefs[0].column;var prefix=ccol.prefix||"",suffix=ccol.suffix||"";var isCcolNumeric=VizUtil.returnsNumericValue(ccol);style=ccol.fontStyle;color=ccol.fontColor;bgcolor=ccol.backgroundColor,customNumFormatter=ccol.customNumFormatter;if(highlightWords){bgcolor=wordColorScale(c)}}else{if(!pdata.measColDefs||pdata.measColDefs.length<=idx){console.log("measColDefs is unexpectedly empty. #21981: \n"+JSON.stringify(pdata.measColDefs));style=null;color=null;bgcolor=null}else{style=pdata.measColDefs[idx].column.headerFontStyle;color=pdata.measColDefs[idx].column.headerFontColor;bgcolor=pdata.measColDefs[idx].column.headerBackgroundColor}}}else if(isTable){if(!pdata.tcolColDefs[idx]){console.log("tcolColDefs dump #21981: \n"+JSON.stringify(pdata.tcolColDefs));style=null;color=null;bgcolor=null}else{style=pdata.tcolColDefs[idx].column.headerFontStyle;color=pdata.tcolColDefs[idx].column.headerFontColor;bgcolor=pdata.tcolColDefs[idx].column.headerBackgroundColor}}else{style=null;color=null}if(style){if(!/bold/.test(style)){elCell.style.fontWeight="normal"}if(/italic/.test(style)){elCell.style.fontStyle="italic"}}if(color){elCell.style.color=color}if(bgcolor){elCell.style.backgroundColor=bgcolor;if(bgcolor!=="#FFFFFF"){elCell.style.borderColor="transparent"}}elCellText=_document.createElement("div");elCell.appendChild(elCellText);elCellText.classList.add("pivot-cell-text");if(isPivot||isSummaryTable){if(pdata.colhColDefs.length>0&&pdata.measColDefs.length===1){if(VizUtil.isEmpty(c)){elCellText.textContent=""}else if(pdata.colhColDefs[0].column&&pdata.colhColDefs[0].column.isDate&&c==="NA"){elCellText.textContent="(NA)"}else if(pdata.colhColDefs[0].column&&translateTargetColumns&&translateTargetColumns.indexOf(pdata.colhColDefs[0].column.name)>-1){elCellText.textContent=translateColumn(c,true);if(isCcolNumeric){elCellText.textContent=formatHeaderValue(elCellText.textContent,prefix,suffix)}}else{elCellText.textContent=isCcolNumeric?formatHeaderValue(c,prefix,suffix):c}}else{elCellText.textContent=translateColumn(getMeasureStr(pdata.measColDefs[idx]),true)}}else{elCellText.textContent=translateColumn(VizUtil.isEmpty(c)?"":c)}if(sortEnabled){var filterClass=color?"filter-"+COLOR_CLASS_MAP[color]:"filter-default";elCellText.innerHTML=elCellText.innerHTML+(_sortDir===_SORT_DESC?' <i class="icon-sort-direction-desc '+filterClass+'"></i>':' <i class="icon-sort-direction-asc '+filterClass+'"></i>')}if(onTableColumnConfigClickCallback&&!(viz["tcol"+idx]&&viz["tcol"+idx].hideEditIcon===true)){var elConfigIcon=_document.createElement("i");elConfigIcon.style.paddingLeft="5px";elConfigIcon.style.cursor="pointer";elConfigIcon.style.verticalAlign="top";elConfigIcon.classList.add("fal","fa-edit","column-header-config");elConfigIcon.onclick=onTableColumnConfigClickCallback.bind(null,viz["tcol"+idx]);elCell.style.textOverflow="unset";elCellText.style.display="inline-block";elCellText.style.width="unset";elCellText.style.maxWidth="calc( 100% - 20px )";elCell.appendChild(elConfigIcon)}elRow.appendChild(elCell);if(viz.pivotShowColumnHeaderDescriptionBalloon==="on"){var balloonContent=null,_content=null;_content=VizUtil.getMessage(PivotTableGenerator._lang,"COL.DESC."+c);if(_content&&_content!=="COL.DESC."+c){balloonContent=_content}if(viz.pivotColumnHeaderDescriptionPrefix){_content=VizUtil.getMessage(PivotTableGenerator._lang,viz.pivotColumnHeaderDescriptionPrefix+c);if(_content&&_content!==viz.pivotColumnHeaderDescriptionPrefix+c){balloonContent=_content}}if(balloonContent){var elToggle=_document.createElement("i");elToggle.className="icon-info";elCell.insertBefore(elToggle,elCellText);elCellText.style.display="inline-flex";elCellText.style.width="unset";elCellText.style.paddingLeft="20px";$(function(){var shown=false;_$(elToggle).on("click",function(ev){var self=this;ev.stopPropagation();if(shown){$(self).hideBalloon()}else{document.body.click();$(self).showBalloon()}shown=!shown;if(shown){var rootClose=function(ev){if(ev.target&&ev.target.className==="pivot-balloon-style"){return}$(self).hideBalloon();shown=false;document.body.removeEventListener("click",rootClose)};document.body.addEventListener("click",rootClose)}}).showBalloon({contents:balloonContent,html:true,position:"bottom"}).hideBalloon()})}}else if(elCell.textContent.length>SHOW_BALLOON_THRESHOLD||viz.pivotShowColumnHeaderBalloon==="on"){_$(elCell).balloon({contents:elCell.textContent})}if(!onTableColumnConfigClickCallback){_$(elCell).click(onColumnHeaderClickHandler.bind(null,_idx))}else{elCell.style.cursor="unset"}})};var _renderTotalHeader=function(){if((isPivot||isSummaryTable)&&pdata.rowTotals&&pdata.rowTotals.length>0){var rowTotalIdx=pdata.colh.length;pdata.measColDefs.forEach(function(measColDef,midx){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","header","col-header");var sortEnabled=_sortDir!==_SORT_NONE&&rowTotalIdx===_sortIdx;if(sortEnabled){elCell.classList.add("with-sort")}elCell.classList.add(getColAlign(midx));if(pdata.colh.length>COL_INDEX_THRESHOLD_FOR_THUMB){elCell.setAttribute("data-html2canvas-ignore","true")}var w=measColDef.cellWidth||defaultCellWidth;if(w){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}var style=measColDef.column.headerFontStyle;var color=measColDef.column.headerFontColor;var bgcolor=measColDef.column.headerBackgroundColor;if(style){if(!/bold/.test(style)){elCell.style.fontWeight="normal"}if(/italic/.test(style)){elCell.style.fontStyle="italic"}}if(color){elCell.style.color=color}if(bgcolor){elCell.style.backgroundColor=bgcolor}if(colh0FontSize){elCell.style.fontSize=colh0FontSize+"px"}elCellText=_document.createElement("div");elCell.appendChild(elCellText);elCellText.classList.add("pivot-cell-text");elCellText.textContent=pdata.colgh.length>0?translateColumn(measColDef.column.displayName)||(measColDef.column.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:measColDef.column.name):translateColumn(viz.pivotTotalTitle)||VizUtil.getMessage(PivotTableGenerator._lang,"Total");if(sortEnabled){elCellText.innerHTML=elCellText.innerHTML+(_sortDir===_SORT_DESC?' <i class="icon-sort-direction-desc"></i>':' <i class="icon-sort-direction-asc"></i>')}elRow.appendChild(elCell);if(elCell.textContent.length>SHOW_BALLOON_THRESHOLD||viz.pivotShowColumnHeaderBalloon==="on"){_$(elCell).balloon({contents:elCell.textContent})}_$(elCell).click(onColumnHeaderClickHandler.bind(null,rowTotalIdx));rowTotalIdx++})}};if(showTotalFirst){_renderTotalHeader();_renderHeader()}else{_renderHeader();_renderTotalHeader()}}if(addRightPaddingForScollbar){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","header","col-header");elCell.style.minWidth=SCROLL_BAR_WIDTH+"px";elCell.style.width=SCROLL_BAR_WIDTH+"px";elCell.style.padding="0px";elCell.style.border="0px";elRow.appendChild(elCell)}};renderHeader(elPivot);renderHeader(elPivotColHeader,true);var canOmitLabel=function(rowhdata,ridx,rhcidx){var v=true;for(var i=0;i<=rhcidx;i++){v=v&&rowhdata[ridx-1][i]===rowhdata[ridx][i]}return v};var isEndOfGroup=function(rowhdata,ridx,rhcidx){if(rowhdata.length-1<=ridx){return true}var v=true;for(var i=0;i<=rhcidx;i++){v=v&&rowhdata[ridx+1][i]===rowhdata[ridx][i]}return!v};var _renderBody=function(row,ridx,rowclass,rctx){row.forEach(function(c,_cidx){var cidx=pdata.colgh.length>0?_cidx%pdata.measColDefs.length:_cidx;var tcol={};if(isTable&&pdata.tcolColDefs&&cidx<pdata.tcolColDefs.length){tcol=pdata.tcolColDefs[cidx].column||{}}else if((isSummaryTable||isPivot)&&pdata.measColDefs&&cidx<pdata.measColDefs.length){tcol=pdata.measColDefs[cidx].column||{}}else if(isPivot&&pdata.colhColDefs.length>0){tcol=pdata.measColDefs[0].column||{}}var extentIdx=isPivot&&pdata.colhColDefs.length>0?0:cidx;elCell=_document.createElement("div");elCell.classList.add("pivot-cell");if(cidx>COL_INDEX_THRESHOLD_FOR_THUMB){elCell.setAttribute("data-html2canvas-ignore","true")}if(rowclass){elCell.classList.add(rowclass)}elCell.classList.add(getColAlign(cidx));var w=tcol.cellWidth||defaultCellWidth;if(w){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}var measFontSize=tcol.fontSize||meas0FontSize;if(measFontSize){elCell.style.fontSize=measFontSize+"px"}if(tcol&&tcol.fontStyle){elCell.style.fontWeight=/bold/.test(tcol.fontStyle)?"bold":"normal";elCell.style.fontStyle=/italic/.test(tcol.fontStyle)?"italic":"normal"}if(tcol&&tcol.fontColor){elCell.style.color=tcol.fontColor}if(bgcolorScale&&fgcolorScale&&!!c[0]){elCell.style.backgroundColor=bgcolorScale(c[0]);elCell.style.color=fgcolorScale(c[0])}var _isUrl=!VizUtil.isEmpty(c)&&c.length>0&&isUrl(c[0]);if(isTable&&_isUrl){elCellText=_document.createElement("a");elCellText.setAttribute("href",c[0]);elCellText.setAttribute("target","_blank");elCellText.onclick=PivotTableGenerator.onLinkClick;var textSpan=_document.createElement("span");textSpan.style.wordBreak="break-all";textSpan.classList.add("ot");textSpan.textContent=c[0];elCellText.appendChild(textSpan)}else{elCellText=_document.createElement("span");if(isTable){elCellText.classList.add("ot")}var prefix=tcol.prefix||"",suffix=tcol.suffix||"";customNumFormatter=tcol.customNumFormatter;if(VizUtil.isEmpty(c)||c.length===0){elCellText.textContent="";if(pdata.defaultNAText){elCellText.textContent=pdata.defaultNAText;elCellText.style.color="#AAAAAA";elCellText.style.fontWeight="normal"}}else{if(_isUrl){elCellText.style.wordBreak="break-all"}elCellText.textContent=VizUtil.isEmpty(c[0],true)?"":getColAlign(cidx)==="num-col"?formatValue(c[0],prefix,suffix):c[0];if((!elCellText.textContent||elCellText.textContent==="")&&pdata.defaultNAText){elCellText.textContent=pdata.defaultNAText;elCellText.style.color="#AAAAAA";elCellText.style.fontWeight="normal"}var urlt,urltp,enableUrl=true;if(isPivot||isSummaryTable){if((pdata.colhColDefs.length===0||pdata.measColDefs.length>1)&&viz["meas"+cidx]){urlt=viz["meas"+cidx].url;urltp=viz["meas"+cidx].urlEncodeParameters==="on";enableUrl=viz["meas"+cidx].enableUrl!=="off"}else if(viz.meas0){urlt=viz.meas0.url;urltp=viz.meas0.urlEncodeParameters==="on";enableUrl=viz["meas0"].enableUrl!=="off"}}else{urlt=viz["tcol"+cidx].url;urltp=viz["tcol"+cidx].urlEncodeParameters==="on";enableUrl=viz["tcol"+cidx].enableUrl!=="off"}var url=enableUrl?PivotTableGenerator.bindUrlData(urlt,urltp,ridx,cidx,pdata.rowh,pdata.rowhCols,row,pdata.colh,pdata.colhCols,c[0],pdata.measCols,pdata.extraData,pdata.extraCols,isPivot,isSummaryTable):null;if(url){elLink=_document.createElement("a");elLink.setAttribute("href",url);elLink.setAttribute("target","_blank");elLink.onclick=PivotTableGenerator.onLinkClick;if(elCellText.textContent===""){elLink.classList.add("no-text-deco")}elLink.appendChild(elCellText);elCellText=elLink}else if(onShowDetailCallback&&(isPivot||isSummaryTable)){_$(elCell).addClass("clickable");_$(elCell).on("click",function(ev){var cdatalist=[];pdata.rowhColDefs.forEach(function(_coldef,_ridx){if(viz["rowh"+_ridx+"HideCells"]){return}var _cdata=JSON.parse(JSON.stringify(_coldef.column));_cdata.datatype=_cdata.type;_cdata.type="rowh"+_ridx;_cdata.value=pdata.rowh[ridx][_ridx];_cdata.rawValue=bucketLabelMap["rowh"+_ridx]?bucketLabelMap["rowh"+_ridx][_cdata.value]||_cdata.value:_cdata.value;_cdata.numDecimalDigits=_cdata.numDecimalDigits||viz.numDecimalDigits||2;_cdata.filter=true;cdatalist.push(_cdata)});pdata.colhColDefs.forEach(function(_coldef,_coldefidx){var _cdata=JSON.parse(JSON.stringify(_coldef.column));_cdata.datatype=_cdata.type;_cdata.type="colh"+_coldefidx;_cdata.value=pdata.colgh.length>0?pdata.colgh[Math.floor(_cidx/pdata.measColDefs.length)]:pdata.colh[_cidx];if(_cdata.value==="NA"&&_coldef.column.isDate){_cdata.value="(NA)"}_cdata.rawValue=bucketLabelMap["colh"+_coldefidx]?bucketLabelMap["colh"+_coldefidx][_cdata.value]||_cdata.value:_cdata.value;_cdata.numDecimalDigits=_cdata.numDecimalDigits||viz.numDecimalDigits||2;_cdata.filter=true;cdatalist.push(_cdata)});cdatalist._lang=PivotTableGenerator._lang;onShowDetailCallback([cdatalist],PivotTableGenerator._getSelectionContext(this,"meas",pdata),ev.ctrlKey||ev.metaKey)})}}}if((isSummaryTable||isPivot)&&tcol.formattingTarget&&tcol.formattingType&&pdata.isApplyColorToAllColumnsDefined){elCell.setAttribute("data-cf","on")}var _formattingColor=null;var opacity=parseFloat(tcol.opacity||(tcol.formattingTarget==="bar"||viz.tableShowBarsOnSort==="on"?"0.6":"1"));if(isTable||isSummaryTable||isPivot){if(VizUtil.isEmpty(c)||c.length===0){}else if(VizUtil.isColumnObject(tcol)&&VizUtil.returnsNumericValue(tcol)&&(VizUtil.isEmpty(c[0],true)||c[0]==="Inf"||c[0]==="-Inf")){}else if(tcol.formattingTarget){if(tcol.formattingType==="cf"){_formattingColor=PivotTableGenerator.applyConditionalFormatting(tcol.conditionalFormattings,tcol,c[0])}else if(tcol.formattingType==="color"&&tcol.scale){if(c.length>1){tcol.scale.domain(c[1])}_formattingColor=VizUtil.isEmpty(c[0],true)?null:tcol.scale(c[0])}else if(tcol.formattingType==="posneg"){var posColor=tcol.posColor||viz.tableBarPositiveColor;var negColor=tcol.negColor||viz.tableBarNegativeColor;_formattingColor=c[0]<0?negColor:posColor}if(_formattingColor&&tcol.formattingTarget!=="bar"){if(elCell.style.color){elCell.style.color=null}if(opacity!==1){_formattingColor=chroma(_formattingColor).alpha(opacity)}elCell.style[tcol.formattingTarget==="bgcolor"?"backgroundColor":"color"]=_formattingColor;if(tcol.formattingTarget==="bgcolor"&&chroma.contrast(_formattingColor,"#ffffff")>chroma.contrast(_formattingColor,"#4d4d4d")){elCell.style.color="#ffffff"}if(tcol.applyColorToAllColumns==="on"){rctx.color=elCell.style.color;rctx.backgroundColor=elCell.style.backgroundColor}}}}if(pdata.data.length>1&&tcol&&(viz.tableFormattingType==="bar"&&!tcol.formattingTarget||viz.tableShowBarsOnSort==="on"&&_sortDir!==_SORT_NONE&&_sortIdx===cidx||tcol.formattingTarget==="bar")){elCellText.style.position="relative";var extent=c.length>1?c[1]:[0,0];extent=d3.extent(extent.concat([0]));var scaleFunc=d3.scale.linear().domain(extent).range([10,90]);var zeroPoint=scaleFunc(0);var dataPoint=scaleFunc(c[0]);var left=c[0]<0?dataPoint+"%":zeroPoint+"%";var width=Math.abs(zeroPoint-dataPoint)+"%";var posColor=tcol.posColor||viz.tableBarPositiveColor||"rgb(153, 228, 245)";var negColor=tcol.negColor||viz.tableBarNegativeColor||"rgb(247, 160, 153)";var color=c[0]<0?negColor:posColor;if(opacity!==1){color=chroma(color).alpha(opacity)}if(tcol.formattingType==="cf"){color=_formattingColor||tcol.defaultBarColor||"#DCDEE0";if(opacity!==1){color=chroma(color).alpha(opacity)}}else if(tcol.formattingType==="color"){if(c.length>1){tcol.scale.domain(c[1])}color=VizUtil.isEmpty(c[0],true)?null:tcol.scale(c[0]);if(color&&opacity!==1){color=chroma(color).alpha(opacity)}}elCell.style.position="relative";var elCellBg=_document.createElement("div");elCellBg.style.position="absolute";elCellBg.style.width=width;elCellBg.style.height="80%";elCellBg.style.top="10%";elCellBg.style.left=left;elCellBg.style.backgroundColor=color;elCellBg.style.padding="0";elCell.appendChild(elCellBg)}elCell.appendChild(elCellText);elRow.appendChild(elCell);var htmlarr=[],btxt;if((isPivot||isSummaryTable)&&viz.pivotShowHoverBalloon==="on"){if(elCell.textContent!==""){htmlarr.push('<div class="pivot-table-frame pivot-data-popover">');pdata.rowhCols.forEach(function(_row,_ridx){if(viz["rowh"+_ridx+"HideCells"]){return}htmlarr.push('<div class="pivot-row">');htmlarr.push('<div class="pivot-cell">');htmlarr.push(translateColumn(_row));htmlarr.push(":</div>");htmlarr.push('<div class="pivot-cell value-cell">');btxt=pdata.rowh[ridx][_ridx];if(pdata.rowhColDefs.length>_ridx&&pdata.rowhColDefs[_ridx].column&&translateTargetColumns&&translateTargetColumns.indexOf(pdata.rowhColDefs[_ridx].column.name)>-1){btxt=translateColumn(btxt,true)}htmlarr.push(btxt);htmlarr.push("</div>");htmlarr.push("</div>")});pdata.colhCols.forEach(function(_col){htmlarr.push('<div class="pivot-row">');htmlarr.push('<div class="pivot-cell">');htmlarr.push(translateColumn(_col));htmlarr.push(":</div>");htmlarr.push('<div class="pivot-cell value-cell">');btxt=pdata.colgh.length>0?pdata.colgh[Math.floor(_cidx/pdata.measColDefs.length)]:pdata.colh[cidx];if(pdata.colhColDefs.length>0&&pdata.colhColDefs[0].column&&translateTargetColumns&&translateTargetColumns.indexOf(pdata.colhColDefs[0].column.name)>-1){btxt=translateColumn(btxt,true)}htmlarr.push(btxt);htmlarr.push("</div>");htmlarr.push("</div>")});htmlarr.push('<div class="pivot-row">');htmlarr.push('<div class="pivot-cell">');htmlarr.push(pdata.numMeas===0?"(count)":translateColumn(pdata.measCols[pdata.colhColDefs.length>0&&pdata.measColDefs.length===1?0:cidx]));htmlarr.push(":</div>");htmlarr.push('<div class="pivot-cell value-cell">');htmlarr.push(elCell.textContent);htmlarr.push("</div>");htmlarr.push("</div>");htmlarr.push("</div>");_$(elCell).balloon({contents:htmlarr.join(""),html:true})}}else{if(elCell.textContent.length>SHOW_BALLOON_THRESHOLD){if(elCellText.nodeName==="A"&&typeof module!=="object"){elCellText.setAttribute("title",elCellText.getAttribute("href"))}else{htmlarr.push('<div class="pivot-table-frame pivot-data-popover" style="max-width:600px');if(isUrl(elCell.textContent)){htmlarr.push(";word-break:break-all")}htmlarr.push('">');htmlarr.push(elCell.textContent);htmlarr.push("</div>");_$(elCell).balloon({contents:htmlarr.join(""),html:true})}}}})};var _renderTotalBody=function(ridx,rowclass){if(isPivot&&pdata.rowTotals){pdata.measColDefs.forEach(function(measColDef,midx){customNumFormatter=measColDef.column.customNumFormatter;elCell=_document.createElement("div");elCell.classList.add("pivot-cell","row-total");elCell.classList.add(getColAlign(midx));if(rowclass){elCell.classList.add(rowclass)}var w=measColDef.cellWidth||defaultCellWidth;if(w){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}if(meas0FontSize){elCell.style.fontSize=meas0FontSize+"px"}elCellText=_document.createElement("span");var prefix=measColDef.column.totalPrefix||"",suffix=measColDef.column.totalSuffix||"",c=pdata.rowTotals[ridx];if(!VizUtil.isEmpty(c)&&c.length>0&&isUrl(c[midx])){elCellText.style.wordBreak="break-all"}if(measColDef&&measColDef.column&&measColDef.column.fontStyle){elCell.style.fontWeight=/bold/.test(measColDef.column.fontStyle)?"bold":"normal";elCell.style.fontStyle=/italic/.test(measColDef.column.fontStyle)?"italic":"normal"}if(viz.pivotTotalFontStyle){elCell.style.fontWeight=!/bold/.test(viz.pivotTotalFontStyle)?"normal":"bold";elCell.style.fontStyle=/italic/.test(viz.pivotTotalFontStyle)?"italic":"normal"}if(measColDef&&measColDef.column&&measColDef.column.fontColor){elCell.style.color=measColDef.column.fontColor}elCellText.textContent=VizUtil.isEmpty(c)||c.length===0||c[midx]==="NA"?"":getColAlign(midx)==="num-col"?formatValue(c[midx],prefix,suffix):c[midx];if((!elCellText.textContent||elCellText.textContent==="")&&pdata.defaultNAText){elCellText.textContent=pdata.defaultNAText;elCellText.style.color="#AAAAAA";elCellText.style.fontWeight="normal"}if(onShowDetailCallback&&(isPivot||isSummaryTable)){_$(elCell).addClass("clickable");_$(elCell).on("click",function(ev){var cdatalist=[];pdata.rowhColDefs.forEach(function(_coldef,_ridx){var _cdata=JSON.parse(JSON.stringify(_coldef.column));_cdata.datatype=_cdata.type;_cdata.type="rowh"+_ridx;_cdata.value=pdata.rowh[ridx][_ridx];_cdata.rawValue=_cdata.value;_cdata.numDecimalDigits=_cdata.numDecimalDigits||viz.numDecimalDigits||2;_cdata.filter=true;cdatalist.push(_cdata)});cdatalist._lang=PivotTableGenerator._lang;onShowDetailCallback([cdatalist],PivotTableGenerator._getSelectionContext(this,"meas",pdata),ev.ctrlKey||ev.metaKey)})}elCell.appendChild(elCellText);elRow.appendChild(elCell)})}};var _renderSubtotal=function(ridx){var elSubTotalRow,endOfGroupIdxs=[];pdata.rowh[ridx].forEach(function(rhc,rhcidx){if(isEndOfGroup(pdata.rowh,ridx,rhcidx)&&rhcidx!==pdata.numRowh-1&&!viz["rowh"+rhcidx+"HideCells"]){endOfGroupIdxs.push(rhcidx)}});endOfGroupIdxs.reverse();endOfGroupIdxs.forEach(function(endOfGroupIdx){elSubTotalRow=_document.createElement("div");elSubTotalRow.classList.add("pivot-row");elPivot.appendChild(elSubTotalRow);if(ridx>ROW_INDEX_THRESHOLD_FOR_THUMB){elSubTotalRow.setAttribute("data-html2canvas-ignore","true")}pdata.rowh[ridx].forEach(function(rhc,rhcidx){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","row-header","subtotal","text-col");if(rhcidx>=endOfGroupIdx){elCell.classList.add("bottom-border")}if(viz.pivotSubtotalFontStyle){elCell.style.fontWeight=!/bold/.test(viz.pivotSubtotalFontStyle)?"normal":"bold";elCell.style.fontStyle=/italic/.test(viz.pivotSubtotalFontStyle)?"italic":"normal"}if(rhcidx<pdata.numRowh-1){elCell.classList.add("grouped","thick")}if(pdata.numRowh===1){elCell.classList.add("thick")}if(colh0FontSize){elCell.style.fontSize=colh0FontSize+"px"}if(viz["rowh"+rhcidx+"HideCells"]){elCell.style.display="none"}elSubTotalRow.appendChild(elCell);elCellText=_document.createElement("span");elCell.appendChild(elCellText);if(rhcidx===endOfGroupIdx+1){elCellText.textContent=translateColumn(viz.pivotSubtotalTitle)||VizUtil.getMessage(PivotTableGenerator._lang,"Subtotal")}else{elCellText.textContent=""}});var subTotalValue=pdata.subTotals.find(function(st){var res=true;pdata.rowh[ridx].forEach(function(rhc,rhcidx){if(rhcidx===pdata.rowh[ridx].length-1){return}if(rhcidx>endOfGroupIdx){res=res&&st[rhcidx]===null}else{res=res&&rhc===st[rhcidx]}});return res});if(subTotalValue){var stv=subTotalValue.slice();for(var i=0;i<pdata.numRowh-1;i++){stv.shift()}for(var i=0;i<pdata.colhColDefs.length;i++){stv.shift()}if(pdata.colhColDefs.length>0){if(pdata.rowTotals){if(showTotalFirst){pdata.measColDefs.forEach(function(x){stv.unshift(stv.pop())})}}else{pdata.measColDefs.forEach(function(x){stv.pop()})}}stv.forEach(function(st,stidx){elCell=_document.createElement("div");elSubTotalRow.appendChild(elCell);elCell.classList.add("pivot-cell","subtotal","bottom-border");elCellText=_document.createElement("span");elCell.appendChild(elCellText);elCell.classList.add(getColAlign(stidx));if(colh0FontSize){elCell.style.fontSize=colh0FontSize+"px"}var cidx=pdata.measColDefs.length>1?stidx%pdata.measColDefs.length:0;var tcol=pdata.measColDefs[cidx].column;var _colhIdx=Math.floor(stidx/pdata.measColDefs.length);var _colhTotalIdx=showTotalFirst?0:stv.length/pdata.measColDefs.length-1;var _isRowTotalCell=pdata.rowTotals&&_colhIdx===_colhTotalIdx;if(showTotalFirst&&pdata.rowTotals){_colhIdx-=1}var prefix=tcol.totalPrefix||"",suffix=tcol.totalSuffix||"";customNumFormatter=tcol.customNumFormatter;if(tcol&&tcol.fontStyle){elCell.style.fontWeight=/bold/.test(tcol.fontStyle)?"bold":"normal";elCell.style.fontStyle=/italic/.test(tcol.fontStyle)?"italic":"normal"}if(viz.pivotSubtotalFontStyle){elCell.style.fontWeight=!/bold/.test(viz.pivotSubtotalFontStyle)?"normal":"bold";elCell.style.fontStyle=/italic/.test(viz.pivotSubtotalFontStyle)?"italic":"normal"}if(tcol&&tcol.fontColor){elCell.style.color=tcol.fontColor}if(isUrl(st)){elCellText.style.wordBreak="break-all"}elCellText.textContent=getColAlign(cidx)==="num-col"?formatValue(st,prefix,suffix):st;if((!elCellText.textContent||elCellText.textContent==="")&&pdata.defaultNAText){elCellText.textContent=pdata.defaultNAText;elCellText.style.color="#AAAAAA";elCellText.style.fontWeight="normal"}if(onShowDetailCallback&&(isPivot||isSummaryTable)){_$(elCell).addClass("clickable");_$(elCell).on("click",function(ev){var cdatalist=[];pdata.rowhColDefs.forEach(function(_coldef,_ridx){if(_ridx<=endOfGroupIdx){var _cdata=JSON.parse(JSON.stringify(_coldef.column));_cdata.datatype=_cdata.type;_cdata.type="rowh"+_ridx;_cdata.value=pdata.rowh[ridx][_ridx];_cdata.rawValue=_cdata.value;_cdata.numDecimalDigits=_cdata.numDecimalDigits||viz.numDecimalDigits||2;_cdata.filter=true;cdatalist.push(_cdata)}});if(pdata.colhColDefs.length>0&&pdata.rowTotals&&!_isRowTotalCell){var _cdata=JSON.parse(JSON.stringify(pdata.colhColDefs[0].column));_cdata.datatype=_cdata.type;_cdata.type="colh0";_cdata.value=pdata.measColDefs.length>1?pdata.colgh[_colhIdx]:pdata.colh[_colhIdx];_cdata.rawValue=pdata.measColDefs.length>1?pdata.colgh[_colhIdx]:pdata.colh[_colhIdx];_cdata.numDecimalDigits=_cdata.numDecimalDigits||viz.numDecimalDigits||2;_cdata.filter=true;cdatalist.push(_cdata)}cdatalist._lang=PivotTableGenerator._lang;onShowDetailCallback([cdatalist],PivotTableGenerator._getSelectionContext(this,"meas",pdata),ev.ctrlKey||ev.metaKey)})}})}})};pdata.data.forEach(function(row,ridx){elRow=_document.createElement("div");elRow.classList.add("pivot-row","banded");if(ridx>ROW_INDEX_THRESHOLD_FOR_THUMB){elRow.setAttribute("data-html2canvas-ignore","true")}if(isTable){elRow.onclick=PivotTableGenerator.onRowClick}elPivot.appendChild(elRow);var rctx={};var rowclass="";if(pdata.rowh[ridx]){pdata.rowh[ridx].forEach(function(rhc,rhcidx){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","row-header");if(viz["rowh"+rhcidx+"HideCells"]){elCell.style.display="none"}switch(pivotTextWrap){case"auto":elCell.classList.add("wrap-responsive-width");break;case"fixed":elCell.classList.add("wrap");break;default:break}var w=pdata.rowhColDefs[rhcidx]?pdata.rowhColDefs[rhcidx].cellWidth:null;w=w||defaultCellWidth;if(w&&pivotTextWrap!=="auto"){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}var rowhFontSize=masterFontSize||pdata.rowhColDefs[rhcidx].fontSize;if(rowhFontSize){elCell.style.fontSize=rowhFontSize+"px"}if(pdata.rowhColDefs[rhcidx].fontStyle){elCell.style.fontWeight=/bold/.test(pdata.rowhColDefs[rhcidx].fontStyle)?"bold":"normal";elCell.style.fontStyle=/italic/.test(pdata.rowhColDefs[rhcidx].fontStyle)?"italic":"normal"}if(pdata.rowhColDefs[rhcidx].fontColor){elCell.style.color=pdata.rowhColDefs[rhcidx].fontColor}if(rhcidx<pdata.numRowh-1){elCell.classList.add("grouped","thick")}if(pdata.numRowh===1){elCell.classList.add("thick")}if(ridx<pdata.rowh.length-1&&rhcidx<pdata.numRowh-1){if(pdata.rowh[ridx+1][rhcidx]!==rhc&&!pdata.subTotals){rowclass="bottom-border"}}if(rowclass){elCell.classList.add(rowclass)}var elCellText;var rcol=pdata.rowhColDefs[rhcidx].column;var isRcolNumeric=VizUtil.returnsNumericValue(rcol);var prefix=rcol.prefix||"",suffix=rcol.suffix||"";customNumFormatter=rcol.customNumFormatter;if(ridx>0&&rhcidx<pdata.numRowh-1&&canOmitLabel(pdata.rowh,ridx,rhcidx)){elCellText=_document.createElement("span");elCellText.textContent=""}else{if(highlightWords){var highlighted=VizUtil.isEmpty(rhc)?"":rhc.replaceAll(HIGHLIGHT_WORD_REGEX,function(match,p1,p2){return'<span style="color: '+wordColorScale(p1)+'; font-weight:bold">'+p2+"</span>"});elCellText=_document.createElement("span");elCellText.innerHTML=highlighted}else if(isUrl(rhc)){elCellText=_document.createElement("a");elCellText.style.wordBreak="break-all";elCellText.setAttribute("href",rhc);elCellText.setAttribute("target","_blank");elCellText.textContent=rhc;elCellText.onclick=PivotTableGenerator.onLinkClick}else{elCellText=_document.createElement("span");elCellText.textContent=VizUtil.isEmpty(rhc)?"":rcol.isDate&&rhc==="NA"?"(NA)":isRcolNumeric?formatHeaderValue(rhc,prefix,suffix):translateColumn(rhc,true);var urlt,urltp,enableUrl=true;if(isSummaryTable||isPivot){urlt=rcol.url;urltp=rcol.urlEncodeParameters==="on";enableUrl=rcol.enableUrl!=="off"}var url=enableUrl?PivotTableGenerator.bindUrlData(urlt,urltp,ridx,null,pdata.rowh,pdata.rowhCols,row,pdata.colh,pdata.colhCols,null,pdata.measCols,pdata.extraData,pdata.extraCols,isPivot,isSummaryTable):null;if(url){elLink=_document.createElement("a");elLink.setAttribute("href",url);elLink.setAttribute("target","_blank");elLink.onclick=PivotTableGenerator.onLinkClick;if(elCellText.textContent===""){elLink.classList.add("no-text-deco")}elLink.appendChild(elCellText);elCellText=elLink}else if(onShowDetailCallback&&(isPivot||isSummaryTable)){_$(elCell).addClass("clickable");_$(elCell).on("click",function(ev){var cdatalist=[];pdata.rowhColDefs.forEach(function(_coldef,_ridx){if(_ridx>rhcidx){return}if(viz["rowh"+_ridx+"HideCells"]){return}var _cdata=JSON.parse(JSON.stringify(_coldef.column));_cdata.datatype=_cdata.type;_cdata.type="rowh"+_ridx;_cdata.value=pdata.rowh[ridx][_ridx];_cdata.rawValue=bucketLabelMap["rowh"+_ridx]?bucketLabelMap["rowh"+_ridx][_cdata.value]||_cdata.value:_cdata.value;_cdata.numDecimalDigits=_cdata.numDecimalDigits||viz.numDecimalDigits||2;_cdata.filter=true;cdatalist.push(_cdata)});cdatalist._lang=PivotTableGenerator._lang;onShowDetailCallback([cdatalist],PivotTableGenerator._getSelectionContext(this,"rowh",pdata),ev.ctrlKey||ev.metaKey)})}}}if((isSummaryTable||isPivot)&&rcol.formattingTarget&&rcol.formattingType&&pdata.isApplyColorToAllColumnsDefined){elCell.setAttribute("data-cf","on")}if(isSummaryTable||isPivot){if(VizUtil.isEmpty(rhc)){}else{var _color;if(rcol.formattingTarget&&rcol.formattingType==="cf"){_color=PivotTableGenerator.applyConditionalFormatting(rcol.conditionalFormattings,rcol,rhc)}else if(rcol.formattingTarget&&rcol.formattingType==="color"&&rcol.scale){_color=VizUtil.isEmpty(rhc,true)?null:rcol.scale(rhc)}if(_color){var opacity;if(rcol.opacity){opacity=parseFloat(rcol.opacity);if(opacity!==1){_color=chroma(_color).alpha(opacity)}}if(elCell.style.color){elCell.style.color=null}elCell.style[rcol.formattingTarget==="bgcolor"?"backgroundColor":"color"]=_color;if(rcol.formattingTarget==="bgcolor"&&chroma.contrast(_color,"#ffffff")>chroma.contrast(_color,"#4d4d4d")){elCell.style.color="#ffffff"}if(rcol.applyColorToAllColumns==="on"){rctx.color=elCell.style.color;rctx.backgroundColor=elCell.style.backgroundColor}}}}elCell.appendChild(elCellText);elRow.appendChild(elCell);if(elCell.textContent.length>SHOW_BALLOON_THRESHOLD){var _contents=highlightWords?elCell.innerHTML:elCell.textContent;var _html=highlightWords;if(isUrl(elCell.textContent)){_contents='<span style="word-break:break-all">'+_contents+"</span>";_html=true}_$(elCell).balloon({contents:_contents,html:_html})}})}if(!hideDataCells){if(showTotalFirst){_renderTotalBody(ridx,rowclass);_renderBody(row,ridx,rowclass,rctx)}else{_renderBody(row,ridx,rowclass,rctx);_renderTotalBody(ridx,rowclass)}}if(rctx.color||rctx.backgroundColor){for(var i=0;i<elRow.childNodes.length;i++){if(!elRow.childNodes[i].getAttribute("data-cf")){if(rctx.color){elRow.childNodes[i].style.color=rctx.color}if(rctx.backgroundColor){elRow.childNodes[i].style.backgroundColor=rctx.backgroundColor}}}}if(pdata.subTotals&&pdata.rowh[ridx]&&!hideDataCells){_renderSubtotal(ridx)}});if(viz.pivotShowTotals==="on"&&pdata.colTotals&&pdata.data.length>0&&!hideDataCells&&(isPivot||isSummaryTable)||isTable&&viz.tableShowTotals==="on"){var v,i;if(pdata.data.length<pdata.originalRowSize){elRow=_document.createElement("div");elRow.classList.add("pivot-row");elPivot.appendChild(elRow);for(i=0;i<pdata.numRowh;i++){elCell=_document.createElement("div");elCell.classList.add("pivot-cell");elRow.appendChild(elCell)}if(isSummaryTable||pdata.numMeas>1){for(i=0;i<pdata.numMeas;i++){elCell=_document.createElement("div");elCell.classList.add("pivot-cell");elCell.classList.add(getColAlign(i));elCell.textContent="";elRow.appendChild(elCell)}}else{for(i=0;i<pdata.colh.length;i++){elCell=_document.createElement("div");elCell.classList.add("pivot-cell");elCell.classList.add(getColAlign(i));elCell.textContent="";elRow.appendChild(elCell)}}}var _renderFooter=function(elRow,totals,options){if(!totals){return}totals.forEach(function(total,_totalidx){var prefix="",suffix="",w=null;var totalidx=pdata.colgh.length>0?_totalidx%pdata.measColDefs.length:_totalidx;if(pdata.colhColDefs.length===0||pdata.measColDefs.length>1||pdata.tcolColDefs.length>0){v=total;var colDefs=isTable?pdata.tcolColDefs:pdata.measColDefs;colDefs.forEach(function(measColDef,midx){customNumFormatter=measColDef&&measColDef.column?measColDef.column.customNumFormatter:null;if((isSummaryTable||isPivot)&&measColDef&&measColDef.column){prefix=measColDef.column.totalPrefix;suffix=measColDef.column.totalSuffix}if(options){customNumFormatter=options.customNumFormatter;prefix=options.prefix;suffix=options.suffix}elCell=_document.createElement("div");elCell.classList.add("pivot-cell","total");var colTypeClass=(isTable||isPivot)&&viz.tableTotalAggregationFunc==="countd"?"num-col":getColAlign(midx);if(options&&measColDef&&measColDef.column){colTypeClass=VizUtil.returnsNumericValue({name:measColDef.column.name,func:options.func==="mode"&&!calcTotalBeforeAggregation?measColDef.column.func:options.func,isNumeric:measColDef.column.isNumeric,isDate:measColDef.column.isDate})?"num-col":"text-col"}elCell.classList.add(colTypeClass);if(meas0TotalFontSize){elCell.style.fontSize=meas0TotalFontSize+"px"}if(measColDef&&measColDef.column&&measColDef.column.fontStyle){elCell.style.fontWeight=/bold/.test(measColDef.column.fontStyle)?"bold":"normal";elCell.style.fontStyle=/italic/.test(measColDef.column.fontStyle)?"italic":"normal"}if(viz.pivotTotalFontStyle){elCell.style.fontWeight=!/bold/.test(viz.pivotTotalFontStyle)?"normal":"bold";elCell.style.fontStyle=/italic/.test(viz.pivotTotalFontStyle)?"italic":"normal"}if(measColDef&&measColDef.column&&measColDef.column.fontColor){elCell.style.color=measColDef.column.fontColor}w=measColDef.cellWidth||defaultCellWidth;if(w){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}if(isUrl(v[midx])){elCell.style.wordBreak="break-all"}elCell.textContent=colTypeClass==="num-col"?formatValue(v[midx],prefix,suffix):v[midx];if(elCell.textContent==="NA"&&measColDef&&measColDef.column&&VizUtil.returnsNumericValue(measColDef.column)){elCell.textContent=""}if((!elCell.textContent||elCell.textContent==="")&&pdata.defaultNAText){elCell.textContent=pdata.defaultNAText;elCell.style.color="#AAAAAA";elCell.style.fontWeight="normal"}if(onShowDetailCallback&&(isPivot||isSummaryTable)){_$(elCell).addClass("clickable");_$(elCell).on("click",function(ev){var cdatalist=[];if(pdata.colhColDefs.length>0){var _cdata=JSON.parse(JSON.stringify(pdata.colhColDefs[0].column));_cdata.datatype=_cdata.type;_cdata.type="colh0";_cdata.value=pdata.colgh[_totalidx];_cdata.rawValue=pdata.colgh[_totalidx];_cdata.numDecimalDigits=_cdata.numDecimalDigits||viz.numDecimalDigits||2;_cdata.filter=true;cdatalist.push(_cdata)}cdatalist._lang=PivotTableGenerator._lang;onShowDetailCallback([cdatalist],PivotTableGenerator._getSelectionContext(this,"meas",pdata),ev.ctrlKey||ev.metaKey)})}elRow.appendChild(elCell)})}else{if(totalidx<pdata.colh.length){prefix="";suffix="";if(viz.meas0){prefix=pdata.measColDefs[0].column.totalPrefix;suffix=pdata.measColDefs[0].column.totalSuffix}if(options){customNumFormatter=options.customNumFormatter;prefix=options.prefix;suffix=options.suffix}v=total.shift();elCell=_document.createElement("div");elCell.classList.add("pivot-cell","total");var colTypeClass=getColAlign(totalidx);if(options){colTypeClass=VizUtil.returnsNumericValue({name:viz.meas0.name,func:options.func==="mode"&&!calcTotalBeforeAggregation?viz.meas0.func:options.func,isNumeric:viz.meas0.isNumeric,isDate:viz.meas0.isDate})?"num-col":"text-col"}elCell.classList.add(colTypeClass);if(totalidx>COL_INDEX_THRESHOLD_FOR_THUMB){elCell.setAttribute("data-html2canvas-ignore","true")}if(meas0TotalFontSize){elCell.style.fontSize=meas0TotalFontSize+"px"}if(viz.pivotTotalFontStyle){elCell.style.fontWeight=!/bold/.test(viz.pivotTotalFontStyle)?"normal":"bold";elCell.style.fontStyle=/italic/.test(viz.pivotTotalFontStyle)?"italic":"normal"}if(pdata.measColDefs[0]&&pdata.measColDefs[0].column&&pdata.measColDefs[0].column.fontColor){elCell.style.color=pdata.measColDefs[0].column.fontColor}w=pdata.measColDefs[0].cellWidth||defaultCellWidth;if(w){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}if(isUrl(v)){elCell.style.wordBreak="break-all"}elCell.textContent=colTypeClass==="num-col"?formatValue(v,prefix,suffix):v;if(elCell.textContent==="NA"&&pdata.measColDefs&&pdata.measColDefs[0]&&pdata.measColDefs[0].column&&VizUtil.returnsNumericValue(pdata.measColDefs[0].column)){elCell.textContent=""}if((!elCell.textContent||elCell.textContent==="")&&pdata.defaultNAText){elCell.textContent=pdata.defaultNAText;elCell.style.color="#AAAAAA";elCell.style.fontWeight="normal"}if(onShowDetailCallback&&(isPivot||isSummaryTable)){_$(elCell).addClass("clickable");_$(elCell).on("click",function(ev){var cdatalist=[];if(pdata.colhColDefs.length>0){var _cdata=JSON.parse(JSON.stringify(pdata.colhColDefs[0].column));_cdata.datatype=_cdata.type;_cdata.type="colh0";_cdata.value=pdata.colh[_totalidx];_cdata.rawValue=pdata.colh[_totalidx];_cdata.numDecimalDigits=_cdata.numDecimalDigits||viz.numDecimalDigits||2;_cdata.filter=true;cdatalist.push(_cdata)}cdatalist._lang=PivotTableGenerator._lang;onShowDetailCallback([cdatalist],PivotTableGenerator._getSelectionContext(this,"meas",pdata),ev.ctrlKey||ev.metaKey)})}elRow.appendChild(elCell)}}})};var _renderTotalFooter=function(elRow,grandTotal,options){if((isPivot||isSummaryTable)&&grandTotal){pdata.measColDefs.forEach(function(measColDef,midx){customNumFormatter=measColDef.column.customNumFormatter;elCell=_document.createElement("div");elCell.classList.add("pivot-cell","total");var colTypeClass=getColAlign(midx);if(options&&measColDef&&measColDef.column){colTypeClass=VizUtil.returnsNumericValue({name:measColDef.column.name,func:options.func==="mode"&&!calcTotalBeforeAggregation?measColDef.column.func:options.func,isNumeric:measColDef.column.isNumeric,isDate:measColDef.column.isDate})?"num-col":"text-col"}elCell.classList.add(colTypeClass);var prefix="",suffix="",w=null;if(measColDef&&measColDef.column){prefix=measColDef.column.totalPrefix;suffix=measColDef.column.totalSuffix;w=measColDef.cellWidth||defaultCellWidth}if(options){customNumFormatter=options.customNumFormatter;prefix=options.prefix;suffix=options.suffix}if(w){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}if(meas0FontSize){elCell.style.fontSize=meas0FontSize+"px"}if(measColDef&&measColDef.column&&measColDef.column.fontStyle){elCell.style.fontWeight=/bold/.test(measColDef.column.fontStyle)?"bold":"normal";elCell.style.fontStyle=/italic/.test(measColDef.column.fontStyle)?"italic":"normal"}if(viz.pivotTotalFontStyle){elCell.style.fontWeight=!/bold/.test(viz.pivotTotalFontStyle)?"normal":"bold";elCell.style.fontStyle=/italic/.test(viz.pivotTotalFontStyle)?"italic":"normal"}if(measColDef&&measColDef.column&&measColDef.column.fontColor){elCell.style.color=measColDef.column.fontColor}elCellText=_document.createElement("span");var c=grandTotal;if(!VizUtil.isEmpty(c)&&c.length>0&&isUrl(c[midx])){elCellText.style.wordBreak="break-all"}elCellText.textContent=VizUtil.isEmpty(c)||c.length===0||c[midx]==="NA"?"":colTypeClass==="num-col"?formatValue(c[midx],prefix,suffix):c[midx];if(elCellText.textContent==="NA"&&measColDef&&measColDef.column&&VizUtil.returnsNumericValue(measColDef.column)){elCellText.textContent=""}if((!elCellText.textContent||elCellText.textContent==="")&&pdata.defaultNAText){elCellText.textContent=pdata.defaultNAText;elCellText.style.color="#AAAAAA";elCellText.style.fontWeight="normal"}if(onShowDetailCallback&&(isPivot||isSummaryTable)){_$(elCell).addClass("clickable");_$(elCell).on("click",function(ev){var cdatalist=[];cdatalist._lang=PivotTableGenerator._lang;onShowDetailCallback([cdatalist],PivotTableGenerator._getSelectionContext(this,"meas",pdata),ev.ctrlKey||ev.metaKey)})}elCell.appendChild(elCellText);elRow.appendChild(elCell)})}};pdata.colTotals.forEach(function(totals,totalIdx){var isDefaultTotal=totalIdx===0;var additionalTotalProps=isDefaultTotal?null:pdata.pivotColTotalAggregations[totalIdx];elRow=_document.createElement("div");elRow.classList.add("pivot-row");if(totalIdx>0){elRow.classList.add("no-top-border")}if(pdata.data.length>ROW_INDEX_THRESHOLD_FOR_THUMB){elRow.setAttribute("data-html2canvas-ignore","true")}elPivot.appendChild(elRow);var isTotalLabelRendered=false;for(i=0;i<pdata.numRowh;i++){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","total","text-col");if(rowh0TotalFontSize){elCell.style.fontSize=rowh0TotalFontSize+"px"}if(viz["rowh"+i+"HideCells"]){elCell.style.display="none"}if(viz.pivotTotalFontStyle){elCell.style.fontWeight=!/bold/.test(viz.pivotTotalFontStyle)?"normal":"bold";elCell.style.fontStyle=/italic/.test(viz.pivotTotalFontStyle)?"italic":"normal"}if(!isTotalLabelRendered&&elCell.style.display!=="none"){if(isDefaultTotal){elCell.textContent=translateColumn(viz.pivotTotalTitle)||VizUtil.getMessage(PivotTableGenerator._lang,"Total")}else{var aggFuncName=additionalTotalProps&&additionalTotalProps.value?" ("+VizUtil.getMessage(PivotTableGenerator._lang,VizUtil.PIVOT_MULTIPLE_TOTAL_AGGREGATION_OPTIONS_PLOT_LABEL_HASH[additionalTotalProps.value])+")":"";elCell.textContent=translateColumn(additionalTotalProps.label)||VizUtil.getMessage(PivotTableGenerator._lang,"Total")+aggFuncName}isTotalLabelRendered=true}else{elCell.textContent=""}elRow.appendChild(elCell)}var gTotal=totals&&pdata.grandTotal&&totalIdx<pdata.grandTotal.length?pdata.grandTotal[totalIdx]:null;var options=null;if(additionalTotalProps){options={};options.customNumFormatter=VizUtil.valueFormatterGenerator(viz.disableDecimalFormatting?null:!VizUtil.isEmpty(additionalTotalProps.numDecimalDigits,true)?additionalTotalProps.numDecimalDigits:!VizUtil.isEmpty(numDecimalDigits,true)?numDecimalDigits:2,additionalTotalProps.useThousandSeparator?additionalTotalProps.useThousandSeparator!=="off":useThousandSeparator,VizUtil.isEmpty(additionalTotalProps.numDecimalDigits,true)&&VizUtil.isEmpty(numDecimalDigits,true));options.prefix=additionalTotalProps.numberFormatting==="currency"?additionalTotalProps.currencySymbol||"$":"";options.suffix=additionalTotalProps.numberFormatting==="percentage"?"%":"";options.func=additionalTotalProps.value}if(showTotalFirst){_renderTotalFooter(elRow,gTotal,options);_renderFooter(elRow,totals,options)}else{_renderFooter(elRow,totals,options);_renderTotalFooter(elRow,gTotal,options)}})}if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){if(pdata.colTotals&&!pdata.colTotals.isMultiple){pdata.colTotals=pdata.colTotals[0]}if(pdata.grandTotal&&!pdata.grandTotal.isMultiple){pdata.grandTotal=pdata.grandTotal[0]}onBeforeRenderingCallback({marker:viz.marker,data:pdata,dom:elTarget.serialize()})}if(isHeadless){return}var postRenderingProcessing=function(){_syncHeader(elTarget);_syncTitle(elTarget);_initScrollHandler(elTarget,prevState);if(prevState&&prevState.keyword){var $search=$(elTarget).find(".search-field");if($search&&$search.css("display")!=="none"){$search.val(prevState.keyword);filterRowsBySearchKeyword($search[0]);highlightSearchKeyword($search[0])}}};if(headerSyncDelay){setTimeout(function(){postRenderingProcessing()},headerSyncDelay)}else{postRenderingProcessing()}};PivotTableGenerator.renderSingleValue=function(viz,data,elTarget,isHeadless,onBeforeRenderingCallback){var numDecimalDigits=viz.meas0.numDecimalDigits||viz.numDecimalDigits;var useThousandSeparator=viz.meas0.useThousandSeparator?viz.meas0.useThousandSeparator!=="off":viz.useThousandSeparator!=="off";var numFormat=viz.meas0.numberFormatting||viz.svNumberFormatting||VizUtil.getDefaultNumberFormattingOption("singlevalue",viz.meas0?viz.meas0.func:null,viz.svWindowFunc);var currencySymbol=viz.meas0.currencySymbol||viz.svCurrencySymbol||"";var prefix="",suffix="";var isNumeric=VizUtil.returnsNumericValue(viz.meas0);if(isNumeric){prefix=VizUtil.getValuePrefix(numFormat,currencySymbol,viz.marker);suffix=VizUtil.getValueSuffix(null,viz.meas0.func,numFormat,viz.marker)}var formatValue=VizUtil.valueFormatterGenerator(viz.disableDecimalFormatting?null:VizUtil.isEmpty(numDecimalDigits,true)?2:numDecimalDigits,useThousandSeparator,VizUtil.isEmpty(numDecimalDigits,true));var value=viz.dataDefaultValue||VizUtil.getDefaultSingleValueValue(viz.meas0);var rawValue=null;var noValueFound=true;var pdata=null;if(data&&data.length>0){pdata=PivotTableGenerator.constructPivotData(viz,data);var v;if(pdata.data&&pdata.data.length>0){v=pdata.data[pdata.data.length-1];if(v&&v.length>0){v=v[v.length-1];if(v&&v.length>0){rawValue=v[v.length-1]}}}if(rawValue&&!(viz.meas0.type==="logical"&&rawValue==="(NA)")){if(!isNaN(rawValue)){rawValue=parseFloat(rawValue)}value=formatValue(rawValue,!VizUtil.returnsNumericValue(viz.meas0));if(value.startsWith("-")){value="-"+prefix+value.replace(/^-/,"")+suffix}else{value=prefix+value+suffix}noValueFound=false}}var defaultFgColor=viz.meas0.fontColor||"#4d4d4d";var defaultCaptionFgColor="#4d4d4d";if(noValueFound){defaultFgColor="#999999"}var fontWeight=viz.meas0.fontStyle&&!/bold/.test(viz.meas0.fontStyle)?"normal":null;var fontStyle=viz.meas0.fontStyle&&/italic/.test(viz.meas0.fontStyle)?"italic":null;var iconClass=viz.singlevalueIconClass||"";var fgColor=viz.singlevalueColor&&viz.singlevalueColor!=="default"?viz.singlevalueColor:defaultFgColor;var captionFgColor=viz.singlevalueCaptionColor&&viz.singlevalueCaptionColor!=="default"?viz.singlevalueCaptionColor:defaultCaptionFgColor;var bgColor=viz.singlevalueBgColor||"#ffffff";var border=viz.singlevalueBorder||"1px solid #d7d7d7";var padding=viz.singlevaluePadding||"0px 9px 0px 0px";var innerPadding=viz.singlevalueInnerPadding||"10px 22px";var caption=viz.svCaptionText||viz.displayName||viz.title||(viz.meas0.type===VizUtil.TYPE_NUMROWS?VizUtil.getMessage(PivotTableGenerator._lang,VizUtil.NUMROWS_COL_LABEL):viz.meas0.name);if(viz.meas0.formattingTarget&&rawValue!==null){if(viz.meas0.formattingType==="cf"){var coldef=JSON.parse(JSON.stringify(viz.meas0));coldef.suffix=suffix;var colorByCondition=PivotTableGenerator.applyConditionalFormatting(viz.meas0.conditionalFormattings,coldef,rawValue);if(colorByCondition){fgColor=colorByCondition}}else if(viz.meas0.formattingType==="posneg"&&isNumeric){var posColor=viz.meas0.positiveColor||"#70BF41";var negColor=viz.meas0.negativeColor||"#EC5D57";fgColor=rawValue<0?negColor:posColor}if(fgColor&&viz.meas0.opacity&&viz.meas0.opacity!=="1"){fgColor=chroma(fgColor).alpha(parseFloat(viz.meas0.opacity))}}var valueStyle={color:fgColor};if(fontWeight){valueStyle["font-weight"]=fontWeight}if(fontStyle){valueStyle["font-style"]=fontStyle}if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:viz.marker,data:pdata,value:value,iconClass:iconClass,fgColor:fgColor,captionFgColor:captionFgColor,bgColor:bgColor,border:border,padding:padding,innerPadding:innerPadding,caption:caption})}if(isHeadless){return}if(elTarget&&$(elTarget).height()<90){innerPadding="2px 22px"}var $elBox=$(document.createElement("div"));$elBox.css({padding:padding}).attr("data-viz-type","singlevalue").addClass("single-value-box");var $elBoxInner=$(document.createElement("div"));$elBoxInner.css({padding:innerPadding,"background-color":bgColor,border:border}).addClass("single-value-innerbox");var $elValue=$(document.createElement("div"));$elValue.css(valueStyle);$elValue.text(value).addClass("single-value-text");if(noValueFound){$elValue.text(value).addClass("no-value")}var $elCaption=$(document.createElement("div"));$elCaption.text(caption).addClass("single-value-caption").css("color",captionFgColor);var $elIconDiv=$(document.createElement("div"));if(iconClass){var $elIcon=$(document.createElement("i"));$elIcon.addClass("fal "+iconClass+" single-value-icon").appendTo($elIconDiv)}$elBox.append($elBoxInner.append($elValue).append($elCaption));$elBox.append($elIconDiv);$elBox.appendTo(elTarget);if(($elCaption[0].scrollHeight>$elCaption[0].clientHeight||caption&&caption.length>70)&&elTarget.clientHeight<130){$elValue.addClass("no-margin")}};PivotTableGenerator.onRowClick=function(event){if(this.classList.contains("selected")){this.classList.remove("selected")}else{this.classList.add("selected")}};PivotTableGenerator.onLinkClick=function(event){if(typeof module==="object"&&module.exports){if(event){event.preventDefault();event.stopPropagation()}global._guiShell.openExternal(this.getAttribute("href"));return false}else{return true}};PivotTableGenerator.bindUrlData=function(urlTemplate,urlEncodeParameters,ridx,cidx,rowh,rowhCols,rowData,colh,colhCols,meas,measCols,extraData,extraCols,isPivot,isSummaryTable){if(!urlTemplate){return null}var ht={};if(isPivot||isSummaryTable){if(rowh&&rowhCols&&ridx<rowh.length){var v=rowh[ridx];rowhCols.forEach(function(rhc,rhcidx){ht[rhc]=v[rhcidx]})}if(cidx===null){if(colhCols.length===0){measCols.forEach(function(m,idx){ht[m]=rowData[idx][0]})}}else{if(measCols&&measCols.length>1){if(measCols&&measCols.length>0&&cidx<measCols.length){ht[measCols[cidx]]=meas}}else{if(colh&&colhCols&&colhCols.length>0&&cidx<colh.length){ht[colhCols[0]]=colh[cidx]}if(measCols&&measCols.length>0){ht[measCols[0]]=meas}}}}else{if(colh&&rowData){colh.forEach(function(c,idx){if(idx<rowData.length){ht[c]=rowData[idx][0]}})}if(extraData&&extraData.length>ridx&&extraCols){var extraRowData=extraData[ridx];extraCols.forEach(function(c,idx){ht[c]=extraRowData[idx]})}}urlTemplate=urlTemplate.replace(/\\\$/g,"___DlR___").replace(/\\\{/g,"___OpN___").replace(/\\\}/g,"___ClS___").replace(/\\\\/g,"___BsL___").replace(/\\/g,"");var res=urlTemplate.replace(/\$\{([^\}]+)\}/g,function(match,p1){p1=p1.replace(/___DlR___/g,"$").replace(/___OpN___/g,"{").replace(/___ClS___/g,"}").replace(/___BsL___/g,"\\");return ht[p1]?urlEncodeParameters?encodeURIComponent(ht[p1]):ht[p1]:""});return res};PivotTableGenerator.constructPivotData=function(viz,data,sortIdx,sortDir){var isPivot=viz.marker==="pivot";var isTable=viz.marker==="table";var isSummaryTable=viz.marker==="summarytable";var isSingleValue=viz.marker==="singlevalue";var _t=new Date;var rowh=[];var colh=data[1].slice();var colgh=[];var cells=[];var extraCells=[];var extraColh=data.length>7?data[7].slice():null;var rowhCols=[];var rowhColDefs=[];var colhCols=[];var colhColDefs=[];var tcolColDefs=[];var measCols=[];var measColDefs=[];var rowhIdx=0,colhIdx=0,measIdx=0,c,i,l;var colTotals=data.length>4&&!(data[4].length===1&&data[4][0]===null)?data[4]:null;var rowTotals=(isPivot||isSummaryTable)&&data.length>5&&!(data[5].length===1&&data[5][0]===null)?data[5]:null;var grandTotal=null;var subTotals=data.length>8&&!(data[8].length===1&&data[8][0]===null)?data[8]:null;var sortAcrossGroup=viz.pivotSortWithinGroup==="off";var measValueSeparator=viz._pivotValueSeparator||",";var categoryListHt=(isPivot||isSummaryTable)&&data.length>9&&data[9]&&!Array.isArray(data[9])?data[9]:{};if(colTotals&&!isTable){colTotals=colTotals.map(function(d){return typeof d==="string"&&(isPivot||isSummaryTable)?d.split(measValueSeparator):[d]})}if(rowTotals){rowTotals=rowTotals.map(function(d){return typeof d==="string"&&(isPivot||isSummaryTable)?d.split(measValueSeparator):[d]});grandTotal=rowTotals.pop()}data[0].forEach(function(dataRow){cells.push(dataRow.slice())});if(data.length>6){data[6].forEach(function(dataRow){if(dataRow){extraCells.push(dataRow.slice())}})}for(i=0,l=VizUtil.MAX_NUMBER_OF_CONTROLS.rowh;i<l;i++){c=viz["rowh"+i];if(c){rowhCols.push(c.balloonDisplayName||c.displayName||c.name);rowhColDefs.push({option:"rowh"+i,column:JSON.parse(JSON.stringify(c)),title:c.displayName||viz["rowh"+i+"Title"],cellWidth:viz["rowh"+i].cellWidth,fontSize:viz["rowh"+i].fontSize||viz["rowh"+i+"FontSize"],fontStyle:viz["rowh"+i].fontStyle,fontColor:viz["rowh"+i].fontColor,categories:categoryListHt["r"+i]});rowhIdx++}}var numRowh=rowhCols.length;colh.splice(0,numRowh);if(numRowh>0){var rh;cells.forEach(function(r){rh=r.splice(0,numRowh);rowh.push(rh)})}for(i=0,l=VizUtil.MAX_NUMBER_OF_CONTROLS.colh;i<l;i++){c=viz["colh"+i];if(c){colhCols.push(c.balloonDisplayName||c.displayName||c.name);colhColDefs.push({option:"colh"+i,column:JSON.parse(JSON.stringify(c)),title:viz["colh"+i+"Title"]});colhIdx++}}var tableMaxNumCol=viz.tableMaxNumCol?parseInt(viz.tableMaxNumCol):VizUtil.MAX_NUMBER_OF_CONTROLS.tcol;for(i=0;i<tableMaxNumCol;i++){c=viz["tcol"+i];if(c){colhCols.push(c.displayName||c.name);tcolColDefs.push({option:"tcol"+i,column:JSON.parse(JSON.stringify(c))});colhIdx++}}for(i=0,l=VizUtil.MAX_NUMBER_OF_CONTROLS.meas;i<l;i++){c=viz["meas"+i];if(c){measCols.push(c.balloonDisplayName||c.displayName||(c.type===VizUtil.TYPE_NUMROWS?VizUtil.getMessage(PivotTableGenerator._lang,VizUtil.NUMROWS_COL_LABEL):c.name));measColDefs.push({option:"meas"+i,column:JSON.parse(JSON.stringify(c)),title:c.displayName||viz["meas"+i+"Title"],cellWidth:viz["meas"+i].cellWidth,fontSize:c.fontSize,fontStyle:c.fontStyle,fontColor:c.fontColor,categories:categoryListHt["m"+i]});measIdx++}}var numMeas=measCols.length;var isColGroupAvailable=measColDefs.length>1&&colhColDefs.length>0;cells.forEach(function(dataRow){dataRow.forEach(function(d,didx){if(d===null||d===undefined){dataRow[didx]=[];measColDefs.forEach(function(){dataRow[didx].push(null)})}else{dataRow[didx]=typeof d==="string"&&(isPivot||isSummaryTable||isSingleValue)?d.split(measValueSeparator):[d]}})});if((isPivot||isSummaryTable)&&measIdx>1){if(isColGroupAvailable){colgh=colh}colh=measColDefs.map(function(x){return x.column.name});if(isColGroupAvailable){var x=[];for(i=0;i<colgh.length;i++){x=x.concat(colh)}colh=x}cells.forEach(function(dataRow){for(i=0,l=colgh.length>0?colgh.length:1;i<l;i++){var measArr=dataRow.shift();measArr.forEach(function(m){dataRow.push([m])})}})}if(isPivot&&!isColGroupAvailable){cells.forEach(function(row){row.forEach(function(cell){if(cell.length===2){cell.pop()}})})}if(isTable){PivotTableGenerator.calculateExtents(null,null,null,tcolColDefs,cells,"table_down")}else if(isSummaryTable||isPivot){PivotTableGenerator.calculateExtents(rowh,rowhColDefs,colhColDefs,measColDefs,cells,"table_down")}var sortCol=null;if(isPivot||isSummaryTable){if(numMeas>1&&measColDefs.length>sortIdx){sortCol=measColDefs[sortIdx].column}else if(measColDefs.length>0){sortCol=measColDefs[0].column}}else if(tcolColDefs.length>sortIdx){sortCol=tcolColDefs[sortIdx].column}var sorted=PivotTableGenerator.sortPivotData(rowh,cells,rowTotals,sortIdx,sortCol,sortDir,sortAcrossGroup,extraCells);rowh=sorted.rowh;cells=sorted.cells;rowTotals=sorted.rowTotals;if(extraCells&&extraCells.length>0){extraCells=sorted.extraCells}if(numRowh<2){subTotals=null}else{if(subTotals&&colhCols.length>0){var ht={},keys=[];subTotals=subTotals.forEach(function(x){var keyArr=x.slice(0,rowhCols.length-1);var key=JSON.stringify(keyArr);keys.push(key);if(!ht[key]){keyArr.push(null);ht[key]=keyArr}ht[key]=ht[key].concat(x.slice(rowhCols.length-1+colhCols.length))});keys=VizUtil.makeArrayUnique(keys);subTotals=keys.map(function(x){return ht[x]})}}var rowsFetched=null;if(isTable&&viz.tableNRowsToShow&&viz.showNRowsToShowOptionInToolbar==="on"){rowsFetched=cells.length;var nrowsToShow=parseInt(viz.tableNRowsToShow);if(cells.length>nrowsToShow){cells=cells.filter(function(x,idx){return idx<nrowsToShow})}}var isApplyColorToAllColumnsDefined=false;if(isPivot||isSummaryTable){rowhColDefs.forEach(function(m){if(m.column.applyColorToAllColumns==="on"){if(isApplyColorToAllColumnsDefined||!m.column.formattingTarget){delete m.column.applyColorToAllColumns}else{isApplyColorToAllColumnsDefined=true}}});if(colhColDefs.length===0){measColDefs.forEach(function(m){if(m.column.applyColorToAllColumns==="on"){if(isApplyColorToAllColumnsDefined||!m.column.formattingTarget){delete m.column.applyColorToAllColumns}else{isApplyColorToAllColumnsDefined=true}}})}else{measColDefs.forEach(function(m){delete m.column.applyColorToAllColumns})}}else{measColDefs.forEach(function(m){delete m.column.applyColorToAllColumns})}colhColDefs.forEach(function(c){VizUtil._migratePivotVisualFormatting(c.column)});rowhColDefs.forEach(function(c){VizUtil._migratePivotVisualFormatting(c.column)});measColDefs.forEach(function(c){VizUtil._migratePivotVisualFormatting(c.column)});tcolColDefs.forEach(function(c){VizUtil._migratePivotVisualFormatting(c.column)});var pivotColTotalAggregations=VizUtil.validatePivotMultipleTotalOptions(viz.pivotColTotalAggregations,VizUtil.getOptions(viz,"meas"),viz.pivotTotalCalcTiming);if(pivotColTotalAggregations&&pivotColTotalAggregations.length>0&&colTotals&&colTotals.length>0){pivotColTotalAggregations.unshift("");var newColTotals=[],colTotalRow,rowItem,mIdx;pivotColTotalAggregations.forEach(function(aggFunc,idx){colTotalRow=[];colTotals.forEach(function(colTotal){rowItem=[];for(mIdx=0;mIdx<numMeas;mIdx++){rowItem.push([colTotal[mIdx*pivotColTotalAggregations.length+idx]])}colTotalRow.push(rowItem)});newColTotals.push(colTotalRow)});newColTotals.isMultiple=true;colTotals=newColTotals;if(grandTotal&&grandTotal.length>0){newColTotals=[];pivotColTotalAggregations.forEach(function(aggFunc,idx){rowItem=[];for(mIdx=0;mIdx<numMeas;mIdx++){rowItem.push([grandTotal[mIdx*pivotColTotalAggregations.length+idx]])}newColTotals.push(rowItem)});newColTotals.isMultiple=true;grandTotal=newColTotals}}else{colTotals=colTotals!==null?[colTotals]:null;grandTotal=grandTotal!==null?[grandTotal]:null}console.log("Time Elapsed for pivoting data (ms): "+((new Date).getTime()-_t.getTime()));var res={colh:colh,colgh:colgh,colhCols:colhCols,colhColDefs:colhColDefs,tcolColDefs:tcolColDefs,rowh:rowh,rowhCols:rowhCols,numRowh:numRowh,rowhColDefs:rowhColDefs,measCols:measCols,measColDefs:measColDefs,numMeas:numMeas,data:cells,extraData:extraCells.length>0?extraCells:null,extraCols:extraColh,colTotals:colTotals,rowTotals:rowTotals,subTotals:subTotals,grandTotal:grandTotal,originalRowSize:data[2][0],originalColSize:data[3][0]-numRowh,defaultNAText:viz.pivotDefaultNAText};if(rowsFetched){res.rowsFetched=rowsFetched}if(isApplyColorToAllColumnsDefined){res.isApplyColorToAllColumnsDefined=true}if(pivotColTotalAggregations){res.pivotColTotalAggregations=pivotColTotalAggregations}return res};PivotTableGenerator._sortDescending=function(a,b){a=a==="Inf"?Number.MAX_SAFE_INTEGER:a==="-Inf"?Number.MIN_SAFE_INTEGER+1:a;b=b==="Inf"?Number.MAX_SAFE_INTEGER:b==="-Inf"?Number.MIN_SAFE_INTEGER+1:b;return d3.descending(a,b)};PivotTableGenerator._sortAscending=function(a,b){a=a==="Inf"?Number.MAX_SAFE_INTEGER:a==="-Inf"?Number.MIN_SAFE_INTEGER+1:a;b=b==="Inf"?Number.MAX_SAFE_INTEGER:b==="-Inf"?Number.MIN_SAFE_INTEGER+1:b;return d3.ascending(a,b)};PivotTableGenerator.sortPivotData=function(rowh,cells,rowTotals,sortIdx,sortCol,sortDir,sortAcrossGroup,extraCells){if(sortDir===_SORT_NONE){return{rowh:rowh,cells:cells,rowTotals:rowTotals,extraCells:extraCells}}var newrowh=[];var newrowTotals=null;var numRowTotalCols=0;if(rowTotals){newrowTotals=[];numRowTotalCols=rowTotals[0].length;cells.forEach(function(cellrow,idx){rowTotals[idx].forEach(function(rowTotal){cellrow.push([rowTotal])})})}cells.forEach(function(cellrow,idx){cellrow.push(rowh[idx]);if(extraCells){cellrow._extraCells=extraCells[idx]}});var sortfunc=sortDir===_SORT_DESC?PivotTableGenerator._sortDescending:PivotTableGenerator._sortAscending;var nestedData=null,v;if(rowh.length>0&&rowh[0].length>1&&!sortAcrossGroup){nestedData=d3.nest().key(function(d){v=d[d.length-1].slice();v.pop();return v.join("::")}).entries(cells)}else{nestedData=[{key:rowh[0],values:cells}]}var isNumericColumn=sortCol?VizUtil.returnsNumericValue(sortCol):true;nestedData.forEach(function(group){group.values.sort(function(a,b){if(isNumericColumn){return sortfunc(a.length<=sortIdx||VizUtil.isEmpty(a[sortIdx])||VizUtil.isEmpty(a[sortIdx][0])||a[sortIdx][0]===""?Number.MIN_SAFE_INTEGER:isNaN(a[sortIdx][0])?a[sortIdx][0]:parseFloat(a[sortIdx][0]),b.length<=sortIdx||VizUtil.isEmpty(b[sortIdx])||VizUtil.isEmpty(b[sortIdx][0])||b[sortIdx][0]===""?Number.MIN_SAFE_INTEGER:isNaN(b[sortIdx][0])?b[sortIdx][0]:parseFloat(b[sortIdx][0]))}else{return sortfunc(a.length<=sortIdx||VizUtil.isEmpty(a[sortIdx])||VizUtil.isEmpty(a[sortIdx][0])?"":a[sortIdx][0],b.length<=sortIdx||VizUtil.isEmpty(b[sortIdx])||VizUtil.isEmpty(b[sortIdx][0])?"":b[sortIdx][0])}})});var newcells=[],newExtraCells=[];nestedData.forEach(function(group){newcells=newcells.concat(group.values)});newcells.forEach(function(cellrow){newrowh.push(cellrow.pop());newExtraCells.push(cellrow._extraCells);if(rowTotals){var arr=[];for(var i=0;i<numRowTotalCols;i++){arr.unshift(cellrow.pop())}newrowTotals.push(arr)}});return{rowh:newrowh,cells:newcells,rowTotals:newrowTotals,extraCells:extraCells?newExtraCells:null}};PivotTableGenerator._getRowGroupInfo=function(rowh,rowhColDefs,cells){var prev=null,startIndexes=[];if(!rowh||rowh.length===0||rowhColDefs.length<2){return[{idx:0,len:cells.length}]}rowh.forEach(function(row,idx){if(prev!==row[0]){startIndexes.push(idx)}prev=row[0]});var res=startIndexes.map(function(v,idx){if(idx===startIndexes.length-1){return{idx:v,len:rowh.length-v}}else{return{idx:v,len:startIndexes[idx+1]-v}}});return res};PivotTableGenerator._calculateExtent=function(data,setZeroAsCenter){var ext=d3.extent(data);if(setZeroAsCenter&&ext&&!isNaN(ext[0])&&!isNaN(ext[1])){var range=Math.max(Math.abs(ext[0]),Math.abs(ext[1]));ext=[-range,range]}return ext[0]===undefined&&ext[1]===undefined?null:ext};PivotTableGenerator.calculateExtents=function(rowh,rowhColDefs,colhColDefs,measColDefs,cells,defaultDirection){if(!measColDefs){return}var isColhAvailable=colhColDefs&&colhColDefs.length>0;measColDefs.forEach(function(measColDef,idx){if(!measColDef||!measColDef.column||!VizUtil.returnsNumericValue(measColDef.column)){return}var direction=measColDef.column.formattingDirection||defaultDirection;if(!direction){return}var setZeroAsCenter=measColDef.column.formattingTarget&&measColDef.column.formattingType==="color"&&measColDef.column.colorSetZeroToCenter==="on",numMeas=measColDefs.length,arr,ext,ncol,groups,cell,i,j,l;if(isColhAvailable){switch(direction){case"table_down_across":{arr=[];cells.forEach(function(row){row.forEach(function(cell,cidx){if(cell&&cell.length>0&&!isNaN(cell[0])&&idx===cidx%numMeas){arr.push(parseFloat(cell[0]))}})});ext=PivotTableGenerator._calculateExtent(arr,setZeroAsCenter);if(ext){cells.forEach(function(row){row.forEach(function(cell,cidx){if(cell&&cell.length>0&&idx===cidx%numMeas){cell.push(ext)}})})}else{measColDef.isCategorical=true}break}case"table_across":{cells.forEach(function(row){arr=[];row.forEach(function(cell,cidx){if(cell&&cell.length>0&&!isNaN(cell[0])&&idx===cidx%numMeas){arr.push(parseFloat(cell[0]))}});ext=PivotTableGenerator._calculateExtent(arr,setZeroAsCenter);if(ext){row.forEach(function(cell,cidx){if(cell&&cell.length>0&&idx===cidx%numMeas){cell.push(ext)}})}else{measColDef.isCategorical=true}});break}case"table_down":{ncol=cells[0].length;for(i=0;i<ncol;i++){if(idx===i%numMeas){arr=[];cells.forEach(function(row){cell=row[i];if(cell&&cell.length>0&&!isNaN(cell[0])){arr.push(parseFloat(cell[0]))}});ext=PivotTableGenerator._calculateExtent(arr,setZeroAsCenter);if(ext){cells.forEach(function(row){cell=row[i];if(cell&&cell.length>0){cell.push(ext)}})}else{measColDef.isCategorical=true}}}break}case"pane_down":{ncol=cells[0].length;groups=PivotTableGenerator._getRowGroupInfo(rowh,rowhColDefs,cells);for(i=0;i<ncol;i++){if(idx===i%numMeas){groups.forEach(function(g){arr=[];for(j=g.idx,l=g.idx+g.len;j<l;j++){cell=cells[j][i];if(cell&&cell.length>0&&!isNaN(cell[0])){arr.push(parseFloat(cell[0]))}}ext=PivotTableGenerator._calculateExtent(arr,setZeroAsCenter);if(ext){for(j=g.idx,l=g.idx+g.len;j<l;j++){cell=cells[j][i];if(cell&&cell.length>0){cell.push(ext)}}}})}else{measColDef.isCategorical=true}}break}case"pane_down_across":{groups=PivotTableGenerator._getRowGroupInfo(rowh,rowhColDefs,cells);groups.forEach(function(g){arr=[];for(j=g.idx,l=g.idx+g.len;j<l;j++){cells[j].forEach(function(cell,cidx){if(cell&&cell.length>0&&!isNaN(cell[0])&&idx===cidx%numMeas){arr.push(parseFloat(cell[0]))}})}ext=PivotTableGenerator._calculateExtent(arr,setZeroAsCenter);if(ext){for(j=g.idx,l=g.idx+g.len;j<l;j++){cells[j].forEach(function(cell,cidx){if(cell&&cell.length>0&&idx===cidx%numMeas){cell.push(ext)}})}}else{measColDef.isCategorical=true}});break}}}else{switch(direction){case"table_down_across":case"table_across":case"table_down":{arr=[];cells.forEach(function(row){cell=row[idx];if(cell&&cell.length>0&&!isNaN(cell[0])){arr.push(parseFloat(cell[0]))}});ext=PivotTableGenerator._calculateExtent(arr,setZeroAsCenter);if(ext){cells.forEach(function(row){cell=row[idx];if(cell&&cell.length>0){cell.push(ext)}})}else{measColDef.isCategorical=true}break}case"pane_down":case"pane_down_across":{ncol=cells[0].length;groups=PivotTableGenerator._getRowGroupInfo(rowh,rowhColDefs,cells);groups.forEach(function(g){arr=[];for(j=g.idx,l=g.idx+g.len;j<l;j++){cell=cells[j][idx];if(cell&&cell.length>0&&!isNaN(cell[0])){arr.push(parseFloat(cell[0]))}}ext=PivotTableGenerator._calculateExtent(arr,setZeroAsCenter);if(ext){for(j=g.idx,l=g.idx+g.len;j<l;j++){cell=cells[j][idx];if(cell&&cell.length>0){cell.push(ext)}}}else{measColDef.isCategorical=true}});break}}}})};PivotTableGenerator.getRenderFunction=function(viz,data,headerSyncDelay,onLoadCallback,onErrorCallback){var func=function(props){viz.width=props.width;viz.height=props.height;var elTarget=props.elem;PivotTableGenerator.render(viz,data,elTarget,false,headerSyncDelay,null,onLoadCallback,onErrorCallback)};return func};PivotTableGenerator._getSelectionContext=function(cell,type,pdata){var ctx={};var ridx=null,cidx=null;cell.parentNode.childNodes.forEach(function(c,idx){if(c===cell){cidx=idx;return true}});cell.parentNode.parentNode.childNodes.forEach(function(c,idx){if(c===cell.parentNode){ridx=idx}});if(pdata){var isMultiMeasure=pdata.measColDefs.length>1;var showColGroup=pdata.colgh.length>0;var rowOffset=showColGroup?2:1;var colOffset=pdata.numRowh;if(type==="meas"){if(isMultiMeasure){ctx.row=[ridx];var _cidx=cidx-colOffset;var startIdx=cidx-_cidx%pdata.measColDefs.length;ctx.col=[];pdata.measColDefs.forEach(function(c,idx){ctx.col.push(startIdx+idx)})}else{ctx.row=[ridx];ctx.col=[cidx]}}else if(type==="rowh"){ctx.col=[cidx];ctx.row=[];var _ridx=ridx-rowOffset;var rowhVal=pdata.rowh[_ridx];rowhVal=rowhVal.slice(0,cidx+1);pdata.rowh.forEach(function(r,idx){var isDifferent=rowhVal.some(function(c,idx){return c!==r[idx]});if(!isDifferent){ctx.row.push(idx+rowOffset)}})}}else{ctx.row=[ridx];ctx.col=[cidx]}return ctx};PivotTableGenerator._highlightSelections=function(pivotElem,ctxs,ctxsToRemove){if(!pivotElem){return null}var pivotBody=pivotElem.querySelector(".pivot-view .pivot-body-view .pivot-table-body-frame");if(!pivotBody){return null}if(ctxsToRemove){ctxsToRemove.forEach(function(ctx){if(ctx&&!VizUtil.isEmpty(ctx.row)&&!VizUtil.isEmpty(ctx.col)){ctx.row.forEach(function(ridx){ctx.col.forEach(function(cidx){if(ridx<pivotBody.childNodes.length&&cidx<pivotBody.childNodes[ridx].childNodes.length){var cell=pivotBody.childNodes[ridx].childNodes[cidx];if(cell){cell.style.cssText=null}}})})}})}ctxs.forEach(function(ctx){if(ctx&&!VizUtil.isEmpty(ctx.row)&&!VizUtil.isEmpty(ctx.col)){ctx.row.forEach(function(ridx){ctx.col.forEach(function(cidx){if(ridx<pivotBody.childNodes.length&&cidx<pivotBody.childNodes[ridx].childNodes.length){var cell=pivotBody.childNodes[ridx].childNodes[cidx];if(cell){cell.style.cssText="background-color: #b5f7b199!important"}}})})}})};if(typeof module==="object"&&module.exports)module.exports=PivotTableGenerator;var ROutputGenerator=function(){};ROutputGenerator.render=function(viz,data,elTarget,onLoadCallback,onErrorCallback,onBeforeRenderingCallback,lang){if(lang){ROutputGenerator._lang=lang}try{ROutputGenerator._render(viz,data,elTarget,onBeforeRenderingCallback)}catch(e){if(onErrorCallback&&typeof onErrorCallback==="function"){onErrorCallback(e,viz)}if(elTarget){VizUtil.renderNoData(elTarget,VizUtil.getMessage(ROutputGenerator._lang,"Chart rendering failed."))}console.error(e)}finally{if(onLoadCallback&&typeof onLoadCallback==="function"){onLoadCallback()}}};ROutputGenerator._render=function(viz,data,elTarget,onBeforeRenderingCallback){if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:viz.marker,data:data})}if(!elTarget){return}while(elTarget.childNodes.length>0){elTarget.removeChild(elTarget.firstChild)}if(data&&data.length===0){VizUtil.renderNoData(elTarget,VizUtil.getMessage(ROutputGenerator._lang,"There is no data to display."));return}var outputFile=null;if(data.outputFile&&data.outputFile.length>0){outputFile=data.outputFile[0];if(!/^data:/.test(outputFile)){if(/^[/\\]/.test(outputFile)||/^[a-zA-Z]:/.test(outputFile)){outputFile="file://"+outputFile}outputFile=outputFile+"?cb="+Date.now()}}var elContent=document.createElement("div");elContent.style.width="100%";elContent.style.height="100%";elTarget.appendChild(elContent);var elImage=document.createElement("img");elImage.classList.add("r-output");elImage.src=outputFile;elImage.style.maxWidth="99%";elImage.style.maxHeight="99%";elImage.style.transform="translate(-50%, -50%)";elImage.style.position="relative";elImage.style.top="50%";elImage.style.left="50%";elContent.appendChild(elImage)};if(typeof module==="object"&&module.exports)module.exports=ROutputGenerator;"use strict";var PlotlyGraphGenerator=function(){this._isFacetFilterEnabled=false;this._isFacetLayoutToolEnabled=false;this._isToolbarEnabled=false;this._isToolbarHidden=false};var NA_LABEL="(NA)";var _adjustColor=function(str,ratio){var p=typeof ratio==="string"?parseFloat(ratio):ratio;var code=_getRGBACode(str);var r=parseInt(Math.max(0,Math.min(255,code.r*p)));var g=parseInt(Math.max(0,Math.min(255,code.g*p)));var b=parseInt(Math.max(0,Math.min(255,code.b*p)));var a=code.a;return"rgba("+r+","+g+","+b+","+a+")"};var _setOpacity=function(str,opacity){var p=typeof ratio==="string"?parseFloat(opacity):opacity;var code=_getRGBACode(str);return"rgba("+code.r+","+code.g+","+code.b+","+p+")"};var _getRGBACode=function(str){var s,r,g,b,a;if(/rgb/.test(str)){s=str.replace(/(rgb\(|rgba\(|\))/g,"");s=s.split(",");r=parseInt(s[0]);g=parseInt(s[1]);b=parseInt(s[2]);a=s.length>3?s[3]:1}else{s=str.replace("#","");r=parseInt(s.substring(0,2),16);g=parseInt(s.substring(2,4),16);b=parseInt(s.substring(4,6),16);a=1}return{r:r,g:g,b:b,a:a}};var VALUE_FOR_NO_COLOR="a";function calculateStackedYValue(traces,isArea){var i;if(isArea){for(i=0;i<traces.length;i++){traces[i]["stacky"]=traces[i]["y"].slice()}for(i=1;i<traces.length;i++){for(var j=0;j<Math.min(traces[i]["stacky"].length,traces[i-1]["stacky"].length);j++){traces[i]["stacky"][j]+=traces[i-1]["stacky"][j]}}traces[traces.length-1]._lastTraceInGroup=true;return traces}for(i=0;i<traces.length;i++){traces[i]["stacky"]=traces[0]["y"].slice();traces[i]["stacky_pos"]=traces[i]["y"].map(function(y){return Math.max(y,0)});traces[i]["stacky_neg"]=traces[i]["y"].map(function(y){return Math.min(y,0)})}for(i=1;i<traces.length;i++){for(var j=0;j<Math.min(traces[i]["stacky"].length,traces[i-1]["stacky"].length);j++){if(traces[i]["y"][j]===null||traces[i]["y"][j]===undefined){traces[i]["stacky_pos"][j]=traces[i-1]["stacky_pos"][j];traces[i]["stacky_neg"][j]=traces[i-1]["stacky_neg"][j];traces[i]["stacky"][j]=traces[i]["stacky_pos"][j]}else if(traces[i]["y"][j]>0){traces[i]["stacky_pos"][j]=traces[i-1]["stacky_pos"][j]+traces[i]["y"][j];traces[i]["stacky_neg"][j]=traces[i-1]["stacky_neg"][j];traces[i]["stacky"][j]=traces[i]["stacky_pos"][j]}else{traces[i]["stacky_pos"][j]=traces[i-1]["stacky_pos"][j];traces[i]["stacky_neg"][j]=traces[i-1]["stacky_neg"][j]+traces[i]["y"][j];traces[i]["stacky"][j]=traces[i]["stacky_neg"][j]}}}for(i=0;i<traces.length;i++){if(i===traces.length-1){traces[i]["stacky_sum"]=traces[i].stacky_pos.map(function(v,idx){return v+traces[i].stacky_neg[idx]});traces[i]._lastTraceInGroup=true}else{delete traces[i]["stacky_pos"];delete traces[i]["stacky_neg"]}}return traces}PlotlyGraphGenerator.calculateStackedYValue=calculateStackedYValue;function convertToStackedYValue(traces){calculateStackedYValue(traces,true);traces.forEach(function(trace){trace.origy=trace.y;trace.y=trace.stacky});return traces}var isGroupedBar=function(xCol,colorCol,layoutBarmode,traceType,numY){var isGroupedBar=!/(stack|overlay)/.test(layoutBarmode)&&traceType==="bar";if(!isGroupedBar){return false}return colorCol&&!(xCol&&xCol.name===colorCol.name)||numY>1};var _needRangeCalcForValueOnPlot=function(marker,orientation,yValueOnPlotPosition,yValueOnPlotTextAngle){orientation=orientation||"vertical";yValueOnPlotTextAngle=yValueOnPlotTextAngle||"0";return yValueOnPlotPosition==="bottom"&&(["bar","errbar","errbar-agg"].includes(marker)&&orientation==="horizontal"&&!["90","270"].includes(yValueOnPlotTextAngle)||orientation==="vertical"&&!["0","180"].includes(yValueOnPlotTextAngle))};var _skipSyncYAxis=function(viz){return viz.marker==="bar"&&(!viz.barstyle||viz.barstyle==="stack")&&viz.color&&viz.facet&&viz.yWindowFunc==="ptotal"&&(!viz.yWindowFuncDirection||viz.yWindowFuncDirection==="color")};PlotlyGraphGenerator._skipSyncYAxis=_skipSyncYAxis;var renderValueOnPlotForBars=function(gData,y1ValuePrefix,y1ValueSuffix,formatY1Value,y2ValuePrefix,y2ValueSuffix,formatY2Value,viz,colMap){var facetCol=viz.facet;var isGroupByMeasuresEnabled=facetCol&&facetCol.type===VizUtil.TYPE_GROUP_BY_MEASURES;var showSumValues=VizUtil.isShowSummarizedValueOnPlotSupported(viz.marker,viz.barstyle)&&viz.yValueOnPlotShowSumValues==="on";var useMarkerColor=viz.yValueOnPlotUseMarkerColor==="on";gData.forEach(function(g){var yOp=g.yOp||"y";var valueOnPlot=viz[yOp+"ValueOnPlot"];var textAngle=viz["yValueOnPlotTextAngle"];var fontSize=viz["yValueOnPlotFontSize"]||viz._defaultValuesOnPlotFontSize||null;var position=!viz["yValueOnPlotPosition"]||viz["yValueOnPlotPosition"]==="none"?"bottom":viz["yValueOnPlotPosition"];if(valueOnPlot!=="on"){return}else if(g.type!=="bar"){return}else if(showSumValues){return}else if(viz["yValueOnPlotFontAutoAdjust"]==="off"){return}var isForY2Axis=g.yaxis&&/[02468]$/.test(g.yaxis);var yValuePrefix=isForY2Axis?y2ValuePrefix:y1ValuePrefix;var yValueSuffix=isForY2Axis?y2ValueSuffix:y1ValueSuffix;var yValueFormatter=isForY2Axis?formatY2Value:formatY1Value;if(isGroupByMeasuresEnabled&&colMap[g.facet]){yValuePrefix=colMap[g.facet].valuePrefix;yValueSuffix=colMap[g.facet].valueSuffix;yValueFormatter=formatY1Value}var thresholdRatio=yValueSuffix==="%"?100:1;switch(position){case"middle":g.textposition="inside";g.insidetextanchor="middle";break;case"top":g.textposition="inside";g.insidetextanchor="end";break;case"bottom":g.textposition="outside";break}g.textangle=textAngle||"0";var indexes=_findValueOnPlotIndexes(showSumValues?g.stacky||g.y:g.y,g,"y",viz,thresholdRatio);if(!g.x){var idx=0;if(g._orderRow&&g._orderRow[idx]){g.text=[]}else if(!indexes[idx]){g.text=[]}else if(g.y[idx]===0&&!showSumValues){g.text=[]}else{g.text=[yValuePrefix+yValueFormatter(showSumValues?g.stacky[idx]||g.y[idx]:g.y[idx],false)+yValueSuffix]}}else{g.text=g.x.map(function(xval,idx){if(g._orderRow&&g._orderRow[idx]){return null}else if(!indexes[idx]){return null}else if(g.y[idx]===0&&!showSumValues){return null}else{return yValuePrefix+yValueFormatter(showSumValues?g.stacky[idx]||g.y[idx]:g.y[idx],false)+yValueSuffix}})}g.text=g.text.map(function(x){return x==="%"?"":x});if(fontSize){if(!g.textfont){g.textfont={}}g.textfont.size=fontSize}if(useMarkerColor&&g.marker&&g.marker.color&&typeof g.marker.color==="string"){if(!g.textfont){g.textfont={}}g.textfont.color=g.marker.color}})};var _findValueOnPlotIndexes=function(data,trace,opId,options,thresholdValueRatio){if(!data){return null}var target=options[opId+"ValueOnPlotTarget"]||"all";switch(target){case"all":{return data.map(function(){return true})}case"select":{var showMin=options[opId+"ValueOnPlotTargetMin"]==="on";var showMax=options[opId+"ValueOnPlotTargetMax"]==="on";var showFirst=options[opId+"ValueOnPlotTargetFirst"]==="on"&&options.marker!=="radar";var showLast=options[opId+"ValueOnPlotTargetLast"]==="on"&&options.marker!=="radar";var firstIdx=null,lastIdx=null,min=null,max=null;if(showMin){min=Math.min.apply(null,data.filter(function(x){return!VizUtil.isEmpty(x)}))}if(showMax){max=Math.max.apply(null,data)}if(showFirst){data.some(function(d,idx){if(!VizUtil.isEmpty(d)){firstIdx=idx;return true}return false})}if(showLast){for(var i=data.length-1;i>=0;i--){if(!VizUtil.isEmpty(data[i])){lastIdx=i;break}}}return data.map(function(d,idx){if(firstIdx!==null&&idx===firstIdx){return true}else if(lastIdx!==null&&idx===lastIdx){return true}else if(min!==null&&d===min){return true}else if(max!==null&&d===max){return true}else{return false}})}case"threshold":{var rangeType=options[opId+"ValueOnPlotRangeType"]||"gte";var threshold=options[opId+"ValueOnPlotThreshold"]?parseFloat(options[opId+"ValueOnPlotThreshold"])*thresholdValueRatio:null;var lowerThreshold=options[opId+"ValueOnPlotLowerThreshold"]?parseFloat(options[opId+"ValueOnPlotLowerThreshold"])*thresholdValueRatio:null;var upperThreshold=options[opId+"ValueOnPlotUpperThreshold"]?parseFloat(options[opId+"ValueOnPlotUpperThreshold"])*thresholdValueRatio:null;return data.map(function(d){if(VizUtil.isEmpty(d)||typeof d!=="number"){return true}else{if(rangeType==="not-between"){if(lowerThreshold===null&&upperThreshold===null){return false}else if(upperThreshold!==null&&d>=upperThreshold){return true}else if(lowerThreshold!==null&&d<=lowerThreshold){return true}else{return false}}else if(rangeType==="between"){if(lowerThreshold===null&&upperThreshold===null){return true}else if(upperThreshold!==null&&lowerThreshold!==null&&d<=upperThreshold&&d>=lowerThreshold){return true}else if(lowerThreshold===null&&upperThreshold!==null&&d<=upperThreshold){return true}else if(upperThreshold===null&&lowerThreshold!==null&&d>=lowerThreshold){return true}else{return false}}else if(rangeType==="gte"){if(threshold===null){return true}else if(d>=threshold){return true}else{return false}}else if(rangeType==="lte"){if(threshold===null){return true}else if(d<=threshold){return true}else{return false}}}})}case"highlight":{var defaultColor=VizUtil.getHighlightDefaultColor(options);if(options.enableHighlight!=="on"){return data.map(function(){return false})}return data.map(function(v,idx){if(trace&&trace.marker&&trace.marker.color){return trace&&trace.marker&&trace.marker.color!==defaultColor}else if(trace&&trace.marker&&trace.marker.colors&&options.marker==="pie"){return trace.marker.colors[idx]!==defaultColor}else{return false}})}default:{return data.map(function(){return true})}}};PlotlyGraphGenerator._findValueOnPlotIndexes=_findValueOnPlotIndexes;var constructAnnotations=function(gData,marker,xCol,colorCol,facetCol,barStyle,layoutBarmode,numY,y1ValuePrefix,y1ValueSuffix,formatY1Value,y2ValuePrefix,y2ValueSuffix,formatY2Value,viz,colMap){if(!VizUtil.isShowValueOnPlotSupported(marker)){return}var annotationContext=[];var numOfTraces=gData.length;var numOfFacets=1;if(facetCol){var _ht={};gData.forEach(function(g){_ht[g.facet]=true});numOfFacets=Object.keys(_ht).length;numOfTraces=numOfTraces/numOfFacets}var pivot=Math.floor(numOfTraces/2);var delta=.8/numOfTraces;var dateX,offset,res;var isGroupByMeasuresEnabled=facetCol&&facetCol.type===VizUtil.TYPE_GROUP_BY_MEASURES;var showSumValues=VizUtil.isShowSummarizedValueOnPlotSupported(viz.marker,viz.barstyle)&&viz.yValueOnPlotShowSumValues==="on";var useMarkerColor=viz.yValueOnPlotUseMarkerColor==="on";gData.forEach(function(group,gidx){var yOp=group.yOp||"y";var valueOnPlot=viz[yOp+"ValueOnPlot"];var textAngle=!viz["yValueOnPlotTextAngle"]||viz["yValueOnPlotTextAngle"]==="0"?null:viz["yValueOnPlotTextAngle"];var fontSize=viz["yValueOnPlotFontSize"]||viz._defaultValuesOnPlotFontSize||null;var position=viz["yValueOnPlotPosition"]||"bottom";if(position==="middle"||position==="none"){position="bottom"}if(valueOnPlot!=="on"){return}else if(showSumValues&&!group._lastTraceInGroup){return}else if(group.type==="bar"&&viz["yValueOnPlotFontAutoAdjust"]!=="off"&&!showSumValues){return}var isForY2Axis=group.yaxis&&/[02468]$/.test(group.yaxis);var yValuePrefix=isForY2Axis?y2ValuePrefix:y1ValuePrefix;var yValueSuffix=isForY2Axis?y2ValueSuffix:y1ValueSuffix;var yValueFormatter=isForY2Axis?formatY2Value:formatY1Value;var xidx;if(isGroupByMeasuresEnabled&&colMap[group.facet]){yValuePrefix=colMap[group.facet].valuePrefix;yValueSuffix=colMap[group.facet].valueSuffix;yValueFormatter=formatY1Value}var yThresholdRatio=yValueSuffix==="%"?100:1;var stacky=null;if(marker==="bar"&&viz.barstyle!=="group"&&showSumValues&&group.stacky&&group.stacky_pos&&group.stacky_neg){stacky=group.stacky.map(function(v,idx){return v===0?null:group.stacky_sum?group.stacky_sum[idx]:v})}var indexes=_findValueOnPlotIndexes(stacky||group.y,group,"y",viz,yThresholdRatio);if(isGroupedBar(xCol,colorCol,layoutBarmode,group.type,numY)){var traceIdx=numOfFacets===1?gidx:Math.floor(gidx/numOfFacets);if(xCol){var allUnique=isAllUnique(group.x);xidx=-1;annotationContext=annotationContext.concat(group.x.map(function(xval,idx){if(group._orderRow&&group._orderRow[idx]){return null}else{xidx++}offset=traceIdx-pivot;if(numOfTraces%2===0){offset+=.5}var xValue=xidx+offset*delta;if(VizUtil.returnsNumericValue(xCol)&&xCol.func!=="ascategory"){xValue=xval+offset*delta}else if(VizUtil.returnsDateValue(xCol)){dateX=Date.parse(xval.indexOf(" ")===-1?xval+" 00:00:00":xval);var datefunc=allUnique?"":xCol.func;switch(datefunc){case"rtoyear":xValue=dateX+offset*delta*31536e6;break;case"rtoq":xValue=dateX+offset*delta*7776e6;break;case"rtomon":xValue=dateX+offset*delta*2592e6;break;case"rtoweek":xValue=dateX+offset*delta*6048e5;break;case"rtoday":xValue=dateX+offset*delta*864e5;break;case"rtohour":xValue=dateX+offset*delta*36e5;break;case"rtomin":xValue=dateX+offset*delta*6e5;break;case"rtosec":xValue=dateX+offset*delta*1e3;break;default:xValue=dateX+offset*delta;break}}res={x:xValue,y:group.stacky?group.stacky[idx]:group.y[idx],origy:group.y[idx],text:yValuePrefix+yValueFormatter(group.y[idx],false)+yValueSuffix,xanchor:"center",yanchor:position,xref:group.xaxis?group.xaxis:"x",yref:group.yaxis?group.yaxis:"y",showarrow:false};if(textAngle){res.textangle=textAngle}if(fontSize){res.font={size:fontSize}}if(useMarkerColor&&group.marker.color){if(!res.font){res.font={}}res.font.color=group.marker.color}return res}).filter(function(ctx,idx){if(ctx===null||VizUtil.isEmpty(ctx.origy)){return false}if(typeof ctx.origy!=="number"){return true}return indexes[idx]}))}else{offset=traceIdx-pivot;if(numOfTraces%2===0){offset+=.5}var xValue=0+offset*delta;if(indexes[0]){res={x:xValue,y:group.stacky?group.stacky[0]:group.y[0],text:group.y[0]===0?"":yValuePrefix+yValueFormatter(group.y[0],false)+yValueSuffix,xanchor:"center",yanchor:position,xref:group.xaxis?group.xaxis:"x",yref:group.yaxis?group.yaxis:"y",showarrow:false};if(textAngle){res.textangle=textAngle}if(fontSize){res.font={size:fontSize}}if(useMarkerColor&&group.marker.color){if(!res.font){res.font={}}res.font.color=group.marker.color}annotationContext=annotationContext.concat([res])}}}else{if(xCol){xidx=-1;var useXidx=VizUtil.returnsCharacterValue(xCol)||xCol.func==="ascategory";var xAxisVals=null;if(useXidx&&group._orderRow){xAxisVals=[];group._orderRow.some(function(v,i){if(!v){return true}xAxisVals.push(group.x[i]);return false});xAxisVals=VizUtil.makeArrayUnique(xAxisVals)}annotationContext=annotationContext.concat(group.x.map(function(xval,idx){if(group._orderRow&&group._orderRow[idx]){return null}xidx++;res={x:!useXidx?xval:xAxisVals&&xAxisVals.indexOf(xval)>-1?xAxisVals.indexOf(xval):xidx,y:showSumValues&&group.stacky_pos?group.stacky_pos[idx]:group.stacky?group.stacky[idx]:group.y[idx],origy:showSumValues?group.y[idx]||0:group.y[idx],text:showSumValues?yValuePrefix+yValueFormatter(group.stacky_sum?group.stacky_sum[idx]:group.stacky?group.stacky[idx]:group.y[idx],false)+yValueSuffix:group.y[idx]===0?"":yValuePrefix+yValueFormatter(group.y[idx],false)+yValueSuffix,xref:group.xaxis?group.xaxis:"x",yref:group.yaxis?group.yaxis:"y",xanchor:"center",yanchor:position,showarrow:false};if(textAngle){res.textangle=textAngle}if(fontSize){res.font={size:fontSize}}if(useMarkerColor&&group.marker.color){if(!res.font){res.font={}}res.font.color=group.marker.color}return res}).filter(function(ctx,idx){if(ctx===null||VizUtil.isEmpty(ctx.origy)){return false}if(typeof ctx.origy!=="number"){return true}return indexes[idx]}))}else if(group.y&&group.y.length>0){if(indexes[0]){res={x:0,y:showSumValues&&group.stacky_pos?group.stacky_pos[0]:group.stacky?group.stacky[0]:group.y[0],text:showSumValues?yValuePrefix+yValueFormatter(group.stacky_sum?group.stacky_sum[0]:group.stacky?group.stacky[0]:group.y[0],false)+yValueSuffix:group.y[0]===0?"":yValuePrefix+yValueFormatter(group.y[0],false)+yValueSuffix,xanchor:"center",yanchor:position,xref:group.xaxis?group.xaxis:"x",yref:group.yaxis?group.yaxis:"y",showarrow:false};if(textAngle){res.textangle=textAngle}if(fontSize){res.font={size:fontSize}}if(useMarkerColor&&group.marker.color){if(!res.font){res.font={}}res.font.color=group.marker.color}annotationContext=annotationContext.concat([res])}}}});annotationContext=annotationContext.filter(function(x){return!!x});return annotationContext.length===0?null:annotationContext};var constructHeatmapAnnotations=function(gData,viz,formatter,prefix,suffix){var res=null;if(viz.colorValueOnPlot==="on"&&viz.marker==="heatmap"){res=[];gData.forEach(function(g){for(var i=0;i<g.x.length;i++){for(var j=0;j<g.y.length;j++){var currentValue=g.z[j][i];var data={xref:g.xaxis||"x1",yref:g.yaxis||"y1",x:i,y:j,text:VizUtil.isEmpty(currentValue)?"NA":prefix+formatter(currentValue)+suffix,showarrow:false,font:{color:viz.colorValueOnPlotFontColor||"white",size:viz.colorValueOnPlotFontSize||viz._defaultValuesOnPlotFontSize||"12"}};res.push(data)}}})}return res};var isAllUnique=function(arr){var i=0,l=0,v=arr[0];for(i=0,l=arr.length;i<l;i++){if(v!==arr[i]){return false}}return true};var numOfXDataPoints=function(gData){if(!gData){return 0}var o={};gData.forEach(function(g){if(g.x){g.x.forEach(function(x){o[x]=true})}});return Object.keys(o).length+1};var isAllNull=function(arr){var i=0,l=0,isAllNull=true;for(i=0,l=arr.length;i<l;i++){if(arr[i]!==null){isAllNull=false;break}}return isAllNull};var isAllEmpty=function(arr){var i=0,l=0,isAllEmpty=true;for(i=0,l=arr.length;i<l;i++){if(arr[i]!==null&&arr[i]!==undefined){isAllEmpty=false;break}}return isAllEmpty};var isAllNaN=function(arr){var i=0,l=0,isAllNaN=true;for(i=0,l=arr.length;i<l;i++){if(!isNaN(arr[i])){isAllNaN=false;break}}return isAllNaN};var isArray=function(o){return Object.prototype.toString.call(o)==="[object Array]"};var REFLINE_DATA_POINT=30;var consolidateRefLines=function(gReflineLayerData,reflineGroup){var hash={},id=null,d=null;gReflineLayerData.forEach(function(g){id=g.yaxis||"y";d=hash[id];if(!d){hash[id]=g}else{if(g.x&&isArray(g.x)&&d.x){d.x=d.x.concat(g.x)}if(g.y&&isArray(g.y)&&d.y){d.y=d.y.concat(g.y)}if(g.z&&isArray(g.z)&&d.z){d.z=d.z.concat(g.z)}if(g.hovertext&&isArray(g.hovertext)&&d.hovertext){d.hovertext=d.hovertext.concat(g.hovertext)}}});var gData=Object.keys(hash).map(function(key){var g=hash[key];g.visible=true;if(!g.hovertext||g.skipRecalc){return g}if(g.customdata){g.customdata.hovertext=g.hovertext}if(!/xaxis/.test(reflineGroup)){var hovertext="";g.hovertext.forEach(function(t){if(t&&t.length>hovertext.length){hovertext=t}});g.hovertext=hovertext}return g});return gData};var recalculateRefLineData=function(viz,gRefLineLayerData,layout,formatRefLineValueHash){if(!viz.x){return}if(!VizUtil.returnsNumericValue(viz.x)||viz.x.func==="ascategory"){gRefLineLayerData.forEach(function(g){if(!g||!g.x||g.x.length===0||g.skipRecalc){return}var hash={},newx=[],newy=[],newhovertext=[];g.x.forEach(function(xval,idx){if(!VizUtil.isEmpty(xval)){if(!hash[xval]){newx.push(xval);hash[xval]=[]}hash[xval].push({y:g.y[idx],hovertext:g.customdata.hovertext&&g.customdata.hovertext.length>idx?g.customdata.hovertext[idx]:null})}});var yvals,tvals;g.x=newx;g.y=newx.map(function(xval){yvals=hash[xval].filter(function(v){return!VizUtil.isEmpty(v.y)}).map(function(v){return v.y});if(yvals.length>0){return yvals[0]}else{return null}});g.hovertext=newx.map(function(xval){tvals=hash[xval].filter(function(v){return!VizUtil.isEmpty(v.y)}).map(function(v){return v.hovertext});if(tvals.length>0){return tvals[0]}else{return null}});var reflineGroup=viz[(g.customdata?g.customdata.yOp||"y":"y")+"ReflineGroup"];if(viz.facet&&(viz.facetSyncXAxis||VizUtil.getDefaultSyncXAxis(viz.marker))==="off"||/^(xaxis|xaxis\+facet)$/.test(reflineGroup)){newx=[],newy=[],newhovertext=[];g.x.forEach(function(v,idx){if(!VizUtil.isEmpty(g.y[idx])){newx.push(v);newy.push(g.y[idx]);newhovertext.push(g.hovertext[idx])}});g.x=newx;g.y=newy;g.hovertext=newhovertext}if(!/xaxis/.test(reflineGroup)){yvals=g.y.filter(function(v){return!VizUtil.isEmpty(v)});tvals=g.hovertext.filter(function(v){return!VizUtil.isEmpty(v)});if(yvals.length>0){g.y=g.y.map(function(){return yvals[0]});g.hovertext=g.hovertext.map(function(){return tvals[0]})}}})}else{gRefLineLayerData.forEach(function(g){if(!g||!g.x||g.x.length===0||g.skipRecalc){return}if(/xaxis/.test(viz[(g.customdata?g.customdata.yOp||"y":"y")+"ReflineGroup"])){var vals=[];g.x.forEach(function(x,idx){if(!VizUtil.isEmpty(x)&&!VizUtil.isEmpty(g.y[idx])){vals.push({x:x,y:g.y[idx],ht:g.hovertext[idx]})}});vals.sort(function(a,b){return a.x-b.x});var newx=[],newy=[],newht=[],prevx=null;vals.forEach(function(val){if(prevx!==val.x){newx.push(val.x);newy.push(val.y);newht.push(val.ht);prevx=val.x}});g.x=newx;g.y=newy;g.hovertext=newht;return}var range;var targetXProp=g.xaxis?g.xaxis.replace(/^x/,"xaxis"):"xaxis";if(/^(bar$|errbar)/.test(viz.marker)&&viz.orientation==="horizontal"){targetXProp=targetXProp.replace("xaxis","yaxis")}if(g.xaxis&&layout[targetXProp].range){range=layout[targetXProp].range}else if(!viz.facet&&layout.xaxis.range){range=layout.xaxis.range}else{range=d3.extent(g.x);range[0]=range[0]-Math.abs(range[1]-range[0])*.04;range[1]=range[1]+Math.abs(range[1]-range[0])*.04}g._range=range});var facetHash={};gRefLineLayerData.forEach(function(g){if(!g._range){return}var key=g.yaxis||"";if(!facetHash[key]){facetHash[key]=g._range}else{facetHash[key]=d3.extent(facetHash[key].concat(g._range))}});gRefLineLayerData.forEach(function(g){var key=g.yaxis||"";if(!facetHash[key]){return}var range=facetHash[key];var isDiagonal=g.customdata&&g.customdata.type==="diagonal";var step=Math.abs(range[1]-range[0])/100;var x=[],y=[],hovertext=[],yval=null,tval=null,i;for(i=0;i<g.x.length;i++){if(g.x[i]!==null&&g.y[i]!==null){yval=g.y[i];tval=g.customdata.hovertext&&g.customdata.hovertext.length>i?g.customdata.hovertext[i]:null;break}}for(i=0;i<100;i++){x.push(range[0]+step*i);y.push(isDiagonal?range[0]+step*i:yval);if(!isDiagonal){hovertext.push(tval)}}g.x=x;g.y=y;if(!isDiagonal){g.hovertext=hovertext}delete g._range})}gRefLineLayerData.forEach(function(g){delete g.customdata.hovertext;if(g.skipRecalc){return}var isDiagonal=g.customdata&&g.customdata.type==="diagonal";if(!isDiagonal){return}var yOp=g.customdata?g.customdata.yOp||"y":"y";var formatter=formatRefLineValueHash[yOp].formatter;var prefix=formatRefLineValueHash[yOp].prefix;var suffix=formatRefLineValueHash[yOp].suffix;var hideValueFromBalloon=formatRefLineValueHash[yOp].hideValueFromBalloon;g.hovertext=g.y.map(function(v){if(hideValueFromBalloon){return g.name||""}return(g.name?g.name+": ":"")+prefix+formatter(v)+suffix})})};var recalculateVRefLineData=function(viz,gVRefLineLayerData,layout,formatVRefLineValueHash,colsOn2ndAxis){if(!viz.y){return}if(!VizUtil.returnsNumericValue(viz.y)||viz.y.func==="ascategory"){gVRefLineLayerData.forEach(function(g){if(!g||!g.y||g.y.length===0||g.skipRecalc){return}var hash={},newx=[],newy=[],newhovertext=[];g.y.forEach(function(yval,idx){if(!VizUtil.isEmpty(yval)){if(!hash[yval]){newy.push(yval);hash[yval]=[]}hash[yval].push({x:g.x[idx],hovertext:g.customdata.hovertext&&g.customdata.hovertext.length>idx?g.customdata.hovertext[idx]:null})}});var xvals,tvals;g.y=newy;g.x=newy.map(function(yval){xvals=hash[yval].filter(function(v){return!VizUtil.isEmpty(v.x)}).map(function(v){return v.x});if(xvals.length>0){return xvals[0]}else{return null}});g.hovertext=newy.map(function(yval){tvals=hash[yval].filter(function(v){return!VizUtil.isEmpty(v.x)}).map(function(v){return v.hovertext});if(tvals.length>0){return tvals[0]}else{return null}});var isGroupByMeasuresEnabled=viz.facet&&viz.facet.type===VizUtil.TYPE_GROUP_BY_MEASURES;if(viz.facet&&(viz.facetSyncYAxis||VizUtil.getDefaultSyncYAxis(viz.marker,isGroupByMeasuresEnabled))==="off"){newx=[],newy=[],newhovertext=[];g.y.forEach(function(v,idx){if(!VizUtil.isEmpty(g.x[idx])){newx.push(g.x[idx]);newy.push(v);newhovertext.push(g.hovertext[idx])}});g.x=newx;g.y=newy;g.hovertext=newhovertext}if(!/yaxis/.test(viz.xReflineGroup)){xvals=g.x.filter(function(v){return!VizUtil.isEmpty(v)});tvals=g.hovertext.filter(function(v){return!VizUtil.isEmpty(v)});if(xvals.length>0){g.x=g.x.map(function(){return xvals[0]});g.hovertext=g.hovertext.map(function(){return tvals[0]})}}})}else{gVRefLineLayerData.forEach(function(g){if(!g||!g.y||g.y.length===0||g.skipRecalc){return}if(/yaxis/.test(viz.xReflineGroup)){return}var range;var targetYProp=g.yaxis?g.yaxis.replace(/^y/,"yaxis"):"yaxis";if(/^(bar$|errbar)/.test(viz.marker)&&viz.orientation==="horizontal"){targetYProp=targetYProp.replace("yaxis","xaxis")}if(g.yaxis&&layout[targetYProp].range){range=layout[targetYProp].range;var rext=d3.extent(g.y);if(/^(bar|errbar)$/.test(viz.marker)){if(rext[0]<=0&&rext[1]<=0){range[1]=0}else if(rext[0]>=0&&rext[1]>=0){range[0]=0}}}else if(!viz.facet&&layout.yaxis.range){range=layout.yaxis.range}else{var includeZero=false;if(viz.yAxisIncludeZero){includeZero=viz.yAxisIncludeZero==="on"}else{includeZero=!/^(scatter|bubble)$/.test(viz.marker)}range=includeZero?d3.extent([0].concat(g.stackyExt||g.y)):d3.extent(g.stackyExt||g.y);range[1]=range[1]+Math.abs(range[1]-range[0])*.04}if(viz.marker==="hist"){range[0]=0;if(viz.histBarStyle==="stack"){range[1]=100}}g._range=range});var facetHash={};gVRefLineLayerData.forEach(function(g){if(!g._range){return}var key=g.xaxis||"";if(!facetHash[key]){facetHash[key]=g._range}else{facetHash[key]=d3.extent(facetHash[key].concat(g._range))}});gVRefLineLayerData.forEach(function(g){var key=g.xaxis||"";if(!facetHash[key]){return}var range=facetHash[key];var step=Math.abs(range[1]-range[0])/100;var x=[],y=[],hovertext=[],xval=null,tval=null,i;for(i=0;i<g.y.length;i++){if(g.x[i]!==null&&g.y[i]!==null){xval=g.x[i];tval=g.customdata.hovertext&&g.customdata.hovertext.length>i?g.customdata.hovertext[i]:null;break}}for(i=0;i<100;i++){x.push(xval);y.push(range[0]+step*i);hovertext.push(tval)}g.x=x;g.y=y;g.hovertext=hovertext;delete g._range})}gVRefLineLayerData.forEach(function(g){delete g.customdata.hovertext;if(Object.keys(g.customdata).length===0&&!Array.isArray(g.customdata)){delete g.customdata}})};var adjustYAxisRangeForVRefLine=function(viz,gVRefLineLayerData,layout,colsOn2ndAxis){if(!viz.y||!colsOn2ndAxis||colsOn2ndAxis.length===0||!VizUtil.returnsNumericValue(viz.y)||viz.y.func==="ascategory"||viz.marker!=="bar"){return}gVRefLineLayerData.forEach(function(g){var targetYProp=g.yaxis?g.yaxis.replace(/^y/,"yaxis"):"yaxis";if(viz.orientation==="horizontal"){targetYProp=targetYProp.replace("yaxis","xaxis")}if(!layout[targetYProp].range){layout[targetYProp].range=d3.extent(g.y)}})};var calculateStackBarRanges=function(viz,gData,gVRefLineLayerData){var _ht={},stacky,stackyExt;if(viz.facet){gData.forEach(function(g){if(!_ht[g.facet]){_ht[g.facet]=[]}_ht[g.facet].push(g)});Object.keys(_ht).forEach(function(key){var group=_ht[key];calculateStackedYValue(group);stacky=group.map(function(d){return d.stacky});stackyExt=d3.extent(d3.merge(stacky));group.stackyExt=stackyExt});gVRefLineLayerData.forEach(function(g){if(_ht[g.facet]&&_ht[g.facet].stackyExt){g.stackyExt=_ht[g.facet].stackyExt}})}else{calculateStackedYValue(gData);stacky=gData.map(function(d){return d.stacky});stackyExt=d3.extent(d3.merge(stacky));gVRefLineLayerData.forEach(function(d){d.stackyExt=stackyExt})}};var recalculateDiagonalRefLineData=function(reflineGroup){if(!reflineGroup||reflineGroup.customdata.type!=="diagonal"){return reflineGroup}var xrange=d3.extent(reflineGroup.x);var yrange=d3.extent(reflineGroup.y);xrange[0]=xrange[0]-Math.abs(xrange[1]-xrange[0])*.04;xrange[1]=xrange[1]+Math.abs(xrange[1]-xrange[0])*.04;var step=Math.abs(xrange[1]-xrange[0])/100;var x=[],y=[],v;for(var i=0;i<100;i++){v=xrange[0]+step*i;x.push(v);y.push(v)}reflineGroup.x=x;reflineGroup.y=y};var addRefLineAnnotations=function(option,viz,gRefLineLayerData,layout){gRefLineLayerData.forEach(function(g){if(g.x.length===0||isAllEmpty(g.y)||isAllNaN(g.y)){return}if(!g._annotationData&&option==="x"&&viz.xReflineType==="constant"&&viz.xReflineLabelOnPlotArea){var d={_constant:g.x[g.x.length-1],_position:g.y[g.y.length-1]};if(viz.xReflineLabelOnPlotArea==="label"){d.text=g.name}else{d.text=g.hovertext[0]}g._annotationData=[d]}if(g._annotationData){if(!layout.annotations){layout.annotations=[]}var data=g._annotationData.map(function(x){if(option.startsWith("x")){x.x=x._constant;x.y=x._position;x.showarrow=false;x.xref=g.xaxis||"x";x.yref=g.yaxis||"y";x.yanchor="top";x.xanchor="right";x.font={color:g.line.color||null};x.xshift=-5;x._type="vrefline";if(viz.xReflineLabelOnPlotAreaFontSize){x.font.size=viz.xReflineLabelOnPlotAreaFontSize}return x}else{return null}}).filter(function(x){return!!x});layout.annotations=layout.annotations.concat(data)}})};PlotlyGraphGenerator._organizeConstantRangeData=function(gRangeData,syncXAxis){if(!gRangeData||gRangeData.length===0){return gRangeData}var res=[];var ht={};gRangeData.forEach(function(g){if(g){if(g.customdata&&g.customdata.type==="constant"){var key=(g.customdata.isMultiY?g.name:"")+(syncXAxis?"":g.xaxis||"");if(!ht[key]){ht[key]=[]}ht[key].push(g)}}});Object.values(ht).forEach(function(gs){var x=[],y=[];gs.forEach(function(g){x=x.concat(g.x);y=y.concat(g.y)});var extx=d3.extent(x),exty=d3.extent(y);if(extx&&!VizUtil.isEmpty(extx[0])&&!VizUtil.isEmpty(extx[1])&&exty&&!VizUtil.isEmpty(exty[0])&&!VizUtil.isEmpty(exty[1])){gs.forEach(function(g){g.customdata.extx=extx;g.customdata.exty=exty})}});ht={};gRangeData.forEach(function(g){if(g){if(g.customdata&&g.customdata.type==="constant"){var key=(g.customdata.isMultiY?g.name:"")+(g.xaxis||"");if(!ht[key]){ht[key]=[]}ht[key].push(g)}else{res.push(g)}}});Object.values(ht).forEach(function(gs){var extx=gs[0].customdata.extx,exty=gs[0].customdata.exty;if(extx&&exty){var newx=[extx[0],extx[1],extx[1],extx[0],extx[0]];var newy=[exty[0],exty[0],exty[1],exty[1],exty[0]];var newg={x:newx,y:newy,fill:"tozerox",fillcolor:VizUtil.hexToRgba("#A6AAA9",.15),line:{color:"transparent"},name:gs[0].name,showlegend:false,type:"scatter",hoverinfo:"skip"};if(gs[0].xaxis){newg.xaxis=gs[0].xaxis}if(gs[0].yaxis){newg.yaxis=gs[0].yaxis}res.push(newg)}});return res};PlotlyGraphGenerator._constructConstantReferenceLineData=function(option,viz,gData,formatRefLineValueHash,translateColumn){if(viz[option+"ReflineType"]!=="constant"){return null}var color=viz[option+"ReflineColor"]||"#A6AAA9",width=viz[option+"ReflineWidth"]||1,style=viz[option+"ReflineStyle"]||"solid",formatter=formatRefLineValueHash[option].formatter,prefix=formatRefLineValueHash[option].prefix,suffix=formatRefLineValueHash[option].suffix,hideValueFromBalloon=formatRefLineValueHash[option].hideValueFromBalloon,hideFromLegend=formatRefLineValueHash[option].hideFromLegend,constantValueFromColumn=viz[option+"ReflineConstantColumn"],constantValueFromColumnExtraTarget=viz[option+"ReflineConstantColumnExtraTarget"],constantValueFromColumnExtraTargetLabel=translateColumn(viz[option+"ReflineConstantColumnExtraTargetLabel"]),showLabelOnPlotArea=viz[option+"ReflineLabelOnPlotArea"]||"",axisRange=option.startsWith("x")&&viz["yAxisRange"]?viz["yAxisRange"].split(",").map(function(x){return parseFloat(x)}):null,axisIncludeZero=VizUtil.getAxisIncludeZero(viz,option),id,d,hash={},globalRange={x:[],y:[],z:[]},syncAxis,legendgroup,isNumeric;var isDateConstant=VizUtil.returnsDateValue(viz[option]);var constantValuesStr=isDateConstant?viz[option+"ReflineConstantDate"]:viz[option+"ReflineConstant"];if(!constantValueFromColumn&&(!constantValuesStr||constantValuesStr.indexOf(",")===-1)){return null}var constantLabelsStr="";if(viz[option+"ReflineLabel"]){constantLabelsStr=VizUtil.getMessage(PlotlyGraphGenerator._lang,viz[option+"ReflineLabel"])}if(!isDateConstant&&!VizUtil.isReferenceLineConstantValuesValid(constantValuesStr)){return[]}var constantValues=constantValuesStr.split(",").map(function(x){return x.trim()}).filter(function(x){return!!x});if(!isDateConstant){constantValues=constantValues.map(function(x){return parseFloat(x)}).filter(function(x){return!isNaN(x)})}var _constantLabels=constantLabelsStr.split(",").map(function(x){return x.trim()}).filter(function(x){return!!x});if(_constantLabels.length===0){_constantLabels.push("")}var constantLabels=constantValues.map(function(x,idx){if(_constantLabels.length>idx){return _constantLabels[idx]}else{return _constantLabels[0]}});if(option.startsWith("x")){syncAxis=viz.facetSyncYAxis!=="off";legendgroup="vrefline";isNumeric=/^(hist|densityplot)$/.test(viz.marker)||VizUtil.returnsNumericValue(viz.y)&&viz.y.func!=="ascategory"}else{syncAxis=viz.facetSyncXAxis!=="off";legendgroup="refline";isNumeric=VizUtil.returnsNumericValue(viz.x)&&viz.x.func!=="ascategory"}gData.forEach(function(g){id=g.facet||"y";d=hash[id];if(!d){d={x:[],y:[],z:[]};hash[id]=d}if(g.use2ndAxis){return}if(g.x&&isArray(g.x)&&d.x){if(isNumeric){d.x=d.x.concat(g.x);globalRange.x=globalRange.x.concat(g.x)}else{d.x=g.x;globalRange.x=g.x}}if(g.y&&isArray(g.y)&&d.y){if(isNumeric){d.y=d.y.concat(g.stacky||g.y);globalRange.y=globalRange.y.concat(g.stacky||g.y)}else{d.y=g.y;globalRange.y=g.y}}if(g.z&&isArray(g.z)&&d.z){if(isNumeric){d.z=d.z.concat(g.z);globalRange.z=globalRange.z.concat(g.z)}else{d.z=g.z;globalRange.z=g.z}}});var gReflineData=gData.map(function(g){var id=g.facet||"y",value=hash[id],data,variableData=[],constantData=[],labelData=[],annotationData=[],_constantValues=viz[constantValueFromColumn]&&!VizUtil.isEmpty(g.constantValues)?g.constantValues:constantValues,_constantExtraValues=constantValueFromColumnExtraTarget&&viz[constantValueFromColumnExtraTarget]&&!VizUtil.isEmpty(g.constantExtraValues)?g.constantExtraValues:null,emptyLayer={showlegend:false,visible:false,mode:"lines",skipRecalc:true,customdata:[],x:[],y:[],z:[]};hash[id]=null;if(!value){return emptyLayer}if(axisRange){data=axisRange}else{if(option.startsWith("x")){data=syncAxis?globalRange.y:value.y}else{data=syncAxis?globalRange.x:value.x}if(axisIncludeZero&&isNumeric){data.push(0)}}if(isAllEmpty(data)){return emptyLayer}if(isNumeric){var range=d3.extent(data);var rangeWidth=Math.abs(range[1]-range[0]);if(!axisRange){if(option.startsWith("y")){range[0]=range[0]-rangeWidth*.04}range[1]=range[1]+rangeWidth*.04}var step=Math.abs(range[1]-range[0])/REFLINE_DATA_POINT;_constantValues.forEach(function(constantValue,idx){for(var i=0;i<=REFLINE_DATA_POINT;i++){variableData.push(range[0]+step*i);constantData.push(constantValue);var labelText=hideValueFromBalloon?constantLabels[idx]:(constantLabels[idx]?constantLabels[idx]+": ":"")+constantValue;if(_constantExtraValues&&_constantExtraValues.length>idx){labelText+="<br>"+(hideValueFromBalloon?constantValueFromColumnExtraTargetLabel:(constantValueFromColumnExtraTargetLabel?constantValueFromColumnExtraTargetLabel+": ":"")+_constantExtraValues[idx])}labelData.push(labelText)}if(showLabelOnPlotArea){annotationData.push({text:showLabelOnPlotArea==="label"?constantLabels[idx]:(constantLabels[idx]?constantLabels[idx]+": ":"")+constantValue,_constant:constantValue,_position:range[1]})}variableData.push(null);constantData.push(null);labelData.push(null)})}else{var newData=VizUtil.makeArrayUnique(data);_constantValues.forEach(function(constantValue,idx){newData.forEach(function(x){variableData.push(x);constantData.push(constantValue);labelData.push(hideValueFromBalloon?constantLabels[idx]:(constantLabels[idx]?constantLabels[idx]+": ":"")+constantValue)});if(showLabelOnPlotArea){annotationData.push({text:showLabelOnPlotArea==="label"?constantLabels[idx]:(constantLabels[idx]?constantLabels[idx]+": ":"")+constantValue,_constant:constantValue,_position:variableData[variableData.length-1]})}variableData.push(null);constantData.push(null);labelData.push(null)})}var graphLayer={line:{color:color,width:width,dash:style},name:constantLabelsStr,legendgroup:legendgroup,visible:true,mode:"lines",hoverinfo:"text",hovertext:labelData,customdata:[],_annotationData:annotationData,skipRecalc:true};if(option.startsWith("x")){graphLayer.x=constantData;graphLayer.y=variableData}else{graphLayer.x=variableData;graphLayer.y=constantData}if(hideFromLegend){graphLayer.showlegend=false}return graphLayer});return gReflineData};var getCorrespondingYAxis=function(yaxis,isFacet){var idx=!yaxis||yaxis==="y"?1:parseInt(yaxis.replace("y",""));if(idx===2&&!isFacet){return"y"}else{return"y"+(idx%2===0?idx-1:idx+1)}};var newPlot=function(elem,gData,layout,config){try{Plotly.newPlot(elem,gData,layout,config)}catch(e){e.graphData={data:gData,layout:layout,config:config};throw e}};PlotlyGraphGenerator._syncZeroLines=function(y1Range,y2Range){if(!y1Range||!y2Range){return[y1Range,y2Range]}var y1Min=y1Range[0],y1Max=y1Range[1],y2Min=y2Range[0],y2Max=y2Range[1],y1Width=y1Max-y1Min,y2Width=y2Max-y2Min,newY1Min=y1Min,newY1Max=y1Max,newY2Min=y2Min,newY2Max=y2Max,y1AboveZeroRatio=null,y2AboveZeroRatio=null,y1WidthRatio=null,y2WidthRatio=null;if(y1Min<0&&y1Max>0){y1AboveZeroRatio=y1Max/y1Width;y2AboveZeroRatio=y2Max<0?0:y2Max/y2Width;if(y2AboveZeroRatio<y1AboveZeroRatio){newY2Max=Math.abs(y1Max*y2Min/y1Min)}else{newY2Min=-Math.abs(y1Min*y2Max/y1Max)}}else if(y2Min<0&&y2Max>0){y1AboveZeroRatio=y1Max<0?0:y1Max/y1Width;y2AboveZeroRatio=y2Max/y2Width;if(y1AboveZeroRatio<y2AboveZeroRatio){newY1Max=Math.abs(y2Max*y1Min/y2Min)}else{newY1Min=-Math.abs(y2Min*y1Max/y2Max)}}else{if(y1Min>=0&&y2Max<=0||y1Max<=0&&y2Min>=0){newY1Max=newY2Max=Math.max(y1Max,y2Max);newY1Min=newY2Min=Math.min(y1Min,y2Min)}else if(y1Min>=0&&y2Min>=0){y1WidthRatio=y1Width/y1Max;y2WidthRatio=y2Width/y2Max;if(y1WidthRatio<y2WidthRatio){if(y2Min===0){newY1Min=0}else{newY1Max=y2Max*y1Min/y2Min}}else{if(y1Min===0){newY2Min=0}else{newY2Max=y1Max*y2Min/y1Min}}}else if(y1Max<=0&&y2Max<=0){y1WidthRatio=Math.abs(y1Width/y1Min);y2WidthRatio=Math.abs(y2Width/y2Min);if(y1WidthRatio<y2WidthRatio){if(y2Max===0){newY1Max=0}else{newY1Min=y1Max*y2Min/y2Max}}else{if(y1Max===0){newY2Max=0}else{newY2Min=y2Max*y1Min/y1Max}}}}return[[newY1Min,newY1Max],[newY2Min,newY2Max]]};PlotlyGraphGenerator._convertGraphDataForScatterLineGroupedByLabel=function(gData){gData.forEach(function(d){if(!d._label||!(d.text||d.hovertext)||!/^lines/.test(d.mode)){return}var hash={},i=0,label;for(i=0;i<d._label.length;i++){label=d._label[i];if(!hash[label]){hash[label]={x:[null],y:[null],z:[null],text:[null],hovertext:[null]}}if(d.text){hash[label].text.push(d.text[i])}if(d.hovertext){hash[label].hovertext.push(d.hovertext[i])}if(d.x){hash[label].x.push(d.x[i])}if(d.y){hash[label].y.push(d.y[i])}if(d.z){hash[label].z.push(d.z[i])}}var x=[],y=[],z=[],text=[],hovertext=[];Object.keys(hash).forEach(function(key){x=x.concat(hash[key].x);y=y.concat(hash[key].y);z=z.concat(hash[key].z);if(d._multiYAndColor){text=text.concat(hash[key].text.map(function(d,idx,arr){return idx===arr.length-1?d:d===null?null:""}));hovertext=hovertext.concat(hash[key].hovertext.map(function(d,idx,arr){return idx===arr.length-1?d:d===null?null:""}))}else{text=text.concat(hash[key].text);hovertext=hovertext.concat(hash[key].hovertext)}});if(d.text){d.text=text}if(d.hovertext){d.hovertext=hovertext}if(d.x){d.x=x}if(d.y){d.y=y}if(d.z){d.z=z}})};PlotlyGraphGenerator._removeNAValues=function(gData,viz){gData.forEach(function(g){if(!g.yOp){return}if(g.y&&viz[g.yOp+"RemoveNAValues"]){PlotlyGraphGenerator._removeNAValuesFromGraphData(g)}})};PlotlyGraphGenerator._removeNAValuesFromGraphData=function(g){var x=[],y=[],hovertext=[],customdata=[],size=[],errhigh=[],errlow=[];g.y.forEach(function(v,idx){if(!VizUtil.isEmpty(v)||g._orderRow&&g._orderRow[idx]){if(g.x&&idx<g.x.length){x.push(g.x[idx])}if(g.y&&idx<g.y.length){y.push(g.y[idx])}if(g.hovertext&&idx<g.hovertext.length){hovertext.push(g.hovertext[idx])}if(g.customdata&&idx<g.customdata.length){customdata.push(g.customdata[idx])}if(g.marker&&g.marker.size&&Array.isArray(g.marker.size)&&idx<g.marker.size.length){size.push(g.marker.size[idx])}if(g.error_y&&g.error_y.array&&idx<g.error_y.array.length){errhigh.push(g.g.error_y.array[idx])}if(g.error_y&&g.error_y.arrayminus&&idx<g.error_y.arrayminus.length){errlow.push(g.g.error_y.arrayminus[idx])}}});g.x=x;g.y=y;g.hovertext=hovertext;g.customdata=customdata;if(g.marker&&g.marker.size&&Array.isArray(g.marker.size)){g.marker.size=size}if(g.error_y&&g.error_y.array){g.error_y.array=errhigh}if(g.error_y&&g.error_y.arrayminus){g.error_y.arrayminus=errlow}};PlotlyGraphGenerator._sortGraphDataByHighlight=function(gData,scale,isReversed,sortHighlightLast){if(!scale.isHighlightColorScale){return}gData.forEach(function(g,idx,orgArr){var v=scale.getOrderByColor(Array.isArray(g.marker.color)?g.marker.color[0]:g.marker.color);g.__sortIdx=v===0?idx:sortHighlightLast?orgArr.length+v:-v;g.__sortOrgIdx=idx});gData.sort(function(a,b){if(b.__sortIdx===a.__sortIdx){return isReversed?b.__sortOrgIdx-a.__sortOrgIdx:a.__sortOrgIdx-b.__sortOrgIdx}return isReversed?b.__sortIdx-a.__sortIdx:a.__sortIdx-b.__sortIdx});gData.forEach(function(g){delete g.__sortIdx;delete g.__sortOrgIdx})};PlotlyGraphGenerator._removeRowsForOrder=function(gData){gData.forEach(function(g){g.showlegend=false;if(g._orderRow){var x=[],y=[],hovertext=[],text=[],customdata=[],size=[],errhigh=[],errlow=[];g._orderRow.forEach(function(v,idx){if(!v){if(g.x&&idx<g.x.length){x.push(g.x[idx])}if(g.y&&idx<g.y.length){y.push(g.y[idx])}if(g.text&&idx<g.text.length){text.push(g.text[idx])}if(g.hovertext&&idx<g.hovertext.length){hovertext.push(g.hovertext[idx])}if(g.customdata&&idx<g.customdata.length){customdata.push(g.customdata[idx])}if(g.marker&&g.marker.size&&Array.isArray(g.marker.size)&&idx<g.marker.size.length){size.push(g.marker.size[idx])}if(g.error_y&&g.error_y.array&&idx<g.error_y.array.length){errhigh.push(g.g.error_y.array[idx])}if(g.error_y&&g.error_y.arrayminus&&idx<g.error_y.arrayminus.length){errlow.push(g.g.error_y.arrayminus[idx])}}});g.x=x;g.y=y;g.hovertext=hovertext;g.text=text;g.customdata=customdata;if(g.marker&&g.marker.size&&Array.isArray(g.marker.size)){g.marker.size=size}if(g.error_y&&g.error_y.array){g.error_y.array=errhigh}if(g.error_y&&g.error_y.arrayminus){g.error_y.arrayminus=errlow}}})};PlotlyGraphGenerator._unsyncAxis=function(gData,axis,existOrderRowOnAxis){var vaxis=axis==="x"?"y":"x",i,facets={};gData.forEach(function(g){if(!facets[g.facet]){facets[g.facet]=[]}facets[g.facet].push(g)});Object.keys(facets).forEach(function(facetName){var groups=facets[facetName];var hash={};groups.forEach(function(g){if(g[axis]&&g[axis].length>0){g[axis].forEach(function(t,idx){if(!VizUtil.isEmpty(g[vaxis][idx])){hash[t]=true}})}});groups.forEach(function(g){i=0;if(g[axis]&&g[axis].length>0){while(i<g[axis].length){if(!hash[g[axis][i]]&&(existOrderRowOnAxis||(!g._orderRow||i<g._orderRow.length&&g._orderRow[i]===false))){g[axis].splice(i,1);if(g[vaxis]&&isArray(g[vaxis])&&i<g[vaxis].length){g[vaxis].splice(i,1)}if(g.hovertext&&isArray(g.hovertext)&&i<g.hovertext.length){g.hovertext.splice(i,1)}if(g.marker&&g.marker.size&&isArray(g.marker.size)&&i<g.marker.size.length){g.marker.size.splice(i,1)}if(g.customdata&&isArray(g.customdata)&&i<g.customdata.length){g.customdata.splice(i,1)}if(g.text&&isArray(g.text)&&i<g.text.length){g.text.splice(i,1)}if(g._label&&isArray(g._label)&&i<g._label.length){g._label.splice(i,1)}if(g.error_y&&g.error_y.array&&isArray(g.error_y.array)&&i<g.error_y.array.length){g.error_y.array.splice(i,1)}if(g.error_y&&g.error_y.arrayminus&&isArray(g.error_y.arrayminus)&&i<g.error_y.arrayminus.length){g.error_y.arrayminus.splice(i,1)}}else{i++}}}})})};PlotlyGraphGenerator._createOrderControlLayer=function(data,viz,colorScale){var res=[];var xarr=[],yarr=[],farr=[],carr=[];data.forEach(function(d){xarr.push(d[viz.x.validLabel]);yarr.push(d[viz.y.validLabel]);if(viz.facet){farr.push(d[viz.facet.validLabel])}if(viz.color){carr.push(viz.colorbucket?d[viz.colorbucket.validLabel]:d[viz.color.validLabel])}});xarr=VizUtil.makeArrayUnique(xarr);yarr=VizUtil.makeArrayUnique(yarr);farr=VizUtil.makeArrayUnique(farr);carr=VizUtil.makeArrayUnique(carr);var xext=[],yext=[];xarr.forEach(function(xval){yarr.forEach(function(yval){xext.push(xval);yext.push(yval)})});var zeroext=xext.map(function(){return 0});var nullext=xext.map(function(){return null});if(farr.length===0){if(carr.length>0){carr.forEach(function(colorVal,cidx){res.push({mode:"markers",name:colorVal,showlegend:true,legendgroup:"lg"+(cidx+1),x:xext,y:yext,marker:{size:zeroext,color:colorScale(colorVal)},hoverinfo:"skip"})})}else{res.push({mode:"markers",name:"",showlegend:false,x:xext,y:yext,marker:{size:zeroext,color:colorScale(viz.y?viz.y.validLabel:VALUE_FOR_NO_COLOR)},hoverinfo:"skip"})}}else{farr.forEach(function(facet,idx){if(carr.length>0){carr.forEach(function(colorVal,cidx){res.push({mode:"markers",name:colorVal,showlegend:idx===0,legendgroup:"lg"+colorVal,x:xext,y:yext,xaxis:"x"+(idx*2+1),yaxis:"y"+(idx*2+1),marker:{size:zeroext,color:colorScale(colorVal)},hoverinfo:"skip"})})}else{res.push({mode:"markers",name:"",showlegend:false,x:xext,y:yext,xaxis:"x"+(idx*2+1),yaxis:"y"+(idx*2+1),marker:{size:zeroext,color:colorScale(viz.y?viz.y.validLabel:VALUE_FOR_NO_COLOR)},hoverinfo:"skip"})}})}return res};var useOverlayMode=function(x,color,facet,marker){return!x&&!color||!x&&color&&marker==="violin"||x&&color&&x.name===color.name||x&&!color&&facet||color&&facet&&color.name===facet.name};var calculateRange=function(gData,targetProp,axisScale,showZero,isNumeric,isDate,marker,needRangeCalcForValueOnPlot,isFacet,errbarGraph,color,isMultiY,rangeTarget,topMarginRatio,bottomMarginRatio){if(targetProp==="x"&&marker==="bar"){return null}if(targetProp==="x"&&/^(line|area)$/.test(marker)&&!(isNumeric||isDate)){return null}rangeTarget=rangeTarget||"all";var dataArr=[];gData.forEach(function(d){if(rangeTarget==="y1"&&d.use2ndAxis){return}else if(rangeTarget==="y2"&&!d.use2ndAxis){return}if(d[targetProp]){dataArr=dataArr.concat(d[targetProp])}if(targetProp==="y"&&d.stacky&&Array.isArray(d.stacky)){dataArr=dataArr.concat(d.stacky)}if(targetProp==="y"&&d.error_y&&d.error_y.array&&d.error_y.array.length===d[targetProp].length){d[targetProp].forEach(function(v,idx){if(VizUtil.isEmpty(v,true)){return}dataArr.push(v+d.error_y.array[idx]);if(d.error_y.arrayminus){dataArr.push(v-d.error_y.arrayminus[idx])}else{dataArr.push(v-d.error_y.array[idx])}})}});if(isDate){dataArr=dataArr.map(function(d){return Date.parse(d)})}if(showZero&&!isDate){dataArr.push(0)}var ext=d3.extent(dataArr);if(!ext||ext.length!==2||typeof ext[0]!=="number"||typeof ext[1]!=="number"){return null}var _topMarginRatio=.17;var _bottomMarginRatio=.17;if(targetProp!=="x"&&/^(bar)$/.test(marker)){_bottomMarginRatio=.04}if(targetProp!=="x"&&/^(errbar|errbar-agg)$/.test(marker)&&errbarGraph==="bar"){_bottomMarginRatio=.04}if(targetProp!=="x"&&/^(hist)$/.test(marker)){_bottomMarginRatio=0}if(targetProp!=="x"&&/^(area|line|densityplot)$/.test(marker)){_topMarginRatio=.04;_bottomMarginRatio=.04}if(targetProp!=="x"&&ext[0]>=0&&ext[1]>=0&&(/^(bar|area|line|densityplot|hist)$/.test(marker)||/^(errbar|errbar-agg)$/.test(marker)&&errbarGraph==="bar")){_bottomMarginRatio=0}if(targetProp==="y"&&needRangeCalcForValueOnPlot){_topMarginRatio+=_topMarginRatio<.1?.07:.04}if(targetProp==="x"&&/^(line|area)$/.test(marker)){_topMarginRatio=.01;_bottomMarginRatio=.01}if(marker=="radar"){_topMarginRatio=0;_bottomMarginRatio=0}if(targetProp==="y"&&marker==="boxplot"){_topMarginRatio=.04;_bottomMarginRatio=.04}if(topMarginRatio&&_topMarginRatio<topMarginRatio){_topMarginRatio=topMarginRatio}if(bottomMarginRatio&&_bottomMarginRatio<bottomMarginRatio){_bottomMarginRatio=bottomMarginRatio}var dataRange=Math.abs(ext[1]-ext[0]);ext[0]=ext[0]-dataRange*_bottomMarginRatio;ext[1]=ext[1]+dataRange*_topMarginRatio;if(axisScale==="log"){ext[0]=Math.log10(Math.max(0,ext[0]));ext[1]=Math.log10(Math.max(0,ext[1]))}return ext};PlotlyGraphGenerator._convertLinesMode=function(gData,layout,viz){var isCategory=layout.xaxis1?layout.xaxis1.type==="category":layout.xaxis.type==="category";if(!isCategory){return}var isLineMode=gData&&gData[0]&&gData[0].x&&gData[0].mode==="lines";if(!isLineMode){return}gData.forEach(function(g){g.x=g.x.map(function(v){if(VizUtil.isEmpty(v,true)){return v}return" "+v+" "})});if(layout.annotations){layout.annotations.forEach(function(v){if(!VizUtil.isEmpty(v.x,true)){v.x=" "+v.x+" "}})}};PlotlyGraphGenerator._getOthersLabelForHighlight=function(){return VizUtil.getMessage(PlotlyGraphGenerator._lang,"Others")};PlotlyGraphGenerator._flattenData=function(nestData,key,keysToKeep){var othersLabel=PlotlyGraphGenerator._getOthersLabelForHighlight();var flattened=d3.nest().key(function(d){return d[key]===null?NA_LABEL:!keysToKeep||keysToKeep.includes(d[key])?d[key]:othersLabel}).entries(nestData);var orderedKeys=VizUtil.distinct(nestData.map(function(d){return d[key]===null?NA_LABEL:!keysToKeep||keysToKeep.includes(d[key])?d[key]:othersLabel}));var hash={};flattened.forEach(function(d){hash[d.key]=d});var sorted=[];orderedKeys.forEach(function(d){if(hash[d]){sorted.push(hash[d])}});return sorted};PlotlyGraphGenerator._flattenDataByFacet=function(viz,nestData){if(viz.facet){var newData=[];nestData.forEach(function(g){var n=PlotlyGraphGenerator._flattenData(g.values,viz.facet.label);n.forEach(function(t){t.facet=t.key;t.key=g.key;if(g.ycolname){t.ycolname=g.ycolname}if(g.winfunc){t.winfunc=g.winfunc}if(g.yOp){t.yOp=g.yOp}if(g.use2ndAxis){t.use2ndAxis=g.use2ndAxis}});newData=newData.concat(n)});return newData}else{return nestData}};var convertCoefByTimeUnit=function(coef,aggfunc,type){if(type==="Date"||type.indexOf("POSIXct")>-1){if(type.indexOf("POSIXct")>-1){coef=coef*(24*60*60)}switch(aggfunc){case"rtoyear":case"year":coef=coef*365.25;break;case"rtohalfyear":case"halfyear":coef=coef*(365.25/2);break;case"rtoq":case"quarter":coef=coef*(365.25/4);break;case"rtobimon":case"bimon":coef=coef*(365.25/6);break;case"rtomon":case"mon":case"monname":coef=coef*(365.25/12);break;case"rtoweek":case"week":coef=coef*7;break;case"rtohour":case"hour":coef=coef/24;break;case"rtomin":case"minute":coef=coef/(24*60);break;case"rtosec":case"second":coef=coef/(24*60*60)}}return coef};PlotlyGraphGenerator._convertCoefByTimeUnit=convertCoefByTimeUnit;var convertToStackedAreas=function(gData){var facets={};gData.forEach(function(g){if(!facets[g.facet]){facets[g.facet]=[];g.fill="tozeroy"}else{g.fill="tonexty"}facets[g.facet].push(g)});Object.keys(facets).forEach(function(key){convertToStackedYValue(facets[key])})};PlotlyGraphGenerator._generateLineFillLayerData=function(viz,data,gData,layout){var res=[];if(!viz.yLineFillColumn||!viz[viz.yLineFillColumn]||!viz.x||!viz.y||viz.marker!=="line"){return res}var fillcol=viz[viz.yLineFillColumn].validLabel,g=null,fill=false,prev=false,color=gData&&gData.marker&&gData.marker.color?gData.marker.color+"44":"#1f77b444",curr=null;data.values.forEach(function(v,idx,arr){curr=v[fillcol];if(!VizUtil.isEmpty(curr)){if(curr){if(!g){g={x:[],y:[],type:"scatter",fill:"tozeroy",fillcolor:color,hoverinfo:"skip",mode:"none",showlegend:false,marker:{color:color},facet:gData.facet}}g.x.push(v[viz.x.validLabel]);g.y.push(v[viz.y.validLabel])}else{if(g){res.push(g);g=null}}prev=curr}if(idx===arr.length-1&&g){res.push(g)}});return res};PlotlyGraphGenerator._generateCumulativeDistLayerData=function(viz,gData,layout,translateColumn,defaultFormatter,defaultUseThousandSeparator){var showY2AxisTickLabel=viz.y2AxisShowTickLabel!=="off";var y2AxisTickAngle=viz.y2AxisTickAngle||"";var syncYAxis=viz.facetSyncYAxis!=="off";var useRatio=viz.histCumDistType==="cumsum-ratio";var title=useRatio?"Cumulative Sum Ratio":"Cumulative Sum";if(viz.histCumDistLabel){title=viz.histCumDistLabel}title=VizUtil.getMessage(PlotlyGraphGenerator._lang,title);var formatter=!viz.histCumDistNumDecimalDigits?defaultFormatter:VizUtil.valueFormatterGenerator(viz.histCumDistNumDecimalDigits,defaultUseThousandSeparator,false);var maxUpperRange=0,maxUpperRangePerFacet={},axisSettings=[];var res=gData.map(function(g){var overlaying="y";var axisId=1;var dualYAxisId=2;var isRepeatBy=!!g.yaxis;if(isRepeatBy){overlaying=g.yaxis;axisId=parseInt(g.yaxis.replace("y",""));dualYAxisId=axisId+1}var axisSetting={side:"right",ticksuffix:useRatio?"%":"",overlaying:overlaying,showgrid:false,zeroline:false,automargin:true};axisSettings.push(axisSetting);if(isRepeatBy){axisSetting.anchor="x"+axisId;axisSetting.titlefont={size:13};axisSetting.tickfont={size:10};if(syncYAxis||useRatio){if(layout["xaxis"+axisId]&&layout["xaxis"+axisId].domain){axisSetting.showticklabels=layout["xaxis"+axisId].domain[1]>.99}}else{axisSetting.showticklabels=true}}else{axisSetting.showticklabels=true}if(!showY2AxisTickLabel){axisSetting.showticklabels=false}if(y2AxisTickAngle){axisSetting.tickangle=y2AxisTickAngle}if(!layout["yaxis"+dualYAxisId]){layout["yaxis"+dualYAxisId]=axisSetting}var datum={x:g.x.slice(),y:g.y.slice(),line:{color:g.marker.color,width:viz.histCumDistWidth||2,dash:viz.histCumDistStyle||"solid"},name:"cumdist",showlegend:false,visible:true,mode:"lines",hoverinfo:"text",yaxis:"y"+dualYAxisId,xaxis:"x"+axisId,legendgroup:g.name,marker:{color:g.marker.color}};if(!g.legendgroup){g.legendgroup=g.name}axisSetting=layout["yaxis"+dualYAxisId];var cumsum=0;datum.y=datum.y.map(function(y){if(!VizUtil.isEmpty(y)){cumsum+=y}return cumsum});if(useRatio){datum.y=datum.y.map(function(y){return 100*y/cumsum});axisSetting.range=[0,103]}else{var upperRange=cumsum*1.03;axisSetting.range=[0,upperRange];if(maxUpperRange<upperRange){maxUpperRange=upperRange}if(maxUpperRangePerFacet["yaxis"+dualYAxisId]===undefined||maxUpperRangePerFacet["yaxis"+dualYAxisId]<upperRange){maxUpperRangePerFacet["yaxis"+dualYAxisId]=upperRange}}datum.hovertext=datum.x.map(function(x,idx){return title+": "+formatter(datum.y[idx])+(useRatio?"%":"")+"<br>"+"("+translateColumn(viz.x.balloonDisplayName||viz.x.name)+": "+defaultFormatter(datum.x[idx]-g.histRange)+" - "+defaultFormatter(datum.x[idx]+g.histRange)+")"});return datum});if(!useRatio){if(syncYAxis){axisSettings.forEach(function(x){x.range=[0,maxUpperRange]})}else{axisSettings.forEach(function(x){x.range=[0,maxUpperRangePerFacet[x.yaxis]]})}}return res};PlotlyGraphGenerator._createReferenceLineRangeLayer=function(gRefline,gLowerRange,gUpperRange){if(!gLowerRange||!gUpperRange){return null}if(!gRefline.line){return null}var x,y,lx=gLowerRange.x.slice(),ly=gLowerRange.y.slice(),ux=gUpperRange.x.slice(),uy=gUpperRange.y.slice();while(lx.length>0&&ly.length>0&&VizUtil.isEmpty(lx[0])&&VizUtil.isEmpty(ly[0])){lx.shift();ly.shift()}while(lx.length>0&&ly.length>0&&VizUtil.isEmpty(lx[lx.length-1])&&VizUtil.isEmpty(ly[ly.length-1])){lx.pop();ly.pop()}while(ux.length>0&&uy.length>0&&VizUtil.isEmpty(ux[0])&&VizUtil.isEmpty(uy[0])){ux.shift();uy.shift()}while(ux.length>0&&uy.length>0&&VizUtil.isEmpty(ux[ux.length-1])&&VizUtil.isEmpty(uy[uy.length-1])){ux.pop();uy.pop()}x=lx.concat(ux.reverse());y=ly.concat(uy.reverse());x.push(x[0]);y.push(y[0]);var gRangeBand={x:x,y:y,customdata:[],fill:"tozerox",fillcolor:VizUtil.hexToRgba(gRefline.line.color,gRefline.customdata.rangeFillOpacity||.2),line:{color:"transparent"},name:gRefline.name+"-rangeband",showlegend:false,visible:gLowerRange.visible,legendgroup:gLowerRange.legendgroup,type:"scatter",hoverinfo:"skip"};if(gRefline.use2ndAxis){gRangeBand.use2ndAxis=gRefline.use2ndAxis;gRangeBand.yaxis="y2"}if(gRefline.xaxis){gRangeBand.xaxis=gRefline.xaxis}if(gRefline.yaxis){gRangeBand.yaxis=gRefline.yaxis}return gRangeBand};PlotlyGraphGenerator._createReferenceLineRangeLayers=function(viz,gReflineLayers,gLowerRangeLayers,gUpperRangeLayers){return gReflineLayers.map(function(line,idx){var opId=line.customdata.xOp||line.customdata.yOp;if(opId&&VizUtil.isReferenceLineRangeSupported(viz.marker,opId,line.customdata.type)&&line.customdata.rangeStyle!=="none"){var upper=null,lower=null;if(viz.facet&&viz.facet.type===VizUtil.TYPE_GROUP_BY_MEASURES){lower=gLowerRangeLayers.filter(function(layer){return layer.xaxis===line.xaxis});lower=lower.length>0?lower[0]:null;upper=gUpperRangeLayers.filter(function(layer){return layer.xaxis===line.xaxis});upper=upper.length>0?upper[0]:null}else if(gLowerRangeLayers.length>idx&&gUpperRangeLayers.length>idx){lower=gLowerRangeLayers[idx];upper=gUpperRangeLayers[idx]}if(upper&&lower){return PlotlyGraphGenerator._createReferenceLineRangeLayer(line,lower,upper)}}return null}).filter(function(x){return x})};var formatValue=VizUtil.valueFormatterGenerator(2,true,true);var formatNumrowValue=VizUtil.valueFormatterGenerator(0,true);var constructFacetData=function(viz,gData,layout,colMap,defaultColor,gRangeLayerData,gTrendLineLayerData,gTrendLineRangeLayerData,colsOn2ndAxis,gRefLineLayerData,gRefLineUpperRangeLayerData,gRefLineLowerRangeLayerData,gVRefLineLayerData,gVRefLineUpperRangeLayerData,gVRefLineLowerRangeLayerData,gLineFillLayerData){if(viz.facet){if(!colsOn2ndAxis){colsOn2ndAxis=[]}var translateColumn=function(text){return viz.translate==="on"?VizUtil.getMessage(PlotlyGraphGenerator._lang,text):text};var marker=viz.marker;var ys=VizUtil.getOptions(viz,"y");var isMultiY=ys.length>1;var numY=0;var isGroupByMeasuresEnabled=viz.facet.type===VizUtil.TYPE_GROUP_BY_MEASURES;var barstyle=viz.barstyle?viz.barstyle:"stack";var needRangeCalcForValueOnPlot=VizUtil.isShowValueOnPlotSupported(marker)&&viz.yValueOnPlot==="on"&&_needRangeCalcForValueOnPlot(marker,viz.orientation,viz.yValueOnPlotPosition||VizUtil.getDefaultValueOnPlotPosition(marker),viz.yValueOnPlotTextAngle);var _axisRanges=null;ys.forEach(function(_y){if(_y){numY++}});var firstYAxisColumnOn2ndAxis=ys.find(function(ycol,idx){return ycol&&viz["y"+idx+"Use2ndAxis"]});var xAxisShowTitle=viz.xAxisShowTitle!=="off";if(viz.facetHideSingleLabel==="on"){var facetNames=gData.map(function(x){return x.facet});facetNames=VizUtil.makeArrayUnique(facetNames);if(facetNames.length===1){xAxisShowTitle=false}}var yAxisShowTitle=viz.yAxisShowTitle!=="off";if(isGroupByMeasuresEnabled){yAxisShowTitle=false}var y2AxisShowTitle=viz.y2AxisShowTitle!=="off";var isColorContinuous=viz.color&&VizUtil.isContinuousValue(viz.color,marker,"color");var trendLineIgnoreColor=viz.color&&VizUtil.isTrendLineIgnoreColorSupported(marker)&&viz.yTrendLineIgnoreColor==="on";var userXAxisRange=PlotlyGraphGenerator.getRangeFromRangeString(viz.xAxisRange);var userYAxisRange=PlotlyGraphGenerator.getRangeFromRangeString(viz.yAxisRange);var userY2AxisRange=PlotlyGraphGenerator.getRangeFromRangeString(viz.y2AxisRange);var showXAxisTickLabel=viz.xAxisShowTickLabel!=="off";var showYAxisTickLabel=viz.yAxisShowTickLabel!=="off";var showY2AxisTickLabel=viz.y2AxisShowTickLabel!=="off";var xAxisTickAngle=viz.xAxisTickAngle||"";var yAxisTickAngle=viz.yAxisTickAngle||"";var y2AxisTickAngle=viz.y2AxisTickAngle||"";var errbarGraph=viz.errbarGraph||"bar";var alwaysShowTickLabel=viz.facetAlwaysShowTickLabel==="on";var alwaysShowYTickLabel=viz.marker==="bubble"&&viz.sortTarget==="x"&&viz.x&&viz.y&&VizUtil.isSortable(viz,"y",viz.sortTarget);var NUMROWS_COL_LABEL=VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.NUMROWS_COL_LABEL);var DENSITY_COL_LABEL=VizUtil.getMessage(PlotlyGraphGenerator._lang,"DENSITY");var layY1OverY2=viz.layY1OverY2==="on";var xValuePrefix="",y1ValuePrefix="",y2ValuePrefix="",xValueSuffix="",y1ValueSuffix="",y2ValueSuffix="",useThousandSeparator=viz.useThousandSeparator!=="off",xUseThousandSeparator=viz.xAxisUseThousandSeparator?viz.xAxisUseThousandSeparator==="on":useThousandSeparator,y1UseThousandSeparator=viz.y1AxisUseThousandSeparator?viz.y1AxisUseThousandSeparator==="on":useThousandSeparator,y2UseThousandSeparator=viz.y2AxisUseThousandSeparator?viz.y2AxisUseThousandSeparator==="on":useThousandSeparator;if(viz.x){xValuePrefix=VizUtil.getValuePrefix(viz.xAxisNumberFormatting,viz.xAxisCurrencySymbol,viz.marker);xValueSuffix=VizUtil.getValueSuffix(null,viz.x.func,viz.xAxisNumberFormatting,viz.marker)}if(viz.y){y1ValuePrefix=VizUtil.getValuePrefix(viz.yAxisNumberFormatting,viz.yAxisCurrencySymbol,viz.marker,VizUtil.getErrorBarCalcType(viz),VizUtil.getErrorBarDirection(viz));y1ValueSuffix=VizUtil.getValueSuffix(viz.yWindowFunc,viz.y.func,viz.yAxisNumberFormatting,viz.marker,VizUtil.getErrorBarCalcType(viz),VizUtil.getErrorBarDirection(viz))}if(marker==="hist"){y1ValueSuffix=VizUtil.getValueSuffix(viz.yWindowFunc,null,viz.yAxisNumberFormatting,viz.marker)}y2ValuePrefix=VizUtil.getValuePrefix(viz.y2AxisNumberFormatting,viz.y2AxisCurrencySymbol,viz.marker,VizUtil.getErrorBarCalcType(viz),VizUtil.getErrorBarDirection(viz));if(colsOn2ndAxis.length>0){ys.forEach(function(y,idx){if(y2ValueSuffix){return}if(viz["y"+idx+"Use2ndAxis"]){y2ValueSuffix=y&&VizUtil.getValueSuffix(viz["y"+idx+"WindowFunc"],y.func,viz.y2AxisNumberFormatting,viz.marker,VizUtil.getErrorBarCalcType(viz),VizUtil.getErrorBarDirection(viz))}})}xValuePrefix=viz.xAxisValuePrefix||xValuePrefix;xValueSuffix=viz.xAxisValueSuffix||xValueSuffix;y1ValuePrefix=viz.y1AxisValuePrefix||y1ValuePrefix;y1ValueSuffix=viz.y1AxisValueSuffix||y1ValueSuffix;y2ValuePrefix=viz.y2AxisValuePrefix||y2ValuePrefix;y2ValueSuffix=viz.y2AxisValueSuffix||y2ValueSuffix;var xTickFormat=viz.xAxisTickFormat||(viz.xAxisNumDecimalDigits||viz.numDecimalDigits?(xUseThousandSeparator?",":"")+"."+(viz.xAxisNumDecimalDigits||viz.numDecimalDigits)+"f":null);var yTickFormat=viz.yAxisTickFormat||(viz.y1AxisNumDecimalDigits||viz.numDecimalDigits?(y1UseThousandSeparator?",":"")+"."+(viz.y1AxisNumDecimalDigits||viz.numDecimalDigits)+"f":null);var y2TickFormat=viz.y2AxisTickFormat||(viz.y2AxisNumDecimalDigits||viz.numDecimalDigits?(y2UseThousandSeparator?",":"")+"."+(viz.y2AxisNumDecimalDigits||viz.numDecimalDigits)+"f":null);if(!xTickFormat&&viz.xAxisUseSIPrefix==="off"&&viz.x&&VizUtil.returnsNumericValue(viz.x)){xTickFormat=xUseThousandSeparator?",":"r"}if(!yTickFormat&&viz.y1AxisUseSIPrefix==="off"&&viz.y&&VizUtil.returnsNumericValue(viz.y)){yTickFormat=y1UseThousandSeparator?",":"r"}if(!y2TickFormat&&viz.y2AxisUseSIPrefix==="off"&&colsOn2ndAxis.length>0&&VizUtil.returnsNumericValue(colsOn2ndAxis[0])){y2TickFormat=y2UseThousandSeparator?",":"r"}var fvalues0=gData.map(function(g){return g.facet});var fvalues=[];fvalues0.forEach(function(v,idx){if(fvalues0.indexOf(v)===idx){fvalues.push(v)}});var ncols=viz.numFacetColumns||"auto";if(ncols==="auto"){if(viz._canvasWidth){var _facetWidth=viz._canvasWidth;ncols=1;while(_facetWidth>VizUtil.MAX_FACET_WIDTH){ncols++;_facetWidth=viz._canvasWidth/ncols}}else{ncols=VizUtil.DEFAULT_FACET_SIZE}if(fvalues.length<ncols){ncols=fvalues.length}switch(fvalues.length){case 1:ncols=1;break;case 2:case 3:case 4:ncols=Math.min(ncols,2);break;case 5:case 6:ncols=Math.min(ncols,3);break;case 7:case 8:ncols=Math.min(ncols,4);break;default:break}}if(fvalues.length===1){ncols=1}var nrows=Math.ceil(fvalues.length/ncols);var X_AXIS_AREA_HEIGHT=viz.facetVerticalPadding?parseInt(viz.facetVerticalPadding):VizUtil.getDefaultFacetVerticalPadding(viz);var X_AXIS_AREA_HEIGHT_PLUS_MARGIN=X_AXIS_AREA_HEIGHT+10;var Y_AXIS_AREA_WIDTH=viz.facetHorizontalPadding?parseInt(viz.facetHorizontalPadding):VizUtil.getDefaultFacetHorizontalPadding(viz);if((viz.facetSyncYAxis||VizUtil.getDefaultSyncYAxis(viz.marker,isGroupByMeasuresEnabled))==="off"&&gData.filter(function(g){return g.use2ndAxis}).length>0){Y_AXIS_AREA_WIDTH*=2}var facetW=(layout.width-layout.margin.l)/ncols;if(viz.facetSqueezePlots!=="on"&&nrows>2){if(ncols>2||marker==="radar"){layout.height=Math.max(layout.height,(facetW+X_AXIS_AREA_HEIGHT)*nrows+layout.margin.t)}else{layout.height=layout.height*nrows+layout.margin.t}}var facetY=(layout.height-layout.margin.t)/nrows;var xdomain=[],ydomain=[],i;for(i=0;i<ncols;i++){xdomain.push(i)}for(i=0;i<nrows;i++){ydomain.push(i)}var paddingRatio=Y_AXIS_AREA_WIDTH/facetW;var xscale=d3.scale.ordinal().domain(xdomain).rangeBands([0,100],paddingRatio,0);var xrange=xscale.range();var xrangeBand=xscale.rangeBand();xrangeBand=Math.max(xrangeBand,1);paddingRatio=X_AXIS_AREA_HEIGHT_PLUS_MARGIN/facetY;var topMarginRatio=viz.marker==="radar"?20/layout.height*100:0;var yscale=d3.scale.ordinal().domain(ydomain).rangeBands([0,100-topMarginRatio],paddingRatio,0);var yrange=yscale.range().reverse();var yrangeBand=yscale.rangeBand();yrangeBand=Math.max(yrangeBand,1);delete layout.xaxis;delete layout.yaxis;delete layout.yaxis2;delete layout.zaxis;if(marker==="area"){convertToStackedAreas(gData)}var syncXAxis=(viz.facetSyncXAxis||VizUtil.getDefaultSyncXAxis(viz.marker))!=="off";if(!viz.facetSyncXAxis&&viz.facetEnableDataCompletion==="off"){syncXAxis=false}var syncYAxis=(viz.facetSyncYAxis||VizUtil.getDefaultSyncYAxis(viz.marker,isGroupByMeasuresEnabled))!=="off";if(!viz.facetSyncYAxis&&viz.facetEnableDataCompletion==="off"){syncYAxis=false}if(_skipSyncYAxis(viz)){syncYAxis=false}if(!syncXAxis){userXAxisRange=null}if(!syncYAxis){userYAxisRange=null;userY2AxisRange=null}var y2SyncZeroLines=colsOn2ndAxis.length>0&&viz.y2SyncZeroLines!=="off"&&VizUtil.isSyncZeroLineEnabled(viz);if(marker==="bar"&&barstyle==="stack"){var _ht={};gData.forEach(function(g){if(!_ht[g.facet]){_ht[g.facet]=[]}_ht[g.facet].push(g)});Object.keys(_ht).forEach(function(key){var group=_ht[key];calculateStackedYValue(group)})}var gd=gData;if(gRangeLayerData){gd=gd.concat(gRangeLayerData)}if(gTrendLineLayerData){gd=gd.concat(gTrendLineLayerData)}if(gTrendLineRangeLayerData){gd=gd.concat(gTrendLineRangeLayerData)}if(gRefLineUpperRangeLayerData){gd=gd.concat(gRefLineUpperRangeLayerData)}if(gRefLineLowerRangeLayerData){gd=gd.concat(gRefLineLowerRangeLayerData)}if(gRefLineLayerData){gd=gd.concat(gRefLineLayerData)}if(gVRefLineUpperRangeLayerData){gd=gd.concat(gVRefLineUpperRangeLayerData)}if(gVRefLineLowerRangeLayerData){gd=gd.concat(gVRefLineLowerRangeLayerData)}if(gVRefLineLayerData){gd=gd.concat(gVRefLineLayerData)}var includeZeroOnXAxis=/^(scatter|bubble)$/.test(marker)&&VizUtil.getAxisIncludeZero(viz,"x");var xAxisRange=syncXAxis?calculateRange(gData,"x",viz.xAxisScale,includeZeroOnXAxis,viz.x&&VizUtil.returnsNumericValue(viz.x),viz.x&&VizUtil.returnsDateValue(viz.x),marker,needRangeCalcForValueOnPlot,true,errbarGraph,viz.color,isMultiY):null;var includeZeroOnYAxis=/^(scatter|bubble|bar|line|area|densityplot|errbar|errbar-agg)$/.test(marker)&&VizUtil.getAxisIncludeZero(viz,"y");var yAxisRange=syncYAxis?calculateRange(gd,"y",viz.yAxisScale,includeZeroOnYAxis,viz.y&&VizUtil.returnsNumericValue(viz.y),false,marker,needRangeCalcForValueOnPlot,null,errbarGraph,null,null,"y1"):null;var includeZeroOnY2Axis=/^(scatter|bubble|bar|line|area|densityplot|errbar|errbar-agg)$/.test(marker)&&VizUtil.getAxisIncludeZero(viz,"y2");var y2AxisRange=syncYAxis?calculateRange(gd,"y",viz.y2AxisScale,includeZeroOnY2Axis,firstYAxisColumnOn2ndAxis&&VizUtil.returnsNumericValue(firstYAxisColumnOn2ndAxis),false,marker,needRangeCalcForValueOnPlot,null,errbarGraph,null,null,"y2"):null;if(syncYAxis&&y2SyncZeroLines&&yAxisRange&&y2AxisRange){_axisRanges=PlotlyGraphGenerator._syncZeroLines(yAxisRange,y2AxisRange);yAxisRange=_axisRanges[0];y2AxisRange=_axisRanges[1]}var xAxisTitleFontSize=viz.facetTitleFontSize||viz.xAxisTitleFontSize||viz._defaultXAxisTitleFontSize||(marker!=="pie"&&ncols>6||marker==="pie"&&ncols>2?12:13);var yAxisTitleFontSize=viz.yAxisTitleFontSize||viz._defaultYAxisTitleFontSize||13;var y2AxisTitleFontSize=viz.y2AxisTitleFontSize||viz._defaultYAxisTitleFontSize||13;var yAxisTitle=viz.yAxisTitle?translateColumn(viz.yAxisTitle):null;if(!yAxisTitle&&viz.y&&viz.yColumnName&&VizUtil.isDualYSupported(marker)){yAxisTitle=viz.yColumnName}if(!yAxisTitle){if(marker==="hist"){yAxisTitle=NUMROWS_COL_LABEL}else if(marker==="densityplot"){yAxisTitle=DENSITY_COL_LABEL}else if(viz.y){yAxisTitle=viz.y.name===VizUtil.NUMROWS_COL_NAME?NUMROWS_COL_LABEL:translateColumn(viz.y.name)}else{yAxisTitle=""}}if(yAxisTitle&&/bold/.test(viz.yAxisTitleFontWeight)){yAxisTitle="<b>"+yAxisTitle+"</b>"}if(yAxisTitle&&/italic/.test(viz.yAxisTitleFontWeight)){yAxisTitle="<i>"+yAxisTitle+"</i>"}var y2AxisTitle=viz.y2AxisTitle?translateColumn(viz.y2AxisTitle):null;if(!y2AxisTitle){if(marker==="hist"){y2AxisTitle=NUMROWS_COL_LABEL}else if(marker==="densityplot"){y2AxisTitle=DENSITY_COL_LABEL}else if(colsOn2ndAxis.length>0){y2AxisTitle=colsOn2ndAxis[0].name===VizUtil.NUMROWS_COL_NAME?NUMROWS_COL_LABEL:colsOn2ndAxis[0].name}else{y2AxisTitle=""}if(colsOn2ndAxis.length>0&&colsOn2ndAxis[0]._columnDisplayName){y2AxisTitle=colsOn2ndAxis[0]._columnDisplayName}}if(y2AxisTitle&&/bold/.test(viz.y2AxisTitleFontWeight)){y2AxisTitle="<b>"+y2AxisTitle+"</b>"}if(y2AxisTitle&&/italic/.test(viz.y2AxisTitleFontWeight)){y2AxisTitle="<i>"+y2AxisTitle+"</i>"}var xAxisTickFontSize=viz.xAxisTickFontSize||viz._defaultXAxisTickFontSize||10;var yAxisTickFontSize=viz.yAxisTickFontSize||viz._defaultYAxisTickFontSize||10;var y2AxisTickFontSize=viz.y2AxisTickFontSize||viz._defaultYAxisTickFontSize||10;var facetShowZeroLine=viz.facetShowZeroLine!=="off";var arr=[],reflineHash={},vreflineHash={},axisRangeHash={};gData.forEach(function(g,gidx){var idx=fvalues.indexOf(g.facet);var xidx=idx%ncols;var yidx=Math.floor(idx/ncols);var x=xrange[xidx];var y=yrange[yidx];var axisIdx=idx*2+1;var xaxisIdx=axisIdx;var yaxisIdx=axisIdx+(g.use2ndAxis?1:0);var legendgroup=g.name+(g.yOp||"");g.legendgroup=legendgroup;if(arr.indexOf(legendgroup)===-1){arr.push(legendgroup)}else{g.showlegend=false}var xAxisTitle=xAxisShowTitle?isGroupByMeasuresEnabled?colMap[g.facet].name:g.facet:"";if(xAxisTitle&&/bold/.test(viz.xAxisTitleFontWeight)){xAxisTitle="<b>"+xAxisTitle+"</b>"}if(xAxisTitle&&/italic/.test(viz.xAxisTitleFontWeight)){xAxisTitle="<i>"+xAxisTitle+"</i>"}layout["xaxis"+xaxisIdx]={domain:[x/100,(x+xrangeBand)/100],anchor:"y"+yaxisIdx,title:xAxisTitle,titlefont:{size:xAxisTitleFontSize},tickfont:{size:xAxisTickFontSize},tickprefix:xValuePrefix,ticksuffix:xValueSuffix,zeroline:facetShowZeroLine,showticklabels:true,zerolinecolor:VizUtil.ZERO_LINE_COLOR};if(viz.marker==="bar"&&viz.orientation==="horizontal"){var _xAxisTitle=xAxisShowTitle&&viz.x?translateColumn(viz.x.name):"";if(_xAxisTitle&&/bold/.test(viz.xAxisTitleFontWeight)){_xAxisTitle="<b>"+_xAxisTitle+"</b>"}if(_xAxisTitle&&/italic/.test(viz.xAxisTitleFontWeight)){_xAxisTitle="<i>"+_xAxisTitle+"</i>"}layout["xaxis"+xaxisIdx].xaxistitle=_xAxisTitle}if(xTickFormat){layout["xaxis"+xaxisIdx].tickformat=xTickFormat}if(viz.axisAutoMargin!=="off"){layout["xaxis"+xaxisIdx].automargin=true}if(marker==="heatmap"){layout["xaxis"+xaxisIdx].type="category";if(viz.xAxisPosition==="top"){layout["xaxis"+xaxisIdx].side="top"}}if(viz.xAxisDirection&&VizUtil.isAxisDirectionEnabled(marker)){layout["xaxis"+xaxisIdx].autorange=viz.xAxisDirection}if(/^(bar|errbar|bubble)$/.test(marker)&&viz.x&&(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory")){layout["xaxis"+xaxisIdx].type="category"}if(/^(scatter|bubble)$/.test(marker)&&viz.xAxisScale){layout["xaxis"+xaxisIdx].type=viz.xAxisScale}if(viz.x&&VizUtil.returnsDateValue(viz.x)){layout["xaxis"+xaxisIdx].type="date";if(viz.xAxisDateTickFormat){layout["xaxis"+xaxisIdx].tickformat=viz.xAxisDateTickFormat}else if(layout["xaxis"+xaxisIdx].tickformat&&!/%/.test(layout["xaxis"+xaxisIdx].tickformat)){delete layout["xaxis"+xaxisIdx].tickformat}}if(viz.x&&!VizUtil.returnsNumericValue(viz.x)&&VizUtil.isPostFilterSupported(viz,"x")&&viz.xPostFilterType){layout["xaxis"+xaxisIdx].type="category"}if(xAxisRange){layout["xaxis"+xaxisIdx].range=xAxisRange;if(viz.xAxisTickStep&&viz.x&&VizUtil.returnsNumericValue(viz.x)){layout["xaxis"+xaxisIdx].dtick=viz.xAxisTickStep}}if(userXAxisRange){layout["xaxis"+xaxisIdx].range=userXAxisRange}if(viz.showXGridLines&&viz.showXGridLines!=="default"&&!/^(boxplot|violin)$/.test(marker)){layout["xaxis"+xaxisIdx].showgrid=viz.showXGridLines==="on"}if(!/^(heatmap|contour|boxplot|violin|pie|radar|parcats)$/.test(marker)){if(viz.xGridLineColor&&viz.xGridLineColor!=="default"){layout["xaxis"+xaxisIdx].gridcolor=viz.xGridLineColor}if(viz.xGridLineWidth&&viz.xGridLineWidth!=="default"){layout["xaxis"+xaxisIdx].gridwidth=viz.xGridLineWidth}}if(!viz.x){layout["xaxis"+xaxisIdx].zeroline=false}if(viz.showXZeroLine&&viz.showXZeroLine!=="default"&&!/^(boxplot|violin)$/.test(marker)){layout["xaxis"+xaxisIdx].zeroline=viz.showXZeroLine==="on"}if(!/^(heatmap|contour|boxplot|violin|pie|radar|parcats)$/.test(marker)){if(viz.xZeroLineColor&&viz.xZeroLineColor!=="default"){layout["xaxis"+xaxisIdx].zerolinecolor=viz.xZeroLineColor}if(viz.xZeroLineWidth&&viz.xZeroLineWidth!=="default"){layout["xaxis"+xaxisIdx].zerolinewidth=viz.xZeroLineWidth}}if(!viz.x){layout["xaxis"+xaxisIdx].showticklabels=false}else if(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory"){layout["xaxis"+xaxisIdx].type="category"}if(!showXAxisTickLabel){layout["xaxis"+xaxisIdx].showticklabels=false}if(xAxisTickAngle){layout["xaxis"+xaxisIdx].tickangle=xAxisTickAngle}if(g.use2ndAxis){layout["yaxis"+yaxisIdx]={domain:[y/100,(y+yrangeBand)/100],anchor:"x"+xaxisIdx,title:xidx===ncols-1&&yidx===0&&y2AxisShowTitle?y2AxisTitle:null,titlefont:{size:y2AxisTitleFontSize||13},tickfont:{size:y2AxisTickFontSize},showticklabels:xidx===ncols-1||!syncYAxis||alwaysShowTickLabel,zeroline:facetShowZeroLine,zerolinecolor:VizUtil.ZERO_LINE_COLOR,tickprefix:y2ValuePrefix,ticksuffix:y2ValueSuffix,side:"right"};if(marker==="violin"&&!layout["yaxis"+yaxisIdx].showticklabels){layout["yaxis"+yaxisIdx].showticklabels=true;layout["yaxis"+yaxisIdx].tickfont.color="transparent"}if(y2TickFormat){layout["yaxis"+yaxisIdx].tickformat=y2TickFormat}if(layY1OverY2){layout["yaxis"+(yaxisIdx-1)].overlaying="y"+yaxisIdx}else{layout["yaxis"+yaxisIdx].overlaying="y"+(yaxisIdx-1)}if(viz.axisAutoMargin!=="off"){layout["yaxis"+yaxisIdx].automargin=true}if(y2AxisRange){layout["yaxis"+yaxisIdx].range=y2AxisRange}if(userY2AxisRange){layout["yaxis"+yaxisIdx].range=userY2AxisRange}if(viz.y2AxisTickStep&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout["yaxis"+yaxisIdx].dtick=viz.y2AxisTickStep}layout["yaxis"+yaxisIdx].showgrid=viz.showY2GridLines==="on";if(!/^(heatmap|contour|pie|radar|parcats)$/.test(marker)){if(viz.y2GridLineColor&&viz.y2GridLineColor!=="default"){layout["yaxis"+yaxisIdx].gridcolor=viz.y2GridLineColor}if(viz.y2GridLineWidth&&viz.y2GridLineWidth!=="default"){layout["yaxis"+yaxisIdx].gridwidth=viz.y2GridLineWidth}}layout["yaxis"+yaxisIdx].zeroline=viz.showY2ZeroLine==="on";if(!/^(heatmap|contour|pie|radar|parcats)$/.test(marker)){if(viz.y2ZeroLineColor&&viz.y2ZeroLineColor!=="default"){layout["yaxis"+yaxisIdx].zerolinecolor=viz.y2ZeroLineColor}if(viz.y2ZeroLineWidth&&viz.y2ZeroLineWidth!=="default"){layout["yaxis"+yaxisIdx].zerolinewidth=viz.y2ZeroLineWidth}}if(/^(bar|errbar|bubble)$/.test(marker)&&viz.y&&(VizUtil.returnsCharacterValue(viz.y)||viz.y.func==="ascategory")){layout["yaxis"+yaxisIdx].type="category"}if(VizUtil.returnsDateValue(colsOn2ndAxis[0])){layout["yaxis"+yaxisIdx].type="date";if(viz.y2AxisDateTickFormat){layout["yaxis"+yaxisIdx].tickformat=viz.y2AxisDateTickFormat}else if(layout["yaxis"+yaxisIdx].tickformat&&!/%/.test(layout["yaxis"+yaxisIdx].tickformat)){delete layout["yaxis"+yaxisIdx].tickformat}}if(viz.y2AxisDirection&&VizUtil.isAxisDirectionEnabled(marker)){layout["yaxis"+yaxisIdx].autorange=viz.y2AxisDirection}if(!showY2AxisTickLabel){layout["yaxis"+yaxisIdx].showticklabels=false}if(y2AxisTickAngle){layout["yaxis"+yaxisIdx].tickangle=y2AxisTickAngle}}else{layout["yaxis"+yaxisIdx]={domain:[y/100,(y+yrangeBand)/100],anchor:"x"+xaxisIdx,title:xidx===0&&yidx===0&&yAxisShowTitle?yAxisTitle:null,titlefont:{size:yAxisTitleFontSize},tickfont:{size:yAxisTickFontSize},showticklabels:xidx===0||!syncYAxis||alwaysShowYTickLabel||alwaysShowTickLabel,zeroline:facetShowZeroLine,zerolinecolor:VizUtil.ZERO_LINE_COLOR,tickprefix:isGroupByMeasuresEnabled&&colMap[g.facet]?colMap[g.facet].valuePrefix:y1ValuePrefix,ticksuffix:isGroupByMeasuresEnabled&&colMap[g.facet]?colMap[g.facet].valueSuffix:y1ValueSuffix};if(marker==="violin"&&!layout["yaxis"+yaxisIdx].showticklabels){layout["yaxis"+yaxisIdx].showticklabels=true;layout["yaxis"+yaxisIdx].tickfont.color="transparent"}if(yTickFormat){layout["yaxis"+yaxisIdx].tickformat=yTickFormat}if(viz.axisAutoMargin!=="off"){layout["yaxis"+yaxisIdx].automargin=true}if(yAxisRange){layout["yaxis"+yaxisIdx].range=yAxisRange}if(userYAxisRange){layout["yaxis"+yaxisIdx].range=userYAxisRange}if(viz.yAxisTickStep&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout["yaxis"+yaxisIdx].dtick=viz.yAxisTickStep}if(viz.showYGridLines&&viz.showYGridLines!=="default"){layout["yaxis"+yaxisIdx].showgrid=viz.showYGridLines==="on"}if(!/^(heatmap|contour|pie|radar|parcats)$/.test(marker)){if(viz.yGridLineColor&&viz.yGridLineColor!=="default"){layout["yaxis"+yaxisIdx].gridcolor=viz.yGridLineColor}if(viz.yGridLineWidth&&viz.yGridLineWidth!=="default"){layout["yaxis"+yaxisIdx].gridwidth=viz.yGridLineWidth}}if(viz.showYZeroLine&&viz.showYZeroLine!=="default"){layout["yaxis"+yaxisIdx].zeroline=viz.showYZeroLine==="on"}if(!/^(heatmap|contour|pie|radar|parcats)$/.test(marker)){if(viz.yZeroLineColor&&viz.yZeroLineColor!=="default"){layout["yaxis"+yaxisIdx].zerolinecolor=viz.yZeroLineColor}if(viz.yZeroLineWidth&&viz.yZeroLineWidth!=="default"){layout["yaxis"+yaxisIdx].zerolinewidth=viz.yZeroLineWidth}}if(marker==="heatmap"){if(xidx!==0){layout["yaxis"+yaxisIdx].ticklen=0}layout["yaxis"+yaxisIdx].type="category"}if(/^(bar|errbar|bubble)$/.test(marker)&&viz.y&&(VizUtil.returnsCharacterValue(viz.y)||viz.y.func==="ascategory")){layout["yaxis"+yaxisIdx].type="category"}if(viz.y&&VizUtil.returnsDateValue(viz.y)){layout["yaxis"+yaxisIdx].type="date";if(viz.yAxisDateTickFormat){layout["yaxis"+yaxisIdx].tickformat=viz.yAxisDateTickFormat}else if(layout["yaxis"+yaxisIdx].tickformat&&!/%/.test(layout["yaxis"+yaxisIdx].tickformat)){delete layout["yaxis"+yaxisIdx].tickformat}}if(viz.yAxisDirection&&VizUtil.isAxisDirectionEnabled(marker)){layout["yaxis"+yaxisIdx].autorange=viz.yAxisDirection}if(!showYAxisTickLabel){layout["yaxis"+yaxisIdx].showticklabels=false}if(yAxisTickAngle){layout["yaxis"+yaxisIdx].tickangle=yAxisTickAngle}}if(/^(scatter|bar|errbar|hist|bubble|line|area)$/.test(marker)&&viz.yAxisScale){layout["yaxis"+yaxisIdx].type=viz.yAxisScale}g.xaxis="x"+xaxisIdx;g.yaxis="y"+yaxisIdx;if(!viz.color&&!isMultiY&&!isGroupByMeasuresEnabled){if(!g.marker){g.marker={}}g.marker.color=defaultColor||"rgb(31, 119, 180)"}if(gRangeLayerData&&gRangeLayerData.length>0){gRangeLayerData[gidx].xaxis="x"+xaxisIdx;gRangeLayerData[gidx].yaxis="y"+yaxisIdx;gRangeLayerData[gidx].legendgroup="lg"+g.name;g.legendgroup="lg"+g.name;if(!g.x||g.x.length===0){gRangeLayerData[gidx].x=[];gRangeLayerData[gidx].y=[]}}if(gTrendLineLayerData&&gTrendLineLayerData.length>0){gTrendLineLayerData[gidx].xaxis="x"+xaxisIdx;gTrendLineLayerData[gidx].yaxis="y"+yaxisIdx;gTrendLineLayerData[gidx].legendgroup="lg"+g.name;g.legendgroup="lg"+g.name;if((!g.x||g.x.length===0)&&!isColorContinuous&&!trendLineIgnoreColor){gTrendLineLayerData[gidx].x=[];gTrendLineLayerData[gidx].y=[]}}if(gTrendLineRangeLayerData&&gTrendLineRangeLayerData.length>0){gTrendLineRangeLayerData[gidx].xaxis="x"+xaxisIdx;gTrendLineRangeLayerData[gidx].yaxis="y"+yaxisIdx;gTrendLineRangeLayerData[gidx].legendgroup="lg"+g.name;g.legendgroup="lg"+g.name;if((!g.x||g.x.length===0)&&!isColorContinuous&&!trendLineIgnoreColor){gTrendLineRangeLayerData[gidx].x=[];gTrendLineRangeLayerData[gidx].y=[]}}var yOp,reflineGroup;if(gRefLineLayerData&&gRefLineLayerData.length>0&&gRefLineLayerData[idx]){yOp=gRefLineLayerData[gidx].customdata.yOp||"y";reflineGroup=viz[yOp+"ReflineGroup"]}if(gRefLineUpperRangeLayerData&&gRefLineUpperRangeLayerData.length>0&&gRefLineUpperRangeLayerData[gidx]){gRefLineUpperRangeLayerData[gidx].xaxis="x"+xaxisIdx;gRefLineUpperRangeLayerData[gidx].yaxis="y"+yaxisIdx;gRefLineUpperRangeLayerData[gidx].legendgroup="refline"+yOp;gRefLineUpperRangeLayerData[gidx].visible=!gRefLineUpperRangeLayerData[gidx].forHighlightOthers&&(!reflineHash["x"+xaxisIdx+"y"+yaxisIdx+yOp]||/color/.test(reflineGroup));if(!g.x||g.x.length===0){gRefLineUpperRangeLayerData[gidx].x=[];gRefLineUpperRangeLayerData[gidx].y=[]}}if(gRefLineLowerRangeLayerData&&gRefLineLowerRangeLayerData.length>0&&gRefLineLowerRangeLayerData[gidx]){gRefLineLowerRangeLayerData[gidx].xaxis="x"+xaxisIdx;gRefLineLowerRangeLayerData[gidx].yaxis="y"+yaxisIdx;gRefLineLowerRangeLayerData[gidx].legendgroup="refline"+yOp;gRefLineLowerRangeLayerData[gidx].visible=!gRefLineLowerRangeLayerData[gidx].forHighlightOthers&&(!reflineHash["x"+xaxisIdx+"y"+yaxisIdx+yOp]||/color/.test(reflineGroup));if(!g.x||g.x.length===0){gRefLineLowerRangeLayerData[gidx].x=[];gRefLineLowerRangeLayerData[gidx].y=[]}}if(gRefLineLayerData&&gRefLineLayerData.length>0&&gRefLineLayerData[gidx]){gRefLineLayerData[gidx].xaxis="x"+xaxisIdx;gRefLineLayerData[gidx].yaxis="y"+yaxisIdx;gRefLineLayerData[gidx].legendgroup="refline"+yOp;if(!g.x||g.x.length===0){gRefLineLayerData[gidx].x=[];gRefLineLayerData[gidx].y=[]}if(isAllNull(gRefLineLayerData[gidx].y)){gRefLineLayerData[gidx].visible=false}else{gRefLineLayerData[gidx].visible=!gRefLineLayerData[gidx].forHighlightOthers&&(!reflineHash["x"+xaxisIdx+"y"+yaxisIdx+yOp]||/color/.test(reflineGroup));reflineHash["x"+xaxisIdx+"y"+yaxisIdx+yOp]=true}}if(gVRefLineLayerData&&gVRefLineLayerData.length>0){gVRefLineLayerData[gidx].xaxis="x"+xaxisIdx;gVRefLineLayerData[gidx].yaxis="y"+yaxisIdx;if(!g.x||g.x.length===0){gVRefLineLayerData[gidx].x=[];gVRefLineLayerData[gidx].y=[]}if(isAllNull(gVRefLineLayerData[gidx].x)){gVRefLineLayerData[gidx].visible=false}else{gVRefLineLayerData[gidx].visible=!gVRefLineLayerData[gidx].forHighlightOthers&&(!vreflineHash["x"+xaxisIdx+"y"+yaxisIdx]||/color/.test(viz.xReflineGroup));vreflineHash["x"+xaxisIdx+"y"+yaxisIdx]=true}}if(gVRefLineUpperRangeLayerData&&gVRefLineUpperRangeLayerData.length>0){gVRefLineUpperRangeLayerData[gidx].xaxis="x"+xaxisIdx;gVRefLineUpperRangeLayerData[gidx].yaxis="y"+yaxisIdx;if(!g.x||g.x.length===0){gVRefLineUpperRangeLayerData[gidx].x=[];gVRefLineUpperRangeLayerData[gidx].y=[]}}if(gVRefLineLowerRangeLayerData&&gVRefLineLowerRangeLayerData.length>0){gVRefLineLowerRangeLayerData[gidx].xaxis="x"+xaxisIdx;gVRefLineLowerRangeLayerData[gidx].yaxis="y"+yaxisIdx;if(!g.x||g.x.length===0){gVRefLineLowerRangeLayerData[gidx].x=[];gVRefLineLowerRangeLayerData[gidx].y=[]}}if(gLineFillLayerData&&gLineFillLayerData.length>gidx&&gLineFillLayerData[gidx]){gLineFillLayerData[gidx].forEach(function(layer){layer.xaxis="x"+xaxisIdx;layer.yaxis="y"+yaxisIdx})}if(!syncYAxis&&(viz["yAxisRangeIgnoreRefline"]==="on"||y2SyncZeroLines||!g.use2ndAxis&&includeZeroOnYAxis&&VizUtil.isIncludeZeroOnAxisSupported(marker,"y")&&!VizUtil.hasBarMarkerOnYAxis(viz,"y")||g.use2ndAxis&&includeZeroOnY2Axis&&VizUtil.isIncludeZeroOnAxisSupported(marker,"y2")&&!VizUtil.hasBarMarkerOnYAxis(viz,"y2")||needRangeCalcForValueOnPlot)){var layers=[g];if(gRangeLayerData&&gRangeLayerData.length>0){layers.push(gRangeLayerData[gidx])}if(y2SyncZeroLines||includeZeroOnYAxis){if(gTrendLineLayerData&&gTrendLineLayerData.length>0){layers.push(gTrendLineLayerData[gidx])}if(gTrendLineRangeLayerData&&gTrendLineRangeLayerData.length>0){layers.push(gTrendLineRangeLayerData[gidx])}if(gRefLineLayerData&&gRefLineLayerData.length>0){layers.push(gRefLineLayerData[gidx])}if(gRefLineUpperRangeLayerData&&gRefLineUpperRangeLayerData.length>0){layers.push(gRefLineUpperRangeLayerData[gidx])}if(gRefLineLowerRangeLayerData&&gRefLineLowerRangeLayerData.length>0){layers.push(gRefLineLowerRangeLayerData[gidx])}}var range=calculateRange(layers,"y",g.use2ndAxis?viz.y2AxisScale:viz.yAxisScale,g.use2ndAxis?includeZeroOnY2Axis:includeZeroOnYAxis,viz.y&&VizUtil.returnsNumericValue(viz.y),false,marker,needRangeCalcForValueOnPlot,null,errbarGraph,null,null,g.use2ndAxis?"y2":"y1");if(range){if(axisRangeHash["yaxis"+yaxisIdx]){range[0]=Math.min(axisRangeHash["yaxis"+yaxisIdx][0],range[0]);range[1]=Math.max(axisRangeHash["yaxis"+yaxisIdx][1],range[1])}axisRangeHash["yaxis"+yaxisIdx]=range}}if(!syncXAxis&&includeZeroOnXAxis){var layers=[g];if(gVRefLineLayerData&&gVRefLineLayerData.length>0){layers.push(gVRefLineLayerData[gidx])}if(gVRefLineUpperRangeLayerData&&gVRefLineUpperRangeLayerData.length>0){layers.push(gVRefLineUpperRangeLayerData[gidx])}if(gVRefLineLowerRangeLayerData&&gVRefLineLowerRangeLayerData.length>0){layers.push(gVRefLineLowerRangeLayerData[gidx])}var range=calculateRange(layers,"x",viz.xAxisScale,includeZeroOnXAxis,viz.x&&VizUtil.returnsNumericValue(viz.x),viz.x&&VizUtil.returnsDateValue(viz.x),marker,needRangeCalcForValueOnPlot,null,errbarGraph,null,null);if(range){if(axisRangeHash["xaxis"+xaxisIdx]){range[0]=Math.min(axisRangeHash["xaxis"+xaxisIdx][0],range[0]);range[1]=Math.max(axisRangeHash["xaxis"+xaxisIdx][1],range[1])}axisRangeHash["xaxis"+xaxisIdx]=range}}});Object.keys(axisRangeHash).forEach(function(key){layout[key].range=axisRangeHash[key]});if(!syncYAxis&&y2SyncZeroLines){var _idx=1;while(layout["yaxis"+_idx]&&layout["yaxis"+(_idx+1)]){_axisRanges=PlotlyGraphGenerator._syncZeroLines(layout["yaxis"+_idx].range,layout["yaxis"+(_idx+1)].range);layout["yaxis"+_idx].range=_axisRanges[0];layout["yaxis"+(_idx+1)].range=_axisRanges[1];_idx+=2}}if(/^(bar|line|area|errbar|errbar-agg)$/.test(viz.marker)&&viz.facet&&!syncXAxis){var h={};gData.forEach(function(g){if(!h[g.facet]){h[g.facet]=[]}h[g.facet].push(g)});Object.keys(h).forEach(function(key){var i=0,group=h[key];while(i<group[0].y.length){var allZero=true,allNull=true,isOrderRow=group[0]._orderRow&&i<group[0]._orderRow.length&&group[0]._orderRow[i]===true;group.forEach(function(d){allZero=d.y[i]===0&&allZero;allNull=d.y[i]===null&&allNull});if(allZero||allNull){if(isOrderRow&&viz.marker==="line"){group.forEach(function(d){if(d.x&&isArray(d.x)&&i<d.x.length){d.x[i]=null}});i++;return}group.forEach(function(d){d.y.splice(i,1);if(d.x&&isArray(d.x)&&i<d.x.length){d.x.splice(i,1)}if(d.hovertext&&isArray(d.hovertext)&&i<d.hovertext.length){d.hovertext.splice(i,1)}if(d.marker.size&&isArray(d.marker.size)&&i<d.marker.size.length){d.marker.size.splice(i,1)}if(d.customdata&&isArray(d.customdata)&&i<d.customdata.length){d.customdata.splice(i,1)}if(d.error_y&&d.error_y.array&&isArray(d.error_y.array)&&i<d.error_y.array.length){d.error_y.array.splice(i,1)}if(d.error_y&&d.error_y.arrayminus&&isArray(d.error_y.arrayminus)&&i<d.error_y.arrayminus.length){d.error_y.arrayminus.splice(i,1)}if(d.stacky&&isArray(d.stacky)&&i<d.stacky.length){d.stacky.splice(i,1)}if(d._orderRow&&isArray(d._orderRow)&&i<d._orderRow.length){d._orderRow.splice(i,1)}})}else{i++}}})}if(/^(scatter)$/.test(viz.marker)&&viz.facet){var scatterLineGroupedByLabel=viz.yMarkerShape==="line"&&!!viz.label;var xAxisDataTypeDetection=viz.xAxisDataTypeDetection==="on";if(!syncXAxis){PlotlyGraphGenerator._unsyncAxis(gData,"x",VizUtil.returnsCharacterValue(viz.x)&&!scatterLineGroupedByLabel&&!xAxisDataTypeDetection)}if(!syncYAxis&&viz.y){PlotlyGraphGenerator._unsyncAxis(gData,"y",VizUtil.returnsCharacterValue(viz.y)&&!scatterLineGroupedByLabel)}}if(/^(bubble)$/.test(viz.marker)&&!!viz.facet&&!!viz["xPostFilterType"]){if(!syncXAxis){PlotlyGraphGenerator._unsyncAxis(gData,"x",VizUtil.returnsCharacterValue(viz.x))}}if(layout.showlegend!==false){layout.showlegend=numY>1||!!viz.color}if(viz.showLegend==="off"){layout.showlegend=false}}return{layout:layout,gData:gData}};PlotlyGraphGenerator._constructFacetData=constructFacetData;PlotlyGraphGenerator.reverseColorOrder=function(gData,colorScale,opacity,marker){if(!gData||gData.length===0){return}var domain=colorScale.domain();domain.reverse();colorScale.domain(domain);gData.forEach(function(g){if(marker==="area"&&g.fillcolor){g.fillcolor=colorScale(g.name);if(!VizUtil.isEmpty(opacity)){g.fillcolor=VizUtil.hexToRgba(g.fillcolor,opacity)}}else if(["bar","line","bubble","errbar","errbar-agg","pie","radar"].includes(marker)&&g.marker&&g.marker.color){if(g.yOp){g.marker.color=colorScale(g._colorVal||g.name)}else{g.marker.color=colorScale(g.name)}}else if(marker==="refline"&&g.line&&g.line.color&&g._colorVal){g.line.color=VizUtil.isEmpty(opacity)?colorScale(g._colorVal):VizUtil.hexToRgba(colorScale(g._colorVal),opacity)}else if(marker==="trendline"&&g.marker&&g.marker.color&&g._colorVal){g.marker.color=VizUtil.isEmpty(opacity)?colorScale(g._colorVal):VizUtil.hexToRgba(colorScale(g._colorVal),opacity)}else if(marker==="trendline-range"&&g.fillcolor&&g.fillcolor&&g._colorVal){g.fillcolor=VizUtil.isEmpty(opacity)?colorScale(g._colorVal):VizUtil.hexToRgba(colorScale(g._colorVal),.2)}});domain.reverse();colorScale.domain(domain);return gData};var _flipProperties=function(a,propNameA,b,propNameB){var x=a[propNameA];a[propNameA]=b[propNameB];b[propNameB]=x};PlotlyGraphGenerator._switchOrientation=function(gData,layout,syncXAxis,isXAxisAssigned,alwaysShowTickLabel,showXAxisTickLabel,showYAxisTickLabel,showY2AxisTickLabel,xAxisTickAngle,yAxisTickAngle,y2AxisTickAngle){var x;gData.forEach(function(data){_flipProperties(data,"x",data,"y");_flipProperties(data,"xaxis",data,"yaxis");_flipProperties(data,"error_x",data,"error_y");if(data.xaxis){data.xaxis=data.xaxis.replace("y","x")}else{delete data.xaxis}if(data.yaxis){data.yaxis=data.yaxis.replace("x","y")}else{delete data.yaxis}if(data.orientation&&data.orientation==="h"){delete data.orientation}else{data.orientation="h"}});if(layout.xaxis&&layout.yaxis){_flipProperties(layout,"xaxis",layout,"yaxis");layout.yaxis.autorange=layout.yaxis.autorange==="reversed"?null:"reversed";layout.yaxis.ticksuffix=" ";if(layout.yaxis2){layout.xaxis2=layout.yaxis2;layout.xaxis2.overlaying="x";layout.xaxis2.side="top";delete layout.yaxis2}}else{var i=1;while(layout["xaxis"+i]&&layout["yaxis"+i]){_flipProperties(layout,"xaxis"+i,layout,"yaxis"+i);_flipProperties(layout["xaxis"+i],"anchor",layout["yaxis"+i],"anchor");_flipProperties(layout["xaxis"+i],"domain",layout["yaxis"+i],"domain");_flipProperties(layout["xaxis"+i],"title",layout["yaxis"+i],"title");_flipProperties(layout["xaxis"+i],"showticklabels",layout["yaxis"+i],"showticklabels");layout["xaxis"+i].showticklabels=true;if(layout["xaxis"+i].tickfont&&layout["xaxis"+i].tickfont.color==="transparent"){delete layout["xaxis"+i].tickfont.color}if(alwaysShowTickLabel){layout["yaxis"+i].showticklabels=isXAxisAssigned;layout["yaxis"+i].ticksuffix=" "}else{if(!syncXAxis){layout["yaxis"+i].showticklabels=isXAxisAssigned;layout["yaxis"+i].ticksuffix=" "}else{layout["yaxis"+i].showticklabels=isXAxisAssigned&&layout["xaxis"+i].domain[0]<1e-5;layout["yaxis"+i].ticksuffix=" "}}if(!showYAxisTickLabel){layout["xaxis"+i].showticklabels=false}if(!showXAxisTickLabel){layout["yaxis"+i].showticklabels=false}if(yAxisTickAngle){layout["xaxis"+i].tickangle=yAxisTickAngle}if(xAxisTickAngle){layout["yaxis"+i].tickangle=xAxisTickAngle}if(layout["yaxis"+i].title&&layout["yaxis"+i].xaxistitle){_flipProperties(layout["yaxis"+i],"title",layout["yaxis"+i],"xaxistitle")}layout["yaxis"+i].autorange=layout["yaxis"+i].autorange==="reversed"?null:"reversed";i++;if(layout["yaxis"+i]){layout["xaxis"+i]=layout["yaxis"+i];delete layout["yaxis"+i];layout["xaxis"+i].overlaying=layout["xaxis"+i].overlaying.replace("y","x");layout["xaxis"+i].anchor=layout["xaxis"+i].anchor.replace("x","y");layout["xaxis"+(i-1)].anchor=layout["xaxis"+i].anchor;layout["xaxis"+i].side="top";layout["xaxis"+i].showticklabels=true;layout["xaxis"+i].title=null;if(!showY2AxisTickLabel){layout["xaxis"+i].showticklabels=false}if(yAxisTickAngle){layout["xaxis"+i].tickangle=y2AxisTickAngle}}i++}}if(layout.annotations){layout.annotations.forEach(function(data){_flipProperties(data,"x",data,"y");_flipProperties(data,"xref",data,"yref");if(data.xref){data.xref=data.xref.replace("y","x")}else{delete data.xref}if(data.yref){data.yref=data.yref.replace("x","y")}else{delete data.yref}data.xanchor=data.yanchor==="top"?"right":"left";data.yanchor="middle"})}if(layout.hovermode==="x"){layout.hovermode="y"}};PlotlyGraphGenerator._switchReferenceLineOrientation=function(gReflineData){var x;gReflineData.forEach(function(data){_flipProperties(data,"x",data,"y");_flipProperties(data,"xaxis",data,"yaxis");_flipProperties(data,"error_x",data,"error_y");if(data.xaxis){data.xaxis=data.xaxis.replace("y","x")}else{delete data.xaxis}if(data.yaxis){data.yaxis=data.yaxis.replace("x","y")}else{delete data.yaxis}if(data.orientation&&data.orientation==="h"){delete data.orientation}else{data.orientation="h"}})};PlotlyGraphGenerator._addCustomBalloon=function(elem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onFigureClickCallback){if(!onShowDetailCallback&&!onKeepThisCallback&&!onExcludeCallback&&!onFigureClickCallback){return}var traces={};var handler=function(data){$("#viz-balloon").remove();var $balloon=$('<div id="viz-balloon"/>');$(elem).append($balloon);var isMultiSelect=data.event.ctrlKey||data.event.metaKey;var cdata;var $row;var $head=$('<div class="balloon-header"></div>');$balloon.append($head);var $htable=$('<div class="balloon-header-table"></div>');$head.append($htable);var $hrow=$('<div class="balloon-header-table-row"></div>');$htable.append($hrow);var $body=$('<div class="balloon-body"></div>');var $table=$('<div class="balloon-body-table"></div>');$body.append($table);$balloon.append($body);if(data.points&&data.points.length>0){var isPie=false,isBoxplot=false,isLine=false,isArea=false,isHeatmap=false,isRadar=false,v,colors;cdata=data.points[0].customdata;if(data.points&&data.points[0]&&data.points[0].data&&data.points[0].data.type==="pie"){var idx=data.points[0].data.labels.indexOf(data.points[0].label);cdata=data.points[0].data.customdata[idx];colors=data.points[0].data.marker.colors;isPie=true}if(cdata){isBoxplot=data.points[0].data&&data.points[0].data.type==="box";isHeatmap=data.points[0].data&&/^(heatmap|contour)$/.test(data.points[0].data.type);isLine=data.points[0].data&&/^lines/.test(data.points[0].data.mode);isArea=data.points[0].data&&/^(tonexty|tozeroy)$/.test(data.points[0].data.fill);isRadar=data.points[0].data&&data.points[0].data.type==="scatterpolar";isLine=isArea?false:isLine;var t,tIndex,tColor,tSize,tData,dIndex,isSelectedItemClicked=false;dIndex=isHeatmap?data.points[0].pointNumber.toString():data.points[0].pointNumber;tIndex=data.points[0].fullData.index;var resetSelection=function(){Object.keys(traces).forEach(function(key){t=traces[key];isSelectedItemClicked=!!t.data[dIndex];if(onFigureClickCallback){isSelectedItemClicked=false}if(t.isLine){Plotly.restyle(elem,{mode:"lines",marker:{color:t.color,size:0}},t.traceIndex)}else if(t.isArea){Plotly.restyle(elem,{mode:"none",marker:{size:0}},t.traceIndex)}else{var v={marker:{color:t.color,line:{width:0},size:t.size}};if(isPie&&colors){v.marker.colors=colors}Plotly.restyle(elem,v,t.traceIndex)}})};if(!isMultiSelect){if(!onFigureClickCallback){resetSelection()}traces={}}t=traces[tIndex];if(t){t.data[dIndex]=!t.data[dIndex]?cdata:false}else{tColor=isPie?data.points[0].color:isLine?data.points[0].fullData.line.color:isArea?data.points[0].data.fillcolor:data.points[0].data.marker?data.points[0].data.marker.color:null;tSize=data&&data.points&&data.points[0].data&&data.points[0].data.marker?data.points[0].data.marker.size:null;tData=isPie?data.points[0].data.values:isRadar?data.points[0].data.r:data.points[0].data.y;tData=tData.map(function(d,idx){return idx===dIndex&&!isSelectedItemClicked?cdata:false});if(isHeatmap){tData[dIndex]=!isSelectedItemClicked?cdata:false}t={traceIndex:tIndex,data:tData,color:tColor,colors:colors,isLine:isLine,isArea:isArea,isBoxplot:isBoxplot,isHeatmap:isHeatmap,isRadar:isRadar,isPie:isPie,size:tSize};traces[t.traceIndex]=t}var cdatalist=[];Object.keys(traces).forEach(function(key){t=traces[key];if(isHeatmap){cdatalist=cdatalist.concat(Object.keys(t.data).map(function(k){return t.data[k]}).filter(function(d){return!!d}))}else{cdatalist=cdatalist.concat(t.data.filter(function(d){return!!d}))}});cdatalist._lang=PlotlyGraphGenerator._lang;if(onFigureClickCallback){if(cdatalist&&cdatalist.length>0){onFigureClickCallback(cdatalist,traces,isMultiSelect)}return}PlotlyGraphGenerator._highlightSelections(elem,traces);var _hash={};cdata.forEach(function(d){if(!_hash[d.name+d.value]){$row=$('<div class="balloon-body-table-row"></div>');$row.append('<div class="balloon-body-table-cell label-cell">'+d.name+"</div>");$row.append('<div class="balloon-body-table-cell value-cell">'+d.value+"</div>");$table.append($row);_hash[d.name+d.value]=true}});var top=data.event.clientY-Object.keys(_hash).length*20;var $vizPane=$balloon.parents(".tab-pane > .viz");if($vizPane.length===1&&$vizPane.height()<top+$balloon.height()){top=$vizPane.height()-$balloon.height()-30}$balloon.css({position:"absolute",left:data.event.offsetX+"px",top:top+"px"});$balloon.on("click",function(){resetSelection();traces={};$balloon.hide();return});if(isSelectedItemClicked){$balloon.hide();return}else{$balloon.show();$balloon.focus()}if(onKeepThisCallback){var $keepOnly=$('<div class="balloon-header-item"><i class="fal fa-check"/> '+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Keep Only")+"</div>");$keepOnly.on("click",function(){onKeepThisCallback(cdatalist)});$hrow.append($keepOnly)}if(onExcludeCallback){var $exclude=$('<div class="balloon-header-item"><i class="fal fa-times"/> '+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Exclude")+"</div>");$exclude.on("click",function(){onExcludeCallback(cdatalist)});$hrow.append($exclude)}if(onShowDetailCallback){var $showDetail=$('<div class="balloon-header-item"><i class="fal fa-table" style="padding-right:3px"/>'+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Show Detail")+"</div>");$showDetail.on("click",function(){onShowDetailCallback(cdatalist)});$hrow.append($showDetail)}$hrow.append($('<div class="balloon-header-close-btn"><i class="fal fa-times"/></div>'));if(cdatalist.length>1){$head.append($('<div style="padding:0px 10px 3px"><b>'+cdatalist.length+"</b> "+VizUtil.getMessage(PlotlyGraphGenerator._lang,"items selected")+"</div>"))}}else{$balloon.hide()}}};var cancelHandler=function(){var $balloon=$("#viz-balloon");$balloon.hide();var t;Object.keys(traces).forEach(function(key){t=traces[key];if(t.isLine){Plotly.restyle(elem,{mode:"lines",marker:{color:t.color,size:0}},t.traceIndex)}else if(t.isArea){Plotly.restyle(elem,{mode:"none",marker:{size:0}},t.traceIndex)}else{Plotly.restyle(elem,{marker:{color:t.color,line:{width:0},size:t.size}},t.traceIndex)}});traces={}};elem.on("plotly_click",handler);elem.on("plotly_doubleclick",cancelHandler)};PlotlyGraphGenerator._mergeTraces=function(tracesArr){var res={};tracesArr.forEach(function(traces){if(traces){Object.keys(traces).forEach(function(key){if(res[key]){res[key].data=res[key].data.map(function(d,idx){return d||traces[key].data[idx]||null})}else{res[key]=traces[key]}})}});return res};PlotlyGraphGenerator._highlightSelections=function(elem,traces,tracesToRemove){var t,v;if(tracesToRemove){Object.keys(tracesToRemove).forEach(function(key){t=tracesToRemove[key];if(t.isLine){Plotly.restyle(elem,{mode:"lines",marker:{color:t.color,size:0}},t.traceIndex)}else if(t.isArea){Plotly.restyle(elem,{mode:"none",marker:{size:0}},t.traceIndex)}else{var _t={marker:{color:t.color,line:{width:0},size:t.size}};if(t.isPie&&t.colors){_t.marker.colors=t.colors}Plotly.restyle(elem,_t,t.traceIndex)}})}Object.keys(traces).forEach(function(key){t=traces[key];if(t.isBoxplot){}else if(t.isLine){Plotly.restyle(elem,{mode:"lines+markers",marker:{color:t.color,size:t.data.map(function(d){return d?10:0})}},t.traceIndex)}else if(t.isArea){Plotly.restyle(elem,{mode:"lines+markers",marker:{color:t.color,size:t.data.map(function(d){return d?10:0})}},t.traceIndex)}else if(t.isHeatmap){}else{v={marker:{line:{color:"#000000",width:t.data.map(function(d){return d?3:0})}}};if(t.color){v.marker.color=t.color}if(t.size){v.marker.size=t.size}if(t.isPie&&t.colors){v.marker.colors=t.colors}Plotly.restyle(elem,v,t.traceIndex)}})};PlotlyGraphGenerator.getRangeFromRangeString=function(rangeString){if(!rangeString){return null}var arr=rangeString.split(",");if(arr.length!==2){return null}arr[0]=parseFloat(arr[0].replace(/[\(\)\[\]\{\}]/g,""));arr[1]=parseFloat(arr[1].replace(/[\(\)\[\]\{\}]/g,""));if(isNaN(arr[0]||isNaN(arr[1]))){return null}return arr};PlotlyGraphGenerator._adjustAxisDirection=function(layout){if(!layout){return}Object.keys(layout).forEach(function(key){if(/axis/.test(key)){if(layout[key]&&layout[key].autorange==="reversed"&&layout[key].range&&layout[key].range.length===2){delete layout[key].autorange;layout[key].range=layout[key].range.slice().reverse()}}})};PlotlyGraphGenerator._showTrendLineMetricsOnPlot=function(gData,layout,vizOptions){gData.forEach(function(g){if(g._metricsText){var position=g._metricsTextPosition||"upperLeft";if(!layout.annotations){layout.annotations=[]}var x=position==="upperLeft"?0:1,y=1,xAxisId=g.xaxis?g.xaxis.replace("x","xaxis"):"xaxis",yAxisId=g.yaxis?g.yaxis.replace("y","yaxis"):"yaxis",dom=null;dom=layout[xAxisId].domain;if(dom){x=dom[position==="upperLeft"?0:1]}dom=layout[yAxisId].domain;if(dom){y=dom[1]}layout.annotations.push({xref:"paper",yref:"paper",x:x,y:y,xshift:position==="upperLeft"?4:-4,yshift:-4,text:g._metricsText,xanchor:position==="upperLeft"?"left":"right",yanchor:"top",font:{size:g._metricsTextFontSize||12},align:"left",bordercolor:"#f0f0f0",borderwidth:1,borderpad:6,bgcolor:"#ffffff",showarrow:false});delete g._metricsText;delete g._metricsTextPosition;delete g._metricsTextFontSize}})};PlotlyGraphGenerator.getRangeFromRangeRatio=function(targetAxis,axisRatio,gData,includeZeroOnYAxis){if(!axisRatio){return null}axisRatio=parseFloat(axisRatio);var dataArr=[];gData.forEach(function(g){dataArr=dataArr.concat(g[targetAxis])});if(includeZeroOnYAxis){dataArr.push(0)}var ext=d3.extent(dataArr);if(!ext||ext.length!==2||typeof ext[0]!=="number"||typeof ext[1]!=="number"){return null}var r=(ext[1]-ext[0])/2;var center=(ext[1]+ext[0])/2;var min=center-r*axisRatio;var max=center+r*axisRatio;return[min,max]};PlotlyGraphGenerator._lang="en";PlotlyGraphGenerator._generateDensityPlotViz=function(viz){viz=JSON.parse(JSON.stringify(viz));viz.x={func:"none",isDate:false,isNumeric:true,label:viz.x.label,name:viz.x.name,type:"numeric",validLabel:viz.x.validLabel,balloonDisplayName:viz.x.balloonDisplayName};viz.y={func:"none",isDate:false,isNumeric:true,label:".density",name:"Density",type:"numeric",validLabel:".density"};return viz};PlotlyGraphGenerator._generateScatterMatrixViz=function(viz){if(!viz.scatterMatrixColumns){return viz}viz=JSON.parse(JSON.stringify(viz));var colnames=null;try{colnames=JSON.parse(viz.scatterMatrixColumns)}catch(e){colnames=viz.scatterMatrixColumns.split(",")}colnames=colnames.map(function(col){return col.name||col});colnames.sort(function(a,b){return a.localeCompare(b)});colnames.forEach(function(colname,idx){colname=colname.trim();var opId="y"+(idx===0?"":idx);viz[opId]={func:"none",isDate:false,isNumeric:true,label:"sm"+idx,name:colname,type:"numeric",validLabel:"sm"+idx}});return viz};PlotlyGraphGenerator._generateGroupByMeasuresViz=function(viz,data){var colMap={};var y1UseThousandSeparator=viz.y1AxisUseThousandSeparator?viz.y1AxisUseThousandSeparator==="on":viz.useThousandSeparator!=="off";Object.keys(viz).forEach(function(key){if(/^y\d*$/.test(key)&&viz[key]){var o=JSON.parse(JSON.stringify(viz[key]));o.opId=key;if(o.type===VizUtil.TYPE_NUMROWS){o.name=VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.NUMROWS_COL_LABEL)}if(viz[key+"ColumnName"]){o.name=viz[key+"ColumnName"]}o.valuePrefix=VizUtil.getValuePrefix(viz[key+"AxisNumberFormatting"],viz[key+"AxisCurrencySymbol"],viz.marker,VizUtil.getErrorBarCalcType(viz),VizUtil.getErrorBarDirection(viz));o.valueSuffix=VizUtil.getValueSuffix(viz[key+"WindowFunc"],viz[key].func,viz[key+"AxisNumberFormatting"],viz.marker,VizUtil.getErrorBarCalcType(viz),VizUtil.getErrorBarDirection(viz));o.trendLine=viz[key+"TrendLine"];o.trendLineWithRange=viz[key+"TrendLineWithRange"];o.trendLineWidth=viz[key+"TrendLineWidth"];o.trendLineType=viz[key+"TrendLineType"];o.trendLineEnableShowMetrics=viz[key+"TrendLineEnableShowMetrics"]==="on"&&VizUtil.isTrendLineShowMetricsEnabled(key,viz);o.trendLineShowMetrics=viz[key+"TrendLineShowMetrics"];o.trendLineShowMetricsPosition=viz[key+"TrendLineShowMetricsPosition"];o.trendLineShowMetricsFontSize=viz[key+"TrendLineShowMetricsFontSize"];o.formatTrendLineValue=VizUtil.valueFormatterGenerator(VizUtil.isEmpty(viz[key+"TrendLineNumDecimalDigits"],true)?null:viz[key+"TrendLineNumDecimalDigits"],y1UseThousandSeparator,false);o.reflineType=viz[key+"ReflineType"];o.reflineRangeType=viz[key+"ReflineRangeType"];o.reflineRangeLabel=viz[key+"ReflineRangeLabel"];o.reflineGroup=viz[key+"ReflineGroup"]||"all";o.reflineColor=viz[key+"ReflineColor"]&&viz[key+"ReflineColor"]!=="default"?viz[key+"ReflineColor"]:"#A6AAA9";o.reflineWidth=viz[key+"ReflineWidth"]||1;o.reflineLength=viz[key+"ReflineLength"]||12;o.reflineStyle=viz[key+"ReflineStyle"]||"solid";o.reflineRangeStyle=viz[key+"ReflineRangeStyle"]||"fill";o.reflineRangeLineWidth=viz[key+"ReflineRangeLineWidth"]||1;o.reflineRangeLineStyle=viz[key+"ReflineRangeLineStyle"]||"solid";o.reflineRangeFillOpacity=viz[key+"ReflineRangeFillOpacity"]||"0.1";o.reflineHideFromLegend=viz[key+"ReflineHideFromLegend"]===true||viz[key+"ReflineShowInLegend"]!=="on";o.markerShape=viz[key+"MarkerShape"];o.markerSize=viz[key+"MarkerSize"];o.markerStyle=viz[key+"MarkerLineStyle"];o.markerOpacity=viz[key+"FillOpacity"];o.markerShape=viz[key+"MarkerShape"];o.markerCircleSize=viz[key+"MarkerCircleSize"];o.winfunc=viz[key+"WindowFunc"];colMap[viz[key].label]=o}if(/^y\d+$/.test(key)&&viz[key]){delete viz[key]}});return colMap};var TOOLBAR_HEIGHT=26;var TOOLBAR_PADDING_TOP=2;var FACET_NUMBER_OF_COLS_LOV=["Auto","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"];PlotlyGraphGenerator.prototype._initToolbarAvailability=function(targetElem,viz,data,onPropUpdateCallback){this._isFacetFilterEnabled=targetElem&&viz.showFacetFilter==="on"&&viz.xAxisDataTypeDetection==="on"&&!!viz.facet&&!!viz.label2;this._isFacetLayoutToolEnabled=targetElem&&viz.showFacetLayoutTool==="on"&&!!viz.facet;if(this._isFacetLayoutToolEnabled&&data){var facetData=data.map(function(row){return row[viz.facet.validLabel]});facetData=VizUtil.makeArrayUnique(facetData);if(facetData.length===1){this._isFacetLayoutToolEnabled=false}}this._isRangeOptionEnabled=viz.showRangeOptionInToolbar==="on";this._isShowLabelOptionEnabled=viz.showLabelOptionInToolbar==="on";this._isShowLabel2OptionEnabled=viz.showLabel2OptionInToolbar==="on";this._isShowColorOptionEnabled=viz.showColorOptionInToolbar==="on";this._isYAxisAutoScaleOptionEnabled=viz.showYAxisAutoScaleOptionInToolbar==="on"&&!this._isFacetLayoutToolEnabled;this._isToolbarEnabled=this._isFacetLayoutToolEnabled||this._isFacetFilterEnabled||this._isRangeOptionEnabled||this._isShowLabelOptionEnabled||this._isShowLabel2OptionEnabled||this._isShowColorOptionEnabled||this._isYAxisAutoScaleOptionEnabled;this._isToolbarHidden=!onPropUpdateCallback};PlotlyGraphGenerator.prototype._renderToolbar=function(targetElem,viz,data){var selectedFacetFilterValue=viz.facetFilter;var filteredData=data;var toolbarElem=document.createElement("div");var isGroupByMeasuresEnabled=viz.facet&&viz.facet.type===VizUtil.TYPE_GROUP_BY_MEASURES;targetElem.appendChild(toolbarElem);toolbarElem.style.fontSize="12px";toolbarElem.style.paddingTop=TOOLBAR_PADDING_TOP+"px";toolbarElem.style.height=TOOLBAR_HEIGHT+"px";toolbarElem.style.boxSizing="border-box";toolbarElem.style.lineHeight="1.5em";if(this._isToolbarHidden){toolbarElem.style.display="none"}if(this._isFacetFilterEnabled){var lov=PlotlyGraphGenerator._populateFacetFilterLov(viz,data);if(!selectedFacetFilterValue||lov.indexOf(selectedFacetFilterValue)===-1){selectedFacetFilterValue=lov[0]}filteredData=data.filter(function(d){return d[viz.label2.label]===selectedFacetFilterValue});this._renderFacetFilterDropdown(toolbarElem,lov,selectedFacetFilterValue)}if(this._isFacetLayoutToolEnabled){var syncXAxis=null,syncYAxis=null;if(VizUtil.isSyncAxisSupported(viz.marker)){syncXAxis=viz.facetSyncXAxis||VizUtil.getDefaultSyncXAxis(viz.marker);syncYAxis=viz.facetSyncYAxis||VizUtil.getDefaultSyncYAxis(viz.marker,isGroupByMeasuresEnabled)}if(viz.xAxisDataTypeDetection==="on"){syncXAxis=null}if(/^(line|area)$/.test(viz.marker)&&viz.x&&VizUtil.returnsCharacterValue(viz.x)){syncXAxis=null}if(viz.showSyncXAxisOptionInToolbar==="off"||/^(radar)$/.test(viz.marker)){syncXAxis=null}if(viz.showSyncYAxisOptionInToolbar==="off"){syncYAxis=null}this._renderFacetLayoutToolDropdown(toolbarElem,viz.numFacetColumns,viz.facetSqueezePlots,syncXAxis,syncYAxis,VizUtil.getMessage(PlotlyGraphGenerator._lang,viz.marker==="radar"?"Sync Radial Axis":"Sync Y Axis"))}if(this._isRangeOptionEnabled){this._renderShowRangeOption(toolbarElem,viz.yErrHighLowEnabledOnUI==="off"?"off":"on")}if(this._isShowLabelOptionEnabled){this._renderShowLabelOption(toolbarElem,viz.labelOnPlot,viz.showLabelsOnPlotLabel)}if(this._isShowLabel2OptionEnabled){this._renderShowLabel2Option(toolbarElem,viz.label2OnPlot,viz.showLabelsOnPlotLabel)}if(this._isShowColorOptionEnabled){this._renderShowColorOption(toolbarElem,viz.colorValueOnPlot)}if(this._isYAxisAutoScaleOptionEnabled){var yAxisIncludeZero=VizUtil.getAxisIncludeZero(viz,"y");this._renderYAxisAutoScaleOption(toolbarElem,yAxisIncludeZero?"off":"on")}return filteredData};PlotlyGraphGenerator.prototype._renderFacetLayoutToolDropdown=function(toolbarElem,numOfCols,fitInScreen,syncXAxis,syncYAxis,syncYAxisLabel){var label=document.createElement("span");label.textContent=VizUtil.getMessage(PlotlyGraphGenerator._lang,"# of Columns")+":";label.style.margin="0 4px 0 0";label.style.verticalAlign="top";label.style.display="inline-block";label.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";label.style.transform="translateY(3px)";toolbarElem.appendChild(label);var select=document.createElement("select");select.classList.add("viz-facet-numcol-dropdown");select.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";select.style.width="60px";select.style.backgroundColor="white";select.style.border="1px solid #ccc";select.style.borderRadius="3px";select.style.outline="none";select.style.margin="0 14px 0 0";select.style.verticalAlign="top";select.style.display="inline-block";select.style.transform="translateY(1px)";select.style.padding="0 0 0 5px";select.style.fontSize="12px";select.onchange=this._onToolbarWidgetChange.bind(this);select.onclick=this._onToolbarWidgetClick;var op;FACET_NUMBER_OF_COLS_LOV.forEach(function(val){op=document.createElement("option");op.value=val;op.innerText=VizUtil.getMessage(PlotlyGraphGenerator._lang,val);if(val===numOfCols){op.selected="selected"}else if(val==="Auto"&&!numOfCols){op.selected="selected"}select.appendChild(op)});toolbarElem.appendChild(select);var cb=document.createElement("input");cb.type="checkbox";if(fitInScreen==="on"){cb.checked="checked"}cb.classList.add("viz-facet-fit-in-screen-cb");cb.style.margin="0 4px 0 0";cb.onchange=this._onToolbarWidgetChange.bind(this);cb.onclick=this._onToolbarWidgetClick;cb.style.verticalAlign="top";cb.style.display="inline-block";cb.style.transform="translateY(5px)";toolbarElem.appendChild(cb);var cblabel=document.createElement("span");cblabel.textContent=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Fit");cblabel.style.verticalAlign="top";cblabel.style.display="inline-block";cblabel.style.marginRight="14px";cblabel.style.transform="translateY(3px)";cblabel.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";toolbarElem.appendChild(cblabel);if(syncXAxis){cb=document.createElement("input");cb.type="checkbox";if(syncXAxis==="on"){cb.checked="checked"}cb.classList.add("viz-facet-sync-xaxis-cb");cb.style.margin="0 4px 0 0";cb.onchange=this._onToolbarWidgetChange.bind(this);cb.onclick=this._onToolbarWidgetClick;cb.style.verticalAlign="top";cb.style.display="inline-block";cb.style.transform="translateY(5px)";toolbarElem.appendChild(cb);cblabel=document.createElement("span");cblabel.textContent=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Sync X Axis");cblabel.style.verticalAlign="top";cblabel.style.display="inline-block";cblabel.style.marginRight="14px";cblabel.style.transform="translateY(3px)";cblabel.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";toolbarElem.appendChild(cblabel)}if(syncYAxis){cb=document.createElement("input");cb.type="checkbox";if(syncYAxis==="on"){cb.checked="checked"}cb.classList.add("viz-facet-sync-yaxis-cb");cb.style.margin="0 4px 0 0";cb.onchange=this._onToolbarWidgetChange.bind(this);cb.onclick=this._onToolbarWidgetClick;cb.style.verticalAlign="top";cb.style.display="inline-block";cb.style.transform="translateY(5px)";toolbarElem.appendChild(cb);cblabel=document.createElement("span");cblabel.textContent=syncYAxisLabel;cblabel.style.verticalAlign="top";cblabel.style.display="inline-block";cblabel.style.marginRight="14px";cblabel.style.transform="translateY(3px)";cblabel.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";toolbarElem.appendChild(cblabel)}};PlotlyGraphGenerator.prototype._renderShowRangeOption=function(toolbarElem,showRange){var cb=document.createElement("input");cb.type="checkbox";if(showRange==="on"){cb.checked="checked"}cb.classList.add("viz-show-range-cb");cb.style.margin="0 4px 0 0";cb.onchange=this._onToolbarWidgetChange.bind(this);cb.onclick=this._onToolbarWidgetClick;cb.style.verticalAlign="top";cb.style.display="inline-block";cb.style.transform="translateY(5px)";toolbarElem.appendChild(cb);var cblabel=document.createElement("span");cblabel.textContent=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Confidence Interval (95%)");cblabel.style.verticalAlign="top";cblabel.style.display="inline-block";cblabel.style.transform="translateY(3px)";cblabel.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";toolbarElem.appendChild(cblabel)};PlotlyGraphGenerator.prototype._renderShowLabelOption=function(toolbarElem,labelOnPlot,label){var cb=document.createElement("input");cb.type="checkbox";if(labelOnPlot==="on"){cb.checked="checked"}cb.classList.add("viz-show-label-on-plot-cb");cb.style.margin="0 4px 0 0";cb.onchange=this._onToolbarWidgetChange.bind(this);cb.onclick=this._onToolbarWidgetClick;cb.style.verticalAlign="top";cb.style.display="inline-block";cb.style.transform="translateY(5px)";toolbarElem.appendChild(cb);var cblabel=document.createElement("span");cblabel.textContent=VizUtil.getMessage(PlotlyGraphGenerator._lang,label||"Show Label Values on Chart");cblabel.style.verticalAlign="top";cblabel.style.display="inline-block";cblabel.style.transform="translateY(3px)";cblabel.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";toolbarElem.appendChild(cblabel)};PlotlyGraphGenerator.prototype._renderShowLabel2Option=function(toolbarElem,label2OnPlot,label){var cb=document.createElement("input");cb.type="checkbox";if(label2OnPlot==="on"){cb.checked="checked"}cb.classList.add("viz-show-label2-on-plot-cb");cb.style.margin="0 4px 0 0";cb.onchange=this._onToolbarWidgetChange.bind(this);cb.onclick=this._onToolbarWidgetClick;cb.style.verticalAlign="top";cb.style.display="inline-block";cb.style.transform="translateY(5px)";toolbarElem.appendChild(cb);var cblabel=document.createElement("span");cblabel.textContent=VizUtil.getMessage(PlotlyGraphGenerator._lang,label||"Show Label Values on Chart");cblabel.style.verticalAlign="top";cblabel.style.display="inline-block";cblabel.style.transform="translateY(3px)";cblabel.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";toolbarElem.appendChild(cblabel)};PlotlyGraphGenerator.prototype._renderShowColorOption=function(toolbarElem,colorOnPlot){var cb=document.createElement("input");cb.type="checkbox";if(colorOnPlot==="on"){cb.checked="checked"}cb.classList.add("viz-show-color-on-plot-cb");cb.style.margin="0 4px 0 0";cb.onchange=this._onToolbarWidgetChange.bind(this);cb.onclick=this._onToolbarWidgetClick;cb.style.verticalAlign="top";cb.style.display="inline-block";cb.style.transform="translateY(5px)";toolbarElem.appendChild(cb);var cblabel=document.createElement("span");cblabel.textContent=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Show Correlation Values");cblabel.style.verticalAlign="top";cblabel.style.display="inline-block";cblabel.style.transform="translateY(3px)";cblabel.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";toolbarElem.appendChild(cblabel)};PlotlyGraphGenerator.prototype._renderYAxisAutoScaleOption=function(toolbarElem,autoScale){var cb=document.createElement("input");cb.type="checkbox";if(autoScale==="on"){cb.checked="checked"}cb.classList.add("viz-yaxis-autoscale-cb");cb.style.margin="0 4px 0 0";cb.onchange=this._onToolbarWidgetChange.bind(this);cb.onclick=this._onToolbarWidgetClick;cb.style.verticalAlign="top";cb.style.display="inline-block";cb.style.transform="translateY(5px)";toolbarElem.appendChild(cb);var cblabel=document.createElement("span");cblabel.textContent=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Autoscale Y Axis");cblabel.style.verticalAlign="top";cblabel.style.display="inline-block";cblabel.style.transform="translateY(3px)";cblabel.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";toolbarElem.appendChild(cblabel)};PlotlyGraphGenerator.prototype._renderFacetFilterDropdown=function(toolbarElem,lov,selectedFacetFilterValue){var label=document.createElement("span");label.textContent=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Repeat By Group")+":";label.style.margin="0 4px 0 0";label.style.verticalAlign="top";label.style.display="inline-block";label.style.transform="translateY(3px)";label.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";toolbarElem.appendChild(label);var select=document.createElement("select");select.classList.add("viz-facet-filter-dropdown");select.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";select.style.minWidth="130px";select.style.maxWidth="300px";select.style.backgroundColor="white";select.style.border="1px solid #ccc";select.style.borderRadius="3px";select.style.outline="none";select.style.margin="0 14px 0 0";select.style.verticalAlign="top";select.style.transform="translateY(1px)";select.style.padding="0 0 0 5px";select.style.display="inline-block";select.style.fontSize="12px";select.onchange=this._onToolbarWidgetChange.bind(this);select.onclick=this._onToolbarWidgetClick;var op;lov.forEach(function(val){op=document.createElement("option");op.value=val;op.innerText=val;if(val===selectedFacetFilterValue){op.selected="selected"}select.appendChild(op)});toolbarElem.appendChild(select)};PlotlyGraphGenerator._populateFacetFilterLov=function(viz,data){var lov=data.map(function(x){return x[viz.label2.label]}).filter(function(x){return!!x});var res=VizUtil.makeArrayUnique(lov);return res};PlotlyGraphGenerator.prototype._onToolbarWidgetClick=function(ev){if(ev){ev.stopPropagation()}};PlotlyGraphGenerator.prototype._onToolbarWidgetChange=function(ev){if(ev){ev.stopPropagation()}var vars=this._initVariables;var $toolbar=$(ev.target.parentNode);var selectedFacetFilterValue=$toolbar.find(".viz-facet-filter-dropdown").val();var selectedNumFacetCols=$toolbar.find(".viz-facet-numcol-dropdown").val();var fitInScreen=$toolbar.find(".viz-facet-fit-in-screen-cb").prop("checked");if(selectedFacetFilterValue){vars.viz.facetFilter=selectedFacetFilterValue;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("facetFilter",selectedFacetFilterValue)}}if(selectedNumFacetCols){if(selectedNumFacetCols==="Auto"){selectedNumFacetCols=null}vars.viz.numFacetColumns=selectedNumFacetCols;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("numFacetColumns",selectedNumFacetCols)}}fitInScreen=!fitInScreen?"":"on";vars.viz.facetSqueezePlots=fitInScreen;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("facetSqueezePlots",fitInScreen)}if($toolbar.find(".viz-facet-sync-xaxis-cb").length>0){var syncXAxis=$toolbar.find(".viz-facet-sync-xaxis-cb").prop("checked")?"on":"off";vars.viz.facetSyncXAxis=syncXAxis;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("facetSyncXAxis",syncXAxis)}}if($toolbar.find(".viz-facet-sync-yaxis-cb").length>0){var syncYAxis=$toolbar.find(".viz-facet-sync-yaxis-cb").prop("checked")?"on":"off";vars.viz.facetSyncYAxis=syncYAxis;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("facetSyncYAxis",syncYAxis)}}var $showRange=$toolbar.find(".viz-show-range-cb");if($showRange.length>0){var showRange=$showRange.prop("checked");showRange=!showRange?"off":"on";vars.viz.yErrHighLowEnabledOnUI=showRange;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("yErrHighLowEnabledOnUI",showRange)}}var $showLabel=$toolbar.find(".viz-show-label-on-plot-cb");if($showLabel.length>0){var showLabel=$showLabel.prop("checked");showLabel=!showLabel?"off":"on";vars.viz.labelOnPlot=showLabel;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("labelOnPlot",showLabel)}}var $showLabel2=$toolbar.find(".viz-show-label2-on-plot-cb");if($showLabel2.length>0){var showLabel2=$showLabel2.prop("checked");showLabel2=!showLabel2?"off":"on";vars.viz.label2OnPlot=showLabel2;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("label2OnPlot",showLabel2)}}var $showColor=$toolbar.find(".viz-show-color-on-plot-cb");if($showColor.length>0){var showColor=$showColor.prop("checked");showColor=!showColor?"off":"on";vars.viz.colorValueOnPlot=showColor;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("colorValueOnPlot",showColor)}}var $autoScale=$toolbar.find(".viz-yaxis-autoscale-cb");if($autoScale.length>0){var autoScale=$autoScale.prop("checked");var includeZero=autoScale?"off":"on";vars.viz.yAxisIncludeZero=includeZero;vars.viz.y2AxisIncludeZero=includeZero;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("yAxisIncludeZero",includeZero);vars.onPropUpdateCallback("y2AxisIncludeZero",includeZero)}}this._render(vars.viz,vars.data,vars.targetElem,vars.renderType,vars.onLoadCallback,vars.onShowDetailCallback,vars.onKeepThisCallback,vars.onExcludeCallback,vars.onFigureClickCallback,vars.onBeforeRenderingCallback,vars.onPropUpdateCallback,vars.lang,vars.configProps,true)};PlotlyGraphGenerator.render=function(viz,data,targetElem,renderType,onLoadCallback,onErrorCallback,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onFigureClickCallback,onBeforeRenderingCallback,onPropUpdateCallback,lang,configProps,isRerender){if(lang){PlotlyGraphGenerator._lang=lang}try{var renderer=new PlotlyGraphGenerator;renderer._render(viz,data,targetElem,renderType,onLoadCallback,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onFigureClickCallback,onBeforeRenderingCallback,onPropUpdateCallback,lang,configProps,isRerender)}catch(e){if(onErrorCallback&&typeof onErrorCallback==="function"){onErrorCallback(e,viz)}if(targetElem){VizUtil.renderNoData(targetElem,VizUtil.getMessage(PlotlyGraphGenerator._lang,"Chart rendering failed."))}console.error(e)}finally{if(onLoadCallback&&typeof onLoadCallback==="function"){onLoadCallback()}}};PlotlyGraphGenerator.prototype._render=function(viz,data,targetElem,renderType,onLoadCallback,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onFigureClickCallback,onBeforeRenderingCallback,onPropUpdateCallback,lang,configProps,isRerender){data=VizUtil.convertColumnarData(data);data=VizUtil.translateColumnData(data,viz,lang,true);var bucketLabelMap=VizUtil.translateBucketLabels(data,viz,lang);this._initToolbarAvailability(targetElem,viz,data,onPropUpdateCallback);if(!isRerender&&this._isToolbarEnabled){this._initVariables={viz:viz,data:data,targetElem:targetElem,renderType:renderType,onLoadCallback:onLoadCallback,onShowDetailCallback:onShowDetailCallback,onKeepThisCallback:onKeepThisCallback,onExcludeCallback:onExcludeCallback,onFigureClickCallback:onFigureClickCallback,onBeforeRenderingCallback:onBeforeRenderingCallback,onPropUpdateCallback:onPropUpdateCallback,lang:lang,configProps:configProps}}if(targetElem){if(targetElem.childNodes.length>0){d3.select(targetElem.querySelector("svg")).remove();$(targetElem).empty()}if(!data||data.length===0){VizUtil.renderNoData(targetElem,VizUtil.getMessage(PlotlyGraphGenerator._lang,"There is no data to display."));return}if(this._isToolbarEnabled){data=this._renderToolbar(targetElem,viz,data)}}if(viz.marker==="densityplot"){viz=PlotlyGraphGenerator._generateDensityPlotViz(viz)}else if(viz.marker==="scattermatrix"){viz=PlotlyGraphGenerator._generateScatterMatrixViz(viz)}VizUtil._migrateShowValueOnPlot(viz);var translateColumn=function(text){return viz.translate==="on"?VizUtil.getMessage(PlotlyGraphGenerator._lang,text,true):text};var marker=viz.marker?viz.marker:null;var isHistogram=marker==="hist",isBoxplot=marker==="boxplot",isHeatmap=/^(heatmap|contour)$/.test(marker);var x=viz.x?viz.x.label:null,y=viz.y?viz.y.label:null,z=viz.z?viz.z.label:null,size=viz.size?viz.size.label:null,color=viz.color?viz.color.label:null,isColorContinuous=viz.color&&VizUtil.isContinuousValue(viz.color,marker,"color"),trendLineIgnoreColor=viz.color&&VizUtil.isTrendLineIgnoreColorSupported(marker)&&viz.yTrendLineIgnoreColor==="on",colorbucket=viz.colorbucket?viz.colorbucket.label:null,colorBucketType=VizUtil.getBucketType("color",viz),colorStackDirection=viz.colorStackDirection||VizUtil.getDefaultColorStackDirection(viz),colorLegendDirection=viz.colorLegendDirection||VizUtil.getDefaultColorLegendDirection(viz),highlightCreateOthers=VizUtil.isHighlightCreateOthersEnabled(viz),highlightSort=viz.highlightSort!=="off",othersLabelForHighlight=PlotlyGraphGenerator._getOthersLabelForHighlight(),groupby=viz.groupby?viz.groupby.label:null,label=viz.label?viz.label.label:null,label2=viz.label2?viz.label2.label:null,label3=viz.label3?viz.label3.label:null,label4=viz.label4?viz.label4.label:null,label5=viz.label5?viz.label5.label:null,errbarSampleSize=viz.errbarSampleSize?viz.errbarSampleSize.label:null,errbarSd=viz.errbarSd?viz.errbarSd.label:null,enableLabel2=!!viz.enableLabel2,facet=viz.facet?viz.facet.label:null,orderRow="..is.order.row",orientation=viz.orientation?viz.orientation:"vertical",barstyle=viz.barstyle?viz.barstyle:"stack",pieHole=!isNaN(viz.pieHole)?parseInt(viz.pieHole)/100:0,barPadding=viz.barPadding||(marker==="hist"?"0":null),opacity=viz.fillOpacity||VizUtil.getDefaultOpacity(viz)||null,sortTarget=viz.sortTarget?viz.sortTarget:"",sortOrder=viz.sortOrder?viz.sortOrder:"desc",labelOnPlot=viz.labelOnPlotOnUI==="off"?"off":viz.labelOnPlot?viz.labelOnPlot:"off",labelOnPlotHAlign=viz.labelOnPlotHAlign||"right",labelOnPlotVAlign=viz.labelOnPlotVAlign||"middle",errbarGraph=viz.errbarGraph||"bar",mapmode=viz.mapmode?viz.mapmode:"USA-states",marginLeft=viz.marginLeft,marginRight=viz.marginRight,marginTop=viz.marginTop,marginBottom=viz.marginBottom,title=viz.title,xAxisTitle=viz.xAxisTitle?translateColumn(viz.xAxisTitle):null,yAxisTitle=viz.yAxisTitle?translateColumn(viz.yAxisTitle):null,y2AxisTitle=viz.y2AxisTitle?translateColumn(viz.y2AxisTitle):null,zAxisTitle=viz.zAxisTitle?translateColumn(viz.zAxisTitle):null,xAxisPosition=viz.xAxisPosition||"bottom",xAxisShowTitle=viz.xAxisShowTitle!=="off",yAxisShowTitle=viz.yAxisShowTitle!=="off",y2AxisShowTitle=viz.y2AxisShowTitle!=="off",zAxisShowTitle=viz.zAxisShowTitle!=="off",circleMaxSize=viz.circleMaxSize||VizUtil.DEFAULT_MAX_CIRCLE_DIAMETER[marker],circleMinSize=viz.circleMinSize||VizUtil.DEFAULT_MIN_CIRCLE_DIAMETER[marker],legendShowFuncName=viz.legendShowFuncName==="on",legendShowAxisName=viz.legendShowAxisName!=="off",yValueOnPlot=VizUtil.isShowValueOnPlotSupported(marker)?viz.yValueOnPlot||"off":"off",yValueOnPlotPosition=viz.yValueOnPlotPosition||VizUtil.getDefaultValueOnPlotPosition(marker),needRangeCalcForValueOnPlot=yValueOnPlot==="on"&&_needRangeCalcForValueOnPlot(marker,orientation,yValueOnPlotPosition,viz.yValueOnPlotTextAngle),disableDecimalFormatting=!!viz.disableDecimalFormatting,numDecimalDigits=!viz.numDecimalDigits?null:parseInt(viz.numDecimalDigits),numDecimalDigitsForFilter=numDecimalDigits===null?2:numDecimalDigits,useThousandSeparator=viz.useThousandSeparator!=="off",xUseThousandSeparator=viz.xAxisUseThousandSeparator?viz.xAxisUseThousandSeparator==="on":useThousandSeparator,y1UseThousandSeparator=viz.y1AxisUseThousandSeparator?viz.y1AxisUseThousandSeparator==="on":useThousandSeparator,y2UseThousandSeparator=viz.y2AxisUseThousandSeparator?viz.y2AxisUseThousandSeparator==="on":useThousandSeparator,zUseThousandSeparator=viz.zAxisUseThousandSeparator?viz.zAxisUseThousandSeparator==="on":useThousandSeparator,userXAxisRange=PlotlyGraphGenerator.getRangeFromRangeString(viz.xAxisRange),userYAxisRange=PlotlyGraphGenerator.getRangeFromRangeString(viz.yAxisRange),userY2AxisRange=PlotlyGraphGenerator.getRangeFromRangeString(viz.y2AxisRange),userZAxisRange=PlotlyGraphGenerator.getRangeFromRangeString(viz.zAxisRange),showXAxisTickLabel=viz.xAxisShowTickLabel!=="off",showYAxisTickLabel=viz.yAxisShowTickLabel!=="off",showY2AxisTickLabel=viz.y2AxisShowTickLabel!=="off",showZAxisTickLabel=viz.zAxisShowTickLabel!=="off",xAxisTickAngle=viz.xAxisTickAngle||"",yAxisTickAngle=viz.yAxisTickAngle||"",y2AxisTickAngle=viz.y2AxisTickAngle||"",zAxisTickAngle=viz.zAxisTickAngle||"",formatXValue=null,formatY1Value=null,formatDensityRatioValue=null,formatY2Value=null,formatZValue=null,formatColorValue=null,formatPieValue=null,xAxisDataTypeDetection=viz.xAxisDataTypeDetection==="on",layY1OverY2=viz.layY1OverY2==="on",NUMROWS_COL_LABEL=VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.NUMROWS_COL_LABEL),DENSITY_COL_LABEL=VizUtil.getMessage(PlotlyGraphGenerator._lang,"DENSITY"),YAXIS_COL_LABEL=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Color"),isGroupByMeasuresEnabled=viz.facet&&viz.facet.type===VizUtil.TYPE_GROUP_BY_MEASURES,colMap={},yLineFillColumn=viz.yLineFillColumn,xReflineConstantColumn=viz.xReflineConstantColumn,xReflineConstantColumnExtraTarget=viz.xReflineConstantColumnExtraTarget,i,l;if(isGroupByMeasuresEnabled){viz=JSON.parse(JSON.stringify(viz));colMap=PlotlyGraphGenerator._generateGroupByMeasuresViz(viz,data)}if(isNaN(pieHole)){pieHole=0}var ys=VizUtil.getOptions(viz,"y");var isMultiY=ys.length>1;var firstYAxisColumnOn2ndAxis=ys.find(function(ycol,idx){return ycol&&viz["y"+idx+"Use2ndAxis"]});var numY=0;ys.forEach(function(_y){if(_y){numY++}});var colsOn2ndAxis=[];var colNaNMap={};colNaNMap["x"]=viz.x&&viz.x.name?!VizUtil.returnsNumericValue(viz.x):false;if(xAxisDataTypeDetection){colNaNMap["x"]=false}colNaNMap["z"]=viz.z&&viz.z.name?!VizUtil.returnsNumericValue(viz.z):false;colNaNMap["color"]=viz.color&&viz.color.name?!VizUtil.returnsNumericValue(viz.color):false;colNaNMap["facet"]=viz.facet&&viz.facet.name?!VizUtil.returnsNumericValue(viz.facet):false;colNaNMap["groupby"]=viz.groupby&&viz.groupby.name?!VizUtil.returnsNumericValue(viz.groupby):false;colNaNMap["label"]=viz.label&&viz.label.name?!VizUtil.returnsNumericValue(viz.label):false;colNaNMap["label2"]=viz.label2&&viz.label2.name?!VizUtil.returnsNumericValue(viz.label2):false;colNaNMap["label3"]=viz.label3&&viz.label3.name?!VizUtil.returnsNumericValue(viz.label3):false;colNaNMap["label4"]=viz.label4&&viz.label4.name?!VizUtil.returnsNumericValue(viz.label4):false;colNaNMap["label5"]=viz.label5&&viz.label5.name?!VizUtil.returnsNumericValue(viz.label5):false;ys.forEach(function(v,index){var op="y"+(index===0?"":index);colNaNMap[op]=viz[op]&&viz[op].name?!VizUtil.returnsNumericValue(viz[op]):false});var allowMultiYAndColor=viz.allowMultiYAndColor==="on";if(isHistogram){y=VizUtil.FREQ_COL_LABEL;if(!color&&!viz.histCumDistType){opacity=viz.fillOpacity||null}}var yValueOnPlotNumDecimalDigits=VizUtil.isShowValueOnPlotSupported(marker)||VizUtil.isShowLabelOnPlotSupported(marker)?viz.yValueOnPlotNumDecimalDigits:null;var yValueOnPlotUseThousandSeparator=VizUtil.isShowValueOnPlotSupported(marker)||VizUtil.isShowLabelOnPlotSupported(marker)?viz.yValueOnPlotUseThousandSeparator:null;formatValue=VizUtil.valueFormatterGenerator(disableDecimalFormatting?null:VizUtil.isEmpty(yValueOnPlotNumDecimalDigits||numDecimalDigits,true)?2:yValueOnPlotNumDecimalDigits||numDecimalDigits,yValueOnPlotUseThousandSeparator?yValueOnPlotUseThousandSeparator==="on":useThousandSeparator,VizUtil.isEmpty(yValueOnPlotNumDecimalDigits||numDecimalDigits,true));formatXValue=VizUtil.valueFormatterGenerator(disableDecimalFormatting?null:VizUtil.isEmpty(yValueOnPlotNumDecimalDigits||viz.xAxisNumDecimalDigits||numDecimalDigits,true)?2:yValueOnPlotNumDecimalDigits||viz.xAxisNumDecimalDigits||numDecimalDigits,yValueOnPlotUseThousandSeparator?yValueOnPlotUseThousandSeparator==="on":xUseThousandSeparator,VizUtil.isEmpty(yValueOnPlotNumDecimalDigits||viz.xAxisNumDecimalDigits||numDecimalDigits,true));formatY1Value=VizUtil.valueFormatterGenerator(disableDecimalFormatting?null:VizUtil.isEmpty(yValueOnPlotNumDecimalDigits||viz.y1AxisNumDecimalDigits||numDecimalDigits,true)?2:yValueOnPlotNumDecimalDigits||viz.y1AxisNumDecimalDigits||numDecimalDigits,yValueOnPlotUseThousandSeparator?yValueOnPlotUseThousandSeparator==="on":y1UseThousandSeparator,VizUtil.isEmpty(yValueOnPlotNumDecimalDigits||viz.y1AxisNumDecimalDigits||numDecimalDigits,true));if(marker==="densityplot"){formatY1Value=VizUtil.valueFormatterGenerator(disableDecimalFormatting?null:VizUtil.isEmpty(yValueOnPlotNumDecimalDigits||viz.y1AxisNumDecimalDigits||numDecimalDigits,true)?2:yValueOnPlotNumDecimalDigits||viz.y1AxisNumDecimalDigits||numDecimalDigits,yValueOnPlotUseThousandSeparator?yValueOnPlotUseThousandSeparator==="on":y1UseThousandSeparator,VizUtil.isEmpty(yValueOnPlotNumDecimalDigits||viz.y1AxisNumDecimalDigits||numDecimalDigits,true),true);formatDensityRatioValue=VizUtil.valueFormatterGenerator(disableDecimalFormatting?null:VizUtil.isEmpty(yValueOnPlotNumDecimalDigits||viz.y1AxisNumDecimalDigits||numDecimalDigits,true)?2:yValueOnPlotNumDecimalDigits||viz.y1AxisNumDecimalDigits||numDecimalDigits,yValueOnPlotUseThousandSeparator?yValueOnPlotUseThousandSeparator==="on":y1UseThousandSeparator,VizUtil.isEmpty(yValueOnPlotNumDecimalDigits||viz.y1AxisNumDecimalDigits||numDecimalDigits,true),false)}formatY2Value=VizUtil.valueFormatterGenerator(disableDecimalFormatting?null:VizUtil.isEmpty(yValueOnPlotNumDecimalDigits||viz.y2AxisNumDecimalDigits||numDecimalDigits,true)?2:yValueOnPlotNumDecimalDigits||viz.y2AxisNumDecimalDigits||numDecimalDigits,yValueOnPlotUseThousandSeparator?yValueOnPlotUseThousandSeparator==="on":y2UseThousandSeparator,VizUtil.isEmpty(yValueOnPlotNumDecimalDigits||viz.y2AxisNumDecimalDigits||numDecimalDigits,true));formatZValue=VizUtil.valueFormatterGenerator(disableDecimalFormatting?null:VizUtil.isEmpty(yValueOnPlotNumDecimalDigits||viz.zAxisNumDecimalDigits||numDecimalDigits,true)?2:yValueOnPlotNumDecimalDigits||viz.zAxisNumDecimalDigits||numDecimalDigits,yValueOnPlotUseThousandSeparator?yValueOnPlotUseThousandSeparator==="on":zUseThousandSeparator,VizUtil.isEmpty(yValueOnPlotNumDecimalDigits||viz.zAxisNumDecimalDigits||numDecimalDigits,true));formatColorValue=!viz.colorNumDecimalDigits&&!viz.colorUseThousandSeparator?formatValue:VizUtil.valueFormatterGenerator(viz.colorNumDecimalDigits||numDecimalDigits,viz.colorUseThousandSeparator?viz.colorUseThousandSeparator==="on":useThousandSeparator,VizUtil.isEmpty(viz.colorNumDecimalDigits||numDecimalDigits,true));formatPieValue=!viz.pieValueNumDecimalDigits?formatValue:VizUtil.valueFormatterGenerator(viz.pieValueNumDecimalDigits,useThousandSeparator,false);if(isHeatmap){if(viz.x&&viz.y&&!viz.color){color='"count(*)"'}}else if(marker==="choropleth"&&!viz.color){color='"count(*)"'}else if(/^(bar|line|area)$/.test(marker)){if(viz.x&&!viz.y||viz.color&&!viz.y){y='"count(*)"'}}var nestData;var gData=[];var gRangeLayerData=[];var gTrendLineLayerData=[];var gTrendLineRangeLayerData=[];var gRefLineLayerData=[];var gRefLineUpperRangeLayerData=[];var gRefLineLowerRangeLayerData=[];var gRefLineRangeBandLayerData=[];var gVRefLineLayerData=[];var gVRefLineUpperRangeLayerData=[];var gVRefLineLowerRangeLayerData=[];var gVRefLineRangeBandLayerData=[];var gLineFillLayerData=[];var sortTargetCol=viz[sortTarget]?viz[sortTarget].label:"";var sortTargetGbysumCol=sortTargetCol?sortTargetCol+".gbysum":"";var direction=sortOrder==="desc"?1:-1;var valueSortFunc=function(a,b){if(a[sortTargetGbysumCol]!==undefined&&b[sortTargetGbysumCol]!==undefined){return(b[sortTargetGbysumCol]-a[sortTargetGbysumCol])*direction}else{return(b[sortTargetCol]-a[sortTargetCol])*direction}};if(colorbucket){VizUtil.formatColorBucketData(data,VizUtil.applyColorBucketAfterSummarize(marker)?colorbucket:color,formatValue);if(marker==="bubble"&&colorBucketType==="none"){data.forEach(function(row){row[colorbucket]=formatValue(row[colorbucket])})}}var xDataRange=null;if(/^(scatter|line|bubble)$/.test(marker)&&viz.x&&VizUtil.returnsNumericValue(viz.x)&&viz.x.func!=="ascategory"){var _xval=[];var _ycol=null;ys.forEach(function(d){if(!!d&&!_ycol){_ycol=d}});data.forEach(function(d){if(!VizUtil.isEmpty(d[viz.x.label])&&!VizUtil.isEmpty(d[_ycol.label])){_xval.push(d[viz.x.label])}});xDataRange=d3.extent(_xval);var _rangeMargin=Math.abs(xDataRange[1]-xDataRange[0])*.1;xDataRange[0]-=_rangeMargin;xDataRange[1]+=_rangeMargin}var colorScale=null;var numberOfItemsInColor=-1;var useHighlightScale=viz.enableHighlight==="on";if(/^(heatmap|contour)$/.test(marker)){if(facet){nestData=d3.nest().key(function(d){return VizUtil.isEmpty(d[facet])?NA_LABEL:d[facet]}).key(function(d){return(VizUtil.isEmpty(d[y])?NA_LABEL:d[y])+(marker==="heatmap"?"\n":"")}).key(function(d){return(VizUtil.isEmpty(d[x])?NA_LABEL:d[x])+(marker==="heatmap"?"\n":"")}).entries(data);var orderedKeys=VizUtil.distinct(data.map(function(d){return VizUtil.isEmpty(d[facet])?NA_LABEL:d[facet]}));var hash={};nestData.forEach(function(d){hash[d.key]=d});var sorted=[];orderedKeys.forEach(function(d){if(hash[d]){sorted.push(hash[d])}});nestData=sorted}else{nestData=[{key:"",values:d3.nest().key(function(d){return(VizUtil.isEmpty(d[y])?NA_LABEL:d[y])+(marker==="heatmap"?"\n":"")}).key(function(d){return(VizUtil.isEmpty(d[x])?NA_LABEL:d[x])+(marker==="heatmap"?"\n":"")}).entries(data)}]}}else if(marker==="radar"){if(color){nestData=PlotlyGraphGenerator._flattenData(data,color)}else{nestData=[{key:"",values:data}]}colorScale=nestData.length<=10?d3.scale.category10():d3.scale.category20();numberOfItemsInColor=nestData.length;if(viz&&(viz.reverseColorPaletteOrder||VizUtil.getDefaultReversePaletteOrder(viz))==="on"){colors=colorScale.range().slice();colors.reverse();colorScale=d3.scale.ordinal().range(colors)}nestData=PlotlyGraphGenerator._flattenDataByFacet(viz,nestData)}else if(marker==="parcats"){nestData=[{key:y,values:data}];colorScale=d3.scale.category10();if(color||colorbucket){var carr=data.map(function(v){return v[color]||v[colorbucket]}).filter(function(v){return!!v});carr=VizUtil.makeArrayUnique(carr.sort());colorScale=carr.length<=10?d3.scale.category10():d3.scale.category20()}nestData=PlotlyGraphGenerator._flattenDataByFacet(viz,nestData)}else if(viz.color){var colorcol=color,colors,sindex,opValue;if(colorbucket&&VizUtil.applyColorBucketAfterSummarize(marker)){colorcol=colorbucket}nestData=PlotlyGraphGenerator._flattenData(data,colorcol,VizUtil.isHighlightCreateOthersEnabled(viz)?(viz.highlightValues||[]).map(function(v){return v.value}):null);if(viz.y){nestData.forEach(function(d){d.winfunc=viz.yWindowFunc})}if(isMultiY&&allowMultiYAndColor){ys.forEach(function(_y,_idx){if(_y&&_idx>0){var winfunc=viz["y"+(_idx===0?"":_idx)+"WindowFunc"];var funcLabel=!winfunc||winfunc==="none"?null:VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.WINDOW_FUNCTION_OPTIONS_HASH[winfunc]);if(!funcLabel){funcLabel=VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.AGGREGATION_FUNCTION_OPTIONS_HASH[_y.func])}var yOp="y"+(_idx===0?"":_idx);nestData.unshift({key:_y.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:_y.name+(funcLabel&&legendShowFuncName?" ("+funcLabel+")":""),ycolname:_y.label,winfunc:winfunc,yOp:yOp,values:data.filter(function(d){return!(d[".resp"]&&d[".resp"]!==_y.label)})})}})}colorScale=nestData.length<=10?d3.scale.category10():d3.scale.category20();numberOfItemsInColor=nestData.length;if(viz&&(viz.reverseColorPaletteOrder||VizUtil.getDefaultReversePaletteOrder(viz))==="on"){colors=colorScale.range().slice();colors.reverse();colorScale=d3.scale.ordinal().range(colors)}if(viz.partialColorOpacityStartingIndex){sindex=parseInt(viz.partialColorOpacityStartingIndex);opValue=parseFloat(viz.partialColorOpacity);colors=colorScale.range().map(function(c,idx){if(idx<sindex){return c}return _setOpacity(c,opValue)});colorScale=d3.scale.ordinal().range(colors)}nestData=PlotlyGraphGenerator._flattenDataByFacet(viz,nestData)}else{if(isMultiY){nestData=[];ys.forEach(function(_y,_idx){if(_y){var yOp="y"+(_idx===0?"":_idx);var winfunc=viz[yOp+"WindowFunc"];var colLabel=viz[yOp+"ColumnName"];_y._columnDisplayName=colLabel;var funcLabel=!winfunc||winfunc==="none"?null:VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.WINDOW_FUNCTION_OPTIONS_HASH[winfunc]);if(!funcLabel){funcLabel=VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.AGGREGATION_FUNCTION_OPTIONS_HASH[_y.func])}var use2ndAxis=viz[yOp+"Use2ndAxis"]==="on"&&VizUtil.isDualYSupported(marker,barstyle);if(use2ndAxis){colsOn2ndAxis.push(_y)}var key=colLabel?colLabel:_y.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:_y.name;key=translateColumn(key);nestData.push({key:key+(funcLabel&&legendShowFuncName&&_y.type!==VizUtil.TYPE_NUMROWS?" ("+funcLabel+")":""),ycolname:_y.label,winfunc:winfunc,use2ndAxis:use2ndAxis,yOp:yOp,values:data.filter(function(d){return!(d[".resp"]&&d[".resp"]!==_y.label)})})}});if(allowMultiYAndColor){nestData.reverse()}else if(marker==="bar"&&barstyle==="stack"&&orientation==="vertical"&&!color&&isMultiY&&!isGroupByMeasuresEnabled){nestData.reverse()}if(legendShowAxisName&&colsOn2ndAxis.length>0){nestData.forEach(function(d){d.key+=" ("+(d.use2ndAxis?"Y2":"Y1")+")"})}}else{var colLabel=VizUtil.isDualYSupported(marker)?viz["yColumnName"]:null;nestData=[{key:colLabel||y,winfunc:viz.yWindowFunc,values:data}]}colorScale=nestData.length<10?d3.scale.category10():d3.scale.category20();numberOfItemsInColor=nestData.length;nestData=PlotlyGraphGenerator._flattenDataByFacet(viz,nestData)}var y2SyncZeroLines=colsOn2ndAxis.length>0&&viz.y2SyncZeroLines!=="off"&&VizUtil.isSyncZeroLineEnabled(viz);var xValuePrefix="",y1ValuePrefix="",y2ValuePrefix="",zValuePrefix="",xValueSuffix="",y1ValueSuffix="",y2ValueSuffix="",zValueSuffix="",sizeValuePrefix="",sizeValueSuffix="",label1ValuePrefix="",label1ValueSuffix="",label2ValuePrefix="",label2ValueSuffix="",label3ValuePrefix="",label3ValueSuffix="",label4ValuePrefix="",label4ValueSuffix="",label5ValuePrefix="",label5ValueSuffix="",colorValuePrefix="",colorValueSuffix="",pieValuePrefix="",pieValueSuffix="";if(viz.x){xValuePrefix=VizUtil.getValuePrefix(viz.xAxisNumberFormatting,viz.xAxisCurrencySymbol,viz.marker);xValueSuffix=VizUtil.getValueSuffix(null,viz.x.func,viz.xAxisNumberFormatting,viz.marker)}if(viz.y){y1ValuePrefix=VizUtil.getValuePrefix(viz.yAxisNumberFormatting,viz.yAxisCurrencySymbol,viz.marker,VizUtil.getErrorBarCalcType(viz),VizUtil.getErrorBarDirection(viz));y1ValueSuffix=VizUtil.getValueSuffix(viz.yWindowFunc,viz.y.func,viz.yAxisNumberFormatting,viz.marker,VizUtil.getErrorBarCalcType(viz),VizUtil.getErrorBarDirection(viz));if(marker==="pie"){pieValuePrefix=VizUtil.getValuePrefix(viz.pieValueNumberFormatting,viz.pieValueCurrencySymbol,viz.marker);pieValueSuffix=VizUtil.getValueSuffix(null,viz.y.func,viz.pieValueNumberFormatting,viz.marker)}}if(marker==="hist"){y1ValueSuffix=VizUtil.getValueSuffix(viz.yWindowFunc,null,viz.yAxisNumberFormatting,viz.marker)}y2ValuePrefix=VizUtil.getValuePrefix(viz.y2AxisNumberFormatting,viz.y2AxisCurrencySymbol,viz.marker,VizUtil.getErrorBarCalcType(viz),VizUtil.getErrorBarDirection(viz));if(colsOn2ndAxis.length>0){ys.forEach(function(y,idx){if(y2ValueSuffix){return}if(viz["y"+idx+"Use2ndAxis"]&&y){y2ValueSuffix=VizUtil.getValueSuffix(viz["y"+idx+"WindowFunc"],y.func,viz.y2AxisNumberFormatting,viz.marker,VizUtil.getErrorBarCalcType(viz),VizUtil.getErrorBarDirection(viz))}})}if(viz.z){zValuePrefix=VizUtil.getValuePrefix(viz.zAxisNumberFormatting,viz.zAxisCurrencySymbol,viz.marker);zValueSuffix=VizUtil.getValueSuffix(null,null,viz.zAxisNumberFormatting,viz.marker)}if(viz.color){colorValuePrefix=VizUtil.getValuePrefix(viz.colorNumberFormatting,viz.colorCurrencySymbol,viz.marker);colorValueSuffix=VizUtil.getValueSuffix(viz.colorWindowFunc,viz.color.func,viz.colorNumberFormatting,viz.marker)}if(viz.size){sizeValuePrefix=VizUtil.getValuePrefix(viz.sizeNumberFormatting,viz.sizeCurrencySymbol,viz.marker);sizeValueSuffix=VizUtil.getValueSuffix(viz.sizeWindowFunc,viz.size.func,viz.sizeNumberFormatting,viz.marker)}if(viz.label){label1ValuePrefix=VizUtil.getValuePrefix(viz.label1NumberFormatting,viz.label1CurrencySymbol,viz.marker);label1ValueSuffix=VizUtil.getValueSuffix(viz.label1WindowFunc,viz.label.func,viz.label1NumberFormatting,viz.marker)}if(viz.label2){label2ValuePrefix=VizUtil.getValuePrefix(viz.label2NumberFormatting,viz.label2CurrencySymbol,viz.marker);label2ValueSuffix=VizUtil.getValueSuffix(viz.label2WindowFunc,viz.label2.func,viz.label2NumberFormatting,viz.marker)}if(viz.label3){label3ValuePrefix=VizUtil.getValuePrefix(viz.label3NumberFormatting,viz.label3CurrencySymbol,viz.marker);label3ValueSuffix=VizUtil.getValueSuffix(viz.label3WindowFunc,viz.label3.func,viz.label3NumberFormatting,viz.marker)}if(viz.label4){label4ValuePrefix=VizUtil.getValuePrefix(viz.label4NumberFormatting,viz.label4CurrencySymbol,viz.marker);label4ValueSuffix=VizUtil.getValueSuffix(viz.label4WindowFunc,viz.label4.func,viz.label4NumberFormatting,viz.marker)}if(viz.label5){label5ValuePrefix=VizUtil.getValuePrefix(viz.label5NumberFormatting,viz.label5CurrencySymbol,viz.marker);label5ValueSuffix=VizUtil.getValueSuffix(viz.label5WindowFunc,viz.label5.func,viz.label5NumberFormatting,viz.marker)}xValuePrefix=viz.xAxisValuePrefix||xValuePrefix;xValueSuffix=viz.xAxisValueSuffix||xValueSuffix;y1ValuePrefix=viz.y1AxisValuePrefix||y1ValuePrefix;y1ValueSuffix=viz.y1AxisValueSuffix||y1ValueSuffix;y2ValuePrefix=viz.y2AxisValuePrefix||y2ValuePrefix;y2ValueSuffix=viz.y2AxisValueSuffix||y2ValueSuffix;colorValuePrefix=viz.colorAxisValuePrefix||colorValuePrefix;colorValueSuffix=viz.colorAxisValueSuffix||colorValueSuffix;sizeValuePrefix=viz.sizeAxisValuePrefix||sizeValuePrefix;sizeValueSuffix=viz.sizeAxisValueSuffix||sizeValueSuffix;label1ValuePrefix=viz.label1AxisValuePrefix||label1ValuePrefix;label1ValueSuffix=viz.label1AxisValueSuffix||label1ValueSuffix;label2ValuePrefix=viz.label2AxisValuePrefix||label2ValuePrefix;label2ValueSuffix=viz.label2AxisValueSuffix||label2ValueSuffix;label3ValuePrefix=viz.label3AxisValuePrefix||label3ValuePrefix;label3ValueSuffix=viz.label3AxisValueSuffix||label3ValueSuffix;label4ValuePrefix=viz.label4AxisValuePrefix||label4ValuePrefix;label4ValueSuffix=viz.label4AxisValueSuffix||label4ValueSuffix;label5ValuePrefix=viz.label5AxisValuePrefix||label5ValuePrefix;label5ValueSuffix=viz.label5AxisValueSuffix||label5ValueSuffix;var formatTrendLineValueHash={};var formatRefLineValueHash={};var formatVRefLineValueHash={};ys.forEach(function(y,idx){var yOp="y"+(idx===0?"":idx);var use2ndAxis=viz[yOp+"Use2ndAxis"]==="on"&&VizUtil.isDualYSupported(marker,barstyle);formatTrendLineValueHash[yOp]=VizUtil.valueFormatterGenerator(VizUtil.isEmpty(viz[yOp+"TrendLineNumDecimalDigits"],true)?null:viz[yOp+"TrendLineNumDecimalDigits"],use2ndAxis?y2UseThousandSeparator:y1UseThousandSeparator,false);formatRefLineValueHash[yOp]={formatter:!viz[yOp+"RefLineNumDecimalDigits"]?use2ndAxis?formatY2Value:formatY1Value:VizUtil.valueFormatterGenerator(viz[yOp+"RefLineNumDecimalDigits"],use2ndAxis?y2UseThousandSeparator:y1UseThousandSeparator,false),prefix:use2ndAxis?y2ValuePrefix:y1ValuePrefix,suffix:use2ndAxis?y2ValueSuffix:y1ValueSuffix,hideFromLegend:viz[yOp+"ReflineHideFromLegend"]===true||viz[yOp+"ReflineShowInLegend"]!=="on",hideValueFromBalloon:viz[yOp+"ReflineHideValueFromBalloon"],showLabelOnPlotArea:viz[yOp+"ReflineLabelOnPlotArea"]||""}});formatVRefLineValueHash.x={formatter:!viz["xRefLineNumDecimalDigits"]?formatXValue:VizUtil.valueFormatterGenerator(viz["xRefLineNumDecimalDigits"],xUseThousandSeparator,false),prefix:xValuePrefix,suffix:xValueSuffix,hideFromLegend:viz["xReflineHideFromLegend"]===true||viz["xReflineShowInLegend"]!=="on",hideValueFromBalloon:viz["xReflineHideValueFromBalloon"],showLabelOnPlotArea:viz["xReflineLabelOnPlotArea"]||""};var reverseColorPaletteOrderOp=viz.reverseColorPaletteOrder||viz.reverseColorPalleteOrder||VizUtil.getDefaultReversePaletteOrder(viz);var colorarr,categColorPalette=viz.categColorPalette||viz.categColorPaletteDefault||VizUtil.getDefaultColorPalette(VizUtil.getBucketType("color",viz),viz)||viz.colorPallete10,customCategColorPaletteOp=viz.customCategColorPalette||viz.customColorPallete10||viz._defaultCustomCategColorPalette;if(colorbucket&&colorBucketType==="none"&&(viz.quantColorPalette||viz._defaultQuantColorPalette)){categColorPalette=viz.quantColorPalette||viz._defaultQuantColorPalette}if(customCategColorPaletteOp&&customCategColorPaletteOp.length>0&&categColorPalette==="custom"){colorarr=customCategColorPaletteOp.match(VizUtil.COLOR_PALETTE_REGEX).slice();for(i=0;i<colorarr.length;i++){if(VizUtil.hexToRgb(colorarr[i])===null){colorarr[i]="#CCCCCC"}}if(reverseColorPaletteOrderOp==="on"){colorarr.reverse()}colorScale=d3.scale.ordinal().range(colorarr)}else if(categColorPalette&&categColorPalette!=="default"&&VizUtil.CATEG_COLOR_PALETTES_HASH[categColorPalette]){var ncolors=numberOfItemsInColor?Math.min(numberOfItemsInColor,10):-1;if(numberOfItemsInColor>0&&VizUtil.colorbrewer[categColorPalette]&&VizUtil.colorbrewer[categColorPalette][ncolors]){colorarr=VizUtil.colorbrewer[categColorPalette][ncolors].slice()}else{colorarr=VizUtil.CATEG_COLOR_PALETTES_HASH[categColorPalette].color.slice()}if(reverseColorPaletteOrderOp==="on"){colorarr.reverse()}if(viz.partialColorOpacityStartingIndex){sindex=parseInt(viz.partialColorOpacityStartingIndex);opValue=parseFloat(viz.partialColorOpacity);colorarr=colorarr.map(function(c,idx){if(idx<sindex){return c}return _setOpacity(c,opValue)})}colorScale=d3.scale.ordinal().range(colorarr)}if(ys.length>0&&!color&&isGroupByMeasuresEnabled){colorScale.range([colorScale.range()[0]])}var hv=viz.highlightValues||[];if(useHighlightScale||viz.highlightOnPalette==="on"){if(!color&&(ys.length>0||["hist","densityplot"].includes(marker)&&x)){if(isGroupByMeasuresEnabled){hv=hv.map(function(v){var res=null;Object.values(colMap).forEach(function(item){if(item.opId===v.value){res={value:item.label,color:v.color}}});return res}).filter(function(x){return!!x})}else{hv=hv.map(function(v){return viz[v.value]?{value:marker==="densityplot"?".density":viz[v.value].label,color:v.color}:null}).filter(function(x){return!!x})}}}if(useHighlightScale){colorScale=VizUtil.generateHighlightColorScale(VizUtil.getHighlightDefaultColor(viz),hv,viz.colorRecode)}else if(viz.highlightOnPalette==="on"){colorScale=VizUtil.generateHighlightOnPaletteColorScale(colorScale,hv,viz.colorRecode)}var quantColorPaletteOp=viz.quantColorPalette||viz.colorPallete||VizUtil.getDefaultQuantColorPalette(viz);if(!VizUtil.QUANT_COLOR_PALETTES_HASH[quantColorPaletteOp]){quantColorPaletteOp=/^(heatmap|contour)$/.test(marker)?"RdBu":"Blues"}var quantColorPalette=VizUtil.QUANT_COLOR_PALETTES_HASH[quantColorPaletteOp].color.slice();var customQuantColorPaletteOp=viz.customQuantColorPalette||viz._defaultCustomQuantColorPalette;if(customQuantColorPaletteOp&&customQuantColorPaletteOp.length>0&&quantColorPaletteOp==="custom"){colorarr=customQuantColorPaletteOp.match(VizUtil.COLOR_PALETTE_REGEX).slice();for(i=0;i<colorarr.length;i++){if(VizUtil.hexToRgb(colorarr[i])===null){colorarr[i]="#CCCCCC"}}quantColorPalette=colorarr}if(!/^(heatmap|contour)$/.test(marker)){var colorNumBuckets=colorBucketType==="bucket_equal_step"||VizUtil.useExtraBucketsForOutsideRangeValues(viz,"color")?numberOfItemsInColor:null;quantColorPalette=VizUtil.getColorPaletteForBuckets(viz,quantColorPaletteOp,colorNumBuckets)||quantColorPalette;if(VizUtil.isBucketZeroToCenterEnabled(viz,"color")){var colorData=VizUtil.distinct(data.map(function(datum){return datum[["scatter","bubble"].includes(viz.marker)?colorbucket:color]}).filter(function(v){return v!==null&&v!==undefined}));if(Object.keys(data[0]).includes(VizUtil.ORIGINAL_COLOR_BUCKET_LABELS)){var bucketData=data.find(function(datum){return datum[VizUtil.ORIGINAL_COLOR_BUCKET_LABELS]});if(bucketData&&bucketData[VizUtil.ORIGINAL_COLOR_BUCKET_LABELS]){colorData=JSON.parse(bucketData[VizUtil.ORIGINAL_COLOR_BUCKET_LABELS]);if(colorLegendDirection==="reversed"){colorData.reverse()}if(marker==="bar"&&barstyle==="stack"&&orientation==="vertical"||marker==="area"){colorData.reverse()}}}if(colorLegendDirection==="reversed"){colorData.reverse()}if(marker==="bar"&&barstyle==="stack"&&orientation==="vertical"||marker==="area"){colorData.reverse()}var centerBucketIndex=VizUtil.findIndexForBucketIncludingZero(colorData);if(!VizUtil.isEmpty(centerBucketIndex)){quantColorPalette=VizUtil.getColorPaletteForZeroCenteredBuckets(reverseColorPaletteOrderOp==="on"?quantColorPalette.reverse():quantColorPalette,colorData.length,centerBucketIndex);reverseColorPaletteOrderOp="off"}}}if(useHighlightScale){quantColorPalette=quantColorPalette.map(function(){return VizUtil.getHighlightDefaultColor(viz)});hv=viz.highlightValues||[];hv.forEach(function(v){var idx=parseInt(v.value);if(idx<quantColorPalette.length){quantColorPalette[idx]=v.color}})}if(reverseColorPaletteOrderOp==="on"){quantColorPalette.reverse()}if(viz.highlightOnPalette==="on"){hv=viz.highlightValues||[];hv.forEach(function(v){var idx=parseInt(v.value);if(idx<quantColorPalette.length){quantColorPalette[idx]=v.color}})}if(colorbucket&&colorBucketType!=="none"){colorScale=d3.scale.ordinal().range(quantColorPalette)}if(viz.categColorSeqValueMode==="on"&&colorScale){colorScale.range().forEach(function(x,idx){colorScale(idx+1+"")})}var _text;var _data;if(isBoxplot){nestData.forEach(function(d){var datum={x:[],y:[],hovertext:[],customdata:[],marker:{}};if(opacity){datum.opacity=opacity}if(facet){datum.facet=d.facet}d.values.forEach(function(v){_data=new VizUtil.BalloonItemList;var xval=x?v[x]:d.key;datum.x=datum.x.concat(xval,xval,xval,xval,xval,xval,xval);if(x){_data.add({type:"x",name:translateColumn(viz.x.balloonDisplayName||viz.x.name),validName:viz.x.validName,rawValue:bucketLabelMap.x?bucketLabelMap.x[xval]||xval:xval,value:xval,func:viz.x.func,datatype:viz.x.type,filter:true},marker,"x",false,viz.x.balloonPosition,viz.x.balloonPositionIndex,viz.x.balloonAddBrackets,viz.x.balloonInvisible||viz.x.balloonHideIfEmpty&&VizUtil.isEmpty(xval))}datum.name=viz.y.name;if(color){datum.name=v[color];if(facet){datum.offsetgroup=v[color]}if(VizUtil.isEmpty(datum.name)){datum.name=NA_LABEL}datum.marker.color=colorScale(v[color]);_data.add({type:"color",name:translateColumn(viz.color.balloonDisplayName||viz.color.name),validName:viz.color.validName,rawValue:bucketLabelMap.color?bucketLabelMap.color[v[color]]||v[color]:v[color],value:v[color],func:viz.color.func,datatype:viz.color.type,filter:true},marker,"color",false,viz.color.balloonPosition,viz.color.balloonPositionIndex,viz.color.balloonAddBrackets,viz.color.balloonInvisible||viz.color.balloonHideIfEmpty&&VizUtil.isEmpty(v[color]))}if(facet){_data.add({type:"facet",name:translateColumn(viz.facet.balloonDisplayName||viz.facet.name),validName:viz.facet.validName,rawValue:bucketLabelMap.facet?bucketLabelMap.facet[v[facet]]||v[facet]:v[facet],value:v[facet],func:viz.facet.func,datatype:viz.facet.type,filter:true},marker,"facet",false,viz.facet.balloonPosition,viz.facet.balloonPositionIndex,viz.facet.balloonAddBrackets,viz.facet.balloonInvisible||viz.facet.balloonHideIfEmpty&&VizUtil.isEmpty(v[facet]))}datum.y=datum.y.concat([v[1],v[2],v[2],v[3],v[4],v[4],v[5]]);_data.add({type:"y",name:translateColumn(viz.y.balloonDisplayName||viz.y.name),validName:viz.y.validName,rawValue:[v[1],v[2],v[3],v[4],v[5]],value:["Min: "+v[1],"1Q: "+v[2],"Median: "+v[3],"3Q: "+v[4],"Max: "+v[5]].join(", "),func:viz.y.func,datatype:viz.y.type,filter:false},marker,"y",true,viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(v));datum.customdata.push(_data.toArray())});if(!datum.marker.color){datum.marker.color=colorScale(viz.y?viz.y.validLabel:VALUE_FOR_NO_COLOR)}gData.push(datum)})}else if(/^(scattermatrix)$/.test(marker)){var datum={type:"splom",dimensions:[],hovertext:[],customdata:[],hovermode:"text",hoverlabel:{bgcolor:[]},marker:{size:circleMinSize,color:[]}};if(opacity){datum.marker.opacity=opacity}if(color){datum.marker.color=[]}ys.forEach(function(y){if(y){datum.dimensions.push({label:y.name,isNumeric:VizUtil.returnsNumericValue(y),values:[],_validLabel:y.validLabel})}});var _range,_colorRange,_scaleFunc,_colorScale=[];if(color){_range=colorScale.range();_colorRange=_range.map(function(x,idx){return idx*.01});_scaleFunc=d3.scale.ordinal().range(_colorRange);_range.forEach(function(x,idx){_colorScale.push([idx*.01,x]);_colorScale.push([(idx+1)*.01,x])});var _lastItem=_colorScale[_colorScale.length-1];_colorScale.push([_lastItem[0],_lastItem[1]]);_colorScale.push([1,_lastItem[1]])}else{_range=colorScale.range();_colorScale=[[0,_range[0]],[1,_range[0]]]}datum.marker.colorscale=_colorScale;data[data.length-1].forEach(function(x){_text=new VizUtil.BalloonItemList;if(color){datum.marker.color.push(_scaleFunc(x[viz.color.validLabel]));_text.add(translateColumn(viz.color.balloonDisplayName||viz.color.name)+": "+formatValue(x[viz.color.validLabel],colNaNMap["color"]),marker,"color",false,viz.color.balloonPosition,viz.color.balloonPositionIndex,viz.color.balloonAddBrackets,viz.color.balloonInvisible||viz.color.balloonHideIfEmpty&&VizUtil.isEmpty(x[viz.color.validLabel]));datum.hoverlabel.bgcolor.push(colorScale(x[viz.color.validLabel]))}else{datum.marker.color.push(0);datum.hoverlabel.bgcolor.push(colorScale(VALUE_FOR_NO_COLOR))}datum.dimensions.forEach(function(d){d.values.push(x[d._validLabel]);_text.add(translateColumn(d.balloonDisplayName||d.label)+": "+formatValue(x[d._validLabel],!d.isNumeric),marker,"dimension",false,d.balloonPosition,d.balloonPositionIndex,d.balloonAddBrackets,d.balloonInvisible||d.balloonHideIfEmpty&&VizUtil.isEmpty(x[d._validLabel]))});datum.hovertext.push(_text.toArray().join("<br>"))});datum.marker.color.push(1);if(viz.facetShowDiagonalPlots!=="on"){datum.diagonal={visible:false}}if(viz.facetShowLowerHalfPlots==="off"){datum.showlowerhalf=false}if(viz.facetShowUpperHalfPlots==="off"){datum.showupperhalf=false}gData.push(datum)}else if(/^(heatmap|contour)$/.test(marker)){if(!color){if(targetElem){VizUtil.renderNoData(targetElem,VizUtil.getMessage(PlotlyGraphGenerator._lang,"Color is not assigned."))}else{console.log("Color column is not defined in heatmap. Exiting.")}return}nestData.forEach(function(item){var groupData=item.values;var group={x:[],y:[],z:[],hovertext:[],customdata:[],marker:{}};if(opacity){group.opacity=opacity}if(facet){group.facet=item.key}group.x=groupData[0].values.map(function(d){return d.key});group.y=groupData.map(function(d){return d.key});group.z=groupData.map(function(d){return d.values.map(function(d2){return d2.values[0][color]})});group.hovertext=groupData.map(function(datax){return datax.values.map(function(datay){_text=new VizUtil.BalloonItemList;_text.add(translateColumn(viz.x.balloonDisplayName||viz.x.name)+": "+formatXValue(datay.values[0][x],colNaNMap["x"]),marker,"x",viz.x.isNumeric,viz.x.balloonPosition,viz.x.balloonPositionIndex,viz.x.balloonAddBrackets,viz.x.balloonInvisible||viz.x.balloonHideIfEmpty&&VizUtil.isEmpty(datay.values[0][x]));if(viz.y){_text.add(translateColumn(viz.y.balloonDisplayName||viz.y.name)+": "+formatY1Value(datay.values[0][y],colNaNMap["y"]),marker,"y",viz.y.isNumeric,viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(datay.values[0][y]))}_text.add(translateColumn(viz.color.balloonDisplayName||(viz.color&&viz.color.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.color.name))+": "+(VizUtil.isEmpty(datay.values[0][color])?NA_LABEL:colorValuePrefix+formatColorValue(datay.values[0][color],colNaNMap["color"])+colorValueSuffix),marker,"color",viz.color.isNumeric,viz.color.balloonPosition,viz.color.balloonPositionIndex,viz.color.balloonAddBrackets,viz.color.balloonInvisible||viz.color.balloonHideIfEmpty&&VizUtil.isEmpty(datay.values[0][color]));if(datay.values[0][VizUtil.NROW_INTERNAL_COL_NAME]&&viz.showNumberOfRowsInBalloon==="on"){_text.add(VizUtil.getMessage(PlotlyGraphGenerator._lang,"(Number of Rows)")+": "+formatNumrowValue(datay.values[0][VizUtil.NROW_INTERNAL_COL_NAME]),marker,"nrow",true,"bottom",null,null,null)}return _text.toArray().join("<br>")})});group.customdata=groupData.map(function(datax){return datax.values.map(function(datay){_data=new VizUtil.BalloonItemList;if(datay.values[0][VizUtil.NROW_INTERNAL_COL_NAME]){_data.add({type:"nrow",name:NUMROWS_COL_LABEL,validName:VizUtil.NUMROWS_COL_NAME,rawValue:datay.values[0][VizUtil.NROW_INTERNAL_COL_NAME],value:formatNumrowValue(datay.values[0][VizUtil.NROW_INTERNAL_COL_NAME]),func:"count",datatype:"numeric",filter:false},marker,"nrow",true,"bottom",null,null,null)}_data.add({type:"x",name:translateColumn(viz.x.balloonDisplayName||viz.x.name),validName:viz.x.validName,rawValue:bucketLabelMap.x?bucketLabelMap.x[datay.values[0][x]]||datay.values[0][x]:datay.values[0][x],value:formatXValue(datay.values[0][x],colNaNMap["x"]),func:viz.x.func,datatype:viz.x.type,filter:true},marker,"x",viz.x.isNumeric,viz.x.balloonPosition,viz.x.balloonPositionIndex,viz.x.balloonAddBrackets,viz.x.balloonInvisible||viz.x.balloonHideIfEmpty&&VizUtil.isEmpty(datay.values[0][x]));if(viz.y){_data.add({type:"y",name:translateColumn(viz.y.balloonDisplayName||viz.y.name),validName:viz.y.validName,rawValue:bucketLabelMap.y?bucketLabelMap.y[datay.values[0][y]]||datay.values[0][y]:datay.values[0][y],value:formatY1Value(datay.values[0][y],colNaNMap["y"]),func:viz.y.func,datatype:viz.y.type,filter:true},marker,"y",viz.y.isNumeric,viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(datay.values[0][y]))}_data.add({type:"color",name:translateColumn(viz.color.balloonDisplayName||(viz.color&&viz.color.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.color.name)),validName:viz.color&&viz.color.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.color.validName,rawValue:VizUtil.isEmpty(datay.values[0][color])?NA_LABEL:datay.values[0][color],value:VizUtil.isEmpty(datay.values[0][color])?NA_LABEL:colorValuePrefix+formatColorValue(datay.values[0][color],colNaNMap["color"])+colorValueSuffix,func:viz.color.func,datatype:viz.color.type,filter:false},marker,"color",viz.color.isNumeric,viz.color.balloonPosition,viz.color.balloonPositionIndex,viz.color.balloonAddBrackets,viz.color.balloonInvisible||viz.color.balloonHideIfEmpty&&VizUtil.isEmpty(datay.values[0][color]));if(viz.facet){_data.add({type:"facet",name:translateColumn(viz.facet.balloonDisplayName||viz.facet.name),validName:viz.facet.validName,rawValue:bucketLabelMap.facet?bucketLabelMap.facet[datay.values[0][facet]]||datay.values[0][facet]:datay.values[0][facet],value:formatValue(datay.values[0][facet],colNaNMap["facet"]),func:viz.facet.func,datatype:viz.facet.type,filter:true},marker,"facet",false,viz.facet.balloonPosition,viz.facet.balloonPositionIndex,viz.facet.balloonAddBrackets,viz.facet.balloonInvisible||viz.facet.balloonHideIfEmpty&&VizUtil.isEmpty(datay.values[0][facet]))}return _data.toArray()})});if(!group.y||group.y[0]==="undefined"){group.y=[""]}while(quantColorPalette.length<5){quantColorPalette=quantColorPalette.concat(quantColorPalette)}group.colorscale=[[0,quantColorPalette[0]],[.25,quantColorPalette[1]],[.5,quantColorPalette[2]],[.75,quantColorPalette[3]],[1,quantColorPalette[4]]];gData.push(group)})}else if(marker==="parcats"){var numFormattingStr=(useThousandSeparator?",":"")+(VizUtil.isEmpty(numDecimalDigits)?"":"."+numDecimalDigits+"f");if(numFormattingStr){numFormattingStr=":"+numFormattingStr}nestData.forEach(function(d){var leftCat={label:translateColumn(viz.x.name),categoryorder:"category ascending",values:[]};var rightCat={label:viz.skipYColumnNameTranslation==="on"?viz.y.name:translateColumn(viz.y.name),categoryorder:"category ascending",values:[]};var lcats=[],rcats=[];var datum={type:"parcats",dimensions:[leftCat,rightCat],counts:[],line:{},labelfont:{size:viz.xAxisTitleFontSize||viz._defaultXAxisTitleFontSize||14},tickfont:{size:viz.xAxisTickFontSize||viz._defaultXAxisTickFontSize||12}};if(opacity){datum.opacity=opacity}if(facet){datum.facet=d.facet}if(color){datum.line.color=[]}d.values.forEach(function(v,idx){if(v[orderRow]){if(color&&!VizUtil.isEmpty(v[colorbucket||color])){colorScale(v[colorbucket||color])}if(!VizUtil.isEmpty(v[x])){lcats.push(v[x])}if(!VizUtil.isEmpty(v[y])){rcats.push(v[y])}return}leftCat.values.push(v[x]);rightCat.values.push(v[y]);datum.counts.push(v[size]);if(color){datum.line.color.push(colorScale(v[colorbucket||color]))}if(color){datum.name=v[color]}else{datum.name=""}});datum.line.hovertemplate=translateColumn(viz.size.balloonDisplayName||(viz.size.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.size.name))+": %{count"+numFormattingStr+"}";datum.hovertemplate=translateColumn(viz.size.balloonDisplayName||(viz.size.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.size.name))+": %{count"+numFormattingStr+"}<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,viz.parcatsCategoryLabel||"Category")+": %{category}";if(lcats.length>0){leftCat.categoryorder="array";leftCat.categoryarray=VizUtil.makeArrayUnique(lcats).filter(function(v){return leftCat.values.indexOf(v)>-1})}if(rcats.length>0){rightCat.categoryorder="array";rightCat.categoryarray=VizUtil.makeArrayUnique(rcats).filter(function(v){return rightCat.values.indexOf(v)>-1})}gData.push(datum)})}else if(marker==="radar"){var hasLessThan3Categories=true;var _thresholdRatio=y1ValueSuffix==="%"?100:1;var useMarkerColor=viz.yValueOnPlotUseMarkerColor==="on";nestData.forEach(function(d){var datum={theta:[],r:[],hovertext:[],customdata:[],marker:{},hoverinfo:"text",type:"scatterpolar"};if(viz.fillLine==="on"){datum.fill="toself"}if(viz.radarMarkerSize){datum.marker.size=viz.radarMarkerSize;if(viz.radarMarkerSize==="0"){datum.mode="lines"}}if(viz.lineWidth){if(!datum.line){datum.line={}}datum.line.width=viz.lineWidth}if(viz.radarMarkerLineStyle){if(!datum.line){datum.line={}}datum.line.dash=viz.radarMarkerLineStyle}if(facet){datum.facet=d.facet}if(!color){datum.showlegend=false}if(viz.radarLongDataMode==="on"){d.values.forEach(function(v,idx){_text=new VizUtil.BalloonItemList;_data=new VizUtil.BalloonItemList;var yOp="y";var xVal=v[x];var yVal=v[y];datum.theta.push(v[x]);datum.r.push(VizUtil.isEmpty(yVal)?0:yVal);_text.add(xVal+": "+y1ValuePrefix+formatY1Value(yVal,colNaNMap[yOp])+y1ValueSuffix,marker,"y",true,viz[yOp].balloonPosition,viz[yOp].balloonPositionIndex,viz[yOp].balloonAddBrackets,viz[yOp].balloonInvisible||viz[yOp].balloonHideIfEmpty&&VizUtil.isEmpty(yVal));_data.add({type:"y",name:xVal,validName:xVal,rawValue:yVal,value:y1ValuePrefix+formatY1Value(yVal,colNaNMap[yOp])+y1ValueSuffix,func:viz[yOp].func,datatype:viz[yOp].type,filter:false},marker,"y",true,viz[yOp].balloonPosition,viz[yOp].balloonPositionIndex,viz[yOp].balloonAddBrackets,viz[yOp].balloonInvisible||viz[yOp].balloonHideIfEmpty&&VizUtil.isEmpty(yVal));if(color){_text.add(translateColumn(viz.color.balloonDisplayName||(viz.color.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.color.name))+": "+colorValuePrefix+formatValue(v[color],colNaNMap["color"])+colorValueSuffix,marker,"color",VizUtil.returnsNumericValue(viz.color)&&viz.color.func!=="ascategory",viz.color.balloonPosition,viz.color.balloonPositionIndex,viz.color.balloonAddBrackets,viz.color.balloonInvisible||viz.color.balloonHideIfEmpty&&VizUtil.isEmpty(v[color]));_data.add({type:"color",name:translateColumn(viz.color.balloonDisplayName||(viz.color.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.color.name)),validName:viz.color&&viz.color.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.color.validName,rawValue:bucketLabelMap.color?bucketLabelMap.color[v[color]]||v[color]:v[color],value:colorValuePrefix+formatValue(v[color],colNaNMap["color"])+colorValueSuffix,func:viz.color.func,datatype:viz.color.type,filter:!(/^(scatter|bubble)$/.test(marker)&&VizUtil.returnsNumericValue(viz.color))},marker,"color",VizUtil.returnsNumericValue(viz.color)&&viz.color.func!=="ascategory",viz.color.balloonPosition,viz.color.balloonPositionIndex,viz.color.balloonAddBrackets,viz.color.balloonInvisible||viz.color.balloonHideIfEmpty&&VizUtil.isEmpty(v[color]))}if(facet){_text.add(translateColumn(viz.facet.balloonDisplayName||(viz.facet.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.facet.name))+": "+formatValue(v[facet],colNaNMap["facet"]),marker,"facet",VizUtil.returnsNumericValue(viz.facet)&&viz.facet.func!=="ascategory",viz.facet.balloonPosition,viz.facet.balloonPositionIndex,viz.facet.balloonAddBrackets,viz.facet.balloonInvisible||viz.facet.balloonHideIfEmpty&&VizUtil.isEmpty(v[facet]));_data.add({type:"facet",name:translateColumn(viz.facet.balloonDisplayName||viz.facet.name),validName:viz.facet.validName,rawValue:bucketLabelMap.facet?bucketLabelMap.facet[v[facet]]||v[facet]:v[facet],value:formatValue(v[facet],colNaNMap["facet"]),func:viz.facet.func,datatype:viz.facet.type,filter:true},marker,"facet",false,viz.facet.balloonPosition,viz.facet.balloonPositionIndex,viz.facet.balloonAddBrackets,viz.facet.balloonInvisible||viz.facet.balloonHideIfEmpty&&VizUtil.isEmpty(v[facet]))}datum.customdata.push(_data.toArray());datum.hovertext.push(_text.toArray().join("<br>"));if(color){datum.name=v[color];datum.marker.color=colorScale(datum.name)}else{datum.name="";datum.marker.color=colorScale(viz.y?viz.y.validLabel:VALUE_FOR_NO_COLOR)}});datum.r.push(datum.r[0]);datum.theta.push(datum.theta[0]);datum.customdata.push(datum.customdata[0]);datum.hovertext.push(datum.hovertext[0])}else{d.values.forEach(function(v,idx){if(v[orderRow]){return}ys.forEach(function(y,idx){if(y){_text=new VizUtil.BalloonItemList;_data=new VizUtil.BalloonItemList;var yOp="y"+(idx===0?"":idx);var yName=translateColumn(viz[yOp+"ColumnName"]||(y.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:y.name));var yVal=v[y.validLabel];datum.theta.push(yName);datum.r.push(VizUtil.isEmpty(yVal)?0:yVal);_text.add(translateColumn(viz[yOp].balloonDisplayName||yName)+": "+y1ValuePrefix+formatY1Value(v[y.validLabel],colNaNMap[yOp])+y1ValueSuffix,marker,"y",true,viz[yOp].balloonPosition,viz[yOp].balloonPositionIndex,viz[yOp].balloonAddBrackets,viz[yOp].balloonInvisible||viz[yOp].balloonHideIfEmpty&&VizUtil.isEmpty(v[y.validLabel]));_data.add({type:"y",name:translateColumn(viz[yOp].balloonDisplayName||yName),validName:yName,rawValue:v[y.validLabel],value:y1ValuePrefix+formatY1Value(v[y.validLabel],colNaNMap[yOp])+y1ValueSuffix,func:viz[yOp].func,datatype:viz[yOp].type,filter:false},marker,"y",true,viz[yOp].balloonPosition,viz[yOp].balloonPositionIndex,viz[yOp].balloonAddBrackets,viz[yOp].balloonInvisible||viz[yOp].balloonHideIfEmpty&&VizUtil.isEmpty(v[y.validLabel]));if(color){_text.add(translateColumn(viz.color.balloonDisplayName||(viz.color.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.color.name))+": "+colorValuePrefix+formatValue(v[color],colNaNMap["color"])+colorValueSuffix,marker,"color",VizUtil.returnsNumericValue(viz.color)&&viz.color.func!=="ascategory",viz.color.balloonPosition,viz.color.balloonPositionIndex,viz.color.balloonAddBrackets,viz.color.balloonInvisible||viz.color.balloonHideIfEmpty&&VizUtil.isEmpty(v[color]));_data.add({type:"color",name:translateColumn(viz.color.balloonDisplayName||(viz.color.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.color.name)),validName:viz.color&&viz.color.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.color.validName,rawValue:bucketLabelMap.color?bucketLabelMap.color[v[color]]||v[color]:v[color],value:colorValuePrefix+formatValue(v[color],colNaNMap["color"])+colorValueSuffix,func:viz.color.func,datatype:viz.color.type,filter:!(/^(scatter|bubble)$/.test(marker)&&VizUtil.returnsNumericValue(viz.color))},marker,"color",VizUtil.returnsNumericValue(viz.color)&&viz.color.func!=="ascategory",viz.color.balloonPosition,viz.color.balloonPositionIndex,viz.color.balloonAddBrackets,viz.color.balloonInvisible||viz.color.balloonHideIfEmpty&&VizUtil.isEmpty(v[color]))}if(facet){_text.add(translateColumn(viz.facet.balloonDisplayName||(viz.facet.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.facet.name))+": "+formatValue(v[facet],colNaNMap["facet"]),marker,"facet",VizUtil.returnsNumericValue(viz.facet)&&viz.facet.func!=="ascategory",viz.facet.balloonPosition,viz.facet.balloonPositionIndex,viz.facet.balloonAddBrackets,viz.facet.balloonInvisible||viz.facet.balloonHideIfEmpty&&VizUtil.isEmpty(v[facet]));_data.add({type:"facet",name:translateColumn(viz.facet.balloonDisplayName||viz.facet.name),validName:viz.facet.validName,rawValue:bucketLabelMap.facet?bucketLabelMap.facet[v[facet]]||v[facet]:v[facet],value:formatValue(v[facet],colNaNMap["facet"]),func:viz.facet.func,datatype:viz.facet.type,filter:true},marker,"facet",false,viz.facet.balloonPosition,viz.facet.balloonPositionIndex,viz.facet.balloonAddBrackets,viz.facet.balloonInvisible||viz.facet.balloonHideIfEmpty&&VizUtil.isEmpty(v[facet]))}datum.customdata.push(_data.toArray());datum.hovertext.push(_text.toArray().join("<br>"))}});datum.r.push(datum.r[0]);datum.theta.push(datum.theta[0]);datum.customdata.push(datum.customdata[0]);datum.hovertext.push(datum.hovertext[0]);if(color){datum.name=v[color];datum.marker.color=colorScale(datum.name)}else{datum.name="";datum.marker.color=colorScale(viz.y?viz.y.validLabel:VALUE_FOR_NO_COLOR)}})}if(datum.fill&&datum.marker.color&&opacity){datum.fillcolor=_setOpacity(datum.marker.color,opacity)}var fontSize=viz["yValueOnPlotFontSize"]||viz._defaultValuesOnPlotFontSize||null;if(yValueOnPlot==="on"){var indexes=_findValueOnPlotIndexes(datum.r,datum,"y",viz,_thresholdRatio);datum.text=datum.r.slice().map(function(v,idx){if(VizUtil.isEmpty(v)){return""}else if(!indexes[idx]){return""}return y1ValuePrefix+formatY1Value(v)+y1ValueSuffix});datum.textposition=yValueOnPlotPosition+" "+(viz.yValueOnPlotHAlign||"right");datum.mode=datum.mode?datum.mode+"+text":"lines+markers+text";if(fontSize){datum.textfont={size:fontSize}}if(useMarkerColor&&datum.marker&&datum.marker.color&&typeof datum.marker.color==="string"){if(!datum.textfont){datum.textfont={}}datum.textfont.color=datum.marker.color}}if(datum.theta.length>3){hasLessThan3Categories=false}gData.push(datum)});if(hasLessThan3Categories){if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,errorMessage:"You need to assign 3 or more columns to Value in order to show the Radar chart."})}VizUtil.renderNoData(targetElem,VizUtil.getMessage(PlotlyGraphGenerator._lang,viz.radarNotEnoughCategoriesMessage||"You need to assign 3 or more columns to Value in order to show the Radar chart."));return}}else{var FITTED_COLUMN="predicted_value";var CONF_HIGH_COLUMN="conf_high";var CONF_LOW_COLUMN="conf_low";var REFLINE_COLUMN="refline";var REFLINE_RANGE_COLUMN="refrange";var _color=color;var rangeLegendgroup=1;var trendLineLegendgroup=1;var trendLineRangeLegendgroup=1;var reflineHash={};var vreflineHash={};nestData.forEach(function(d){var group={name:d.key,marker:{line:{width:0}},line:{},customdata:[]};if(color&&facet&&marker==="violin"){group.offsetgroup=group.name}if(d.yOp){group.yOp=d.yOp;group._colorVal=viz[d.yOp].validLabel}var range={x:[],hi:[],low:[]};var trendLineRange={x:[],hi:[],low:[]};var trendLineGroup={x:[],y:[],hovertext:[],hoverinfo:"text",mode:"lines",showlegend:false};if(!color&&y&&!isMultiY){if(marker==="bubble"){group.name=viz.groupby?viz.groupby.type===VizUtil.TYPE_ROWID?VizUtil.ROWID_COL_LABEL:viz.groupby.name:viz.y?viz.y.name:""}else if(marker==="hist"){group.name=viz.x?viz.x.name:""}else{group.name=viz.y.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.y.name}}if(group.name==="null"){group.name=NA_LABEL}if(allowMultiYAndColor){group.name=VizUtil.getMessage(PlotlyGraphGenerator._lang,group.name)}if(facet){group.facet=d.facet}if(/^(bar|errbar)$/.test(marker)&&viz.x&&!VizUtil.returnsNumericValue(viz.x)&&!VizUtil.returnsDateValue(viz.x)&&sortTarget&&sortTargetCol&&(!viz._desktopVersion||VizUtil.compareVersionStr(viz._desktopVersion,"5.3.2.1")<0)){d.values.sort(valueSortFunc)}var yop=d.yOp||"y",xop="x";var reflineEnabled=!!viz[yop+"ReflineType"]&&viz[yop+"ReflineType"]!=="none"&&VizUtil.isHorizontalReferenceLineSupported(marker);var reflineRangeEnabled=!!viz[yop+"ReflineRangeType"]&&viz[yop+"ReflineRangeType"]!=="none"&&VizUtil.isHorizontalReferenceLineSupported(marker);var vReflineEnabled=!!viz[xop+"ReflineType"]&&viz[xop+"ReflineType"]!=="none"&&VizUtil.isVerticalReferenceLineSupported(marker);var vReflineRangeEnabled=!!viz[xop+"ReflineRangeType"]&&viz[xop+"ReflineRangeType"]!=="none"&&VizUtil.isVerticalReferenceLineSupported(marker);trendLineGroup.line={width:viz[yop+"TrendLineWidth"]||1,dash:viz[yop+"TrendLineType"]||"dot"};var markerShape=viz[yop+"MarkerShape"];var markerSize=viz[yop+"MarkerSize"];var markerStyle=viz[yop+"MarkerLineStyle"];var markerOpacity=viz[yop+"FillOpacity"];var markerCircleSize=viz[yop+"MarkerCircleSize"];if(isGroupByMeasuresEnabled){reflineEnabled=!!colMap[group.facet].reflineType&&colMap[group.facet].reflineType!=="none"&&/^(bar|line|scatter|bubble|errbar)$/.test(marker);reflineRangeEnabled=!!colMap[group.facet].reflineRangeType&&colMap[group.facet].reflineRangeType!=="none"&&/^(bar|line|scatter|bubble|errbar)$/.test(marker);trendLineGroup.line.width=colMap[group.facet].trendLineWidth||1,trendLineGroup.line.dash=colMap[group.facet].trendLineType||"dot";markerShape=colMap[group.facet].markerShape;markerSize=colMap[group.facet].markerSize;markerStyle=colMap[group.facet].markerStyle;markerOpacity=colMap[group.facet].markerOpacity;markerCircleSize=colMap[group.facet].markerCircleSize}if(/^(scatter|line|bar)$/.test(marker)&&markerShape){switch(markerShape){case"circle":group.type="scatter";group.mode="markers";if(/^(bar|line)$/.test(marker)&&markerSize){group.marker.size=markerSize}if(allowMultiYAndColor&&viz.multiYAndColorOpacity){group.marker.opacity=parseFloat(viz.multiYAndColorOpacity)}if(!VizUtil.isEmpty(markerOpacity)){group.marker.opacity=parseFloat(markerOpacity)}break;case"bar":group.type="bar";group.mode=null;if(!VizUtil.isEmpty(markerOpacity)){group.opacity=parseFloat(markerOpacity)}break;case"line":group.type="scatter";group.mode="lines";if(markerSize){group.line.width=markerSize}if(markerStyle){group.line.dash=markerStyle}group.opacity=opacity;if(!VizUtil.isEmpty(markerOpacity)){group.opacity=parseFloat(markerOpacity)}break;case"line+circle":group.type="scatter";group.mode="lines+markers";if(/^(bar|line)$/.test(marker)&&markerCircleSize){group.marker.size=markerCircleSize}if(markerSize){group.line.width=markerSize}if(markerStyle){group.line.dash=markerStyle}group.opacity=opacity;if(!VizUtil.isEmpty(markerOpacity)){group.opacity=parseFloat(markerOpacity)}break;case"default":if(marker==="line"){if(markerSize){group.line.width=markerSize}if(markerStyle){group.line.dash=markerStyle}group.opacity=opacity;if(!VizUtil.isEmpty(markerOpacity)){group.opacity=parseFloat(markerOpacity)}}else{if(!VizUtil.isEmpty(markerOpacity)){group.marker.opacity=parseFloat(markerOpacity)}}break}}if(marker==="line"&&!markerShape){if(markerSize){group.line.width=markerSize}if(markerStyle){group.line.dash=markerStyle}}if(marker==="bubble"){group.type="scatter";group.mode="markers"}if(d.use2ndAxis){group.use2ndAxis=d.use2ndAxis;group.yaxis="y2"}var histRange=null;if(marker==="hist"&&d.values&&d.values.length>1){histRange=Math.abs(d.values[d.values.length-1][x]-d.values[d.values.length-2][x])/2;group.histRange=histRange}var _y=isMultiY?d.ycolname:y;var _xDateParser=null,_xDateFormatter=null,xHoverFormatter=null;if(viz.x&&VizUtil.returnsDateValue(viz.x)&&viz.xHoverFormat){_xDateParser=d3.time.format("%Y-%m-%d").parse;_xDateFormatter=d3.time.format(viz.xHoverFormat);xHoverFormatter=function(datestr){if(!datestr){return null}return _xDateFormatter(_xDateParser(datestr))}}var isLineGroup=xAxisDataTypeDetection&&label&&d.values.some(function(v){return v[label]==="line"});var prefix,suffix,formatfunc;d.values.forEach(function(v,idx){_text=new VizUtil.BalloonItemList;_data=new VizUtil.BalloonItemList;if(marker==="scatter"&&allowMultiYAndColor){if(VizUtil.isUndefined(v[_y])&&!VizUtil.isUndefined(v[y])){_y=y}}if(marker!=="scatter"||!VizUtil.isUndefined(v[x])&&!VizUtil.isUndefined(v[_y])){var nrow=null;if(v[VizUtil.NROW_INTERNAL_COL_NAME]){nrow=v[VizUtil.NROW_INTERNAL_COL_NAME]}else if(marker==="hist"){nrow=v[y]}if(viz.y&&viz.y.type===VizUtil.TYPE_NUMROWS&&viz.yWindowFunc&&viz.yWindowFunc==="none"){nrow=null}if(viz.marker==="errbar"&&VizUtil.getErrorBarCalcType(viz)==="ratio"&&viz.y&&VizUtil.isEmpty(v[VizUtil.ERRBAR_NUMERATOR_INTERNAL_COL_NAME])){nrow=null}if(nrow){_data.add({type:"nrow",name:VizUtil.getMessage(PlotlyGraphGenerator._lang,"(Number of Rows)"),validName:VizUtil.NUMROWS_COL_NAME,rawValue:nrow,value:formatNumrowValue(nrow),func:"count",datatype:"numeric",filter:false},marker,"nrow",true,"bottom",null,null,null);if(viz.marker!=="errbar"&&viz.showNumberOfRowsInBalloon==="on"||viz.marker==="errbar"&&VizUtil.getErrorBarCalcType(viz)!=="ratio"){_text.add(VizUtil.getMessage(PlotlyGraphGenerator._lang,"(Number of Rows)")+": "+formatNumrowValue(nrow),marker,"nrow",true,"bottom",null,null,null)}}if(groupby){_text.add(translateColumn(viz.groupby.balloonDisplayName||(viz.groupby.type===VizUtil.TYPE_ROWID?VizUtil.ROWID_COL_LABEL:viz.groupby.name))+": "+formatValue(v[groupby],colNaNMap["groupby"]),marker,"groupby",false,viz.groupby.balloonPosition,viz.groupby.balloonPositionIndex,viz.groupby.balloonAddBrackets,viz.groupby.balloonInvisible||viz.groupby.balloonHideIfEmpty&&VizUtil.isEmpty(v[groupby]));_data.add({type:"groupby",name:translateColumn(viz.groupby.balloonDisplayName||(viz.groupby.type===VizUtil.TYPE_ROWID?VizUtil.ROWID_COL_LABEL:viz.groupby.name)),validName:viz.groupby.type===VizUtil.TYPE_ROWID?VizUtil.ROWID_COL_NAME:viz.groupby.validName,rawValue:bucketLabelMap.groupby?bucketLabelMap.groupby[v[groupby]]||v[groupby]:v[groupby],value:formatValue(v[groupby],colNaNMap["groupby"]),func:viz.groupby.func,datatype:viz.groupby.type,filter:marker==="bubble"?true:viz.groupby.type!==VizUtil.TYPE_ROWID},marker,"groupby",false,viz.groupby.balloonPosition,viz.groupby.balloonPositionIndex,viz.groupby.balloonAddBrackets,viz.groupby.balloonInvisible||viz.groupby.balloonHideIfEmpty&&VizUtil.isEmpty(v[groupby]))}if(facet&&!isGroupByMeasuresEnabled){_data.add({type:"facet",name:translateColumn(viz.facet.balloonDisplayName||viz.facet.name),validName:viz.facet.validName,rawValue:bucketLabelMap.facet?bucketLabelMap.facet[v[facet]]||v[facet]:v[facet],value:formatValue(v[facet],colNaNMap["facet"]),func:viz.facet.func,datatype:viz.facet.type,filter:true},marker,"facet",false,viz.facet.balloonPosition,viz.facet.balloonPositionIndex,viz.facet.balloonAddBrackets,viz.facet.balloonInvisible||viz.facet.balloonHideIfEmpty&&VizUtil.isEmpty(v[facet]))}if(color){_text.add(translateColumn(viz.color.balloonDisplayName||(viz.color&&viz.color.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.color&&viz.color.type===VizUtil.TYPE_YAXIS?YAXIS_COL_LABEL:viz.color.name))+": "+(marker==="scatter"&&VizUtil.isEmpty(v[color])?NA_LABEL:colorValuePrefix+formatValue(v[color],colNaNMap["color"])+colorValueSuffix),marker,"color",VizUtil.returnsNumericValue(viz.color)&&viz.color.func!=="ascategory",viz.color.balloonPosition,viz.color.balloonPositionIndex,viz.color.balloonAddBrackets,viz.color.balloonInvisible||viz.color.balloonHideIfEmpty&&VizUtil.isEmpty(v[color]));_data.add({type:"color",name:translateColumn(viz.color.balloonDisplayName||(viz.color&&viz.color.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.color&&viz.color.type===VizUtil.TYPE_YAXIS?YAXIS_COL_LABEL:viz.color.name)),validName:viz.color&&viz.color.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.color.validName,rawValue:marker==="scatter"&&VizUtil.isEmpty(v[color])?NA_LABEL:bucketLabelMap.color?bucketLabelMap.color[v[color]]||v[color]:v[color],value:marker==="scatter"&&VizUtil.isEmpty(v[color])?NA_LABEL:colorValuePrefix+formatValue(v[color],colNaNMap["color"])+colorValueSuffix,func:viz.color.func,datatype:viz.color.type,filter:!(marker==="scatter"&&VizUtil.returnsNumericValue(viz.color)||marker==="bubble"&&VizUtil.returnsNumericValue(viz.color)&&VizUtil.AGGREGATION_FUNCTION_OPTIONS_HASH[viz.color.func]||viz.color&&viz.color.type===VizUtil.TYPE_YAXIS)},marker,"color",VizUtil.returnsNumericValue(viz.color)&&viz.color.func!=="ascategory",viz.color.balloonPosition,viz.color.balloonPositionIndex,viz.color.balloonAddBrackets,viz.color.balloonInvisible||viz.color.balloonHideIfEmpty&&VizUtil.isEmpty(v[color]))}if(size){if(!group.marker.size)group.marker.size=[];group.marker.size.push(v[size]);_text.add(translateColumn(viz.size.balloonDisplayName||(viz.size&&viz.size.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.size.name))+": "+sizeValuePrefix+formatValue(v[size],colNaNMap["size"])+sizeValueSuffix,marker,"size",true,viz.size.balloonPosition,viz.size.balloonPositionIndex,viz.size.balloonAddBrackets,viz.size.balloonInvisible||viz.size.balloonHideIfEmpty&&VizUtil.isEmpty(v[size]));_data.add({type:"size",name:translateColumn(viz.size.balloonDisplayName||(viz.size&&viz.size.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.size.name)),validName:viz.size&&viz.size.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.size.validName,rawValue:v[size],value:sizeValuePrefix+formatValue(v[size],colNaNMap["size"])+sizeValueSuffix,func:viz.size.func,datatype:viz.size.type,filter:false},marker,"size",true,viz.size.balloonPosition,viz.size.balloonPositionIndex,viz.size.balloonAddBrackets,viz.size.balloonInvisible||viz.size.balloonHideIfEmpty&&VizUtil.isEmpty(v[size]))}else if(/^(scatter)$/.test(marker)){if(Object.prototype.hasOwnProperty.call(v,"..size")){if(!group.marker.size)group.marker.size=[];group.marker.size.push(v["..size"]?1:null)}}else if(marker==="bubble"){if(Object.prototype.hasOwnProperty.call(v,"..is.order.row")){if(!group.marker.size)group.marker.size=[];group.marker.size.push(v["..is.order.row"]==="TRUE"?null:1)}}if(label){if(!group._label)group._label=[];group._label.push(v[label]);if(!viz.hideLabel&&!allowMultiYAndColor&&!xAxisDataTypeDetection&&yLineFillColumn!=="label"&&xReflineConstantColumn!=="label"&&xReflineConstantColumnExtraTarget!=="label"&&viz.label.balloonHideLabelOn!==(d.yOp||"y")){_text.add(translateColumn(viz.label.balloonDisplayName||(viz.label&&viz.label.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label.name))+": "+label1ValuePrefix+formatValue(v[label],colNaNMap["label"])+label1ValueSuffix,marker,"label",false,viz.label.balloonPosition,viz.label.balloonPositionIndex,viz.label.balloonAddBrackets,viz.label.balloonInvisible||viz.label.balloonHideIfEmpty&&VizUtil.isEmpty(v[label]));_data.add({type:"x",name:translateColumn(viz.label.balloonDisplayName||(viz.label&&viz.label.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label.name)),validName:viz.label&&viz.label.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.label.validName,rawValue:v[label],value:label1ValuePrefix+formatValue(v[label],colNaNMap["label"])+label1ValueSuffix,func:viz.label.func,datatype:viz.label.type,filter:false},marker,"label",false,viz.label.balloonPosition,viz.label.balloonPositionIndex,viz.label.balloonAddBrackets,viz.label.balloonInvisible||viz.label.balloonHideIfEmpty&&VizUtil.isEmpty(v[label]))}}if(label2&&(allowMultiYAndColor||enableLabel2)&&yLineFillColumn!=="label2"&&xReflineConstantColumn!=="label2"&&xReflineConstantColumnExtraTarget!=="label2"&&viz.label2.balloonHideLabelOn!==(d.yOp||"y")){if(!(viz.hideLabel2||viz.hideEmptyLabel2&&VizUtil.isEmpty(v[label2]))){_text.add(translateColumn(viz.label2.balloonDisplayName||(viz.label2&&viz.label2.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label2.name))+": "+label2ValuePrefix+formatValue(v[label2],colNaNMap["label2"])+label2ValueSuffix,marker,"label2",false,viz.label2.balloonPosition,viz.label2.balloonPositionIndex,viz.label2.balloonAddBrackets,viz.label2.balloonInvisible||viz.label2.balloonHideIfEmpty&&VizUtil.isEmpty(v[label2]));_data.add({type:"x",name:translateColumn(viz.label2.balloonDisplayName||(viz.label2&&viz.label2.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label2.name)),validName:viz.label2&&viz.label2.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.label2.validName,rawValue:v[label2],value:label2ValuePrefix+formatValue(v[label2],colNaNMap["label2"])+label2ValueSuffix,func:viz.label2.func,datatype:viz.label2.type,filter:false},marker,"label2",false,viz.label2.balloonPosition,viz.label2.balloonPositionIndex,viz.label2.balloonAddBrackets,viz.label2.balloonInvisible||viz.label2.balloonHideIfEmpty&&VizUtil.isEmpty(v[label2]))}}if(label3&&yLineFillColumn!=="label3"&&xReflineConstantColumn!=="label3"&&xReflineConstantColumnExtraTarget!=="label3"&&viz.label3.balloonHideLabelOn!==(d.yOp||"y")){_text.add(translateColumn(viz.label3.balloonDisplayName||(viz.label3&&viz.label3.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label3.name))+": "+label3ValuePrefix+formatValue(v[label3],colNaNMap["label3"])+label3ValueSuffix,marker,"label3",false,viz.label3.balloonPosition,viz.label3.balloonPositionIndex,viz.label3.balloonAddBrackets,viz.label3.balloonInvisible||viz.label3.balloonHideIfEmpty&&VizUtil.isEmpty(v[label3]));_data.add({type:"x",name:translateColumn(viz.label3.balloonDisplayName||(viz.label3&&viz.label3.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label3.name)),validName:viz.label3&&viz.label3.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.label3.validName,rawValue:v[label3],value:label3ValuePrefix+formatValue(v[label3],colNaNMap["label3"])+label3ValueSuffix,func:viz.label3.func,datatype:viz.label3.type,filter:false},marker,"label3",false,viz.label3.balloonPosition,viz.label3.balloonPositionIndex,viz.label3.balloonAddBrackets,viz.label3.balloonInvisible||viz.label3.balloonHideIfEmpty&&VizUtil.isEmpty(v[label3]))}if(label4&&yLineFillColumn!=="label4"&&xReflineConstantColumn!=="label4"&&xReflineConstantColumnExtraTarget!=="label4"&&viz.label4.balloonHideLabelOn!==(d.yOp||"y")){_text.add(translateColumn(viz.label4.balloonDisplayName||(viz.label4&&viz.label4.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label4.name))+": "+label4ValuePrefix+formatValue(v[label4],colNaNMap["label4"])+label4ValueSuffix,marker,"label4",false,viz.label4.balloonPosition,viz.label4.balloonPositionIndex,viz.label4.balloonAddBrackets,viz.label4.balloonInvisible||viz.label4.balloonHideIfEmpty&&VizUtil.isEmpty(v[label4]));_data.add({type:"x",name:translateColumn(viz.label4.balloonDisplayName||(viz.label4&&viz.label4.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label4.name)),validName:viz.label4&&viz.label4.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.label4.validName,rawValue:v[label4],value:label4ValuePrefix+formatValue(v[label4],colNaNMap["label4"])+label4ValueSuffix,func:viz.label4.func,datatype:viz.label4.type,filter:false},marker,"label4",false,viz.label4.balloonPosition,viz.label4.balloonPositionIndex,viz.label4.balloonAddBrackets,viz.label4.balloonInvisible||viz.label4.balloonHideIfEmpty&&VizUtil.isEmpty(v[label4]))}if(label5&&yLineFillColumn!=="label5"&&xReflineConstantColumn!=="label5"&&xReflineConstantColumnExtraTarget!=="label5"&&viz.label5.balloonHideLabelOn!==(d.yOp||"y")){_text.add(translateColumn(viz.label5.balloonDisplayName||(viz.label5&&viz.label5.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label5.name))+": "+label5ValuePrefix+formatValue(v[label5],colNaNMap["label5"])+label5ValueSuffix,marker,"label5",false,viz.label5.balloonPosition,viz.label5.balloonPositionIndex,viz.label5.balloonAddBrackets,viz.label5.balloonInvisible||viz.label5.balloonHideIfEmpty&&VizUtil.isEmpty(v[label5]));_data.add({type:"x",name:translateColumn(viz.label5.balloonDisplayName||(viz.label5&&viz.label5.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label5.name)),validName:viz.label5&&viz.label5.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.label5.validName,rawValue:v[label5],value:label5ValuePrefix+formatValue(v[label5],colNaNMap["label5"])+label5ValueSuffix,func:viz.label5.func,datatype:viz.label5.type,filter:false},marker,"label5",false,viz.label5.balloonPosition,viz.label5.balloonPositionIndex,viz.label5.balloonAddBrackets,viz.label5.balloonInvisible||viz.label5.balloonHideIfEmpty&&VizUtil.isEmpty(v[label5]))}if(x){if(!group.x)group.x=[];group.x.push(v[x]);if(histRange){_text.add(translateColumn(viz.x.balloonDisplayName||viz.x.name)+": "+xValuePrefix+formatXValue(v[x]-histRange,false)+xValueSuffix+" - "+xValuePrefix+formatXValue(v[x]+histRange,false)+xValueSuffix,marker,"x",true,viz.x.balloonPosition,viz.x.balloonPositionIndex,viz.x.balloonAddBrackets,viz.x.balloonInvisible||viz.x.balloonHideIfEmpty&&VizUtil.isEmpty(v[x]));_data.add({type:"x",name:translateColumn(viz.x.balloonDisplayName||viz.x.name),validName:viz.x.validName,rawValue:bucketLabelMap.x?bucketLabelMap.x[v[x]]||v[x]:v[x],value:xValuePrefix+formatXValue(v[x]-histRange,false)+xValueSuffix+" - "+xValuePrefix+formatXValue(v[x]+histRange,false)+xValueSuffix,func:viz.x.func,datatype:viz.x.type,filter:true,histRange:histRange},marker,"x",true,viz.x.balloonPosition,viz.x.balloonPositionIndex,viz.x.balloonAddBrackets,viz.x.balloonInvisible||viz.x.balloonHideIfEmpty&&VizUtil.isEmpty(v[x]))}else{var _val=!xHoverFormatter?xValuePrefix+formatXValue(v[x],colNaNMap["x"])+xValueSuffix:xHoverFormatter(v[x]);_text.add(translateColumn(viz.x.balloonDisplayName||(viz.x.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.x.name))+": "+_val,marker,"x",VizUtil.returnsNumericValue(viz.x)&&viz.x.func!=="ascategory",viz.x.balloonPosition,viz.x.balloonPositionIndex,viz.x.balloonAddBrackets,viz.x.balloonInvisible||viz.x.balloonHideIfEmpty&&VizUtil.isEmpty(v[x]));_data.add({type:"x",name:translateColumn(viz.x.balloonDisplayName||(viz.x.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.x.name)),validName:viz.x&&viz.x.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.x.validName,rawValue:bucketLabelMap.x?bucketLabelMap.x[v[x]]||v[x]:v[x],value:_val,func:marker==="scatter"&&viz.x.isNumeric?"round":viz.x.func,datatype:viz.x.type,filter:!(marker==="bubble"&&VizUtil.returnsNumericValue(viz.x)&&VizUtil.AGGREGATION_FUNCTION_OPTIONS_HASH[viz.x.func]),numDecimalDigits:numDecimalDigitsForFilter},marker,"x",VizUtil.returnsNumericValue(viz.x)&&viz.x.func!=="ascategory",viz.x.balloonPosition,viz.x.balloonPositionIndex,viz.x.balloonAddBrackets,viz.x.balloonInvisible||viz.x.balloonHideIfEmpty&&VizUtil.isEmpty(v[x]))}}if(_y){if(!group.y)group.y=[];if(!group.ygbysum)group.ygbysum=[];var ycol="y";var errLow=viz.yErrLow||viz.errLow;var errHigh=viz.yErrHigh||viz.errHigh;var errLowValue=viz.yErrLowValue;var errHighValue=viz.yErrHighValue;var errHighLowEnabled=viz.yErrHighLowEnabled||viz.errHighLowEnabled;var errHighLowRangeFunc=viz.yErrHighLowRangeFunc;var errBarWidth=viz.yErrBarWidth||viz.errBarWidth;var errBarThickness=viz.yErrBarThickness;var errBarCircleSize=viz.yMarkerCircleSize;if(viz.yErrHighLowEnabledOnUI==="off"){errHighLowEnabled="off"}if(isMultiY){if(!viz.color)_color=d.ycolname;ycol=d.yOp;errLow=viz[d.yOp+"ErrLow"];errHigh=viz[d.yOp+"ErrHigh"];errLowValue=viz[d.yOp+"ErrLowValue"];errHighValue=viz[d.yOp+"ErrHighValue"];errHighLowEnabled=viz[d.yOp+"ErrHighLowEnabled"];errHighLowRangeFunc=viz[d.yOp+"ErrHighLowRangeFunc"];errBarWidth=viz[d.yOp+"ErrBarWidth"];errBarThickness=viz[d.yOp+"ErrBarThickness"];errBarCircleSize=viz[d.yOp+"MarkerCircleSize"];if(viz[d.yOp+"ErrHighLowEnabledOnUI"]==="off"){errHighLowEnabled="off"}}group.y.push(v[_y]);if(!VizUtil.isUndefined(v[_y+".gbysum"])){group.ygbysum.push(v[_y+".gbysum"])}var lineDistRangeEnabled=_y&&errHighLowEnabled==="func"&&!VizUtil.isUndefined(v[_y+"eb"])&&marker==="line";if(!VizUtil.isUndefined(v[_y])){var winfunc=d.winfunc&&d.winfunc!=="none"?" ("+VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.WINDOW_FUNCTION_OPTIONS_HASH[d.winfunc])+")":"";prefix=d.use2ndAxis?y2ValuePrefix:y1ValuePrefix;suffix=d.use2ndAxis?y2ValueSuffix:y1ValueSuffix;if(isGroupByMeasuresEnabled&&colMap[v[facet]]){prefix=colMap[v[facet]].valuePrefix;suffix=colMap[v[facet]].valueSuffix;winfunc=colMap[v[facet]].winfunc&&colMap[v[facet]].winfunc!=="none"?" ("+VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.WINDOW_FUNCTION_OPTIONS_HASH[colMap[v[facet]].winfunc])+")":""}if(marker==="errbar"||marker==="errbar-agg"){winfunc=" ("+(VizUtil.getErrorBarCalcType(viz)==="ratio"?VizUtil.getMessage(PlotlyGraphGenerator._lang,"Ratio"):VizUtil.getMessage(PlotlyGraphGenerator._lang,"Mean"))+")"}formatfunc=d.use2ndAxis?formatY2Value:formatY1Value;if(isMultiY){var _dispname=null,_coldef=null;if(!ycol){_coldef=viz.y;_dispname=translateColumn(_coldef.balloonDisplayName||(_coldef.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:_coldef.name))}else{_coldef=viz[ycol];_dispname=translateColumn(_coldef.balloonDisplayName||group.name)}_text.add(_dispname+(legendShowFuncName?"":winfunc)+": "+prefix+formatfunc(v[_y],colNaNMap[_y])+suffix,marker,"y",VizUtil.returnsNumericValue(_coldef)&&_coldef.func!=="ascategory",_coldef.balloonPosition,_coldef.balloonPositionIndex,_coldef.balloonAddBrackets,_coldef.balloonInvisible||_coldef.balloonHideIfEmpty&&VizUtil.isEmpty(v[_y]));_data.add({type:"y",name:_dispname+(legendShowFuncName?"":winfunc),validName:_coldef.validName,rawValue:bucketLabelMap.y?bucketLabelMap.y[v[_y]]||v[_y]:v[_y],value:VizUtil.isEmpty(v[_y],true)?"":prefix+formatfunc(v[_y],colNaNMap[_y])+suffix,func:marker==="scatter"&&_coldef.isNumeric?"round":_coldef.func,datatype:null,filter:marker==="scatter"||marker==="bubble"&&!(VizUtil.returnsNumericValue(viz.y)&&viz.y.func!=="ascategory"),numDecimalDigits:numDecimalDigitsForFilter},marker,"y",VizUtil.returnsNumericValue(_coldef)&&_coldef.func!=="ascategory",_coldef.balloonPosition,_coldef.balloonPositionIndex,_coldef.balloonAddBrackets,_coldef.balloonInvisible||_coldef.balloonHideIfEmpty&&VizUtil.isEmpty(v[_y]));if(lineDistRangeEnabled&&!VizUtil.isUndefined(v[_y+"eb"])){_text.add(VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range")+": "+prefix+formatfunc(v[_y+"eb"],false)+suffix+" ("+prefix+formatfunc(v[_y]-v[_y+"eb"],false)+suffix+" - "+prefix+formatfunc(v[_y]+v[_y+"eb"],false)+suffix+")",marker,"eb",true,_coldef.balloonPosition,_coldef.balloonPositionIndex,_coldef.balloonAddBrackets,_coldef.balloonInvisible||_coldef.balloonHideIfEmpty&&VizUtil.isEmpty(v[_y+"eb"]));_data.add({type:"y",name:VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range"),validName:VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range"),rawValue:v[_y],value:""+prefix+formatfunc(v[_y+"eb"],false)+suffix+" ("+prefix+formatfunc(v[_y]-v[_y+"eb"],false)+suffix+" - "+prefix+formatfunc(v[_y]+v[_y+"eb"],false)+suffix+")",func:null,datatype:null,filter:false,numDecimalDigits:numDecimalDigitsForFilter},marker,"eb",true,_coldef.balloonPosition,_coldef.balloonPositionIndex,_coldef.balloonAddBrackets,_coldef.balloonInvisible||_coldef.balloonHideIfEmpty&&VizUtil.isEmpty(v[_y+"eb"]))}}else{if(viz.y){if(!VizUtil.isUndefined(v[y+"eb"])){var yval=VizUtil.isEmpty(v[y],true)?"":prefix+formatfunc(v[y],colNaNMap["y"])+suffix;_text.add(translateColumn(viz.y.balloonDisplayName||(viz.y.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.y.name))+winfunc+": "+yval,marker,"eb",true,viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(v[y]));_data.add({type:"y",name:translateColumn(viz.y.balloonDisplayName||(viz.y.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.y.name))+winfunc,validName:viz.y.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.y.validName,rawValue:v[y],value:yval,func:marker==="scatter"&&viz.y.isNumeric?"round":viz[ycol].func,datatype:null,filter:false,numDecimalDigits:numDecimalDigitsForFilter},marker,"eb",true,viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(v[y]));var den,denLabel,num,numLabel;if(marker==="errbar"&&VizUtil.getErrorBarCalcType(viz)==="ratio"&&!VizUtil.isEmpty(v[VizUtil.ERRBAR_NUMERATOR_INTERNAL_COL_NAME])){num=v[VizUtil.ERRBAR_NUMERATOR_INTERNAL_COL_NAME];den=num/v[y]*100;if(!isNaN(den)){if(/^(truecount|falsecount|nacount|nnacount)$/.test(viz.y.func)){den=Math.round(den)}var ratioBy=VizUtil.getErrorBarDirection(viz)==="color"?VizUtil.getMessage(PlotlyGraphGenerator._lang,"X Axis"):VizUtil.getErrorBarDirection(viz)==="x"?VizUtil.getMessage(PlotlyGraphGenerator._lang,"Color"):VizUtil.getMessage(PlotlyGraphGenerator._lang,"All");denLabel=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Total Number")+" ("+VizUtil.getMessage(PlotlyGraphGenerator._lang,ratioBy)+")";_data.add({type:"nrow",name:denLabel,validName:VizUtil.NUMROWS_COL_NAME,rawValue:den,value:formatfunc(den,false),func:"count",datatype:"numeric",filter:false},marker,"nrow",true,"bottom",null,null,null);_text.add(denLabel+": "+formatfunc(den,false),marker,"nrow",true,"bottom",null,null,null);numLabel=VizUtil.getMessage(PlotlyGraphGenerator._lang,NUMROWS_COL_LABEL);if(viz.y.type!==VizUtil.TYPE_NUMROWS){numLabel=viz.y.name+" ("+VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.AGGREGATION_FUNCTION_OPTIONS_HASH[viz.y.func])+")"}_data.add({type:"nrow",name:numLabel,validName:VizUtil.NUMROWS_COL_NAME,rawValue:num,value:formatfunc(num,false),func:"count",datatype:"numeric",filter:false},marker,"nrow",true,"bottom",null,null,null);_text.add(numLabel+": "+formatfunc(num,false),marker,"nrow",true,"bottom",null,null,null)}}if(marker==="errbar-agg"){den=v[errbarSampleSize];denLabel=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Total Number");_data.add({type:"nrow",name:denLabel,validName:VizUtil.NUMROWS_COL_NAME,rawValue:den,value:formatfunc(den,false),func:"count",datatype:"numeric",filter:false},marker,"nrow",true,"bottom",null,null,null);_text.add(denLabel+": "+formatfunc(den,false),marker,"nrow",true,"bottom",null,null,null);if(VizUtil.getErrorBarCalcType(viz)==="ratio"){num=v[VizUtil.ERRBAR_NUMERATOR_INTERNAL_COL_NAME];numLabel=viz.y.name+" ("+VizUtil.getMessage(PlotlyGraphGenerator._lang,"#True")+")";_data.add({type:"nrow",name:numLabel,validName:VizUtil.NUMROWS_COL_NAME,rawValue:num,value:formatfunc(num,false),func:"count",datatype:"numeric",filter:false},marker,"nrow",true,"bottom",null,null,null);_text.add(numLabel+": "+formatfunc(num,false),marker,"nrow",true,"bottom",null,null,null)}}_text.add(VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range")+": "+prefix+formatfunc(v[y+"eb"],false)+suffix+" ("+prefix+formatfunc(v[y]-v[y+"eb"],false)+suffix+" - "+prefix+formatfunc(v[y]+v[y+"eb"],false)+suffix+")",marker,"eb",true,viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(v[y+"eb"]));_data.add({type:"y",name:VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range"),validName:VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range"),rawValue:v[y],value:""+prefix+formatfunc(v[y+"eb"],false)+suffix+" ("+prefix+formatfunc(v[y]-v[y+"eb"],false)+suffix+" - "+prefix+formatfunc(v[y]+v[y+"eb"],false)+suffix+")",func:null,datatype:null,filter:false,numDecimalDigits:numDecimalDigitsForFilter},marker,"eb",true,viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(v[y+"eb"]))}else{var colName=VizUtil.isDualYSupported(marker)||marker==="pie"?viz.yColumnName:null;_text.add(translateColumn(viz.y.balloonDisplayName||(isGroupByMeasuresEnabled?colMap[v[facet]].name:colName||(viz.y.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:marker==="densityplot"?DENSITY_COL_LABEL:viz.y.name)))+winfunc+": "+(marker==="pie"?pieValuePrefix+formatPieValue(v[y],colNaNMap["y"])+pieValueSuffix:prefix+formatfunc(v[y],colNaNMap["y"])+suffix),marker,"y",VizUtil.returnsNumericValue(viz.y)&&viz.y.func!=="ascategory",viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(v[y]));_data.add({type:"y",name:translateColumn(viz.y.balloonDisplayName||(isGroupByMeasuresEnabled?colMap[v[facet]].name:colName||(viz.y.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:marker==="densityplot"?DENSITY_COL_LABEL:viz.y.name)))+winfunc,validName:viz.y.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.y.validName,rawValue:bucketLabelMap.y?bucketLabelMap.y[v[y]]||v[y]:v[y],value:VizUtil.isEmpty(v[y],true)?"":marker==="pie"?pieValuePrefix+formatPieValue(v[y],colNaNMap["y"])+pieValueSuffix:prefix+formatfunc(v[y],colNaNMap["y"])+suffix,func:/^(scatter|violin)$/.test(marker)&&viz.y.isNumeric?"round":viz[ycol].func,datatype:null,filter:/^(scatter|violin)$/.test(marker)||marker==="bubble"&&!(VizUtil.returnsNumericValue(viz.y)&&VizUtil.AGGREGATION_FUNCTION_OPTIONS_HASH[viz.y.func]),numDecimalDigits:numDecimalDigitsForFilter},marker,"y",VizUtil.returnsNumericValue(viz.y)&&viz.y.func!=="ascategory",viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(v[y]))}}else{_text.add((marker==="hist"&&y===VizUtil.NUMROWS_COL_LABEL?NUMROWS_COL_LABEL:translateColumn(y))+winfunc+": "+prefix+formatfunc(v[y],false)+suffix,marker,"y",true,null,null,null,null);_data.add({type:"y",name:(marker==="hist"&&y===VizUtil.NUMROWS_COL_LABEL?NUMROWS_COL_LABEL:translateColumn(y))+winfunc,validName:VizUtil.NUMROWS_COL_NAME,rawValue:bucketLabelMap.y?bucketLabelMap.y[v[y]]||v[y]:v[y],value:VizUtil.isEmpty(v[y],true)?"":prefix+formatfunc(v[y],false)+suffix,func:"sum",datatype:null,filter:marker==="scatter"||marker==="bubble"&&!(VizUtil.returnsNumericValue(viz.y)&&viz.y.func!=="ascategory"),numDecimalDigits:numDecimalDigitsForFilter},marker,"y",true,null,null,null,null)}}}if(marker==="densityplot"&&!VizUtil.isEmpty(v[".pct"])){_text.add(VizUtil.getMessage(PlotlyGraphGenerator._lang,viz.densityAreaRatioDirection==="reversed"?"Area Ratio (From Max)":"Area Ratio (From Min)")+": "+prefix+formatDensityRatioValue(v[".pct"],false)+"%",marker,"y",true,null,null,null,null);_data.add({type:"y",name:VizUtil.getMessage(PlotlyGraphGenerator._lang,viz.densityAreaRatioDirection==="reversed"?"Area Ratio (From Max)":"Area Ratio (From Min)"),validName:VizUtil.getMessage(PlotlyGraphGenerator._lang,viz.densityAreaRatioDirection==="reversed"?"Area Ratio (From Max)":"Area Ratio (From Min)"),rawValue:v[".pct"],value:prefix+formatDensityRatioValue(v[".pct"],false)+"%",func:"sum",datatype:null,filter:false},marker,"y",true,null,null,null,null)}if(reflineEnabled){if(!group.refline)group.refline={x:[],y:[]};group.refline.x.push(VizUtil.isEmpty(v[x])?null:v[x]);group.refline.y.push(VizUtil.isEmpty(v[_y+REFLINE_COLUMN])?null:v[_y+REFLINE_COLUMN]);if(reflineRangeEnabled){if(!group.refrange)group.refrange={x:[],y:[]};group.refrange.x.push(VizUtil.isEmpty(v[x])?null:v[x]);group.refrange.y.push(VizUtil.isEmpty(v[_y+REFLINE_RANGE_COLUMN])?null:v[_y+REFLINE_RANGE_COLUMN])}}if(vReflineEnabled){if(!group.vrefline)group.vrefline={x:[],y:[]};group.vrefline.x.push(VizUtil.isEmpty(v[x+REFLINE_COLUMN])?null:v[x+REFLINE_COLUMN]);group.vrefline.y.push(VizUtil.isEmpty(v[_y])?null:v[_y]);if(!group.vrefrange)group.vrefrange={x:[],y:[]};group.vrefrange.x.push(VizUtil.isEmpty(v[x+REFLINE_RANGE_COLUMN])?null:v[x+REFLINE_RANGE_COLUMN]);group.vrefrange.y.push(VizUtil.isEmpty(v[_y])?null:v[_y])}if(lineDistRangeEnabled){if(v[_y]===null){}else{range.x.push(v[x]);range.hi.push(v[_y]+v[_y+"eb"]);range.low.push(v[_y]-v[_y+"eb"])}}else if((marker==="errbar"||marker==="errbar-agg")&&!VizUtil.isUndefined(v[y+"eb"])){if(!group.error_y){group.error_y={type:"data",array:[],visible:true,width:errBarWidth?errBarWidth:4};if(errBarThickness){group.error_y.thickness=errBarThickness}if(errbarGraph==="marker"&&errBarCircleSize){if(!group.marker){group.marker={}}group.marker.size=errBarCircleSize}}group.error_y.array.push(v[y+"eb"])}else if(errHigh&&errLow&&VizUtil.returnsNumericValue(viz[ycol])&&errHighLowEnabled==="on"&&marker==="scatter"&&!isLineGroup){if(!group.error_y){group.error_y={type:"data",symmetric:false,array:[],arrayminus:[],visible:true,width:errBarWidth?errBarWidth:4}}if(!VizUtil.isUndefined(v[errHigh.label])&&!VizUtil.isUndefined(v[errLow.label])){group.error_y.array.push(v[errHigh.label]===null?0:Math.abs(v[viz[ycol].label]-v[errHigh.label]));group.error_y.arrayminus.push(v[errLow.label]===null?0:Math.abs(v[viz[ycol].label]-v[errLow.label]));if(!xAxisDataTypeDetection||!VizUtil.isEmpty(v[errHigh.label])){_text.add(translateColumn(errHigh.balloonDisplayName||errHigh.name)+": "+prefix+formatValue(v[errHigh.label],false)+suffix,marker,"errh",true,errHigh.balloonPosition,errHigh.balloonPositionIndex,errHigh.balloonAddBrackets,errHigh.balloonInvisible||errHigh.balloonHideIfEmpty&&VizUtil.isEmpty(v[errHigh.label]));_data.add({type:"errh",name:translateColumn(errHigh.balloonDisplayName||errHigh.name),validName:errHigh.validName,rawValue:v[errHigh.label],value:prefix+formatValue(v[errHigh.label],false)+suffix,func:null,datatype:null,filter:false},marker,"y",true,errHigh.balloonPosition,errHigh.balloonPositionIndex,errHigh.balloonAddBrackets,errHigh.balloonInvisible||errHigh.balloonHideIfEmpty&&VizUtil.isEmpty(v[errHigh.label]))}if(!xAxisDataTypeDetection||!VizUtil.isEmpty(v[errLow.label])){_text.add(translateColumn(errLow.balloonDisplayName||errLow.name)+": "+prefix+formatValue(v[errLow.label],false)+suffix,marker,"errl",true,errLow.balloonPosition,errLow.balloonPositionIndex,errLow.balloonAddBrackets,errLow.balloonInvisible||errLow.balloonHideIfEmpty&&VizUtil.isEmpty(v[errLow.label]));_data.add({type:"errl",name:translateColumn(errLow.balloonDisplayName||errLow.name),validName:errLow.validName,rawValue:v[errLow.label],value:prefix+formatValue(v[errLow.label],false)+suffix,func:null,datatype:null,filter:false},marker,"y",true,errLow.balloonPosition,errLow.balloonPositionIndex,errLow.balloonAddBrackets,errLow.balloonInvisible||errLow.balloonHideIfEmpty&&VizUtil.isEmpty(v[errLow.label]))}}}else if(y&&errHigh&&errLow&&errHighLowEnabled==="on"&&VizUtil.returnsNumericValue(viz[ycol])&&(marker==="line"||isLineGroup)){if(!VizUtil.isUndefined(v[errHigh.label])&&!VizUtil.isUndefined(v[errLow.label])){if(v[_y]===null){}else{range.x.push(v[x]);range.hi.push(v[errHigh.label]===null?v[_y]:v[errHigh.label]);range.low.push(v[errLow.label]===null?v[_y]:v[errLow.label]);if(!VizUtil.isEmpty(v[errHigh.label])){_text.add(translateColumn(errHigh.balloonDisplayName||errHigh.name)+": "+prefix+formatValue(v[errHigh.label],false)+suffix,marker,"errh",true,errHigh.balloonPosition,errHigh.balloonPositionIndex,errHigh.balloonAddBrackets,errHigh.balloonInvisible||errHigh.balloonHideIfEmpty&&VizUtil.isEmpty(v[errHigh.label]));_data.add({type:"errh",name:translateColumn(errHigh.balloonDisplayName||errHigh.name),validName:errHigh.validName,rawValue:v[errHigh.label],value:prefix+formatValue(v[errHigh.label],false)+suffix,func:null,datatype:null,filter:false},marker,"errh",true,errHigh.balloonPosition,errHigh.balloonPositionIndex,errHigh.balloonAddBrackets,errHigh.balloonInvisible||errHigh.balloonHideIfEmpty&&VizUtil.isEmpty(v[errHigh.label]))}if(!VizUtil.isEmpty(v[errLow.label])){_text.add(translateColumn(errLow.balloonDisplayName||errLow.name)+": "+prefix+formatValue(v[errLow.label],false)+suffix,marker,"errl",true,errLow.balloonPosition,errLow.balloonPositionIndex,errLow.balloonAddBrackets,errLow.balloonInvisible||errLow.balloonHideIfEmpty&&VizUtil.isEmpty(v[errLow.label]));_data.add({type:"errl",name:translateColumn(errLow.balloonDisplayName||errLow.name),validName:errLow.validName,rawValue:v[errLow.label],value:prefix+formatValue(v[errLow.label],false)+suffix,func:null,datatype:null,filter:false},marker,"errl",true,errLow.balloonPosition,errLow.balloonPositionIndex,errLow.balloonAddBrackets,errLow.balloonInvisible||errLow.balloonHideIfEmpty&&VizUtil.isEmpty(v[errLow.label]))}}}}else if(y&&errHighValue&&errLowValue&&errHighLowEnabled==="constant"&&VizUtil.returnsNumericValue(viz[ycol])&&(marker==="line"||isLineGroup)){if(v[_y]===null){}else{errHighValue=parseFloat(errHighValue);errLowValue=parseFloat(errLowValue);range.x.push(v[x]);range.hi.push(errHighValue);range.low.push(errLowValue);range.type="constant";range.isMultiY=isMultiY;var displayColName=translateColumn(viz[ycol].name)+" ("+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Upper")+") ";var displayValue=prefix+formatValue(errHighValue,false)+suffix;_text.add(displayColName+": "+displayValue,marker,"errh",true);_data.add({type:"errh",name:displayColName,validName:displayColName,rawValue:errHighValue,value:displayValue,func:null,datatype:null,filter:false},marker,"errh",true);displayColName=translateColumn(viz[ycol].name)+" ("+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Lower")+") ";displayValue=prefix+formatValue(errLowValue,false)+suffix;_text.add(displayColName+": "+displayValue,marker,"errl",true);_data.add({type:"errl",name:displayColName,validName:displayColName,rawValue:errLowValue,value:displayValue,func:null,datatype:null,filter:false},marker,"errl",true)}}}if(z){if(!group.z)group.z=[];group.z.push(v[z]);_text.add(translateColumn(viz.z.balloonDisplayName||viz.z.name)+": "+zValuePrefix+formatZValue(v[z],colNaNMap["z"])+zValueSuffix,marker,"z",VizUtil.returnsNumericValue(viz.z)&&viz.z.func!=="ascategory",viz.z.balloonPosition,viz.z.balloonPositionIndex,viz.z.balloonAddBrackets,viz.z.balloonInvisible||viz.z.balloonHideIfEmpty&&VizUtil.isEmpty(v[z]));_data.add({type:"z",name:translateColumn(viz.z.balloonDisplayName||viz.z.name),validName:viz.z.validName,rawValue:v[z],value:zValuePrefix+formatZValue(v[z],colNaNMap["z"])+zValueSuffix,func:viz.z.func,datatype:viz.z.type,filter:false,numDecimalDigits:numDecimalDigitsForFilter},marker,"z",VizUtil.returnsNumericValue(viz.z)&&viz.z.func!=="ascategory",viz.z.balloonPosition,viz.z.balloonPositionIndex,viz.z.balloonAddBrackets,viz.z.balloonInvisible||viz.z.balloonHideIfEmpty&&VizUtil.isEmpty(v[z]))}if(v[orderRow]!==undefined){if(!group._orderRow)group._orderRow=[];group._orderRow.push(!!v[orderRow])}if(marker.startsWith("errbar")||lineDistRangeEnabled){var fnc=marker.startsWith("errbar")?viz.errbarType:errHighLowRangeFunc;if(!fnc){fnc="confint"}_text.add(VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range Type")+": "+VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.ERROR_BAR_TYPE_OPTIONS_HASH[fnc]),marker,"stderr",true,null,null,null,null);_data.add({type:"y",name:VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range Type"),validName:VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range Type"),rawValue:viz.errbarType,value:VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.ERROR_BAR_TYPE_OPTIONS_HASH[fnc]),func:null,datatype:null,filter:false,numDecimalDigits:numDecimalDigitsForFilter},marker,"eb",true,viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible)}if(!group.hovertext){group.hovertext=[]}group.hovertext.push(v[orderRow]==="TRUE"?"":_text.toArray().join("<br>"));if(allowMultiYAndColor&&marker==="scatter"&&group.mode==="markers"&&viz.label2OnPlot==="on"&&!!label2&&group.type==="scatter"){if(!group.text){group.text=[]}group.text.push(v[orderRow]==="TRUE"?"":formatValue(v[label2],colNaNMap["label2"]))}else if(VizUtil.isShowLabelOnPlotSupported(marker)&&labelOnPlot==="on"&&label){if(!group.text){group.text=[]}group.text.push(v[orderRow]==="TRUE"?"":formatValue(v[label],colNaNMap["label"]))}group.customdata.push(v[orderRow]==="TRUE"?(new VizUtil.BalloonItemList).toArray():_data.toArray());if(marker==="scatter"){if(!group.marker.opacity){group.marker.opacity=opacity;if(group.error_y){group.error_y.opacity=opacity}}else if(viz.fillOpacity){group.marker.opacity=viz.fillOpacity;if(group.error_y){group.error_y.opacity=viz.fillOpacity}}}else if(marker==="bubble"){group.marker.opacity=opacity}else{group.opacity=opacity}if(_color){if(!group.marker.color){group.marker.color=[]}if(isMultiY&&!viz.color){group.marker.color=colorScale(_color)}else{if(viz.color&&VizUtil.applyColorBucketAfterSummarize(marker)&&colorbucket){group.marker.color.push(colorScale(v[colorbucket]))}else{if(isMultiY&&allowMultiYAndColor&&viz.color&&d.ycolname){group.marker.color=colorScale(_color)}else{group.marker.color=VizUtil.isEmpty(v[_color])?"":colorScale(v[_color])}}}}}var yOp=d.yOp||"y";var trendLineOp=d.yOp?viz[d.yOp+"TrendLine"]:viz.yTrendLine||viz.trendLine;var formatTrendLineValue=formatTrendLineValueHash[d.yOp||"y"];prefix=d.use2ndAxis?y2ValuePrefix:y1ValuePrefix;suffix=d.use2ndAxis?y2ValueSuffix:y1ValueSuffix;formatfunc=d.use2ndAxis?formatY2Value:formatY1Value;var withRange=d.yOp?viz[d.yOp+"TrendLineWithRange"]:viz.yTrendLineWithRange||viz.trendLineWithRange;var trendLineEnableShowMetrics=viz[yOp+"TrendLineEnableShowMetrics"]==="on"&&VizUtil.isTrendLineShowMetricsEnabled(yOp,viz);var trendLineShowMetrics=viz[yOp+"TrendLineShowMetrics"];var trendLineShowMetricsFontSize=viz[yOp+"TrendLineShowMetricsFontSize"];var trendLineShowMetricsPosition=viz[yOp+"TrendLineShowMetricsPosition"];if(isGroupByMeasuresEnabled){trendLineOp=colMap[v[facet]].trendLine;formatTrendLineValue=colMap[v[facet]].formatTrendLineValue;prefix=colMap[v[facet]].valuePrefix;suffix=colMap[v[facet]].valueSuffix;withRange=colMap[v[facet]].trendLineWithRange||viz.yTrendLineWithRange;trendLineEnableShowMetrics=colMap[v[facet]].trendLineEnableShowMetrics;trendLineShowMetrics=colMap[v[facet]].trendLineShowMetrics;trendLineShowMetricsFontSize=colMap[v[facet]].trendLineShowMetricsFontSize;trendLineShowMetricsPosition=colMap[v[facet]].trendLineShowMetricsPosition}trendLineShowMetrics=trendLineShowMetrics||"r2+coef";trendLineShowMetricsPosition=trendLineShowMetricsPosition||"upperLeft";trendLineShowMetricsFontSize=trendLineShowMetricsFontSize||12;if(isGroupByMeasuresEnabled){trendLineOp=colMap[v[facet]].trendLine}if(x&&trendLineOp&&trendLineOp!=="none"&&/^(scatter|line|bubble)$/.test(marker)){if(!VizUtil.isEmpty(v[FITTED_COLUMN])&&(!xDataRange||v[x]>=xDataRange[0]&&v[x]<=xDataRange[1])){trendLineGroup.x.push(v[x]);trendLineGroup.y.push(v[FITTED_COLUMN]);var xValue=translateColumn(viz.x.balloonDisplayName||(viz.x.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.x.name))+": "+formatfunc(v[x],colNaNMap["x"]);var yValue=translateColumn(viz[yOp].balloonDisplayName||(viz[yOp].type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz[yOp].name))+": "+prefix+formatfunc(v[FITTED_COLUMN],false)+suffix;switch(trendLineOp){case"lmfit":var t="";if(v["cor.value"]){t+=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Correlation")+": "+formatTrendLineValue(v["cor.value"])+"<br>"}t+=VizUtil.getMessage(PlotlyGraphGenerator._lang,"R Squared")+": "+formatTrendLineValue(v.r_squared);var coef=null;if(v.coef){coef=convertCoefByTimeUnit(v.coef,viz.x.func,viz.x.type);t+="<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Coefficient")+": "+formatTrendLineValue(coef)}t+="<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"P-Value")+": "+formatTrendLineValue(v.p_value);t+="<br>("+xValue+")";t+="<br>("+yValue+")";trendLineGroup.hovertext.push(t);if(!trendLineGroup._metricsText&&trendLineEnableShowMetrics){var _lines=[];if(/r2/.test(trendLineShowMetrics)){_lines.push(VizUtil.getMessage(PlotlyGraphGenerator._lang,"R Squared")+": "+formatTrendLineValue(v.r_squared))}if(coef&&/coef/.test(trendLineShowMetrics)){_lines.push(VizUtil.getMessage(PlotlyGraphGenerator._lang,"Coefficient")+": "+formatTrendLineValue(coef))}trendLineGroup._metricsText=_lines.join("<br>");trendLineGroup._metricsTextPosition=trendLineShowMetricsPosition;trendLineGroup._metricsTextFontSize=trendLineShowMetricsFontSize}break;case"gamfit":trendLineGroup.hovertext.push(VizUtil.getMessage(PlotlyGraphGenerator._lang,"R Squared")+": "+formatTrendLineValue(v.r_squared)+"<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Deviance Explained")+": "+formatTrendLineValue(v.deviance_explained)+"<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"GCV")+": "+formatTrendLineValue(v.gcv)+"<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Scale Est.")+": "+formatTrendLineValue(v.scale_est)+"<br>("+xValue+")"+"<br>("+yValue+")");break;case"loessfit":trendLineGroup.hovertext.push(VizUtil.getMessage(PlotlyGraphGenerator._lang,"Equivalent Number of Parameters")+": "+formatTrendLineValue(v.enp)+"<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Residual Standard Error")+": "+formatTrendLineValue(v.residual_std_error)+"<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Trace of Smoother Matrix")+": "+formatTrendLineValue(v.trace_of_smoother_matrix)+"<br>("+xValue+")"+"<br>("+yValue+")");break;case"logistic-fit":trendLineGroup.hovertext.push(VizUtil.getMessage(PlotlyGraphGenerator._lang,"AUC")+": "+formatTrendLineValue(v.auc)+"<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Odds Ratio")+": "+formatTrendLineValue(v.odds_ratio)+"<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"P-Value")+": "+formatTrendLineValue(v.p_value)+"<br>("+xValue+")"+"<br>("+yValue+")");break;case"poisson-fit":trendLineGroup.hovertext.push(VizUtil.getMessage(PlotlyGraphGenerator._lang,"Incidence Rate Ratio")+": "+formatTrendLineValue(v.incident_rate_ratio)+"<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"P-Value")+": "+formatTrendLineValue(v.p_value)+"<br>("+xValue+")"+"<br>("+yValue+")");break}}if(withRange!=="off"){if(!VizUtil.isEmpty(v[CONF_HIGH_COLUMN])&&!VizUtil.isEmpty(v[CONF_LOW_COLUMN])&&(!xDataRange||v[x]>=xDataRange[0]&&v[x]<=xDataRange[1])){trendLineRange.x.push(v[x]);trendLineRange.hi.push(v[CONF_HIGH_COLUMN]);trendLineRange.low.push(v[CONF_LOW_COLUMN])}}}});if(group.marker.color&&Array.isArray(group.marker.color)&&marker==="choropleth"){group.marker.colorscale=[[0,quantColorPalette[0]],[.25,quantColorPalette[1]],[.5,quantColorPalette[2]],[.75,quantColorPalette[3]],[1,quantColorPalette[4]]]}if(!group.marker.color){group.marker.color=colorScale(viz.y?isGroupByMeasuresEnabled?d.facet:viz.y.validLabel:viz.x&&(marker==="hist"||marker==="densityplot")?viz.x.validLabel:VALUE_FOR_NO_COLOR)}if(marker==="errbar"&&group.error_y){if(errbarGraph==="bar"){group.error_y.color="#4d4d4d"}else if(errbarGraph==="marker"){group.error_y.color=group.marker.color}}else if(marker==="scatter"&&group.error_y){markerShape=viz[yop+"MarkerShape"];if(isGroupByMeasuresEnabled){markerShape=colMap[group.facet].markerShape}if(!markerShape||/^(circle|default)$/.test(markerShape)){group.error_y.color=group.marker.color}else{group.error_y.color="#4d4d4d"}}if(viz.hideNullFromLegend==="on"&&group.name==="null"){group.showlegend=false}if(!group.textfont){group.textfont={}}if((viz[yop+"SyncTextColor"]==="on"||viz.yValueOnPlotUseMarkerColor==="on")&&group.marker.color){group.textfont.color=group.marker.color}if(viz[yop+"LabelFontSize"]){group.textfont.size=viz[yop+"LabelFontSize"]}if(VizUtil.isShowLabelOnPlotSupported(marker)&&labelOnPlot==="on"&&label&&viz.y&&VizUtil.returnsNumericValue(viz.y)){var indexes=group.y?_findValueOnPlotIndexes(group.y,group,"label",viz,1):null;if(group.text){group.text=group.text.map(function(text,idx){return indexes&&!indexes[idx]?"":text})}}if(allowMultiYAndColor&&group.name===NA_LABEL&&isAllNull(group.y)){group.showlegend=false}if(xReflineConstantColumn&&viz[xReflineConstantColumn]){var colname=viz[xReflineConstantColumn].validLabel;var extraColname=null;if(xReflineConstantColumnExtraTarget&&viz[xReflineConstantColumnExtraTarget]){extraColname=viz[xReflineConstantColumnExtraTarget].validLabel}var vs=[],extraVs=[];d.values.forEach(function(v){if(v[colname]){vs.push(v[x]);if(extraColname){extraVs.push(v[extraColname])}}});if(vs.length>0){group.constantValues=vs;if(extraVs.length>0){group.constantExtraValues=extraVs}}}gData.push(group);gLineFillLayerData.push(PlotlyGraphGenerator._generateLineFillLayerData(viz,d,group,layout));var REFLINE_COLOR_OPACITY=.4;if(reflineEnabled&&group.x&&!VizUtil.isUndefined(group.refline)){var reflineType=viz[yop+"ReflineType"];var reflineLabel="("+VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.REFERENCE_LINE_OPTIONS_HASH[viz[yop+"ReflineType"]]||VizUtil.REFERENCE_LINE_OPTIONS[0].label)+")";if(reflineType==="constant"){reflineLabel=""}if(viz[yop+"ReflineLabel"]){reflineLabel=VizUtil.getMessage(PlotlyGraphGenerator._lang,viz[yop+"ReflineLabel"])}var reflineRangeType=viz[yop+"ReflineRangeType"];var reflineRangeLabel=reflineRangeType?VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.REFERENCE_LINE_RANGE_TYPE_OPTIONS_HASH[reflineRangeType]):"";var reflineGroup=viz[yop+"ReflineGroup"]||"all";var reflineColor=viz[yop+"ReflineColor"]&&viz[yop+"ReflineColor"]!=="default"?viz[yop+"ReflineColor"]:isMultiY?group.marker.color:"#A6AAA9";var reflineWidth=viz[yop+"ReflineWidth"]||1;var reflineLength=viz[yop+"ReflineLength"]||12;var reflineStyle=viz[yop+"ReflineStyle"]||"solid";var reflineRangeStyle=viz[yop+"ReflineRangeStyle"]||"fill";var reflineRangeLineWidth=viz[yop+"ReflineRangeLineWidth"]||1;var reflineRangeLineStyle=viz[yop+"ReflineRangeLineStyle"]||"solid";var reflineRangeFillOpacity=viz[yop+"ReflineRangeFillOpacity"]||"0.1";var reflineHideFromLegend=viz[yop+"ReflineHideFromLegend"]===true||viz[yop+"ReflineShowInLegend"]!=="on";if(isGroupByMeasuresEnabled){reflineType=colMap[group.facet].reflineType;reflineRangeType=colMap[group.facet].reflineRangeType;reflineRangeLabel=reflineRangeType?VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.REFERENCE_LINE_RANGE_TYPE_OPTIONS_HASH[reflineRangeType]):"";reflineGroup=colMap[group.facet].reflineGroup||"all";reflineColor=colMap[group.facet].reflineColor&&colMap[group.facet].reflineColor!=="default"?colMap[group.facet].reflineColor:group.marker.color||"#A6AAA9";reflineWidth=colMap[group.facet].reflineWidth||1;reflineLength=colMap[group.facet].reflineLength||12;reflineStyle=colMap[group.facet].reflineStyle||"solid";reflineRangeStyle=colMap[group.facet].reflineRangeStyle||"fill";reflineRangeLineWidth=colMap[group.facet].reflineRangeLineWidth||1;reflineRangeLineStyle=colMap[group.facet].reflineRangeLineStyle||"solid";reflineRangeFillOpacity=colMap[group.facet].reflineRangeFillOpacity||"0.1";reflineHideFromLegend=colMap[group.facet].reflineHideFromLegend===true||colMap[group.facet].reflineShowInLegend!=="on"}if(reflineStyle==="none"){reflineWidth=0}if(/color/.test(reflineGroup)){reflineColor=group.marker.color;if(Array.isArray(reflineColor)){reflineColor=reflineColor[0]}}var errorbarRange=group.refline.x.map(function(){return 0});var reflineOnEachXDataPoint=/^(xaxis|xaxis\+facet)$/.test(reflineGroup)&&marker==="scatter"&&!VizUtil.returnsNumericValue(viz.x);var formatRefLineValue=formatRefLineValueHash[yop].formatter;var refLineValuePrefix=formatRefLineValueHash[yop].prefix;var refLineValueSuffix=formatRefLineValueHash[yop].suffix;var hideRefLineValueFromBalloon=formatRefLineValueHash[yop].hideValueFromBalloon;if(reflineRangeEnabled){var upperYValues=group.refline.y.map(function(v,idx){return VizUtil.isEmpty(v)?null:v+group.refrange.y[idx]});var upperYLabels=upperYValues.map(function(v){return reflineRangeLabel+": "+refLineValuePrefix+formatRefLineValue(v)+refLineValueSuffix});var lowerYValues=group.refline.y.map(function(v,idx){return VizUtil.isEmpty(v)?null:v-group.refrange.y[idx]});var lowerYLabels=lowerYValues.map(function(v){return reflineRangeLabel+": "+refLineValuePrefix+formatRefLineValue(v)+refLineValueSuffix});var lowerRangeLayer=null,upperRangeLayer=null;if(reflineOnEachXDataPoint){upperRangeLayer={name:reflineRangeLabel,x:group.refline.x,y:group.refline.y.map(function(v,idx){return VizUtil.isEmpty(v)?null:v+group.refrange.y[idx]}),error_y:{type:"data",array:errorbarRange,visible:true,width:reflineLength,thickness:reflineWidth,color:_setOpacity(reflineColor,REFLINE_COLOR_OPACITY)},type:"scatter",mode:"markers",showlegend:false,visible:!reflineHash[yop]||/color/.test(reflineGroup),marker:{size:1,color:_setOpacity(reflineColor,REFLINE_COLOR_OPACITY),symbol:"line-ew-open"},hoverinfo:"text",hovertext:upperYLabels,use2ndAxis:group.use2ndAxis,customdata:{type:reflineType,yOp:yop,hovertext:upperYLabels}};lowerRangeLayer={name:reflineRangeLabel,x:group.refline.x,y:group.refline.y.map(function(v,idx){return VizUtil.isEmpty(v)?null:v-group.refrange.y[idx]}),error_y:{type:"data",array:errorbarRange,visible:true,width:reflineLength,thickness:reflineWidth,color:_setOpacity(reflineColor,REFLINE_COLOR_OPACITY)},type:"scatter",mode:"markers",showlegend:false,visible:!reflineHash[yop]||/color/.test(reflineGroup),marker:{size:1,color:_setOpacity(reflineColor,REFLINE_COLOR_OPACITY),symbol:"line-ew-open"},hoverinfo:"text",hovertext:lowerYLabels,use2ndAxis:group.use2ndAxis,customdata:{type:reflineType,yOp:yop,hovertext:lowerYLabels}}}else{upperRangeLayer={x:group.refline.x,y:upperYValues,line:{color:_setOpacity(reflineColor,REFLINE_COLOR_OPACITY),width:reflineRangeLineWidth,dash:reflineRangeLineStyle},name:reflineRangeLabel,legendgroup:"refline"+yop,showlegend:false,visible:!reflineHash[yop]||/color/.test(reflineGroup),mode:"lines",hovertext:upperYLabels,hoverinfo:"text",use2ndAxis:group.use2ndAxis,customdata:{type:reflineType,yOp:yop,hovertext:upperYLabels}};lowerRangeLayer={x:group.refline.x,y:lowerYValues,line:{color:_setOpacity(reflineColor,REFLINE_COLOR_OPACITY),width:reflineRangeLineWidth,dash:reflineRangeLineStyle},name:reflineRangeLabel,legendgroup:"refline"+yop,showlegend:false,visible:!reflineHash[yop]||/color/.test(reflineGroup),mode:"lines",hovertext:lowerYLabels,hoverinfo:"text",use2ndAxis:group.use2ndAxis,customdata:{type:reflineType,yOp:yop,hovertext:lowerYLabels}}}if(VizUtil.isColorStackDirectionSupported(viz)){if(color&&/color/.test(reflineGroup)){upperRangeLayer._colorVal=group.name;lowerRangeLayer._colorVal=group.name}else if(!color&&isMultiY&&!isGroupByMeasuresEnabled&&reflineColor===group.marker.color){upperRangeLayer._colorVal=viz[yop].validLabel;lowerRangeLayer._colorVal=viz[yop].validLabel}}if(highlightCreateOthers&&/color/.test(reflineGroup)&&group.name===othersLabelForHighlight){upperRangeLayer.visible=false;lowerRangeLayer.visible=false}gRefLineUpperRangeLayerData.push(upperRangeLayer);gRefLineLowerRangeLayerData.push(lowerRangeLayer)}else{gRefLineUpperRangeLayerData.push({x:[],y:[],customdata:{}});gRefLineLowerRangeLayerData.push({x:[],y:[],customdata:{}})}var reflineLineGroup=null;var constructLabelText=function(v,idx){if(hideRefLineValueFromBalloon){return reflineLabel||""}var txt=(reflineLabel?reflineLabel+": ":"")+refLineValuePrefix+formatRefLineValue(v)+refLineValueSuffix;var rng=group.refrange&&group.refrange.y&&group.refrange.y.length>idx?group.refrange.y[idx]:null;if(rng!==null){txt+="<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range")+": "+refLineValuePrefix+formatRefLineValue(rng)+refLineValueSuffix+" ("+refLineValuePrefix+formatRefLineValue(v-rng)+refLineValueSuffix+" - "+refLineValuePrefix+formatRefLineValue(v+rng)+refLineValueSuffix+")<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range Type")+": "+reflineRangeLabel}return txt};var hoverText=group.refline.y.map(constructLabelText);if(reflineOnEachXDataPoint){reflineLineGroup={name:reflineLabel,x:group.refline.x,y:group.refline.y,error_y:{type:"data",array:errorbarRange,visible:true,width:reflineLength,thickness:reflineWidth,color:reflineColor},type:"scatter",mode:"markers",legendgroup:"refline"+yop,showlegend:!reflineHash[yop],visible:!reflineHash[yop]||/color/.test(reflineGroup),marker:{size:12,color:reflineColor,symbol:"line-ew-open"},hoverinfo:"text",hovertext:hoverText,customdata:{type:reflineType,yOp:yop,hovertext:hoverText}}}else{reflineLineGroup={x:group.refline.x,y:group.refline.y,line:{color:reflineColor,width:reflineWidth,dash:reflineStyle},name:reflineLabel,legendgroup:"refline"+yop,showlegend:!reflineHash[yop],visible:!reflineHash[yop]||/color/.test(reflineGroup),mode:"lines",hoverinfo:"text",hovertext:hoverText,customdata:{type:reflineType,yOp:yop,hovertext:hoverText,rangeStyle:reflineRangeStyle,rangeFillOpacity:reflineRangeFillOpacity}}}if(group.use2ndAxis){reflineLineGroup.use2ndAxis=group.use2ndAxis;reflineLineGroup.yaxis=group.yaxis}if(reflineHideFromLegend){reflineLineGroup.showlegend=false}if(reflineType==="diagonal"){recalculateDiagonalRefLineData(reflineLineGroup)}reflineHash[yop]=true;if(VizUtil.isColorStackDirectionSupported(viz)){if(color&&/color/.test(reflineGroup)){reflineLineGroup._colorVal=group.name}else if(!color&&isMultiY&&!isGroupByMeasuresEnabled&&reflineColor===group.marker.color){reflineLineGroup._colorVal=viz[yop].validLabel}}if(highlightCreateOthers&&/color/.test(reflineGroup)&&group.name===othersLabelForHighlight){reflineLineGroup.visible=false;reflineLineGroup.forHighlightOthers=true}gRefLineLayerData.push(reflineLineGroup)}else{gRefLineLayerData.push({x:[],y:[],customdata:{}});gRefLineUpperRangeLayerData.push({x:[],y:[],customdata:{}});gRefLineLowerRangeLayerData.push({x:[],y:[],customdata:{}})}if(vReflineEnabled&&group.x&&!VizUtil.isUndefined(group.vrefline)){var vReflineType=viz[xop+"ReflineType"];var vReflineLabel="("+VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.REFERENCE_LINE_OPTIONS_HASH[viz[xop+"ReflineType"]]||VizUtil.REFERENCE_LINE_OPTIONS[0].label)+")";if(viz[xop+"ReflineType"]==="constant"){vReflineLabel=""}if(viz[xop+"ReflineLabel"]){vReflineLabel=VizUtil.getMessage(PlotlyGraphGenerator._lang,viz[xop+"ReflineLabel"])}var vReflineGroup=viz[xop+"ReflineGroup"]||"all";var vReflineColor=viz[xop+"ReflineColor"]&&viz[xop+"ReflineColor"]!=="default"?viz[xop+"ReflineColor"]:"#A6AAA9";var vReflineWidth=viz[xop+"ReflineWidth"]||1;var vReflineStyle=viz[xop+"ReflineStyle"]||"solid";var vReflineRangeStyle=viz[xop+"ReflineRangeStyle"]||"fill";var vReflineRangeLineWidth=viz[xop+"ReflineRangeLineWidth"]||1;var vReflineRangeLineStyle=viz[xop+"ReflineRangeLineStyle"]||"solid";var vReflineRangeFillOpacity=viz[xop+"ReflineRangeFillOpacity"]||"0.1";if(vReflineStyle==="none"){vReflineWidth=0}var vReflineHideFromLegend=viz[xop+"ReflineHideFromLegend"]===true||viz[xop+"ReflineShowInLegend"]!=="on";var formatVRefLineValue=formatVRefLineValueHash[xop].formatter;var vRefLineValuePrefix=formatVRefLineValueHash[xop].prefix;var vRefLineValueSuffix=formatVRefLineValueHash[xop].suffix;var hideVRefLineValueFromBalloon=formatVRefLineValueHash[xop].hideValueFromBalloon;if(/color/.test(vReflineGroup)){vReflineColor=group.marker.color;if(Array.isArray(vReflineColor)){vReflineColor=vReflineColor[0]}}if(vReflineRangeEnabled){var vReflineRangeType=viz[xop+"ReflineRangeType"];var vReflineRangeLabel=vReflineRangeType?VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.REFERENCE_LINE_RANGE_TYPE_OPTIONS_HASH[vReflineRangeType]):"";var upperXValues=group.vrefline.x.map(function(v,idx){return VizUtil.isEmpty(v)?null:v+group.vrefrange.x[idx]});var upperXLabels=upperXValues.map(function(v){return vReflineRangeLabel+": "+vRefLineValuePrefix+formatVRefLineValue(v)+vRefLineValueSuffix});var lowerXValues=group.vrefline.x.map(function(v,idx){return VizUtil.isEmpty(v)?null:v-group.vrefrange.x[idx]});var lowerXLabels=lowerXValues.map(function(v){return vReflineRangeLabel+": "+vRefLineValuePrefix+formatVRefLineValue(v)+vRefLineValueSuffix});var upperVRangeLayer={x:upperXValues,y:group.vrefline.y,line:{color:_setOpacity(vReflineColor,REFLINE_COLOR_OPACITY),width:vReflineRangeLineWidth,dash:vReflineRangeLineStyle},name:vReflineRangeLabel,legendgroup:"vrefline"+xop,showlegend:false,visible:true,mode:"lines",hovertext:upperXLabels,hoverinfo:"text",customdata:{type:vReflineType,xOp:xop,hovertext:upperXLabels}};var lowerVRangeLayer={x:lowerXValues,y:group.vrefline.y,line:{color:_setOpacity(vReflineColor,REFLINE_COLOR_OPACITY),width:vReflineRangeLineWidth,dash:vReflineRangeLineStyle},name:vReflineRangeLabel,legendgroup:"vrefline"+xop,showlegend:false,visible:true,mode:"lines",hovertext:lowerXLabels,hoverinfo:"text",customdata:{type:vReflineType,xOp:xop,hovertext:lowerXLabels}};if(VizUtil.isColorStackDirectionSupported(viz)){if(color&&/color/.test(vReflineGroup)){upperVRangeLayer._colorVal=group.name;lowerVRangeLayer._colorVal=group.name}else if(!color&&isMultiY&&!isGroupByMeasuresEnabled&&vReflineColor===group.marker.color){upperVRangeLayer._colorVal=viz[yop].validLabel;lowerVRangeLayer._colorVal=viz[yop].validLabel}}if(highlightCreateOthers&&/color/.test(vReflineGroup)&&group.name===othersLabelForHighlight){upperVRangeLayer.visible=false;lowerVRangeLayer.visible=false;upperVRangeLayer.forHighlightOthers=true;lowerVRangeLayer.forHighlightOthers=true}gVRefLineUpperRangeLayerData.push(upperVRangeLayer);gVRefLineLowerRangeLayerData.push(lowerVRangeLayer)}else{gVRefLineUpperRangeLayerData.push({x:[],y:[],customdata:{}});gVRefLineLowerRangeLayerData.push({x:[],y:[],customdata:{}})}hoverText=group.vrefline.x.map(function(v,idx){if(hideVRefLineValueFromBalloon){return vReflineLabel||""}var txt=(vReflineLabel?vReflineLabel+": ":"")+vRefLineValuePrefix+formatVRefLineValue(v)+vRefLineValueSuffix;var rng=group.vrefrange&&group.vrefrange.x&&group.vrefrange.x.length>idx?group.vrefrange.x[idx]:null;if(rng!==null){txt+="<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range")+": "+vRefLineValuePrefix+formatVRefLineValue(rng)+vRefLineValueSuffix+" ("+vRefLineValuePrefix+formatVRefLineValue(v-rng)+vRefLineValueSuffix+" - "+vRefLineValuePrefix+formatVRefLineValue(v+rng)+vRefLineValueSuffix+")<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range Type")+": "+vReflineRangeLabel}return txt});var vReflineLineGroup={x:group.use2ndAxis?[]:group.vrefline.x,y:group.use2ndAxis?[]:group.vrefline.y,line:{color:vReflineColor,width:vReflineWidth,dash:vReflineStyle},name:vReflineLabel,legendgroup:"vrefline"+xop,showlegend:!vreflineHash[xop],visible:!vreflineHash[xop]||/color/.test(vReflineGroup),mode:"lines",hoverinfo:"text",hovertext:hoverText,customdata:{xOp:xop,hovertext:hoverText,type:vReflineType,rangeStyle:vReflineRangeStyle,rangeFillOpacity:vReflineRangeFillOpacity},facet:group.facet};if(vReflineHideFromLegend){vReflineLineGroup.showlegend=false}vreflineHash[xop]=true;if(VizUtil.isColorStackDirectionSupported(viz)){if(color&&/color/.test(vReflineGroup)){vReflineLineGroup._colorVal=group.name}else if(!color&&isMultiY&&!isGroupByMeasuresEnabled&&vReflineColor===group.marker.color){vReflineLineGroup._colorVal=viz[yop].validLabel}}if(highlightCreateOthers&&/color/.test(vReflineGroup)&&group.name===othersLabelForHighlight){vReflineLineGroup.visible=false;vReflineLineGroup.forHighlightOthers=true}gVRefLineLayerData.push(vReflineLineGroup)}else{gVRefLineLayerData.push({x:[],y:[],customdata:{}});gVRefLineUpperRangeLayerData.push({x:[],y:[],customdata:{}});gVRefLineLowerRangeLayerData.push({x:[],y:[],customdata:{}})}var copyx,copyx2;if(/^(line|scatter)$/.test(marker)&&!z&&range){var rangeGroup={x:[],y:[],fill:"tozerox",fillcolor:VizUtil.hexToRgba(isArray(group.marker.color)?quantColorPalette[quantColorPalette.length-1]:group.marker.color,.2),line:{color:"transparent"},name:group.name,showlegend:false,type:"scatter",hoverinfo:"skip"};if(d.use2ndAxis){rangeGroup.use2ndAxis=d.use2ndAxis;rangeGroup.yaxis="y2"}if(range.type==="constant"){rangeGroup.customdata={type:"constant",isMultiY:range.isMultiY}}copyx=range.x?range.x.slice():group.x.slice();copyx2=range.x?range.x.slice():group.x.slice();rangeGroup.x=copyx.concat(copyx2.reverse());rangeGroup.y=range.hi.concat(range.low.reverse());rangeGroup.x.push(copyx[0]);rangeGroup.y.push(range.hi[0]);gRangeLayerData.push(rangeGroup);rangeGroup.legendgroup="lg"+rangeLegendgroup;group.legendgroup="lg"+rangeLegendgroup;rangeLegendgroup++}if(/^(line|scatter|bubble)$/.test(marker)&&!z&&trendLineGroup){trendLineGroup.marker={color:isColorContinuous?quantColorPalette[quantColorPalette.length-1]:group.marker.color};if(trendLineIgnoreColor){trendLineGroup.marker.color=viz.yTrendLineColor&&viz.yTrendLineColor!=="default"?viz.yTrendLineColor:VizUtil.getTrendLineDefaultColor()}if(d.use2ndAxis){trendLineGroup.use2ndAxis=d.use2ndAxis;trendLineGroup.yaxis="y2"}if(VizUtil.isColorStackDirectionSupported(viz)){if(color&&viz.yTrendLineIgnoreColor!=="on"){trendLineGroup._colorVal=group.name}}if(highlightCreateOthers&&!trendLineIgnoreColor&&group.name===othersLabelForHighlight){trendLineGroup.visible=false;trendLineGroup.forHighlightOthers=true}trendLineGroup.showlegend=VizUtil.isTrendLineIgnoreColorSupported(marker)&&viz.yTrendLineIgnoreColor==="on"&&viz[yop+"TrendLineShowInLegend"]!=="off"&&trendLineGroup.x.length>0&&!!viz.color&&!gTrendLineLayerData._legendShown;if(trendLineGroup.showlegend){trendLineGroup.name=VizUtil.getMessage(PlotlyGraphGenerator._lang,"(Trend)");gTrendLineLayerData._legendShown=true}gTrendLineLayerData.push(trendLineGroup);trendLineGroup.legendgroup="lg"+trendLineLegendgroup;group.legendgroup="lg"+trendLineLegendgroup;trendLineLegendgroup++}if(/^(line|scatter|bubble)$/.test(marker)&&!z&&trendLineRange){var trendLineRangeGroup={x:[],y:[],fill:"tozerox",fillcolor:VizUtil.hexToRgba(isColorContinuous?quantColorPalette[quantColorPalette.length-1]:group.marker.color,.2),line:{color:"transparent"},name:group.name,showlegend:false,type:"scatter",hoverinfo:"none"};if(trendLineIgnoreColor){trendLineRangeGroup.fillcolor=VizUtil.hexToRgba(viz.yTrendLineColor&&viz.yTrendLineColor!=="default"?viz.yTrendLineColor:VizUtil.getTrendLineDefaultColor(),.2)}if(d.use2ndAxis){trendLineRangeGroup.use2ndAxis=d.use2ndAxis;trendLineRangeGroup.yaxis="y2"}copyx=trendLineRange.x?trendLineRange.x.slice():group.x.slice();copyx2=trendLineRange.x?trendLineRange.x.slice():group.x.slice();trendLineRangeGroup.x=copyx.concat(copyx2.reverse());trendLineRangeGroup.y=trendLineRange.hi.concat(trendLineRange.low.reverse());trendLineRangeGroup.x.push(copyx[0]);trendLineRangeGroup.y.push(trendLineRange.hi[0]);trendLineRangeGroup.hoverinfo="skip";if(VizUtil.isColorStackDirectionSupported(viz)){if(color&&viz.yTrendLineIgnoreColor!=="on"){trendLineRangeGroup._colorVal=group.name}}if(highlightCreateOthers&&!trendLineIgnoreColor&&group.name===othersLabelForHighlight){trendLineRangeGroup.visible=false;trendLineRangeGroup.forHighlightOthers=true}gTrendLineRangeLayerData.push(trendLineRangeGroup);trendLineRangeGroup.legendgroup="lg"+trendLineRangeLegendgroup;trendLineRangeLegendgroup++}})}delete gTrendLineLayerData._legendShown;if(VizUtil.isHorizontalReferenceLineSupported(marker)){var reflineGraphData=PlotlyGraphGenerator._constructConstantReferenceLineData("y",viz,gData,formatRefLineValueHash,translateColumn);if(reflineGraphData){gRefLineLayerData=reflineGraphData}}if(marker==="bar"&&barstyle==="stack"&&color&&gVRefLineLayerData.length>0){calculateStackBarRanges(viz,gData,gVRefLineLayerData)}if(VizUtil.isVerticalReferenceLineSupported(marker)){var vReflineGraphData=PlotlyGraphGenerator._constructConstantReferenceLineData("x",viz,gData,formatVRefLineValueHash,translateColumn);if(vReflineGraphData){gVRefLineLayerData=vReflineGraphData}}var divElem=null;if(targetElem){divElem=document.createElement("div");divElem.style.width="100%";divElem.style.height="100%";if(this._isToolbarEnabled&&!this._isToolbarHidden){divElem.style.height="calc(100% - "+TOOLBAR_HEIGHT+"px)"}targetElem.appendChild(divElem);viz._canvasWidth=$(targetElem).width();viz._canvasHeight=$(targetElem).height()}var _bottom=VizUtil.getDefaultBottomMargin(viz),_left=VizUtil.getDefaultLeftMargin(viz),_top=VizUtil.getDefaultTopMargin(viz),_right=VizUtil.getDefaultRightMargin(viz),_v;if(viz.axisAutoMargin==="off"){_v=parseInt(marginTop);if(!isNaN(_v)){_top=_v}_v=parseInt(marginBottom);if(!isNaN(_v)){_bottom=_v}_v=parseInt(marginLeft);if(!isNaN(_v)){_left=_v}_v=parseInt(marginRight);if(!isNaN(_v)){_right=_v}}if(/^(scatter|bubble)$/.test(marker)&&gData.length>0&&gData[0].marker.size&&gData[0].marker.size.length>0){var _exts=gData.map(function(d){if(!d.marker.size){return[]}return d3.extent(d.marker.size)});var _ext=d3.extent(d3.merge(_exts));var _scale=d3.scale.linear().domain(_ext).range([circleMinSize,circleMaxSize]);gData.forEach(function(d){if(!d.marker.size){return}d.marker.size_org=d.marker.size;d.marker.size=d.marker.size_org.map(function(sz){return sz===null?null:_scale(sz)})})}var layout={font:{family:'"Helvetica Neue", Arial, Helvetica, " Pro W3", "Hiragino Kaku Gothic Pro", "","Hiragino Sans", "Hiragino Kaku Gothic", "Meiryo UI", "", Meiryo, " ", "MS PGothic", sans-serif'},margin:{t:_top,b:_bottom,l:_left,r:_right},legend:{traceorder:"normal",font:{}},title:{font:{}},hovermode:viz.hoverMode||VizUtil.getDefaultHoverMode(marker),hoverlabel:{align:"left"},xaxis:{zerolinecolor:VizUtil.ZERO_LINE_COLOR,titlefont:{},tickfont:{}},yaxis:{zerolinecolor:VizUtil.ZERO_LINE_COLOR,titlefont:{},tickfont:{}},zaxis:{zerolinecolor:VizUtil.ZERO_LINE_COLOR,titlefont:{},tickfont:{}},paper_bgcolor:viz.backgroundColor||"rgba(255,255,255,1)",plot_bgcolor:viz.backgroundColor||"rgba(255,255,255,1)",scene:{xaxis:{titlefont:{},tickfont:{}},yaxis:{titlefont:{},tickfont:{}},yaxis2:{titlefont:{},tickfont:{}},zaxis:{titlefont:{},tickfont:{}}}};if(["bar","errbar","errbar-agg"].includes(marker)&&viz.barGroupGap==="on"){layout.bargroupgap=.1}if(viz.showLegendTitle==="on"){if(viz.legendTitle){layout.legend.title={text:viz.legendTitle}}else if(color){layout.legend.title={text:viz.color.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.color&&viz.color.type===VizUtil.TYPE_YAXIS?VizUtil.getMessage(PlotlyGraphGenerator._lang,"(Y Axis Values)"):viz.color.displayName||viz.color.name}}if(layout.legend.title){layout.legend.title.font={size:viz.legendTitleFontSize||viz._defaultLegendTitleFontSize||12};if(/bold/.test(viz.legendTitleFontWeight)){layout.legend.title.text="<b>"+layout.legend.title.text+"</b>"}if(/italic/.test(viz.legendTitleFontWeight)){layout.legend.title.text="<i>"+layout.legend.title.text+"</i>"}}}if(viz.hoverDistance){layout.hoverdistance=viz.hoverDistance}var xTickFormat=viz.xAxisTickFormat||(viz.xAxisNumDecimalDigits||viz.numDecimalDigits?(xUseThousandSeparator?",":"")+"."+(viz.xAxisNumDecimalDigits||viz.numDecimalDigits)+"f":null);var yTickFormat=viz.yAxisTickFormat||(viz.y1AxisNumDecimalDigits||viz.numDecimalDigits?(y1UseThousandSeparator?",":"")+"."+(viz.y1AxisNumDecimalDigits||viz.numDecimalDigits)+"f":null);var y2TickFormat=viz.y2AxisTickFormat||(viz.y2AxisNumDecimalDigits||viz.numDecimalDigits?(y2UseThousandSeparator?",":"")+"."+(viz.y2AxisNumDecimalDigits||viz.numDecimalDigits)+"f":null);var zTickFormat=viz.zAxisTickFormat||(viz.zAxisNumDecimalDigits||viz.numDecimalDigits?(zUseThousandSeparator?",":"")+"."+(viz.zAxisNumDecimalDigits||viz.numDecimalDigits)+"f":null);if(!xTickFormat&&viz.xAxisUseSIPrefix==="off"&&viz.x&&VizUtil.returnsNumericValue(viz.x)){xTickFormat=xUseThousandSeparator?",":"r"}if(!yTickFormat&&viz.y1AxisUseSIPrefix==="off"&&viz.y&&VizUtil.returnsNumericValue(viz.y)){yTickFormat=y1UseThousandSeparator?",":"r"}if(!y2TickFormat&&viz.y2AxisUseSIPrefix==="off"&&colsOn2ndAxis.length>0&&VizUtil.returnsNumericValue(colsOn2ndAxis[0])){y2TickFormat=y2UseThousandSeparator?",":"r"}if(!zTickFormat&&viz.zAxisUseSIPrefix==="off"&&viz.z&&VizUtil.returnsNumericValue(viz.z)){zTickFormat=zUseThousandSeparator?",":"r"}if(xTickFormat){layout.xaxis.tickformat=layout.scene.xaxis.tickformat=xTickFormat}if(yTickFormat){layout.yaxis.tickformat=layout.scene.yaxis.tickformat=yTickFormat}if(y2TickFormat){if(!layout.yaxis2){layout.yaxis2={}}if(!layout.scene.yaxis2){layout.scene.yaxis2={}}layout.yaxis2.tickformat=layout.scene.yaxis2.tickformat=y2TickFormat}if(zTickFormat){layout.zaxis.tickformat=layout.scene.zaxis.tickformat=zTickFormat}if(marker==="heatmap"){if(xAxisPosition==="top"){layout.xaxis.side="top"}}if(VizUtil.isAxisDirectionEnabled(marker)){if(viz.xAxisDirection){layout.xaxis.autorange=viz.xAxisDirection}if(viz.yAxisDirection){layout.yaxis.autorange=viz.yAxisDirection}if(viz.y2AxisDirection){if(!layout.yaxis2){layout.yaxis2={}}layout.yaxis2.autorange=viz.y2AxisDirection}if(viz.zAxisDirection){layout.zaxis.autorange=viz.zAxisDirection}}if(viz.x){layout.xaxis.title=layout.scene.xaxis.title=translateColumn(viz.x.name)}if(viz.y){layout.yaxis.title=layout.scene.yaxis.title=translateColumn(viz.y.name)}if(viz.z){layout.zaxis.title=layout.scene.zaxis.title=translateColumn(viz.z.name)}if(y===VizUtil.FREQ_COL_LABEL){layout.yaxis.title=NUMROWS_COL_LABEL}if(viz.x&&viz.x.type===VizUtil.TYPE_NUMROWS){layout.xaxis.title=NUMROWS_COL_LABEL}if(viz.y&&viz.y.type===VizUtil.TYPE_NUMROWS){layout.yaxis.title=NUMROWS_COL_LABEL}if(viz.y&&marker==="densityplot"){layout.yaxis.title=DENSITY_COL_LABEL}if(!isMultiY&&viz.yWindowFunc&&/^(bar|line|area)$/.test(marker)){var _funclabel=VizUtil.WINDOW_FUNCTION_OPTIONS_HASH[viz.yWindowFunc];if(_funclabel&&viz.yWindowFunc!=="none"&&legendShowFuncName){layout.yaxis.title+=" ("+_funclabel+")"}}layout.xaxis.tickprefix=layout.scene.xaxis.tickprefix=xValuePrefix;layout.xaxis.ticksuffix=layout.scene.xaxis.ticksuffix=xValueSuffix;layout.yaxis.tickprefix=layout.scene.yaxis.tickprefix=y1ValuePrefix;layout.yaxis.ticksuffix=layout.scene.yaxis.ticksuffix=y1ValueSuffix;layout.zaxis.tickprefix=layout.scene.zaxis.tickprefix=zValuePrefix;layout.zaxis.ticksuffix=layout.scene.zaxis.ticksuffix=zValueSuffix;if(/^(scatter|bubble)$/.test(marker)&&viz.xAxisScale){layout.xaxis.type=layout.scene.xaxis.type=viz.xAxisScale}if(viz.x&&VizUtil.returnsDateValue(viz.x)){layout.xaxis.type=layout.scene.xaxis.type="date";if(viz.xAxisDateTickFormat){layout.xaxis.tickformat=layout.scene.xaxis.tickformat=viz.xAxisDateTickFormat}else if(layout.xaxis.tickformat&&!/%/.test(layout.xaxis.tickformat)){delete layout.xaxis.tickformat;delete layout.scene.xaxis.tickformat}}if(/^(scatter|bar|errbar|hist|bubble|line|area)$/.test(marker)&&viz.yAxisScale){layout.yaxis.type=layout.scene.yaxis.type=viz.yAxisScale}if(viz.y&&VizUtil.returnsDateValue(viz.y)){layout.yaxis.type=layout.scene.yaxis.type="date";if(viz.yAxisDateTickFormat){layout.yaxis.tickformat=layout.scene.yaxis.tickformat=viz.yAxisDateTickFormat}else if(layout.yaxis.tickformat&&!/%/.test(layout.yaxis.tickformat)){delete layout.yaxis.tickformat;delete layout.scene.yaxis.tickformat}}if(/^(scatter)$/.test(marker)&&viz.zAxisScale){layout.zaxis.type=layout.scene.zaxis.type=viz.zAxisScale}if(viz.z&&VizUtil.returnsDateValue(viz.z)){layout.zaxis.type=layout.scene.zaxis.type="date";if(viz.zAxisDateTickFormat){layout.zaxis.tickformat=layout.scene.zaxis.tickformat=viz.zAxisDateTickFormat}else if(layout.zaxis.tickformat&&!/%/.test(layout.zaxis.tickformat)){delete layout.zaxis.tickformat;delete layout.scene.zaxis.tickformat}}if(!yAxisTitle&&viz.y&&viz.yColumnName&&VizUtil.isDualYSupported(marker)){yAxisTitle=viz.yColumnName}if(xAxisTitle){layout.xaxis.title=layout.scene.xaxis.title=xAxisTitle}if(yAxisTitle){layout.yaxis.title=layout.scene.yaxis.title=yAxisTitle}if(zAxisTitle){layout.zaxis.title=layout.scene.zaxis.title=zAxisTitle}if(!xAxisShowTitle){layout.xaxis.title=layout.scene.xaxis.title=""}if(!yAxisShowTitle){layout.yaxis.title=layout.scene.yaxis.title=""}if(!zAxisShowTitle){layout.zaxis.title=layout.scene.zaxis.title=""}layout.xaxis.titlefont.size=layout.scene.xaxis.titlefont.size=viz.xAxisTitleFontSize||viz._defaultXAxisTitleFontSize||13;layout.yaxis.titlefont.size=layout.scene.yaxis.titlefont.size=viz.yAxisTitleFontSize||viz._defaultYAxisTitleFontSize||13;layout.zaxis.titlefont.size=layout.scene.zaxis.titlefont.size=viz.zAxisTitleFontSize||viz._defaultZAxisTitleFontSize||13;if(layout.xaxis.title&&/bold/.test(viz.xAxisTitleFontWeight)){layout.xaxis.title=layout.scene.xaxis.title="<b>"+layout.xaxis.title+"</b>"}if(layout.xaxis.title&&/italic/.test(viz.xAxisTitleFontWeight)){layout.xaxis.title=layout.scene.xaxis.title="<i>"+layout.xaxis.title+"</i>"}if(layout.yaxis.title&&/bold/.test(viz.yAxisTitleFontWeight)){layout.yaxis.title=layout.scene.yaxis.title="<b>"+layout.yaxis.title+"</b>"}if(layout.yaxis.title&&/italic/.test(viz.yAxisTitleFontWeight)){layout.yaxis.title=layout.scene.yaxis.title="<i>"+layout.yaxis.title+"</i>"}if(layout.zaxis.title&&/bold/.test(viz.zAxisTitleFontWeight)){layout.zaxis.title=layout.scene.zaxis.title="<b>"+layout.zaxis.title+"</b>"}if(layout.zaxis.title&&/italic/.test(viz.zAxisTitleFontWeight)){layout.zaxis.title=layout.scene.zaxis.title="<i>"+layout.zaxis.title+"</i>"}if(viz.xAxisTickFontSize||viz._defaultXAxisTickFontSize){layout.xaxis.tickfont.size=layout.scene.xaxis.tickfont.size=viz.xAxisTickFontSize||viz._defaultXAxisTickFontSize}if(viz.yAxisTickFontSize||viz._defaultYAxisTickFontSize){layout.yaxis.tickfont.size=layout.scene.yaxis.tickfont.size=viz.yAxisTickFontSize||viz._defaultYAxisTickFontSize}if(viz.zAxisTickFontSize||viz._defaultZAxisTickFontSize){layout.zaxis.tickfont.size=layout.scene.zaxis.tickfont.size=viz.zAxisTickFontSize||viz._defaultZAxisTickFontSize}if(viz.axisAutoMargin!=="off"){layout.xaxis.automargin=true;layout.yaxis.automargin=true}if(viz.showXGridLines&&viz.showXGridLines!=="default"&&!/^(boxplot|violin)$/.test(marker)){layout.xaxis.showgrid=layout.scene.xaxis.showgrid=viz.showXGridLines==="on"}if(!/^(heatmap|contour|boxplot|violin|pie|radar|parcats)$/.test(marker)){if(viz.xGridLineColor&&viz.xGridLineColor!=="default"){layout.xaxis.gridcolor=layout.scene.xaxis.gridcolor=viz.xGridLineColor}if(viz.xGridLineWidth&&viz.xGridLineWidth!=="default"){layout.xaxis.gridwidth=layout.scene.xaxis.gridwidth=viz.xGridLineWidth}}if(viz.showYGridLines&&viz.showYGridLines!=="default"){layout.yaxis.showgrid=layout.scene.yaxis.showgrid=viz.showYGridLines==="on"}if(!/^(heatmap|contour|pie|radar|parcats)$/.test(marker)){if(viz.yGridLineColor&&viz.yGridLineColor!=="default"){layout.yaxis.gridcolor=layout.scene.yaxis.gridcolor=viz.yGridLineColor}if(viz.yGridLineWidth&&viz.yGridLineWidth!=="default"){layout.yaxis.gridwidth=layout.scene.yaxis.gridwidth=viz.yGridLineWidth}}if(viz.showZGridLines&&viz.showZGridLines!=="default"){layout.zaxis.showgrid=layout.scene.zaxis.showgrid=viz.showZGridLines==="on"}if(!/^(heatmap|contour|pie|radar|parcats)$/.test(marker)){if(viz.zGridLineColor&&viz.zGridLineColor!=="default"){layout.zaxis.gridcolor=layout.scene.zaxis.gridcolor=viz.zGridLineColor}if(viz.zGridLineWidth&&viz.zGridLineWidth!=="default"){layout.zaxis.gridwidth=layout.scene.zaxis.gridwidth=viz.zGridLineWidth}}if(!viz.x){layout.xaxis.zeroline=layout.scene.xaxis.zeroline=false}if(viz.showXZeroLine&&viz.showXZeroLine!=="default"&&!/^(boxplot|violin)$/.test(marker)){layout.xaxis.zeroline=layout.scene.xaxis.zeroline=viz.showXZeroLine==="on"}if(!/^(heatmap|contour|boxplot|violin|pie|radar|parcats)$/.test(marker)){if(viz.xZeroLineColor&&viz.xZeroLineColor!=="default"){layout.xaxis.zerolinecolor=layout.scene.xaxis.zerolinecolor=viz.xZeroLineColor}if(viz.xZeroLineWidth&&viz.xZeroLineWidth!=="default"){layout.xaxis.zerolinewidth=layout.scene.xaxis.zerolinewidth=viz.xZeroLineWidth}}if(viz.showYZeroLine&&viz.showYZeroLine!=="default"){layout.yaxis.zeroline=layout.scene.yaxis.zeroline=viz.showYZeroLine==="on"}if(!/^(heatmap|contour|pie|radar|parcats)$/.test(marker)){if(viz.yZeroLineColor&&viz.yZeroLineColor!=="default"){layout.yaxis.zerolinecolor=layout.scene.yaxis.zerolinecolor=viz.yZeroLineColor}if(viz.yZeroLineWidth&&viz.yZeroLineWidth!=="default"){layout.yaxis.zerolinewidth=layout.scene.yaxis.zerolinewidth=viz.yZeroLineWidth}}if(viz.showZZeroLine&&viz.showZZeroLine!=="default"){layout.zaxis.zeroline=layout.scene.zaxis.zeroline=viz.showZZeroLine==="on"}if(!/^(heatmap|contour|pie|radar|parcats)$/.test(marker)){if(viz.zZeroLineColor&&viz.zZeroLineColor!=="default"){layout.zaxis.zerolinecolor=layout.scene.zaxis.zerolinecolor=viz.zZeroLineColor}if(viz.zZeroLineWidth&&viz.zZeroLineWidth!=="default"){layout.zaxis.zerolinewidth=layout.scene.zaxis.zerolinewidth=viz.zZeroLineWidth}}if(viz.xAxisTickStep&&viz.x&&VizUtil.returnsNumericValue(viz.x)){layout.xaxis.dtick=layout.scene.xaxis.dtick=viz.xAxisTickStep}if(userXAxisRange){layout.xaxis.range=layout.scene.xaxis.range=userXAxisRange}if(viz.yAxisTickStep&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis.dtick=layout.scene.yaxis.dtick=viz.yAxisTickStep}if(userYAxisRange){layout.yaxis.range=layout.scene.yaxis.range=userYAxisRange}if(viz.zAxisTickStep&&viz.z&&VizUtil.returnsNumericValue(viz.z)){layout.zaxis.dtick=layout.scene.zaxis.dtick=viz.zAxisTickStep}if(userZAxisRange){layout.zaxis.range=layout.scene.zaxis.range=userZAxisRange}if(viz.x&&!VizUtil.returnsNumericValue(viz.x)&&VizUtil.isPostFilterSupported(viz,"x")&&viz.xPostFilterType){layout.xaxis.type="category"}if(colsOn2ndAxis.length>0){if(!layout.yaxis2){layout.yaxis2={}}layout.yaxis2.zerolinecolor=VizUtil.ZERO_LINE_COLOR;layout.yaxis2.titlefont={};layout.yaxis2.tickfont={};layout.yaxis2.side="right";if(layY1OverY2){layout.yaxis.overlaying="y2"}else{layout.yaxis2.overlaying="y"}if(viz.axisAutoMargin!=="off"){layout.yaxis2.automargin=true}var _col=colsOn2ndAxis[0];if(y2AxisTitle){layout.yaxis2.title=layout.scene.yaxis2.title=y2AxisTitle}else{layout.yaxis2.title=_col.name;if(_col.label===VizUtil.FREQ_COL_LABEL){layout.yaxis2.title=NUMROWS_COL_LABEL}if(_col.type===VizUtil.TYPE_NUMROWS){layout.yaxis2.title=NUMROWS_COL_LABEL}if(_col._columnDisplayName){layout.yaxis2.title=_col._columnDisplayName}}if(!y2AxisShowTitle){layout.yaxis2.title=""}layout.yaxis2.title=translateColumn(layout.yaxis2.title);if(layout.yaxis2.title&&/bold/.test(viz.y2AxisTitleFontWeight)){layout.yaxis2.title="<b>"+layout.yaxis2.title+"</b>"}if(layout.yaxis2.title&&/italic/.test(viz.y2AxisTitleFontWeight)){layout.yaxis2.title="<i>"+layout.yaxis2.title+"</i>"}if(/^(scatter|bar|errbar|hist|bubble|area|line)$/.test(marker)&&viz.y2AxisScale){layout.yaxis2.type=layout.scene.yaxis2.type=viz.y2AxisScale}if(VizUtil.returnsDateValue(_col)){layout.yaxis2.type=layout.scene.yaxis2.type="date";if(viz.y2AxisDateTickFormat){layout.yaxis2.tickformat=viz.y2AxisDateTickFormat}else if(layout.yaxis2.tickformat&&!/%/.test(layout.yaxis2.tickformat)){delete layout.yaxis2.tickformat}}layout.yaxis2.tickprefix=y2ValuePrefix;layout.yaxis2.ticksuffix=y2ValueSuffix;layout.yaxis2.titlefont.size=viz.y2AxisTitleFontSize||viz._defaultYAxisTitleFontSize||13;if(viz.y2AxisTickFontSize||viz._defaultYAxisTickFontSize){layout.yaxis2.tickfont.size=viz.y2AxisTickFontSize||viz._defaultYAxisTickFontSize}layout.yaxis2.showgrid=viz.showY2GridLines==="on";if(!/^(heatmap|contour|pie|radar|parcats)$/.test(marker)){if(viz.y2GridLineColor&&viz.y2GridLineColor!=="default"){layout.yaxis2.gridcolor=layout.scene.yaxis2.gridcolor=viz.y2GridLineColor}if(viz.y2GridLineWidth&&viz.y2GridLineWidth!=="default"){layout.yaxis2.gridwidth=layout.scene.yaxis2.gridwidth=viz.y2GridLineWidth}}layout.yaxis2.zeroline=viz.showY2ZeroLine==="on";if(!/^(heatmap|contour|pie|radar|parcats)$/.test(marker)){if(viz.y2ZeroLineColor&&viz.y2ZeroLineColor!=="default"){layout.yaxis2.zerolinecolor=layout.scene.yaxis2.zerolinecolor=viz.y2ZeroLineColor}if(viz.y2ZeroLineWidth&&viz.y2ZeroLineWidth!=="default"){layout.yaxis2.zerolinewidth=layout.scene.yaxis2.zerolinewidth=viz.y2ZeroLineWidth}}if(viz.y2AxisTickStep&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis2.dtick=viz.y2AxisTickStep}if(userY2AxisRange){layout.yaxis2.range=userY2AxisRange}}if(viz.legendFontSize||viz._defaultLegendFontSize){layout.legend.font.size=viz.legendFontSize||viz._defaultLegendFontSize}if(title){layout.title.text=title}if(/bold/.test(viz.titleFontWeight)){layout.title.text="<b>"+layout.title.text+"</b>"}if(/italic/.test(viz.titleFontWeight)){layout.title.text="<i>"+layout.title.text+"</i>"}if(viz.titleFontSize||viz._defaultTitleFontSize){layout.title.font.size=viz.titleFontSize||viz._defaultTitleFontSize}if(viz.titleFontWeight){layout.title.font.size=viz.titleFontSize||viz._defaultTitleFontSize}if(viz.titleLocation){switch(viz.titleLocation){case"left":layout.title.xanchor="left";layout.title.x=0;break;case"right":layout.title.xanchor="right";layout.title.x=1;break;default:layout.title.xanchor="center";delete layout.title.x;break}}if(viz.width){layout.width=viz.width}if(viz.height){layout.height=viz.height;if(this._isToolbarEnabled&&!this._isToolbarHidden){layout.height-=TOOLBAR_HEIGHT}}if(!showXAxisTickLabel){layout.xaxis.showticklabels=layout.scene.xaxis.showticklabels=false}if(!showYAxisTickLabel){layout.yaxis.showticklabels=layout.scene.yaxis.showticklabels=false}if(!showY2AxisTickLabel){if(!layout.yaxis2){layout.yaxis2={}}if(!layout.scene.yaxis2){layout.scene.yaxis2={}}layout.yaxis2.showticklabels=layout.scene.yaxis2.showticklabels=false}if(!showZAxisTickLabel){layout.zaxis.showticklabels=layout.scene.zaxis.showticklabels=false}if(xAxisTickAngle){layout.xaxis.tickangle=layout.scene.xaxis.tickangle=xAxisTickAngle}if(yAxisTickAngle){layout.yaxis.tickangle=layout.scene.yaxis.tickangle=yAxisTickAngle}if(y2AxisTickAngle){if(!layout.yaxis2){layout.yaxis2={}}if(!layout.scene.yaxis2){layout.scene.yaxis2={}}layout.yaxis2.tickangle=layout.scene.yaxis2.tickangle=y2AxisTickAngle}if(zAxisTickAngle){layout.zaxis.tickangle=layout.scene.zaxis.tickangle=zAxisTickAngle}var config={displayModeBar:false};if(PlotlyGraphGenerator._lang&&PlotlyGraphGenerator._lang!=="en"){config.locale=PlotlyGraphGenerator._lang}if(configProps&&configProps.doubleClickDelay){config.doubleClickDelay=configProps.doubleClickDelay}switch(viz.legendLocation){case"top":layout.legend.orientation="h";layout.legend.y=viz.plotlyLegendPosY||1;layout.legend.x=viz.plotlyLegendPosX||.5;layout.legend.xanchor="center";layout.legend.yanchor="bottom";if(isMultiY||color){layout.margin.t+=18}break;case"bottom":layout.legend.orientation="h";layout.legend.y=viz.plotlyLegendPosY||-.12;layout.legend.x=viz.plotlyLegendPosX||.5;layout.legend.xanchor="center";break;case"left":layout.legend.orientation="v";layout.legend.y=viz.plotlyLegendPosY||1.04;layout.legend.x=viz.plotlyLegendPosX||-.2;break;case"none":layout.showlegend=false;break;default:if(viz.plotlyLegendPosX){layout.legend.x=viz.plotlyLegendPosX}if(viz.plotlyLegendPosY){layout.legend.y=viz.plotlyLegendPosY}break}if(viz.showLegend==="off"){layout.showlegend=false}if(viz._invalidLogicalizeCommandForColor){layout.showlegend=false}if(viz.hoverLabelBgColorBrightnessRatio){gData.forEach(function(g){if(!g.hoverlabel){g.hoverlabel={}}if(g.marker.color){g.hoverlabel.bgcolor=_adjustColor(g.marker.color,viz.hoverLabelBgColorBrightnessRatio)}})}var annotations,annotationContext=null,gDataFiltered,_axisRanges,syncYAxis=(viz.facetSyncYAxis||VizUtil.getDefaultSyncYAxis(marker,isGroupByMeasuresEnabled))!=="off";switch(marker){case"scatter":layout.barmode="group";if(viz.scatterLayoutMode){layout.barmode=viz.scatterLayoutMode}if(viz.x&&(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory")){layout.xaxis.type="category"}if(viz.y&&(VizUtil.returnsCharacterValue(viz.y)||viz.y.func==="ascategory")){layout.yaxis.type="category"}if(allowMultiYAndColor){layout.legend.traceorder="reversed"}gData=gData.map(function(datum){datum.mode=datum.mode||"markers";datum.hoverinfo="text";if(allowMultiYAndColor){datum._multiYAndColor=true;if(viz.multiYAndColorHideNA&&datum.name===NA_LABEL){datum.showlegend=false}}if(allowMultiYAndColor&&datum.mode==="markers"&&datum.type==="scatter"){if(viz.label2OnPlot==="on"&&label2){datum.mode+="+text";datum.textposition=labelOnPlotVAlign+" "+labelOnPlotHAlign;if(datum.type==="bar"){datum.textposition="outside"}datum.hoverinfo="x+y+z";if(viz.yValueOnPlotFontSize||viz._defaultValuesOnPlotFontSize){if(!datum.textfont){datum.textfont={}}datum.textfont.size=viz.yValueOnPlotFontSize||viz._defaultValuesOnPlotFontSize}}}else{if(labelOnPlot==="on"&&label){datum.mode+="+text";datum.textposition=labelOnPlotVAlign+" "+labelOnPlotHAlign;if(datum.type==="bar"){datum.textposition="outside"}datum.hoverinfo="x+y+z";if(viz.yValueOnPlotFontSize||viz._defaultValuesOnPlotFontSize){if(!datum.textfont){datum.textfont={}}datum.textfont.size=viz.yValueOnPlotFontSize||viz._defaultValuesOnPlotFontSize}}}if(datum.marker){datum.marker.sizemode="diameter";datum.marker.sizemin=circleMinSize/2;if(!datum.marker.size){datum.marker.size=circleMinSize}}if(datum.z){datum.type="scatter3d"}if(datum.name==="null"){datum.visible=false;datum.showlegend=false}return datum});if(facet){constructFacetData(viz,gData,layout,colMap,colorarr&&colorarr.length>0?colorarr[0]:null,gRangeLayerData,gTrendLineLayerData,gTrendLineRangeLayerData,colsOn2ndAxis,gRefLineLayerData,gRefLineUpperRangeLayerData,gRefLineLowerRangeLayerData,gVRefLineLayerData,gVRefLineUpperRangeLayerData,gVRefLineLowerRangeLayerData)}else{if(viz.xAxisIncludeZero==="on"&&!layout.xaxis.range){layout.xaxis.range=layout.scene.xaxis.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"x",viz.xAxisScale,true,viz.x&&VizUtil.returnsNumericValue(viz.x),false,marker,needRangeCalcForValueOnPlot,false,errbarGraph,color,isMultiY,"x")}if((y2SyncZeroLines||viz.yAxisIncludeZero==="on"||yValueOnPlot==="on"&&yValueOnPlotPosition==="bottom")&&!layout.yaxis.range){layout.yaxis.range=layout.scene.yaxis.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"y",viz.yAxisScale,viz.yAxisIncludeZero==="on",viz.y&&VizUtil.returnsNumericValue(viz.y),false,marker,needRangeCalcForValueOnPlot,false,errbarGraph,color,isMultiY,"y1")}if((y2SyncZeroLines||viz.y2AxisIncludeZero==="on"||yValueOnPlot==="on"&&yValueOnPlotPosition==="bottom")&&colsOn2ndAxis.length>0&&!layout.yaxis2.range){layout.yaxis2.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"y",viz.y2AxisScale,viz.y2AxisIncludeZero==="on",firstYAxisColumnOn2ndAxis&&VizUtil.returnsNumericValue(firstYAxisColumnOn2ndAxis),false,marker,needRangeCalcForValueOnPlot,false,errbarGraph,color,isMultiY,"y2");if(y2SyncZeroLines&&layout.yaxis.range&&layout.yaxis2.range){_axisRanges=PlotlyGraphGenerator._syncZeroLines(layout.yaxis.range,layout.yaxis2.range);layout.yaxis.range=_axisRanges[0];layout.yaxis2.range=_axisRanges[1]}}if(viz.zAxisIncludeZero==="on"&&!layout.zaxis.range){layout.zaxis.range=layout.scene.zaxis.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"z",viz.zAxisScale,true,viz.z&&VizUtil.returnsNumericValue(viz.z),false,marker,needRangeCalcForValueOnPlot,false,errbarGraph,color,isMultiY,"z")}}if(xAxisDataTypeDetection){gData.forEach(function(datum,idx){if(datum._label&&datum._label.length>0&&datum._label.indexOf("line")!==-1){delete datum.error_y;datum.mode="lines";datum.opacity=datum.marker.opacity;if(datum.xaxis){delete layout[datum.xaxis.replace("x","xaxis")].type}else{delete layout.xaxis.type}if(!VizUtil.isEmpty(viz.xAxisDataTypeDetectionLineRefLineConst)||viz.xAxisDataTypeDetectionSupressLineRefLine==="on"){if(gRefLineLayerData&&gRefLineLayerData.length>idx&&gRefLineLayerData[idx].y){gRefLineLayerData[idx].y=gRefLineLayerData[idx].y.map(function(v){if(viz.xAxisDataTypeDetectionSupressLineRefLine==="on"){return null}else{return VizUtil.isEmpty(v)?v:viz.xAxisDataTypeDetectionLineRefLineConst}});gRefLineLayerData[idx].x.sort(function(a,b){return parseFloat(a)-parseFloat(b)})}}}})}if(viz.clusterCircles&&/^(line|fill)$/.test(viz.clusterCircles)){layout.shapes=[];gData.forEach(function(datum){var cx=[],cy=[];if(datum&&datum.y){datum.y.forEach(function(yval,index){if(!VizUtil.isEmpty(yval)){cy.push(yval);cx.push(datum.x[index])}})}if(cx.length>0){var xext=d3.extent(cx);var yext=d3.extent(cy);var shape={type:"circle",xref:datum.xaxis?datum.xaxis:"x",yref:datum.yaxis?datum.yaxis:"y",x0:xext[0],y0:yext[0],x1:xext[1],y1:yext[1]};var colorValue=datum.marker.color||"#0000FF";if(Array.isArray(colorValue)){colorValue=colorValue.length>0?colorValue[0]:"#0000FF"}if(viz.clusterCircles==="line"){shape.line={color:VizUtil.hexToRgba(colorValue,.8),width:1}}else if(viz.clusterCircles==="fill"){shape.fillcolor=VizUtil.hexToRgba(colorValue,.2);shape.line={color:VizUtil.hexToRgba(colorValue,.2),width:1}}layout.shapes.push(shape)}})}if(marker==="scatter"&&!isMultiY&&!xAxisDataTypeDetection){if(!/color/.test(viz.yReflineGroup)){gRefLineUpperRangeLayerData=consolidateRefLines(gRefLineUpperRangeLayerData,viz.yReflineGroup);gRefLineLowerRangeLayerData=consolidateRefLines(gRefLineLowerRangeLayerData,viz.yReflineGroup);gRefLineLayerData=consolidateRefLines(gRefLineLayerData,viz.yReflineGroup)}if(!/color/.test(viz.xReflineGroup)){gVRefLineLayerData=consolidateRefLines(gVRefLineLayerData,viz.xReflineGroup)}}gRefLineLayerData=gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineUpperRangeLayerData=gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineLowerRangeLayerData=gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gVRefLineLayerData=gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});recalculateRefLineData(viz,gRefLineLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineUpperRangeLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineLowerRangeLayerData,layout,formatRefLineValueHash);recalculateVRefLineData(viz,gVRefLineLayerData,layout,formatVRefLineValueHash,colsOn2ndAxis);gRefLineRangeBandLayerData=PlotlyGraphGenerator._createReferenceLineRangeLayers(viz,gRefLineLayerData,gRefLineLowerRangeLayerData,gRefLineUpperRangeLayerData);addRefLineAnnotations("x",viz,gVRefLineLayerData,layout);layout.showlegend=!(!viz.color&&numY<2&&gRefLineLayerData.filter(function(g){return g.showlegend}).length===0&&gVRefLineLayerData.filter(function(g){return g.showlegend}).length===0);if(viz.legendLocation==="none"||viz.showLegend==="off"||viz._invalidLogicalizeCommandForColor){layout.showlegend=false}if(label&&!xAxisDataTypeDetection&&viz.scatterSplitLineByLabel==="on"){PlotlyGraphGenerator._convertGraphDataForScatterLineGroupedByLabel(gData)}else{gData.forEach(function(g){if(g.mode==="lines"){var cx=[],cy=[],ctxt=[];if(g&&g.y){g.y.forEach(function(yval,index){if(!VizUtil.isEmpty(yval)&&!VizUtil.isEmpty(g.x[index])){cy.push(yval);cx.push(g.x[index]);if(g.hovertext){ctxt.push(g.hovertext[index])}}})}g.x=cx;g.y=cy;if(ctxt.length>0){g.hovertext=ctxt}}})}if(useHighlightScale&&!colorbucket&&highlightSort){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,true);layout.legend.traceorder="reversed"}if(viz.reverseGraphLayerOrder||allowMultiYAndColor){gData.reverse()}if(VizUtil.isColumnObject(viz.x)&&VizUtil.returnsCharacterValue(viz.x)&&VizUtil.isColumnObject(viz.y)&&VizUtil.returnsCharacterValue(viz.y)){PlotlyGraphGenerator._removeRowsForOrder(gData);gData=PlotlyGraphGenerator._createOrderControlLayer(data,viz,colorScale).concat(gData)}if(xAxisDataTypeDetection){gData.forEach(function(g){if(g.x&&g.x.length===1&&g.x[0]===null&&g.y&&g.y.length===1&&g.y[0]===null){g.showlegend=false}})}if(viz.yAxisRangeRatio&&syncYAxis&&!userYAxisRange){var includeZeroOnYAxis=VizUtil.getAxisIncludeZero(viz,"y");var _yAxisRange=PlotlyGraphGenerator.getRangeFromRangeRatio("y",viz.yAxisRangeRatio,gData,includeZeroOnYAxis);Object.keys(layout).forEach(function(key){if(/^yaxis/.test(key)){layout[key].range=_yAxisRange}})}gDataFiltered=[].concat(gData).concat(gTrendLineRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gRefLineRangeBandLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gTrendLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0}));PlotlyGraphGenerator._convertLinesMode(gDataFiltered,layout,viz);PlotlyGraphGenerator._adjustAxisDirection(layout);PlotlyGraphGenerator._showTrendLineMetricsOnPlot(gDataFiltered,layout,viz);gDataFiltered.forEach(function(g){delete g._colorVal});if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gDataFiltered,layout:layout,config:config})}if(divElem){newPlot(divElem,gDataFiltered,layout,config);PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onFigureClickCallback)}break;case"hist":case"bar":case"errbar":case"errbar-agg":if(!viz.x){layout.xaxis.showticklabels=false}else{if(viz.x.func==="aschar"||!viz.x.isNumeric&&!viz.x.isDate){layout.xaxis.type="category"}else if(VizUtil.isDisablingAxisTickAutoScalingSupported(viz)){if(viz.xAxisAutomaticNumOfTicks!=="off"){}else{layout.xaxis.nticks=numOfXDataPoints(gData)}}}if(barPadding){layout.bargap=barPadding}if(marker==="hist"){barstyle=viz.histBarStyle==="stack"?"stack":"overlay"}if(marker==="errbar"||marker==="errbar-agg"){layout.barmode="group";if(viz.x&&viz.color&&viz.x.name===viz.color.name){layout.barmode="stack"}gData=gData.map(function(datum){datum.type=errbarGraph==="bar"?"bar":"scatter";datum.mode=errbarGraph==="bar"?null:"markers";datum.hoverinfo="text";return datum})}else{layout.barmode=barstyle;gData=gData.map(function(datum){if(!datum.type){datum.type="bar"}datum.hoverinfo="text";return datum})}if(facet){constructFacetData(viz,gData,layout,colMap,colorarr&&colorarr.length>0?colorarr[0]:null,null,null,null,colsOn2ndAxis,gRefLineLayerData,gRefLineUpperRangeLayerData,gRefLineLowerRangeLayerData,gVRefLineLayerData,gVRefLineUpperRangeLayerData,gVRefLineLowerRangeLayerData);if(!x){gData.forEach(function(g){if(!g.x){g.x=g.y.map(function(){return"x"})}})}if(!viz.facetSyncYAxis&&viz.facetEnableDataCompletion==="off"){syncYAxis=false}}else{if(marker==="bar"){if(y2SyncZeroLines||needRangeCalcForValueOnPlot||VizUtil.getAxisIncludeZero(viz,"y")&&!VizUtil.hasBarMarkerOnYAxis(viz,"y")){if(layout.yaxis.range){layout.yaxis.range=d3.extent(layout.yaxis.range.concat([0]))}else{layout.yaxis.range=calculateRange(gData,"y",viz.yAxisScale,VizUtil.getAxisIncludeZero(viz,"y"),viz.y&&VizUtil.returnsNumericValue(viz.y),false,marker,needRangeCalcForValueOnPlot,null,errbarGraph,null,null,"y1")}if(userYAxisRange&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis.range=userYAxisRange}}if(colsOn2ndAxis.length>0&&(y2SyncZeroLines||needRangeCalcForValueOnPlot||VizUtil.getAxisIncludeZero(viz,"y2")&&!VizUtil.hasBarMarkerOnYAxis(viz,"y2"))){if(layout.yaxis2.range){layout.yaxis2.range=d3.extent(layout.yaxis2.range.concat([0]))}else{layout.yaxis2.range=calculateRange(gData,"y",viz.yAxisScale,VizUtil.getAxisIncludeZero(viz,"y2"),firstYAxisColumnOn2ndAxis&&VizUtil.returnsNumericValue(firstYAxisColumnOn2ndAxis),false,marker,needRangeCalcForValueOnPlot,null,errbarGraph,null,null,"y2")}if(y2SyncZeroLines){_axisRanges=PlotlyGraphGenerator._syncZeroLines(layout.yaxis.range,layout.yaxis2.range);layout.yaxis.range=_axisRanges[0];layout.yaxis2.range=_axisRanges[1]}if(userY2AxisRange&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis2.range=userY2AxisRange}}}}if(useHighlightScale&&!colorbucket&&highlightSort){if(marker==="bar"&&barstyle==="stack"&&orientation==="vertical"){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,false,viz.showHighlightAtBottom!=="on")}else if(marker==="hist"){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,true);layout.legend.traceorder="reversed"}else{PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,false)}}if(yValueOnPlot==="on"&&marker==="bar"&&barstyle==="stack"){if(facet){var _ht={};gData.forEach(function(g){if(!_ht[g.facet]){_ht[g.facet]=[]}_ht[g.facet].push(g)});Object.keys(_ht).forEach(function(key){var group=_ht[key];calculateStackedYValue(group)})}else{gData=calculateStackedYValue(gData)}}annotations=constructAnnotations(gData,marker,viz.x,viz.color,viz.facet,barstyle,layout.barmode,numY,y1ValuePrefix,y1ValueSuffix,formatY1Value,y2ValuePrefix,y2ValueSuffix,formatY2Value,viz,colMap);if(annotations){layout.annotations=annotations}if(color||!color&&isMultiY&&!isGroupByMeasuresEnabled){if(marker==="bar"&&barstyle==="stack"&&orientation==="vertical"){layout.legend.traceorder="reversed";if(!(useHighlightScale&&!colorbucket)&&colorLegendDirection==="normal"){PlotlyGraphGenerator.reverseColorOrder(gData,colorScale,opacity||null,marker);PlotlyGraphGenerator.reverseColorOrder(gRefLineLayerData,colorScale,null,"refline");PlotlyGraphGenerator.reverseColorOrder(gRefLineLowerRangeLayerData,colorScale,.4,"refline");PlotlyGraphGenerator.reverseColorOrder(gRefLineUpperRangeLayerData,colorScale,.4,"refline");PlotlyGraphGenerator.reverseColorOrder(gVRefLineLayerData,colorScale,null,"refline");PlotlyGraphGenerator.reverseColorOrder(gVRefLineLowerRangeLayerData,colorScale,.4,"refline");PlotlyGraphGenerator.reverseColorOrder(gVRefLineUpperRangeLayerData,colorScale,.4,"refline")}}else{if(colorLegendDirection==="reversed"){PlotlyGraphGenerator.reverseColorOrder(gData,colorScale,opacity||null,marker);PlotlyGraphGenerator.reverseColorOrder(gRefLineLayerData,colorScale,null,"refline");PlotlyGraphGenerator.reverseColorOrder(gRefLineLowerRangeLayerData,colorScale,.4,"refline");PlotlyGraphGenerator.reverseColorOrder(gRefLineUpperRangeLayerData,colorScale,.4,"refline");PlotlyGraphGenerator.reverseColorOrder(gVRefLineLayerData,colorScale,null,"refline");PlotlyGraphGenerator.reverseColorOrder(gVRefLineLowerRangeLayerData,colorScale,.4,"refline");PlotlyGraphGenerator.reverseColorOrder(gVRefLineUpperRangeLayerData,colorScale,.4,"refline")}}}if(barstyle==="group"&&gData.filter(function(g){return g.use2ndAxis&&!/^(lines|markers)$/.test(g.mode)}).length>0){var gDualYedData=[];gData.forEach(function(g){if(g.use2ndAxis){gDualYedData.push({x:[g.x&&g.x.length>0?g.x[0]:0],y:[0],type:"bar",hoverinfo:"none",showlegend:false,customdata:[],yaxis:getCorrespondingYAxis(g.yaxis,!!facet),xaxis:g.xaxis});gDualYedData.push(g)}else{gDualYedData.push(g);gDualYedData.push({x:[g.x&&g.x.length>0?g.x[0]:0],y:[0],type:"bar",hoverinfo:"none",showlegend:false,customdata:[],yaxis:getCorrespondingYAxis(g.yaxis,!!facet),xaxis:g.xaxis})}});gData=gDualYedData}renderValueOnPlotForBars(gData,y1ValuePrefix,y1ValueSuffix,formatY1Value,y2ValuePrefix,y2ValueSuffix,formatY2Value,viz,colMap);if(orientation==="horizontal"&&/^(bar|errbar|errbar-agg)$/.test(marker)){PlotlyGraphGenerator._switchOrientation(gData,layout,viz.facetSyncXAxis!=="off",!!x,viz.facetAlwaysShowTickLabel==="on"||/^y/.test(viz.sortTarget)&&viz.x&&viz[viz.sortTarget]&&VizUtil.isSortable(viz,"x",viz.sortTarget),showXAxisTickLabel,showYAxisTickLabel,showY2AxisTickLabel,xAxisTickAngle,yAxisTickAngle,y2AxisTickAngle)}if(isGroupByMeasuresEnabled){gRefLineUpperRangeLayerData.forEach(function(g){return g.skipRecalc=true});gRefLineLowerRangeLayerData.forEach(function(g){return g.skipRecalc=true});gRefLineLayerData.forEach(function(g){return g.skipRecalc=true})}if(marker==="hist"){viz.y=VizUtil.NUMROWS_COL_TEMPLATE;if(!/color/.test(viz.xReflineGroup)){gVRefLineLayerData=consolidateRefLines(gVRefLineLayerData,viz.xReflineGroup);gVRefLineUpperRangeLayerData=consolidateRefLines(gVRefLineUpperRangeLayerData,viz.xReflineGroup);gVRefLineLowerRangeLayerData=consolidateRefLines(gVRefLineLowerRangeLayerData,viz.xReflineGroup)}}if(marker==="bar"&&!isMultiY||marker==="errbar"||marker==="errbar-agg"){if(!/color/.test(viz.yReflineGroup)){gRefLineUpperRangeLayerData=consolidateRefLines(gRefLineUpperRangeLayerData,viz.yReflineGroup);gRefLineLowerRangeLayerData=consolidateRefLines(gRefLineLowerRangeLayerData,viz.yReflineGroup);gRefLineLayerData=consolidateRefLines(gRefLineLayerData,viz.yReflineGroup)}if(!/color/.test(viz.xReflineGroup)){gVRefLineLayerData=consolidateRefLines(gVRefLineLayerData,viz.xReflineGroup)}}gRefLineUpperRangeLayerData=gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineLowerRangeLayerData=gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineLayerData=gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gVRefLineUpperRangeLayerData=gVRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gVRefLineLowerRangeLayerData=gVRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gVRefLineLayerData=gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});recalculateRefLineData(viz,gRefLineLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineUpperRangeLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineLowerRangeLayerData,layout,formatRefLineValueHash);recalculateVRefLineData(viz,gVRefLineLayerData,layout,formatVRefLineValueHash,colsOn2ndAxis);recalculateVRefLineData(viz,gVRefLineUpperRangeLayerData,layout,formatVRefLineValueHash,colsOn2ndAxis);recalculateVRefLineData(viz,gVRefLineLowerRangeLayerData,layout,formatVRefLineValueHash,colsOn2ndAxis);adjustYAxisRangeForVRefLine(viz,gVRefLineLayerData,layout,colsOn2ndAxis);adjustYAxisRangeForVRefLine(viz,gVRefLineUpperRangeLayerData,layout,colsOn2ndAxis);adjustYAxisRangeForVRefLine(viz,gVRefLineLowerRangeLayerData,layout,colsOn2ndAxis);gVRefLineRangeBandLayerData=PlotlyGraphGenerator._createReferenceLineRangeLayers(viz,gVRefLineLayerData,gVRefLineLowerRangeLayerData,gVRefLineUpperRangeLayerData);gRefLineRangeBandLayerData=PlotlyGraphGenerator._createReferenceLineRangeLayers(viz,gRefLineLayerData,gRefLineLowerRangeLayerData,gRefLineUpperRangeLayerData);addRefLineAnnotations("x",viz,gVRefLineLayerData,layout);if(orientation==="horizontal"&&/^(bar|errbar|errbar-agg)$/.test(marker)){PlotlyGraphGenerator._switchReferenceLineOrientation(gRefLineLayerData);PlotlyGraphGenerator._switchReferenceLineOrientation(gRefLineUpperRangeLayerData);PlotlyGraphGenerator._switchReferenceLineOrientation(gRefLineLowerRangeLayerData);PlotlyGraphGenerator._switchReferenceLineOrientation(gRefLineRangeBandLayerData);PlotlyGraphGenerator._switchReferenceLineOrientation(gVRefLineLayerData);PlotlyGraphGenerator._switchReferenceLineOrientation(gVRefLineUpperRangeLayerData);PlotlyGraphGenerator._switchReferenceLineOrientation(gVRefLineLowerRangeLayerData);PlotlyGraphGenerator._switchReferenceLineOrientation(gVRefLineRangeBandLayerData);if(layout.annotations){layout.annotations.forEach(function(aData){if(aData._type==="vrefline"){_flipProperties(aData,"x",aData,"y");aData.xanchor="right";aData.yanchor="top";delete aData.xshift;aData.yshift=-2}})}}layout.showlegend=!(!viz.color&&numY<2&&gRefLineLayerData.filter(function(g){return g.showlegend}).length===0&&gVRefLineLayerData.filter(function(g){return g.showlegend}).length===0);if(viz.legendLocation==="none"||viz.showLegend==="off"||viz._invalidLogicalizeCommandForColor){layout.showlegend=false}if(marker==="hist"){gData.forEach(function(g){if(g&&g.customdata){g.customdata.some(function(d){return d.some(function(op){if(op&&op.type==="x"&&!VizUtil.isEmpty(op.rawValue)&&!VizUtil.isEmpty(op.histRange)){op.includeEdge="both";return true}return false})})}})}if(marker==="hist"&&viz.histCumDistType&&viz.histType!=="ratio"){gRefLineLayerData=PlotlyGraphGenerator._generateCumulativeDistLayerData(viz,gData,layout,translateColumn,formatValue,y1UseThousandSeparator)}gDataFiltered=[].concat(gData).concat(gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gRefLineRangeBandLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gVRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gVRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gVRefLineRangeBandLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false}));PlotlyGraphGenerator._convertLinesMode(gDataFiltered,layout,viz);PlotlyGraphGenerator._adjustAxisDirection(layout);if(layout.barmode==="stack"&&marker==="bar"){layout.barmode="relative"}gDataFiltered.forEach(function(g){delete g._colorVal;delete g._lastTraceInGroup;delete g.stacky_pos;delete g.stacky_neg;delete g.stacky_sum});if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gDataFiltered,layout:layout,config:config})}if(divElem){if(marker==="hist"&&gData.filter(function(g){return g&&g.x&&g.x.indexOf("NA")===-1}).length===0){VizUtil.renderNoData(divElem,VizUtil.getMessage(PlotlyGraphGenerator._lang,"Histogram is not generated because all the values for the X-Axis column are NA."));return}newPlot(divElem,gDataFiltered,layout,config);PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onFigureClickCallback)}break;case"line":case"bubble":case"densityplot":if(marker==="line"&&viz.x&&(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory")){layout.xaxis.type="category"}if(viz.x&&!VizUtil.returnsCharacterValue(viz.x)&&VizUtil.isDisablingAxisTickAutoScalingSupported(viz)&&viz.xAxisAutomaticNumOfTicks==="off"){layout.xaxis.nticks=numOfXDataPoints(gData)}if(marker==="bubble"){if(viz.x&&(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory")){layout.xaxis.type="category"}if(viz.y&&(VizUtil.returnsCharacterValue(viz.y)||viz.y.func==="ascategory")){layout.yaxis.type="category"}}gData=gData.map(function(datum){datum.type=datum.type||"scatter";datum.mode=datum.mode||"lines";datum.hoverinfo="text";if(marker==="densityplot"){if(viz.fillLine==="on"){datum.fill="tozeroy";datum.fillcolor=VizUtil.hexToRgba(isArray(datum.marker.color)?quantColorPalette[quantColorPalette.length-1]:datum.marker.color,opacity);datum.marker.opacity=null}datum.opacity=null;if(!datum.line){datum.line={}}datum.line.shape="spline";datum.line.smoothing=.5}if(marker==="bubble"&&labelOnPlot==="on"&&label){datum.mode+="+text";datum.textposition=labelOnPlotVAlign+" "+labelOnPlotHAlign;datum.hoverinfo="x+y+z";if(viz.yValueOnPlotFontSize||viz._defaultValuesOnPlotFontSize){datum.textfont={size:viz.yValueOnPlotFontSize||viz._defaultValuesOnPlotFontSize}}if(viz.yValueOnPlotUseMarkerColor==="on"&&datum.marker.color){if(!datum.textfont){datum.textfont={}}datum.textfont.color=datum.marker.color}}if(marker==="bubble"){datum.marker.sizemode="diameter";datum.marker.sizemin=circleMinSize/2;if(!datum.marker.size){datum.marker.size=circleMinSize}}return datum});if(facet){constructFacetData(viz,gData,layout,colMap,colorarr&&colorarr.length>0?colorarr[0]:null,gRangeLayerData,gTrendLineLayerData,gTrendLineRangeLayerData,colsOn2ndAxis,gRefLineLayerData,gRefLineUpperRangeLayerData,gRefLineLowerRangeLayerData,gVRefLineLayerData,gVRefLineUpperRangeLayerData,gVRefLineLowerRangeLayerData,gLineFillLayerData)}else{if(/^(bubble)$/.test(marker)&&VizUtil.getAxisIncludeZero(viz,"x")){layout.xaxis.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"x",viz.xAxisScale,true,viz.y&&VizUtil.returnsNumericValue(viz.y),false,marker,needRangeCalcForValueOnPlot,false,errbarGraph,color,isMultiY,"x")}var _includeZeroOnYAxis=/^(bubble|line|densityplot)$/.test(marker)&&VizUtil.getAxisIncludeZero(viz,"y");layout.yaxis.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"y",viz.yAxisScale,_includeZeroOnYAxis,viz.y&&VizUtil.returnsNumericValue(viz.y),false,marker,needRangeCalcForValueOnPlot,null,errbarGraph,null,null,"y1");if(userYAxisRange&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis.range=userYAxisRange}if(colsOn2ndAxis.length>0){var _includeZeroOnY2Axis=/^(bubble|line|densityplot)$/.test(marker)&&VizUtil.getAxisIncludeZero(viz,"y2");layout.yaxis2.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"y",viz.y2AxisScale,_includeZeroOnY2Axis,firstYAxisColumnOn2ndAxis&&VizUtil.returnsNumericValue(firstYAxisColumnOn2ndAxis),false,marker,needRangeCalcForValueOnPlot,null,errbarGraph,null,null,"y2");if(userY2AxisRange&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis2.range=userY2AxisRange}if(y2SyncZeroLines){_axisRanges=PlotlyGraphGenerator._syncZeroLines(layout.yaxis.range,layout.yaxis2.range);layout.yaxis.range=_axisRanges[0];layout.yaxis2.range=_axisRanges[1]}}if(marker==="line"&&viz.x&&!viz.facet&&VizUtil.returnsDateValue(viz.x)&&viz.xAxisShowRangeSlider==="on"){layout.xaxis.type="date";layout.xaxis.rangeslider={range:calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"x",viz.xAxisScale,true,viz.x&&VizUtil.returnsNumericValue(viz.x),false,marker,needRangeCalcForValueOnPlot,false,errbarGraph,color,isMultiY,"x")}}}if(useHighlightScale&&!(colorbucket&&colorBucketType!=="none")&&highlightSort){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,true);layout.legend.traceorder="reversed"}annotations=constructAnnotations(gData,marker,viz.x,viz.color,viz.facet,barstyle,layout.barmode,numY,y1ValuePrefix,y1ValueSuffix,formatY1Value,y2ValuePrefix,y2ValueSuffix,formatY2Value,viz,colMap);if(annotations){layout.annotations=annotations}if(color||!color&&isMultiY&&!isGroupByMeasuresEnabled){if(colorLegendDirection==="reversed"){PlotlyGraphGenerator.reverseColorOrder(gData,colorScale,opacity||null,marker);PlotlyGraphGenerator.reverseColorOrder(gRefLineLayerData,colorScale,null,"refline");PlotlyGraphGenerator.reverseColorOrder(gRefLineLowerRangeLayerData,colorScale,.4,"refline");PlotlyGraphGenerator.reverseColorOrder(gRefLineUpperRangeLayerData,colorScale,.4,"refline");PlotlyGraphGenerator.reverseColorOrder(gVRefLineLayerData,colorScale,null,"refline");PlotlyGraphGenerator.reverseColorOrder(gVRefLineLowerRangeLayerData,colorScale,.4,"refline");PlotlyGraphGenerator.reverseColorOrder(gVRefLineUpperRangeLayerData,colorScale,.4,"refline");PlotlyGraphGenerator.reverseColorOrder(gTrendLineLayerData,colorScale,null,"trendline");PlotlyGraphGenerator.reverseColorOrder(gTrendLineRangeLayerData,colorScale,.2,"trendline-range")}}if(marker==="line"){renderValueOnPlotForBars(gData,y1ValuePrefix,y1ValueSuffix,formatY1Value,y2ValuePrefix,y2ValueSuffix,formatY2Value,viz,colMap)}if(isGroupByMeasuresEnabled){gRefLineUpperRangeLayerData.forEach(function(g){return g.skipRecalc=true});gRefLineLowerRangeLayerData.forEach(function(g){return g.skipRecalc=true});gRefLineLayerData.forEach(function(g){return g.skipRecalc=true})}if(/^(bubble|densityplot)$/.test(marker)&&!/color/.test(viz.yReflineGroup)){gRefLineUpperRangeLayerData=consolidateRefLines(gRefLineUpperRangeLayerData,viz.yReflineGroup);gRefLineLowerRangeLayerData=consolidateRefLines(gRefLineLowerRangeLayerData,viz.yReflineGroup);gRefLineLayerData=consolidateRefLines(gRefLineLayerData,viz.yReflineGroup)}if(/^(line|bubble|densityplot)$/.test(marker)&&!/color/.test(viz.xReflineGroup)){gVRefLineUpperRangeLayerData=consolidateRefLines(gVRefLineUpperRangeLayerData,viz.xReflineGroup);gVRefLineLowerRangeLayerData=consolidateRefLines(gVRefLineLowerRangeLayerData,viz.xReflineGroup);gVRefLineLayerData=consolidateRefLines(gVRefLineLayerData,viz.xReflineGroup)}gRefLineUpperRangeLayerData=gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineLowerRangeLayerData=gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineLayerData=gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gVRefLineUpperRangeLayerData=gVRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gVRefLineLowerRangeLayerData=gVRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gVRefLineLayerData=gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});recalculateRefLineData(viz,gRefLineLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineUpperRangeLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineLowerRangeLayerData,layout,formatRefLineValueHash);recalculateVRefLineData(viz,gVRefLineLayerData,layout,formatVRefLineValueHash,colsOn2ndAxis);recalculateVRefLineData(viz,gVRefLineUpperRangeLayerData,layout,formatVRefLineValueHash,colsOn2ndAxis);recalculateVRefLineData(viz,gVRefLineLowerRangeLayerData,layout,formatVRefLineValueHash,colsOn2ndAxis);gVRefLineRangeBandLayerData=PlotlyGraphGenerator._createReferenceLineRangeLayers(viz,gVRefLineLayerData,gVRefLineLowerRangeLayerData,gVRefLineUpperRangeLayerData);gRefLineRangeBandLayerData=PlotlyGraphGenerator._createReferenceLineRangeLayers(viz,gRefLineLayerData,gRefLineLowerRangeLayerData,gRefLineUpperRangeLayerData);addRefLineAnnotations("x",viz,gVRefLineLayerData,layout);layout.showlegend=!(!viz.color&&numY<2&&gRefLineLayerData.filter(function(g){return g.showlegend}).length===0&&gVRefLineLayerData.filter(function(g){return g.showlegend}).length===0);if(viz.legendLocation==="none"||viz.showLegend==="off"||viz._invalidLogicalizeCommandForColor){layout.showlegend=false}PlotlyGraphGenerator._removeNAValues(gData,viz);if(marker==="line"&&viz.color&&(!viz.yCompleteInstruction||viz.yCompleteInstruction==="none")){gData.forEach(PlotlyGraphGenerator._removeNAValuesFromGraphData)}if(marker==="bubble"&&viz.color&&VizUtil.isContinuousValue(viz.color,marker,"color")){gData=gData.filter(function(g){return g.name!==NA_LABEL})}if(trendLineIgnoreColor){gData=gData.filter(function(g){return!(g.name==="undefined"&&isAllEmpty(g.y))})}gRangeLayerData=PlotlyGraphGenerator._organizeConstantRangeData(gRangeLayerData,(viz.facetSyncXAxis||VizUtil.getDefaultSyncXAxis(viz.marker))!=="off");gDataFiltered=[].concat(gData).concat(gTrendLineRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gRefLineRangeBandLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gVRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gVRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gVRefLineRangeBandLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gTrendLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0}).concat(d3.merge(gLineFillLayerData)));PlotlyGraphGenerator._convertLinesMode(gDataFiltered,layout,viz);PlotlyGraphGenerator._adjustAxisDirection(layout);PlotlyGraphGenerator._showTrendLineMetricsOnPlot(gDataFiltered,layout,viz);gDataFiltered.forEach(function(g){delete g._colorVal;delete g._lastTraceInGroup;delete g.stacky_pos;delete g.stacky_neg;delete g.stacky_sum});if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gDataFiltered,layout:layout,config:config})}if(marker==="bubble"){Object.keys(layout).forEach(function(key){if(/xaxis[1-9]/.test(key)&&layout[key].title===NA_LABEL){var name=key.replace("xaxis","x");gDataFiltered=gDataFiltered.filter(function(g){return!(g.xaxis===name&&(isAllNull(g.x)||isAllNull(g.y)))})}})}if(divElem){newPlot(divElem,gDataFiltered,layout,config);if(marker!=="densityplot"){PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onFigureClickCallback)}}break;case"area":if(viz.x&&(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory")){layout.xaxis.type="category"}if(viz.x&&!VizUtil.returnsCharacterValue(viz.x)&&VizUtil.isDisablingAxisTickAutoScalingSupported(viz)&&viz.xAxisAutomaticNumOfTicks==="off"){layout.xaxis.nticks=numOfXDataPoints(gData)}if(useHighlightScale&&!colorbucket&&highlightSort){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,false,viz.showHighlightAtBottom!=="on")}gData=gData.map(function(datum,idx){datum.fill=idx===0?"tozeroy":"tonexty";datum.type="scatter";datum.mode="none";datum.hoverinfo="text";datum.fillcolor=VizUtil.hexToRgba(datum.marker.color||"#1f77b4",opacity||.68);if(datum.y&&isArray(datum.y)&&datum.hovertext&&isArray(datum.hovertext)){datum.y.forEach(function(yvalue,idx){if(yvalue===0){datum.hovertext[idx]=null}})}return datum});if(facet){constructFacetData(viz,gData,layout,colMap,colorarr&&colorarr.length>0?colorarr[0]:null)}else{gData=convertToStackedYValue(gData);layout.yaxis.range=calculateRange(gData,"y",viz.yAxisScale,true,viz.y&&VizUtil.returnsNumericValue(viz.y),false,marker,needRangeCalcForValueOnPlot,null,errbarGraph,null,null,"y1");if(userYAxisRange&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis.range=userYAxisRange}}var textAngle=!viz["yValueOnPlotTextAngle"]||viz["yValueOnPlotTextAngle"]==="0"?null:viz["yValueOnPlotTextAngle"];var fontSize=viz["yValueOnPlotFontSize"]||viz._defaultValuesOnPlotFontSize||null;var position=viz["yValueOnPlotPosition"]||VizUtil.getDefaultValueOnPlotPosition(marker);if(position==="middle"){position="bottom"}var useMarkerColor=viz.yValueOnPlotUseMarkerColor==="on";var showSumValues=VizUtil.isShowSummarizedValueOnPlotSupported(viz.marker,viz.barstyle)&&viz.yValueOnPlotShowSumValues==="on";if(yValueOnPlot==="on"){annotationContext=[];var thresholdRatio=y1ValueSuffix==="%"?100:1;gData.forEach(function(group){if(!group.x||!Array.isArray(group.x)){return}else if(showSumValues&&!group._lastTraceInGroup){return}var xidx=-1;var useXidx=VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory";var indexes=_findValueOnPlotIndexes(group.y,group,"y",viz,thresholdRatio);annotationContext=annotationContext.concat(group.x.map(function(x,idx){if(!group._orderRow||!group._orderRow[idx]){xidx++}var v={x:useXidx?xidx:x,y:group.y[idx],origy:group.origy[idx],xref:group.xaxis?group.xaxis:"x",yref:group.yaxis?group.yaxis:"y",text:showSumValues?y1ValuePrefix+formatY1Value(group.y[idx],false)+y1ValueSuffix:group.origy[idx]===0?"":y1ValuePrefix+formatY1Value(group.origy[idx],false)+y1ValueSuffix,xanchor:"center",yanchor:position,showarrow:false};if(textAngle){v.textangle=textAngle}if(fontSize){v.font={size:fontSize}}if(useMarkerColor&&group.marker&&group.marker.color&&typeof group.marker.color==="string"){if(!v.font){v.font={}}v.font.color=group.marker.color}return v}).filter(function(ctx,idx){if(!ctx||VizUtil.isEmpty(ctx.y)||VizUtil.isEmpty(ctx.origy)){return false}if(typeof ctx.origy!=="number"){return true}return indexes[idx]}))});layout.annotations=annotationContext}if(color){layout.legend.traceorder="reversed";if(!(useHighlightScale&&!colorbucket)&&colorLegendDirection!=="reversed"){PlotlyGraphGenerator.reverseColorOrder(gData,colorScale,opacity||.68,marker)}}PlotlyGraphGenerator._adjustAxisDirection(layout);if(viz.color&&(layout.showlegend===null||layout.showlegend===undefined)){layout.showlegend=true}if(viz.showLegend==="off"){layout.showlegend=false}gData.forEach(function(g){delete g._colorVal;delete g._lastTraceInGroup;delete g.stacky_pos;delete g.stacky_neg;delete g.stacky_sum});if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gData,layout:layout,config:config})}if(divElem){newPlot(divElem,gData,layout,config);PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onFigureClickCallback)}break;case"pie":var _pieDataHash={},_pieDataList=[],_xaxis,_yaxis;var pieMasterFontSize=viz.xAxisTitleFontSize||(viz.facet?12:14);if(facet){constructFacetData(viz,gData,layout,colorarr&&colorarr.length>0?colorarr[0]:null)}if(useHighlightScale&&!colorbucket&&highlightSort){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,false,false)}if(colorLegendDirection==="reversed"){PlotlyGraphGenerator.reverseColorOrder(gData,colorScale,opacity||null,marker)}gData.forEach(function(d){var hashkey=(d.xaxis||"")+(d.yaxis||"");var pieData=_pieDataHash[hashkey];if(!pieData){pieData={values:[],_realvalues:[],labels:[],text:[],hovertext:[],customdata:[],type:"pie",textinfo:"text",textposition:[],hoverinfo:"text",marker:{colors:[]},sort:false,textfont:{size:viz.plotAreaFontSize||pieMasterFontSize},hole:pieHole,direction:"clockwise"};_pieDataHash[hashkey]=pieData;_pieDataList.push(pieData)}if(d.xaxis&&d.yaxis){_xaxis=layout[d.xaxis.replace(/^x/,"xaxis")];_yaxis=layout[d.yaxis.replace(/^y/,"yaxis")];pieData.domain={x:_xaxis.domain,y:_yaxis.domain};pieData._xref=d.xaxis;pieData._yref=d.yaxis;pieData._titleText=_xaxis.title}pieData._titleFontSize=pieMasterFontSize;i=d.y[d.y.length-1]||0;pieData._realvalues.push(i);if(i<0){i=Math.abs(i)}pieData.values.push(i);pieData.hovertext.push(d.hovertext[d.hovertext.length-1]);pieData.customdata.push(d.customdata[d.customdata.length-1]);pieData.labels.push(d.name);pieData.marker.colors.push(d.marker.color)});var formatPctValue=viz.piePctNumDecimalDigits?VizUtil.valueFormatterGenerator(viz.piePctNumDecimalDigits,useThousandSeparator,false):formatValue;if(viz.pieValueOnPlotTarget===undefined){VizUtil._migratePieShowValueOnPlot(viz)}_pieDataList.forEach(function(d){d._summary=d._realvalues.reduce(function(acc,cur){return acc+cur});var sum=d.values.reduce(function(acc,cur){return acc+cur});d.pcts=d.values.map(function(v){return v/sum*100});var indexes=_findValueOnPlotIndexes(d.pcts.map(function(v){return v===0?null:v}),d,"pie",viz,pieValueSuffix==="%"?100:1);d.text=d._realvalues.map(function(v,idx){var textinfo=[];if(viz.pieShowLabels!=="off"){textinfo.push(d.labels[idx])}if(viz.pieShowPercentages!=="off"){textinfo.push(formatPctValue(d.pcts[idx],false)+"%")}if(viz.pieShowValues==="on"){textinfo.push(pieValuePrefix+formatPieValue(v,false)+pieValueSuffix)}return textinfo.join("<br>")});d.hovertext=d.hovertext.map(function(v,idx){if(!v||!v.split){console.log("Debug #14657: [typeof v]=["+typeof v+"], [v]=["+JSON.stringify(v)+"]");return""}var arr=v.split("<br>");arr[0]+=" ("+formatValue(d.pcts[idx],false)+"%)";return arr.join("<br>")});d.textposition=d.pcts.map(function(v,idx){return indexes[idx]&&v&&!isNaN(v)?"auto":"none"});if(d.marker.colors){d.marker.colors=d.marker.colors.map(function(c){return VizUtil.hexToRgba(c,opacity||.8)})}});if(!color){layout.showlegend=false;_pieDataList.forEach(function(d){d.labels[0]=viz.y.name})}Object.keys(layout).forEach(function(key){if(/^(xaxis|yaxis)/.test(key)){layout[key].showticklabels=false;layout[key].showline=false;layout[key].showgrid=false;layout[key].zeroline=false;layout[key].showspikes=false;layout[key].fixedrange=true;layout[key].nticks=0;if(/^yaxis/.test(key)||/^xaxis/.test(key)&&pieHole!==0){layout[key].visible=false;layout[key].title=""}}});delete layout.scene;if(pieHole!==0){layout.annotations=_pieDataList.map(function(d){var _title=xAxisShowTitle?d._titleText||(viz.yColumnName||(viz.y.name===VizUtil.NUMROWS_COL_NAME?NUMROWS_COL_LABEL:viz.y.name)):"";return{font:{size:pieMasterFontSize},showarrow:false,text:_title+"<br>"+pieValuePrefix+formatPieValue(d._summary,false)+pieValueSuffix,x:d.domain?d3.mean(d.domain.x):.5,y:d.domain?d3.mean(d.domain.y):.5,xref:"paper",yref:"paper",xanchor:"center",yanchor:"middle",align:"center"}})}gDataFiltered=_pieDataList.filter(function(d){var res=false;for(i=0,l=d.values.length;i<l;i++){if(typeof d.values[i]!=="undefined"&&d.values[i]!==null&&d.values[i]!==0){res=true;break}}return res});PlotlyGraphGenerator._adjustAxisDirection(layout);gDataFiltered.forEach(function(g){delete g._colorVal});if(gDataFiltered.length===0&&targetElem){VizUtil.renderNoData(targetElem,VizUtil.getMessage(PlotlyGraphGenerator._lang,"There is no data to display."))}else{if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:_pieDataList,layout:layout,config:config})}if(divElem){newPlot(divElem,_pieDataList,layout,config);PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onFigureClickCallback)}}break;case"boxplot":if(!viz.x){layout.yaxis.title=""}else{if(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory"){layout.xaxis.type="category"}}gData=gData.map(function(datum,idx){datum.type="box";if(!viz.x){datum.x=datum.x.map(function(){return viz.y.name})}datum.boxpoints=false;return datum});if(useOverlayMode(viz.x,viz.color,viz.facet,viz.marker)){layout.boxmode="overlay"}else{layout.boxmode="group"}if(viz.boxplotLayoutMode){layout.boxmode=viz.boxplotLayoutMode}if(facet){constructFacetData(viz,gData,layout)}if(yTickFormat){gData.forEach(function(datum){datum.yhoverformat=yTickFormat})}if(useHighlightScale&&!colorbucket&&highlightSort){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,false)}PlotlyGraphGenerator._adjustAxisDirection(layout);if(orientation==="horizontal"){PlotlyGraphGenerator._switchOrientation(gData,layout,viz.facetSyncXAxis!=="off",!!x,viz.facetAlwaysShowTickLabel==="on"||/^y/.test(viz.sortTarget)&&viz.x&&viz[viz.sortTarget]&&VizUtil.isSortable(viz,"x",viz.sortTarget),showXAxisTickLabel,showYAxisTickLabel,showY2AxisTickLabel,xAxisTickAngle,yAxisTickAngle,y2AxisTickAngle)}if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gData,layout:layout,config:config})}if(divElem){newPlot(divElem,gData,layout,config)}break;case"violin":if(!viz.x){layout.yaxis.title=""}else{if(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory"){layout.xaxis.type="category"}}layout.hovermode="closest";if(useOverlayMode(viz.x,viz.color,viz.facet,viz.marker)){layout.violinmode="overlay"}else{layout.violinmode="group"}if(viz.violinLayoutMode){layout.violinmode=viz.violinLayoutMode}var vPoints=viz.violinShowAllPoints==="on"?"all":viz.includeOutlier==="on"?"outliers":"none";if(vPoints!=="all"){layout.violingap=.1;layout.violingroupgap=.1}if(vPoints==="none"){vPoints=false}var vShowBoxplot=viz.violinShowBoxplot!=="off";var vShowMeanLine=viz.violinShowMeanLine!=="off";var vJitter=viz.violinJitter?parseFloat(viz.violinJitter):null;var vPointOpacity=viz.violinPointOpacity?parseFloat(viz.violinPointOpacity):VizUtil.DEFAULT_VIOLIN_POINT_OPACITY;gData=gData.map(function(datum,idx){datum.type="violin";datum.box={visible:vShowBoxplot};datum.meanline={visible:vShowMeanLine};datum.points=vPoints;if(vJitter!==null){datum.jitter=vJitter}if(!datum.marker){datum.marker={}}datum.marker.opacity=vPointOpacity;return datum});if(facet){constructFacetData(viz,gData,layout)}if(useHighlightScale&&!colorbucket&&highlightSort){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,false)}PlotlyGraphGenerator._adjustAxisDirection(layout);if(orientation==="horizontal"){PlotlyGraphGenerator._switchOrientation(gData,layout,viz.facetSyncXAxis!=="off",!!x,viz.facetAlwaysShowTickLabel==="on"||/^y/.test(viz.sortTarget)&&viz.x&&viz[viz.sortTarget]&&VizUtil.isSortable(viz,"x",viz.sortTarget),showXAxisTickLabel,showYAxisTickLabel,showY2AxisTickLabel,xAxisTickAngle,yAxisTickAngle,y2AxisTickAngle)}if(yTickFormat){gData.forEach(function(datum){datum.yhoverformat=yTickFormat})}if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gData,layout:layout,config:config})}if(divElem){newPlot(divElem,gData,layout,config)}break;case"scattermatrix":var xAxisTemplate={showline:false,zeroline:false,showgrid:true,titlefont:{size:layout.xaxis.titlefont.size},tickfont:{}};if(!showXAxisTickLabel){xAxisTemplate.showticklabels=false}if(xAxisTickAngle){xAxisTemplate.tickangle=xAxisTickAngle}if(layout.xaxis.tickfont.size){xAxisTemplate.tickfont.size=layout.xaxis.tickfont.size}if(viz.showXGridLines&&viz.showXGridLines!=="default"){xAxisTemplate.showgrid=viz.showXGridLines==="on"}if(viz.showXZeroLine&&viz.showXZeroLine!=="default"){xAxisTemplate.zeroline=viz.showXZeroLine==="on"}var yAxisTemplate={showline:false,zeroline:false,showgrid:true,titlefont:{size:layout.yaxis.titlefont.size},tickfont:{}};if(!showYAxisTickLabel){yAxisTemplate.showticklabels=false}if(yAxisTickAngle){yAxisTemplate.tickangle=yAxisTickAngle}if(layout.yaxis.tickfont.size){yAxisTemplate.tickfont.size=layout.yaxis.tickfont.size}if(viz.showYGridLines&&viz.showYGridLines!=="default"){yAxisTemplate.showgrid=viz.showYGridLines==="on"}if(viz.showYZeroLine&&viz.showYZeroLine!=="default"){yAxisTemplate.zeroline=viz.showYZeroLine==="on"}ys.forEach(function(y,idx){var axisName="axis"+(idx===0?"":idx+1);layout["x"+axisName]=JSON.parse(JSON.stringify(xAxisTemplate));layout["y"+axisName]=JSON.parse(JSON.stringify(yAxisTemplate))});layout.autosize=false;layout.hovermode="closest";layout.dragmode="select";if(viz.facetSqueezePlots==="off"){var facetWidth=viz.facetWidth?parseInt(viz.facetWidth):180;var facetHeight=viz.facetHeight?parseInt(viz.facetHeight):180;layout.width=facetWidth*ys.length;layout.height=facetHeight*ys.length}PlotlyGraphGenerator._adjustAxisDirection(layout);if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gData,layout:layout,config:config})}if(divElem){newPlot(divElem,gData,layout,config)}break;case"heatmap":case"contour":layout.xaxis.zeroline=false;layout.xaxis.showgrid=false;layout.yaxis.zeroline=false;layout.yaxis.showgrid=false;if(viz.colorForNA){layout.plot_bgcolor=viz.colorForNA}if(marker==="heatmap"){layout.xaxis.type="category";layout.yaxis.type="category"}if(gData[0].y.length===1&&gData[0].y[0]===""){layout.yaxis.ticklen=0}var colorBarRange=PlotlyGraphGenerator.getRangeFromRangeString(viz.colorBarRange);var allDataRange=null;if(facet){constructFacetData(viz,gData,layout);allDataRange=[];data.forEach(function(d){allDataRange.push(d[color])});allDataRange=d3.extent(allDataRange);Object.keys(layout).forEach(function(key){if(/^(xaxis|yaxis)/.test(key)){layout[key].zeroline=false;layout[key].showgrid=false}})}else if(viz.colorSetZeroToCenter==="on"){allDataRange=[];data.forEach(function(d){allDataRange.push(d[color])});allDataRange=d3.extent(allDataRange)}if(viz.colorSetZeroToCenter==="on"){var absmin=Math.abs(allDataRange[0]);var absmax=Math.abs(allDataRange[1]);if(absmax>absmin){colorBarRange=[-absmax,absmax]}else{colorBarRange=[-absmin,absmin]}}var colorbarFormat=(useThousandSeparator?",":"")+"."+(viz.colorNumDecimalDigits||numDecimalDigits||"")+"f";gData=gData.map(function(datum,idx){datum.type=marker;datum.hoverinfo="text";datum.colorbar={len:viz.colorBarLength||.65};if(colorbarFormat!==",.f"){datum.colorbar.tickformat=colorbarFormat}if(colorValuePrefix){datum.colorbar.tickprefix=colorValuePrefix}if(colorValueSuffix){datum.colorbar.ticksuffix=colorValueSuffix}if(viz.legendFontSize){datum.colorbar.tickfont={size:viz.legendFontSize}}if(viz.showLegendTitle==="on"){if(viz.legendTitle){datum.colorbar.title={text:viz.legendTitle}}else if(color){datum.colorbar.title={text:viz.color.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.color.displayName||viz.color.name}}if(datum.colorbar.title){datum.colorbar.title.font={size:viz.legendTitleFontSize||viz._defaultLegendTitleFontSize||12};if(/bold/.test(viz.legendTitleFontWeight)){datum.colorbar.title.text="<b>"+datum.colorbar.title.text+"</b>"}if(/italic/.test(viz.legendTitleFontWeight)){datum.colorbar.title.text="<i>"+datum.colorbar.title.text+"</i>"}}}if(colorBarRange){datum.zmin=colorBarRange[0];datum.zmax=colorBarRange[1];datum.zauto=false}else if(facet){datum.zmin=allDataRange[0];datum.zmax=allDataRange[1];datum.zauto=false}if(facet){if(idx===0){datum.colorbar.len=layout.yaxis1.domain[1]-layout.yaxis1.domain[0];datum.colorbar.y=1;datum.colorbar.yanchor="top"}else{datum.showscale=false}}if(idx===0&&viz.showLegend==="off"){datum.showscale=false}return datum});var heatmapAnnotations=constructHeatmapAnnotations(gData,viz,formatColorValue,colorValuePrefix,colorValueSuffix);if(heatmapAnnotations){if(!layout.annotations){layout.annotations=[]}layout.annotations=layout.annotations.concat(heatmapAnnotations)}PlotlyGraphGenerator._adjustAxisDirection(layout);if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gData,layout:layout,config:config})}if(divElem){newPlot(divElem,gData,layout,config);PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onFigureClickCallback)}break;case"parcats":if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gData,layout:layout,config:config})}if(divElem){newPlot(divElem,gData,layout,config);PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onFigureClickCallback)}break;case"radar":layout.xaxis.zeroline=false;layout.xaxis.showgrid=false;layout.yaxis.zeroline=false;layout.yaxis.showgrid=false;layout.polar={radialaxis:{visible:true},angularaxis:{type:"category",linewidth:viz.showRadarOuterLine==="on"?viz.yGridLineWidth||1:0,linecolor:viz.yGridLineColor&&viz.yGridLineColor!=="default"?viz.yGridLineColor:"#b4b4b4",direction:"clockwise",rotation:viz.radarAxisStartingPosition||"90"}};if(viz.yAxisShowTickLabel==="off"){layout.polar.radialaxis.showticklabels=false;layout.polar.radialaxis.ticks="";layout.polar.radialaxis.linewidth=0}if(yAxisTickAngle){layout.polar.radialaxis.tickangle=yAxisTickAngle}if(yTickFormat){layout.polar.radialaxis.tickformat=yTickFormat}if(y1ValuePrefix){layout.polar.radialaxis.tickprefix=y1ValuePrefix}if(y1ValueSuffix){layout.polar.radialaxis.ticksuffix=y1ValueSuffix}if(viz.yGridLineColor&&viz.yGridLineColor!=="default"){layout.polar.radialaxis.gridcolor=viz.yGridLineColor}if(viz.yGridLineWidth){layout.polar.radialaxis.gridwidth=viz.yGridLineWidth}var includeZero=VizUtil.getAxisIncludeZero(viz,"y");if(viz.yAxisRange){layout.polar.radialaxis.range=viz.yAxisRange.split(",").map(function(x){return parseFloat(x)})}else if(syncYAxis&&facet||!facet&&!includeZero){layout.polar.radialaxis.range=calculateRange(gData,"r",null,includeZero,true,false,marker)}if(viz.showYGridLines==="on"||viz.showYGridLines==="off"){layout.polar.radialaxis.showgrid=viz.showYGridLines==="on"}if(viz.yAxisTickFontSize||viz._defaultYAxisTickFontSize){layout.polar.radialaxis.tickfont={size:viz.yAxisTickFontSize||viz._defaultYAxisTickFontSize}}if(viz.yAxisTickStep){layout.polar.radialaxis.dtick=viz.yAxisTickStep}if(viz.xAxisTickFontSize||viz._defaultXAxisTickFontSize){layout.polar.angularaxis.tickfont={size:viz.xAxisTickFontSize||viz._defaultXAxisTickFontSize}}if(xAxisTickAngle){layout.polar.angularaxis.tickangle=xAxisTickAngle}if(facet){constructFacetData(viz,gData,layout);layout.annotations=[];var facetHt=!syncYAxis&&!includeZero?{}:null;gData.forEach(function(g){g.subplot=g.xaxis.replace("x","polar");layout.annotations.push({text:"",showarrow:false,x:.5,y:0,xref:g.xaxis,yref:g.yaxis,xanchor:"center",yanchor:"top",font:{size:16}});delete g.xaxis;delete g.yaxis;if(facetHt){if(!facetHt[g.subplot]){facetHt[g.subplot]=[]}facetHt[g.subplot]=facetHt[g.subplot].concat(d3.extent(g.r))}});if(facetHt){Object.keys(facetHt).forEach(function(key){facetHt[key]=d3.extent(facetHt[key])})}Object.keys(layout).forEach(function(key){if(/^xaxis([\d]+)$/.test(key)){var idx=RegExp.$1;var props=JSON.parse(JSON.stringify(layout.polar));props.domain={x:layout["xaxis"+idx].domain,y:layout["yaxis"+idx].domain};if(facetHt){props.radialaxis.range=facetHt["polar"+idx]}layout["polar"+idx]=props;layout["xaxis"+idx].visible=true;layout["xaxis"+idx].showgrid=false;layout["xaxis"+idx].zeroline=false;layout["xaxis"+idx].showticklabels=false;layout["xaxis"+idx].range=[0,1];layout["yaxis"+idx].visible=true;layout["yaxis"+idx].showgrid=false;layout["yaxis"+idx].zeroline=false;layout["yaxis"+idx].showticklabels=false;layout["yaxis"+idx].range=[0,1];layout["yaxis"+idx].title=""}});layout.polar.domain=layout.polar1.domain}if(viz.radarReflineType==="constant"&&viz.radarReflineConstant){var subplots=facet?Object.keys(layout).filter(function(x){return/^polar\d+$/.test(x)}):[""];subplots.forEach(function(subplot,idx){var reflineHoverText=(viz.radarReflineLabel?viz.radarReflineLabel+": ":"")+viz.radarReflineConstant;var reflineGroup={type:"scatterpolar",marker:{color:viz.radarReflineColor||"#A6AAA9"},mode:"lines",theta:gData[0].theta,r:gData[0].theta.map(function(){return viz.radarReflineConstant}),hoverinfo:"text",hovertext:gData[0].theta.map(function(){return reflineHoverText}),showlegend:idx===0&&viz.radarReflineShowInLegend==="on",legendgroup:"radarRefline",name:viz.radarReflineLabel||""};if(viz.radarReflineWidth){if(!reflineGroup.line){reflineGroup.line={}}reflineGroup.line.width=viz.radarReflineWidth}if(viz.radarReflineStyle){if(!reflineGroup.line){reflineGroup.line={}}reflineGroup.line.dash=viz.radarReflineStyle}if(subplot){reflineGroup.subplot=subplot}gRefLineLayerData.push(reflineGroup)})}if(colorLegendDirection==="reversed"){PlotlyGraphGenerator.reverseColorOrder(gData,colorScale,opacity||null,marker)}if(useHighlightScale&&!colorbucket&&highlightSort){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,true);layout.legend.traceorder="reversed"}gDataFiltered=gData.concat(gRefLineLayerData);if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gDataFiltered,layout:layout,config:config})}if(divElem){newPlot(divElem,gDataFiltered,layout,config);PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onFigureClickCallback)}break;case"choropleth":gData=gData.map(function(datum){datum.type=marker;datum.hoverinfo="text";datum.z=datum.marker.color;datum.locations=datum.x;datum.locationmode=mapmode;datum.colorscale=datum.marker.colorscale;datum.showscale=false;datum.marker.line={color:"#ddd",width:.5};layout.margin={b:0,l:0,r:0,t:title?40:10,autoexpand:false,pad:0};switch(mapmode){case"USA-states":layout.geo={scope:"usa",showcoastlines:true,coastlinecolor:"#ccc",showcountries:true,countrycolor:"#ccc",showsubunits:true,subunitcolor:"#ccc",projection:{type:"albers usa"}};break;case"ISO-3":case"country names":layout.geo={showframe:false,showcoastlines:true,coastlinecolor:"#ccc",showcountries:true,countrycolor:"#ccc",projection:{type:"equirectangular"}};break}return datum});if(divElem){newPlot(divElem,gData,layout,config)}break;default:console.error("No such graph type supported: "+marker);break}};PlotlyGraphGenerator.getRenderSvgFunction=function(viz,data,onLoadCallback){var func=function(props){viz.width=props.width;viz.height=props.height;var targetElem=props.elem;PlotlyGraphGenerator.render(viz,data,targetElem,"svg",onLoadCallback)};return func};if(typeof module==="object"&&module.exports)module.exports=PlotlyGraphGenerator;var MapGenerator=function(){};var mapBoxConfig={id:"kei51/ckxtwxvv1j8e517pepk17auzh",accessToken:"pk.eyJ1Ijoia2VpNTEiLCJhIjoiY2tmbzltMDA2MDByODJ0cXFsb2tveWRpdyJ9.-5UukAYe4mZhn8L2SxkJBg"};var mapConfig={minCircleSize:VizUtil.DEFAULT_MIN_CIRCLE_DIAMETER.map,maxCircleSize:VizUtil.DEFAULT_MAX_CIRCLE_DIAMETER.map,lineWidth:3,selectedLineWidth:5,borderWidth:1,selectedBorderWidth:3,pointRadius:5,pointBorderWidth:0,selectedPointBorderWidth:3};var MAP_TYPE_MAPPING={"mapbox.light":{standard:"kei51/ckxtwxvv1j8e517pepk17auzh",large:"kei51/clqpi0fka00ca01r8a96n46lp"},"mapbox.dark":{standard:"kei51/ckxtx33dgux3414lg28s78qw7",large:"kei51/clqpjmes500bp01rj4xr4e9v7"},"mapbox.streets":{standard:"kei51/ckxt9da6xd8vb14qle0w26a1c",large:"kei51/clqpjmodi00at01pz12dp7pko"}};MAP_TYPE_MAPPING["mapbox.streets-basic"]=MAP_TYPE_MAPPING["mapbox.streets"];var MAP_TYPE_MAPPING_JA={"mapbox.light":{standard:"kei51/clluayuhk004x01rd7spf2zw8",large:"kei51/clqpi0ai5003e01rcc486gnyn"},"mapbox.dark":{standard:"kei51/cllucnst1005e01r97ulqamnn",large:"kei51/clqpjml5u00cc01r84bte5ire"},"mapbox.streets":{standard:"kei51/cllucopia005j01rfd50l5hg2",large:"kei51/clqpjmrdu00c401obgqw21b4h"}};MAP_TYPE_MAPPING_JA["mapbox.streets-basic"]=MAP_TYPE_MAPPING_JA["mapbox.streets"];var getMapStyleId=function(mapType,fontSize,lang){return lang==="ja"?MAP_TYPE_MAPPING_JA[mapType||"mapbox.light"][fontSize||"standard"]:MAP_TYPE_MAPPING[mapType||"mapbox.light"][fontSize||"standard"]};var formatValue=VizUtil.valueFormatterGenerator(2,true,true);var formatColorValue=VizUtil.valueFormatterGenerator(2,true,true);var formatSizeValue=VizUtil.valueFormatterGenerator(2,true,true);var formatNumrowValue=VizUtil.valueFormatterGenerator(0,true);MapGenerator.createInfoBox=function(){var info=L.control();info.onAdd=function(){this._div=L.DomUtil.create("div","info info-box");this.update();return this._div};info.update=function(values){var html="";if(values){var boxstyle="";var title=null,labels=[],long,lat;values.forEach(function(v){switch(v.type){case"title":title=v;break;case"label":labels.push(v);break;case"long":long=v;break;case"lat":lat=v;break}});if(title){html+='<div class="info-box-title">'+title.value+"</div>"}html+='<div class="info-box-table">';labels=labels.filter(function(label){return!title||!(title.column.name===label.column.name&&title.column.func===label.column.func&&title.suffix===label.suffix)});var labelHash={};var filteredLabels=[];labels.forEach(function(label){if(!labelHash[label.column.name+"::"+label.column.func+"::"+(label.suffix||"")]){filteredLabels.push(label);labelHash[label.column.name+"::"+label.column.func+"::"+(label.suffix||"")]=true}});if(long){html+='<div class="info-box-value '+boxstyle+'">'+'  <div class="label-col">'+VizUtil.getMessage(MapGenerator._lang,"Longitude")+":</div>"+'  <div class="value-col">'+long.value+"</div>"+"</div>"}if(lat){html+='<div class="info-box-value '+boxstyle+'">'+'  <div class="label-col">'+VizUtil.getMessage(MapGenerator._lang,"Latitude")+":</div>"+'  <div class="value-col">'+lat.value+"</div>"+"</div>"}filteredLabels.forEach(function(label){var labelText=(label.column.name===VizUtil.NUMROWS_COL_NAME?VizUtil.getMessage(MapGenerator._lang,VizUtil.NUMROWS_COL_LABEL):label.column.name)+(label.suffix||"");if(labelText){labelText+=":"}html+='<div class="info-box-value '+boxstyle+'">'+'  <div class="label-col">'+labelText+"</div>"+'  <div class="value-col">'+label.value+"</div>"+"</div>"});html+="</div>"}else{html="Hover over or click an area."}this._div.innerHTML=html};return info};MapGenerator.createLegend=function(colorData,catColorScale,colorOpacity,legendType,legendTitleText,legendTitleFontSize,legendTitleFontWeight,legendFontSize,legendLocation,highlightSort){var uniqs=VizUtil.distinct(colorData);var legend=L.control({position:legendLocation||"bottomright"});if(catColorScale.isHighlightColorScale&&highlightSort){uniqs.sort(function(a,b){return catColorScale.getOrderByValue(b)-catColorScale.getOrderByValue(a)})}legend.onAdd=function(){var div=L.DomUtil.create("div","info legend "+legendType);var _arr=[];if(legendTitleText){legendTitleText=VizUtil.escapeHTMLTags(legendTitleText);if(/bold/.test(legendTitleFontWeight)){legendTitleText='<span style="font-weight:bold">'+legendTitleText+"</span>"}if(/italic/.test(legendTitleFontWeight)){legendTitleText='<span style="font-style:italic">'+legendTitleText+"</span>"}_arr.push('<div class="legend-title-row"'+(legendTitleFontSize?' style="font-size:'+legendTitleFontSize+'px;"':"")+">"+legendTitleText+"</div>")}for(var i=0;i<uniqs.length;i++){_arr.push('<div class="legend-row" '+(legendFontSize?' style="font-size:'+legendFontSize+'px;"':"")+'><i style="background:'+catColorScale(uniqs[i])+"; opacity:"+colorOpacity+' "></i> '+(uniqs[i]||"NA")+"</div>")}div.innerHTML=_arr.join("");return div};return legend};MapGenerator.createCatColorScale=function(viz,numUniqsOnColor){if(viz.enableHighlight==="on"&&viz.color&&!(VizUtil.isContinuousValue(viz.color,viz.marker,"color")&&VizUtil.getBucketType("color",viz)!=="none")){return VizUtil.generateHighlightColorScale(viz.highlightDefaultColor||"#DCDEE0",viz.highlightValues||[],viz.colorRecode)}var colorScale=numUniqsOnColor&&numUniqsOnColor>10?d3.scale.category20():d3.scale.category10(),colorarr;var colorBucketType=VizUtil.getBucketType("color",viz);var categColorPalette=viz.categColorPalette||VizUtil.getDefaultColorPalette(colorBucketType,viz);var customCategColorPaletteOp=viz.customCategColorPalette||viz._defaultCustomCategColorPalette;if(viz.colorbucket&&colorBucketType==="none"&&viz.quantColorPalette){categColorPalette=viz.quantColorPalette;customCategColorPaletteOp=viz.customQuantColorPalette||viz._defaultCustomQuantColorPalette}var reverseColorPaletteOrderOp=viz.reverseColorPaletteOrder||viz.reverseColorPalleteOrder||"off";if(customCategColorPaletteOp&&customCategColorPaletteOp.length>0&&categColorPalette==="custom"){colorarr=customCategColorPaletteOp.match(VizUtil.COLOR_PALETTE_REGEX).slice();for(var i=0;i<colorarr.length;i++){if(VizUtil.hexToRgb(colorarr[i])===null){colorarr[i]="#CCCCCC"}}if(reverseColorPaletteOrderOp==="on"){colorarr.reverse()}colorScale=d3.scale.ordinal().range(colorarr)}else if(categColorPalette&&categColorPalette!=="default"&&VizUtil.CATEG_COLOR_PALETTES_HASH[categColorPalette]){var ncolors=numUniqsOnColor?Math.min(numUniqsOnColor,10):-1;if(ncolors>0&&VizUtil.colorbrewer[categColorPalette]&&VizUtil.colorbrewer[categColorPalette][ncolors]){colorarr=VizUtil.colorbrewer[categColorPalette][ncolors].slice()}else{colorarr=VizUtil.CATEG_COLOR_PALETTES_HASH[categColorPalette].color.slice()}if(reverseColorPaletteOrderOp==="on"){colorarr.reverse()}colorScale=d3.scale.ordinal().range(colorarr)}else{if(reverseColorPaletteOrderOp==="on"){var colors=colorScale.range().slice();colors.reverse();return d3.scale.ordinal().range(colors)}}if(viz.highlightOnPalette==="on"){colorScale=VizUtil.generateHighlightOnPaletteColorScale(colorScale,viz.highlightValues||[],viz.colorRecode)}return colorScale};MapGenerator._moveHighlightedCirclesToBottom=function(circles,scale){if(!scale.isHighlightColorScale){return}circles.forEach(function(c,idx){var v=scale.getOrderByColor(c.options.fillColor);c.__sortIdx=v===0?idx:-v});circles.sort(function(a,b){return b.__sortIdx-a.__sortIdx})};MapGenerator.createQuantColorScale=function(viz,colorData){var numCategories=colorData?colorData.length:null;var bucketType=VizUtil.getBucketType("color",viz);var quantColorPaletteOp=viz.quantColorPalette||viz._defaultQuantColorPalette||VizUtil.getDefaultColorPalette(bucketType,viz)||"Blues";if(!VizUtil.QUANT_COLOR_PALETTES_HASH[quantColorPaletteOp]){quantColorPaletteOp="Blues"}var reverseColorPaletteOrderOp=viz.reverseColorPaletteOrder||"off";var quantColorPalette=VizUtil.QUANT_COLOR_PALETTES_HASH[quantColorPaletteOp].color.slice();var customQuantColorPalette=viz.customQuantColorPalette||viz._defaultCustomQuantColorPalette;if(customQuantColorPalette&&customQuantColorPalette.length>0&&quantColorPaletteOp=="custom"){var colorarr=customQuantColorPalette.match(VizUtil.COLOR_PALETTE_REGEX).slice();for(var i=0;i<colorarr.length;i++){if(VizUtil.hexToRgb(colorarr[i])===null){colorarr[i]="#CCCCCC"}}quantColorPalette=colorarr}if(viz.quantColorPalette!=="custom"){var colorNumBuckets=bucketType==="bucket_equal_step"||VizUtil.useExtraBucketsForOutsideRangeValues(viz,"color")?numCategories:null;quantColorPalette=VizUtil.getColorPaletteForBuckets(viz,quantColorPaletteOp,colorNumBuckets)||quantColorPalette;if(VizUtil.isBucketZeroToCenterEnabled(viz,"color")&&colorData){var centerBucketIndex=VizUtil.findIndexForBucketIncludingZero(colorData);if(!VizUtil.isEmpty(centerBucketIndex)){quantColorPalette=VizUtil.getColorPaletteForZeroCenteredBuckets(reverseColorPaletteOrderOp==="on"?quantColorPalette.reverse():quantColorPalette,numCategories,centerBucketIndex);reverseColorPaletteOrderOp="off"}}}var hv;if(viz.enableHighlight==="on"&&viz.color){quantColorPalette=quantColorPalette.map(function(){return viz.highlightDefaultColor||"#DCDEE0"});hv=viz.highlightValues||[];hv.forEach(function(v){var idx=parseInt(v.value);if(idx<quantColorPalette.length){quantColorPalette[idx]=v.color}})}if(reverseColorPaletteOrderOp==="on"){quantColorPalette.reverse()}if(viz.highlightOnPalette==="on"){hv=viz.highlightValues||[];hv.forEach(function(v){var idx=parseInt(v.value);if(idx<quantColorPalette.length){quantColorPalette[idx]=v.color}})}return d3.scale.ordinal().range(quantColorPalette)};MapGenerator.noKeyMatch=function(data,keyCol,geojson,keyProp){var keycols=data.map(function(d){return d[keyCol]});var keyprops=geojson.features.map(function(feature){return feature.properties[keyProp]});var i,l;for(i=0,l=keycols.length;i<l;i++){if(keyprops.indexOf(keycols[i])!==-1){return false}}return true};MapGenerator.render=function(viz,data,elTarget,geoJSON,onLoadCallback,onErrorCallback,onZoomEndCallback,onMoveEndCallback,noThumbnail,onBeforeRenderingCallback,lang,onShowDetailCallback){if(lang){MapGenerator._lang=lang}try{MapGenerator._render(viz,data,elTarget,geoJSON,onLoadCallback,onZoomEndCallback,onMoveEndCallback,noThumbnail,onBeforeRenderingCallback,onShowDetailCallback)}catch(e){if(onErrorCallback&&typeof onErrorCallback==="function"){onErrorCallback(e,viz)}if(elTarget){VizUtil.renderNoData(elTarget,VizUtil.getMessage(MapGenerator._lang,"Chart rendering failed."))}console.error(e)}};MapGenerator._render=function(viz,data,elTarget,geoJSON,onLoadCallback,onZoomEndCallback,onMoveEndCallback,noThumbnail,onBeforeRenderingCallback,onShowDetailCallback){data=VizUtil.convertColumnarData(data);var bucketLabelMap=VizUtil.translateBucketLabels(data,viz,MapGenerator._lang);if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:viz.marker,data:data})}if(!elTarget){return}while(elTarget.childNodes.length>0){elTarget.removeChild(elTarget.firstChild)}if(!data&&!geoJSON||data&&data.length===0){VizUtil.renderNoData(elTarget,VizUtil.getMessage(MapGenerator._lang,"There is no data to display."));if(onLoadCallback&&typeof onLoadCallback==="function"){onLoadCallback()}return}var colorValuePrefix="",colorValueSuffix="",sizeValuePrefix="",sizeValueSuffix="",label1ValuePrefix="",label1ValueSuffix="",label2ValuePrefix="",label2ValueSuffix="",label3ValuePrefix="",label3ValueSuffix="";if(viz.color){colorValuePrefix=VizUtil.getValuePrefix(viz.colorNumberFormatting,viz.colorCurrencySymbol,viz.marker);colorValueSuffix=VizUtil.getValueSuffix(viz.colorWindowFunc,viz.color.func,viz.colorNumberFormatting,viz.marker)}if(viz.size){sizeValuePrefix=VizUtil.getValuePrefix(viz.sizeNumberFormatting,viz.sizeCurrencySymbol,viz.marker);sizeValueSuffix=VizUtil.getValueSuffix(viz.sizeWindowFunc,viz.size.func,viz.sizeNumberFormatting,viz.marker)}if(viz.label){label1ValuePrefix=VizUtil.getValuePrefix(viz.label1NumberFormatting,viz.label1CurrencySymbol,viz.marker);label1ValueSuffix=VizUtil.getValueSuffix(viz.label1WindowFunc,viz.label.func,viz.label1NumberFormatting,viz.marker)}if(viz.label2){label2ValuePrefix=VizUtil.getValuePrefix(viz.label2NumberFormatting,viz.label2CurrencySymbol,viz.marker);label2ValueSuffix=VizUtil.getValueSuffix(viz.label2WindowFunc,viz.label2.func,viz.label2NumberFormatting,viz.marker)}var labelNameMap={},labelNaNMap={};if(viz.x){labelNameMap[viz.x.label]=viz.x.name;labelNaNMap[viz.x.label]=false}if(viz.y){labelNameMap[viz.y.label]=viz.y.name;labelNaNMap[viz.y.label]=false}if(viz.size){labelNameMap[viz.size.label]=viz.size.name;labelNaNMap[viz.size.label]=false}if(viz.color){labelNameMap[viz.color.label]=viz.color.name;labelNaNMap[viz.color.label]=!VizUtil.returnsNumericValue(viz.color)}if(viz.label){labelNameMap[viz.label.label]=viz.label.name;labelNaNMap[viz.label.label]=!VizUtil.returnsNumericValue(viz.label)}if(viz.label2){labelNameMap[viz.label2.label]=viz.label2.name;labelNaNMap[viz.label2.label]=!VizUtil.returnsNumericValue(viz.label2)}if(viz.groupby){labelNaNMap[viz.groupby.label]=!VizUtil.returnsNumericValue(viz.groupby)}var showLegend=viz.showLegend||"on";var disableDecimalFormatting=!!viz.disableDecimalFormatting;var numDecimalDigits=viz.numDecimalDigits;var useThousandSeparator=viz.useThousandSeparator!=="off";formatValue=VizUtil.valueFormatterGenerator(disableDecimalFormatting?null:VizUtil.isEmpty(numDecimalDigits,true)?2:numDecimalDigits,useThousandSeparator,VizUtil.isEmpty(numDecimalDigits,true));formatColorValue=viz.colorNumDecimalDigits?VizUtil.valueFormatterGenerator(viz.colorNumDecimalDigits,useThousandSeparator,false):formatValue;formatSizeValue=viz.sizeNumDecimalDigits?VizUtil.valueFormatterGenerator(viz.sizeNumDecimalDigits,useThousandSeparator,false):formatValue;var divElem=document.createElement("div");divElem.style.width="100%";divElem.style.height="100%";elTarget.appendChild(divElem);var map=L.map(divElem,{zoomControl:true,preferCanvas:true,zoomDelta:.5,zoomSnap:.5});if(onLoadCallback&&typeof onLoadCallback==="function"){map.on("load",onLoadCallback)}var geoJSONLayer=null;L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{maxZoom:18,id:getMapStyleId(viz.mapType,viz.mapFontSize,MapGenerator._lang),accessToken:mapBoxConfig.accessToken,attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, '+'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, '+'Imagery &copy; <a href="http://mapbox.com">Mapbox</a>'}).addTo(map);var colorOpacity=viz.colorOpacity||VizUtil.getDefaultOpacity(viz);var quantColorScale=MapGenerator.createQuantColorScale(viz);var catColorScale=MapGenerator.createCatColorScale(viz);var colorBucketType=VizUtil.getBucketType("color",viz);var legend=null,colorData=null,colorHash=null,infobox=null;var legendTitleText="";if(viz.showLegendTitle==="on"){if(viz.legendTitle){legendTitleText=viz.legendTitle}else if(viz.color){legendTitleText=viz.color.type===VizUtil.TYPE_NUMROWS?VizUtil.getMessage(MapGenerator._lang,"(Number of Rows)"):viz.color.displayName||viz.color.name}}var zoomLevel=null,bounds=null,center=null;if(viz.mapZoomStatus){var arr=viz.mapZoomStatus.split(",");zoomLevel=parseFloat(arr[0]);if(arr.length===5){bounds=L.latLngBounds(L.latLng(parseFloat(arr[2]),parseFloat(arr[1])),L.latLng(parseFloat(arr[4]),parseFloat(arr[3])));if(!bounds.isValid()){bounds=null;zoomLevel=null}}else if(arr.length===3){center=L.latLng(parseFloat(arr[1]),parseFloat(arr[2]))}}var marker=viz.marker;var isEasymap=viz.marker==="easymap";if(marker==="easymap"){if(viz.easymapType!=="area"){marker="map"}else{marker="geojson"}}var easymapCols=[];if(isEasymap){Object.keys(viz).forEach(function(colname){if(colname&&colname.startsWith("map")&&VizUtil.isColumnObject(viz[colname])){easymapCols.push(colname)}})}var geoLayerBounds,_bounds;switch(marker){case"geojson":{infobox=MapGenerator.createInfoBox();infobox.addTo(map);if(!geoJSON){map.setView([0,0],1);return}var nameHash=null;if(data){nameHash={};data.forEach(function(d){if(isEasymap){nameHash[d[VizUtil.KEYPROP_COL_NAME]]=d}else{nameHash[d[viz.x.label]]=d}})}var keyprop=isEasymap?viz.easymapKeyProp:viz.geojsonKeyProp;var keypropForDisplay=isEasymap?viz.easymapKeyPropForDisplay:viz.geojsonKeyProp;var featureFilter=function(feature){return true};var options={};options.filter=featureFilter;var highlightFeature=function(e){var layer=e.target;layer.setStyle({weight:/^(LineString|MultiLineString)$/.test(layer.feature.geometry.type)?mapConfig.selectedLineWidth:layer.feature.geometry.type==="Point"?mapConfig.selectedPointBorderWidth:mapConfig.selectedBorderWidth});if(!L.Browser.ie&&!L.Browser.opera&&!L.Browser.edge){layer.bringToFront()}var infoboxValues=[];var labelAsTitle=viz.labelAsCardTitle==="on";if(nameHash&&nameHash[layer.feature.properties[keyprop]]){if(viz.x&&!labelAsTitle){infoboxValues.push({type:labelAsTitle?"label":"title",column:viz.x,value:layer.feature.properties[keyprop]})}if(isEasymap){infoboxValues.push({type:labelAsTitle?"label":"title",column:{name:VizUtil.getMessage(MapGenerator._lang,"Name"),func:""},value:layer.feature.properties[keypropForDisplay]})}if(viz.label){infoboxValues.push({type:labelAsTitle?"title":"label",column:viz.label,value:label1ValuePrefix+formatValue(nameHash[layer.feature.properties[keyprop]][viz.label.label],labelNaNMap[viz.label.label])+label1ValueSuffix})}if(viz.label2){infoboxValues.push({type:"label",column:viz.label2,value:label2ValuePrefix+formatValue(nameHash[layer.feature.properties[keyprop]][viz.label2.label],labelNaNMap[viz.label2.label])+label2ValueSuffix})}if(viz.color){infoboxValues.push({type:"label",suffix:" ("+VizUtil.getMessage(MapGenerator._lang,"Color")+")",column:viz.color,value:colorValuePrefix+formatColorValue(nameHash[layer.feature.properties[keyprop]][viz.color.label],labelNaNMap[viz.color.label])+colorValueSuffix})}}if(infoboxValues.length===0){if(keypropForDisplay){infoboxValues.push({type:"label",column:{name:isEasymap?"":keypropForDisplay,func:""},value:e.target.feature.properties[keypropForDisplay]})}else{var key=Object.keys(e.target.feature.properties);if(key.length>0){key=key[0];infoboxValues.push({type:"label",column:{name:"",func:""},value:e.target.feature.properties[key]})}}}if(viz.showNumberOfRowsInBalloon==="on"&&nameHash[layer.feature.properties[keyprop]][VizUtil.NROW_INTERNAL_COL_NAME]&&infoboxValues.filter(function(v){return v.column.name===VizUtil.NUMROWS_COL_NAME}).length===0){infoboxValues.push({type:"label",column:{name:VizUtil.NUMROWS_COL_NAME,func:""},value:formatNumrowValue(nameHash[layer.feature.properties[keyprop]][VizUtil.NROW_INTERNAL_COL_NAME])})}infobox.update(infoboxValues)};var resetHighlight=function(e){var layer=e.target;if(!layer.options._orgColor){e.target.setStyle({weight:/^(LineString|MultiLineString)$/.test(layer.feature.geometry.type)?mapConfig.lineWidth:layer.feature.geometry.type==="Point"?mapConfig.pointBorderWidth:mapConfig.borderWidth})}infobox.update()};var onFeatureClick=null;if(onShowDetailCallback){onFeatureClick=function(e){var cdata=[];var layer=e.target;if(viz.marker==="geojson"){cdata.push({type:"x",filter:true,datatype:viz.x.type,rawValue:layer.feature.properties[keyprop],value:layer.feature.properties[keyprop],name:viz.x.name,validName:viz.x.validName||viz.x.name,func:viz.x.func})}else{easymapCols.forEach(function(col){cdata.push({type:"x",filter:true,datatype:viz[col].type,rawValue:nameHash[layer.feature.properties[keyprop]][col],value:nameHash[layer.feature.properties[keyprop]][col],name:viz[col].name,validName:viz[col].validName||viz[col].name,func:viz[col].func})})}cdata._lang=MapGenerator._lang;onShowDetailCallback([cdata],layer.feature.properties,e.originalEvent.ctrlKey||e.originalEvent.metaKey)}}var onEachFeature=function(feature,layer){layer.on({mouseover:highlightFeature,mouseout:resetHighlight,click:onFeatureClick})};options.onEachFeature=onEachFeature;var pointStyles={radius:mapConfig.pointRadius,weight:0,opacity:1,fillOpacity:colorOpacity};options.pointToLayer=function(feature,latlng){return L.circleMarker(latlng,pointStyles)};geoJSONLayer=L.geoJSON(geoJSON,options);var hasZoomLevel=zoomLevel!==undefined&&zoomLevel!==null&&zoomLevel!=="";if(hasZoomLevel&&bounds){try{map.setZoom(zoomLevel)}catch(e){console.log(e)}map.fitBounds(bounds)}else if(hasZoomLevel&&center){try{map.setView(center,zoomLevel)}catch(e){console.log(e)}}else{geoLayerBounds=geoJSONLayer.getBounds();if(L.latLngBounds(geoLayerBounds).isValid()){map.fitBounds(geoLayerBounds)}else{map.setView([0,0],1)}}if(data){var styleFunc;if(viz.colorbucket&&colorBucketType!=="none"){colorData=VizUtil.distinct(data.map(function(datum){return datum[viz.colorbucket.label]}));var originalColorData=null;if(Object.keys(data[0]).includes(VizUtil.ORIGINAL_COLOR_BUCKET_LABELS)){var bucketData=data.find(function(datum){return datum[VizUtil.ORIGINAL_COLOR_BUCKET_LABELS]});if(bucketData&&bucketData[VizUtil.ORIGINAL_COLOR_BUCKET_LABELS]){originalColorData=JSON.parse(bucketData[VizUtil.ORIGINAL_COLOR_BUCKET_LABELS])}}if(colorBucketType==="bucket_equal_step"||VizUtil.useExtraBucketsForOutsideRangeValues(viz,"color")||VizUtil.isBucketZeroToCenterEnabled(viz,"color")){quantColorScale=MapGenerator.createQuantColorScale(viz,originalColorData||colorData)}colorData.forEach(function(x){quantColorScale(x)});styleFunc=function(feature){var styles={weight:/^(LineString|MultiLineString)$/.test(feature.geometry.type)?mapConfig.lineWidth:feature.geometry.type==="Point"?mapConfig.pointBorderWidth:mapConfig.borderWidth};var v=nameHash[feature.properties[keyprop]];if(v){if(/^(LineString|MultiLineString)$/.test(feature.geometry.type)){styles.color=quantColorScale(v[viz.colorbucket.label])}else{styles.color=viz.polygonBorderColor||"#FFFFFF";styles.fillColor=quantColorScale(v[viz.colorbucket.label]);styles.fillOpacity=colorOpacity}}else{styles.color="transparent"}return styles};legend=MapGenerator.createLegend(colorData,quantColorScale,colorOpacity,"square",legendTitleText,viz.legendTitleFontSize||viz._defaultLegendTitleFontSize,viz.legendTitleFontWeight,viz.legendFontSize||viz._defaultLegendFontSize,viz.legendLocation,viz.highlightSort!=="off")}else{colorData=VizUtil.distinct(data.map(function(datum){return viz.colorbucket?formatColorValue(datum[viz.colorbucket.label]):datum[viz.color.label]}));catColorScale=MapGenerator.createCatColorScale(viz,colorData.length);colorData.forEach(function(x){catColorScale(x)});styleFunc=function(feature){var styles={weight:/^(LineString|MultiLineString)$/.test(feature.geometry.type)?mapConfig.lineWidth:feature.geometry.type==="Point"?mapConfig.pointBorderWidth:mapConfig.borderWidth};var v=nameHash[feature.properties[keyprop]];if(v){if(/^(LineString|MultiLineString)$/.test(feature.geometry.type)){styles.color=catColorScale(viz.colorbucket?formatColorValue(v[viz.colorbucket.label]):v[viz.color.label])}else{styles.color=viz.polygonBorderColor||"#FFFFFF";styles.fillColor=catColorScale(viz.colorbucket?formatColorValue(v[viz.colorbucket.label]):v[viz.color.label]);styles.fillOpacity=colorOpacity}}else{styles.color="transparent"}return styles};legend=MapGenerator.createLegend(colorData,catColorScale,colorOpacity,"square"+(viz.colorbucket&&colorBucketType==="none"?" pull-text-right":""),legendTitleText,viz.legendTitleFontSize||viz._defaultLegendTitleFontSize,viz.legendTitleFontWeight,viz.legendFontSize||viz._defaultLegendFontSize,viz.legendLocation,viz.highlightSort!=="off")}geoJSONLayer.setStyle(styleFunc);if(legend&&showLegend==="on"){legend.addTo(map)}}else{geoJSONLayer.setStyle(function(feature){return{weight:/^(LineString|MultiLineString)$/.test(feature.geometry.type)?mapConfig.lineWidth:feature.geometry.type==="Point"?mapConfig.pointBorderWidth:mapConfig.borderWidth}})}geoJSONLayer.addTo(map);break}case"map":{var longCol=isEasymap?{name:"longitude",label:"longitude",func:""}:viz.x,latCol=isEasymap?{name:"latitude",label:"latitude",func:""}:viz.y,valueLabelHt;if(longCol&&latCol&&data){if(isEasymap){valueLabelHt={};var prop=viz.easymapKeyProp;var propForDisplay=viz.easymapKeyPropForDisplay;var _s=Date.now();geoJSON.features.map(function(feature){valueLabelHt[feature.properties[prop]]=feature.properties[propForDisplay]})}var showLines=viz.mapMarkerType&&!isEasymap?/line$/.test(viz.mapMarkerType):viz.mapShowLines==="on";var showDashedLines=viz.mapMarkerType?viz.mapMarkerType==="circle+dashedline":viz.mapDashedLines==="on";var normalizeSize=viz.size&&viz.mapNormalizeSizeByGroup==="on"&&showLines;var DEFAULT_GROUP_NAME="default";var CALCULATED_LONG="..lng";var CALCULATED_SIZE="..sz";infobox=MapGenerator.createInfoBox();infobox.addTo(map);if(viz.color){if(viz.colorbucket&&colorBucketType!=="none"){colorData=VizUtil.distinct(data.map(function(datum){return datum[viz.colorbucket.label]}));var originalColorData=null;if(Object.keys(data[0]).includes(VizUtil.ORIGINAL_COLOR_BUCKET_LABELS)){var bucketData=data.find(function(datum){return datum[VizUtil.ORIGINAL_COLOR_BUCKET_LABELS]});if(bucketData&&bucketData[VizUtil.ORIGINAL_COLOR_BUCKET_LABELS]){originalColorData=JSON.parse(bucketData[VizUtil.ORIGINAL_COLOR_BUCKET_LABELS])}}if(colorBucketType==="bucket_equal_step"||VizUtil.useExtraBucketsForOutsideRangeValues(viz,"color")||VizUtil.isBucketZeroToCenterEnabled(viz,"color")){quantColorScale=MapGenerator.createQuantColorScale(viz,originalColorData||colorData)}colorData.forEach(function(x){quantColorScale(x)});legend=MapGenerator.createLegend(colorData,quantColorScale,colorOpacity,"circle",legendTitleText,viz.legendTitleFontSize||viz._defaultLegendTitleFontSize,viz.legendTitleFontWeight,viz.legendFontSize||viz._defaultLegendFontSize,viz.legendLocation,viz.highlightSort!=="off")}else{colorData=VizUtil.distinct(data.map(function(datum){return viz.colorbucket?formatColorValue(datum[viz.colorbucket.label]):datum[viz.color.label]}));catColorScale=MapGenerator.createCatColorScale(viz,colorData.length);colorData.forEach(function(x){catColorScale(x)});legend=MapGenerator.createLegend(colorData,catColorScale,colorOpacity,"circle"+(viz.colorbucket&&colorBucketType==="none"?" pull-text-right":""),legendTitleText,viz.legendTitleFontSize||viz._defaultLegendTitleFontSize,viz.legendTitleFontWeight,viz.legendFontSize||viz._defaultLegendFontSize,viz.legendLocation,viz.highlightSort!=="off")}if(legend&&showLegend==="on"){legend.addTo(map)}}var minSize=parseFloat(viz.circleMinSize)||mapConfig.minCircleSize;var maxSize=parseFloat(viz.circleMaxSize)||mapConfig.maxCircleSize;var sizeScale=d3.scale.linear().domain([0,0]).rangeRound([minSize,maxSize]);if(viz.size){if(normalizeSize){sizeScale.domain([0,1])}else{var sizeData=data.map(function(datum){return datum[viz.size.label]});sizeScale.domain([d3.min(sizeData),d3.max(sizeData)])}}var polylines=[];if(showLines){var lineData=data.filter(function(d){return!VizUtil.isEmpty(d[latCol.label])&&!VizUtil.isEmpty(d[longCol.label])});var splitLinesByLabel=viz.mapSplitLinesByLabel==="on";var groupbyCol=viz.color?viz.color.label:null;if(splitLinesByLabel&&viz.label){groupbyCol=viz.label.label}var colorCol=viz.color?viz.color.label:null;lineData=groupbyCol?d3.nest().key(function(d){return d[groupbyCol]}).entries(lineData):[{key:DEFAULT_GROUP_NAME,values:data}];lineData.forEach(function(datum,idx){if(datum.values&&datum.values.length>1){if(!VizUtil.isEmpty(datum.values[0][VizUtil.ORIGINAL_ORDER_COL_NAME])){datum.values.sort(function(a,b){return b[VizUtil.ORIGINAL_ORDER_COL_NAME]-a[VizUtil.ORIGINAL_ORDER_COL_NAME]})}var colorValue=groupbyCol===colorCol?catColorScale(datum.key):colorCol&&datum.values[0][colorCol]?catColorScale(datum.values[0][colorCol]):catColorScale(DEFAULT_GROUP_NAME);if(viz.colorbucket&&colorBucketType!=="none"){colorValue=quantColorScale(datum.values[0][viz.colorbucket.label])}var msg="";for(var key in datum.values[0]){if(labelNameMap[key]){var value=datum.values[0][key];msg+='<div class="popup-content-row"><div class="popup-content-cell">'+labelNameMap[key]+':</div><div class="popup-content-cell">'+formatValue(value,labelNaNMap[key])+"</div></div>"}}if(normalizeSize){var sizes=datum.values.map(function(v){return v[viz.size.label]});var sscale=d3.scale.linear().domain(d3.extent(sizes)).range([0,1]);datum.values.forEach(function(v){v[CALCULATED_SIZE]=sscale(v[viz.size.label])})}var lng=null,lat=null,prevlng=null;var latlngs=datum.values.map(function(v){lng=v[longCol.label];lat=v[latCol.label];if(prevlng!==null&&Math.abs(lng-prevlng)>180&&lng*prevlng<0){if(prevlng<0){lng=lng-360}else{lng=lng+360}}prevlng=lng;v[CALCULATED_LONG]=lng;return L.latLng(lat,lng)});var polyline=L.polyline(latlngs,{color:colorValue,opacity:colorOpacity,dashArray:showDashedLines?"5, 5":null,"data-line-id":idx});polyline.on("mouseover",function(evt){var dataidx=evt.target.options["data-line-id"];var dt=lineData[dataidx].values[0];var infoboxValues=[];if(viz.label){infoboxValues.push({type:"title",column:viz.label,value:label1ValuePrefix+formatValue(dt[viz.label.label],labelNaNMap[viz.label.label])+label1ValueSuffix});if(viz.color){infoboxValues.push({type:"label",suffix:" ("+VizUtil.getMessage(MapGenerator._lang,"Color")+")",column:viz.color,value:colorValuePrefix+formatColorValue(dt[viz.color.label],labelNaNMap[viz.color.label])+colorValueSuffix})}}else if(viz.color){infoboxValues.push({type:"title",column:viz.color,value:formatColorValue(dt[viz.color.label],labelNaNMap[viz.color.label])})}infobox.update(infoboxValues);polyline.setStyle({weight:5})});polyline.on("mouseout",function(){infobox.update();if(!polyline.options._orgColor){polyline.setStyle({weight:3})}});polylines.push(polyline)}})}var circles=[];if(!showLines&&viz.size){data=data.sort(function(a,b){return b[viz.size.label]-a[viz.size.label]})}data.forEach(function(datum,idx){if(VizUtil.isEmpty(datum[latCol.label])||VizUtil.isEmpty(datum[longCol.label])){return}var colorValue=catColorScale(viz.color?datum[viz.color.label]:DEFAULT_GROUP_NAME);if(viz.colorbucket){if(colorBucketType==="none"){colorValue=catColorScale(formatColorValue(datum[viz.colorbucket.label]))}else{colorValue=quantColorScale(datum[viz.colorbucket.label])}}var sizeValue=sizeScale(viz.size?normalizeSize?datum[CALCULATED_SIZE]||0:datum[viz.size.label]:null);var showBorder=viz.mapShowBorder!=="off";var borderColor=viz.mapBorderColor||"#ffffff";var msg="";for(var key in datum){if(labelNameMap[key]){var value=datum[key];msg+='<div class="popup-content-row"><div class="popup-content-cell">'+labelNameMap[key]+':</div><div class="popup-content-cell">'+formatValue(value,labelNaNMap[key])+"</div></div>"}}var circleMarker=L.circleMarker(L.latLng(datum[latCol.label],datum[CALCULATED_LONG]||datum[longCol.label]),{stroke:showBorder,color:colorValue,fillColor:colorValue,fillOpacity:colorOpacity,radius:sizeValue,weight:showBorder?1:0,"data-id":idx});circleMarker.on("mouseover",function(evt){var dataidx=evt.target.options["data-id"];var dt=data[dataidx];var infoboxValues=[];var labelAsTitle=viz.labelAsCardTitle==="on";if(viz.showLongLatValues==="on"){infoboxValues.push({type:"long",column:longCol,value:formatValue(dt[longCol.label],false)});infoboxValues.push({type:"lat",column:latCol,value:formatValue(dt[latCol.label],false)})}if(viz.groupby&&viz.showGroupByValueInBalloon!=="off"){if(viz.groupby.type===VizUtil.TYPE_ROWID){infoboxValues.push({type:"label",column:{name:VizUtil.getMessage(MapGenerator._lang,VizUtil.ROWID_COL_LABEL),func:"",type:VizUtil.TYPE_ROWID},value:formatValue(dt[viz.groupby.label],labelNaNMap[viz.groupby.label])})}else{infoboxValues.push({type:labelAsTitle?"label":"title",column:viz.groupby,value:formatValue(dt[viz.groupby.label],labelNaNMap[viz.groupby.label])})}}if(isEasymap){infoboxValues.push({type:viz.label&&labelAsTitle?"label":"title",column:{name:VizUtil.getMessage(MapGenerator._lang,"Name"),func:""},value:valueLabelHt[dt[VizUtil.KEYPROP_COL_NAME]]||""})}if(viz.label){infoboxValues.push({type:labelAsTitle?"title":"label",column:viz.label,value:label1ValuePrefix+formatValue(dt[viz.label.label],labelNaNMap[viz.label.label])+label1ValueSuffix})}if(viz.label2){infoboxValues.push({type:"label",column:viz.label2,value:label2ValuePrefix+formatValue(dt[viz.label2.label],labelNaNMap[viz.label2.label])+label2ValueSuffix})}if(viz.color){infoboxValues.push({type:"label",suffix:" ("+VizUtil.getMessage(MapGenerator._lang,"Color")+")",column:viz.color,value:colorValuePrefix+formatColorValue(dt[viz.color.label],labelNaNMap[viz.color.label])+colorValueSuffix})}if(viz.size){infoboxValues.push({type:"label",suffix:" ("+VizUtil.getMessage(MapGenerator._lang,"Size")+")",column:viz.size,value:sizeValuePrefix+formatSizeValue(dt[viz.size.label],labelNaNMap[viz.size.label])+sizeValueSuffix})}if(viz.showNumberOfRowsInBalloon==="on"&&(isEasymap||viz.groupby&&viz.groupby.name!==VizUtil.ROWID_COL_NAME)&&dt[VizUtil.NROW_INTERNAL_COL_NAME]&&infoboxValues.filter(function(v){return v.column.name===VizUtil.NUMROWS_COL_NAME}).length===0){infoboxValues.push({type:"label",column:{name:VizUtil.NUMROWS_COL_NAME,func:""},value:formatNumrowValue(dt[VizUtil.NROW_INTERNAL_COL_NAME])})}infobox.update(infoboxValues);circleMarker.setStyle({stroke:true,weight:3})});circleMarker.on("mouseout",function(){infobox.update();if(!circleMarker.options._orgColor){circleMarker.setStyle({stroke:showBorder,weight:showBorder?1:0})}});if(onShowDetailCallback){circleMarker.on("click",function(e){var cdata=[];if(viz.marker==="map"){if(viz.groupby){if(viz.groupby.type===VizUtil.TYPE_ROWID){return}else{cdata.push({type:"groupby",filter:true,datatype:viz.groupby.type,rawValue:bucketLabelMap.groupby?bucketLabelMap.groupby[datum[viz.groupby.label]]||datum[viz.groupby.label]:datum[viz.groupby.label],value:datum[viz.groupby.label],name:viz.groupby.name,validName:viz.groupby.validName||viz.groupby.name,func:viz.groupby.func,isNumeric:viz.groupby.isNumeric,isDate:viz.groupby.isDate,numDecimalDigits:viz.numDecimalDigits||2})}}}else{easymapCols.forEach(function(col){cdata.push({type:"x",filter:true,datatype:viz[col].type,rawValue:datum[col],value:datum[col],name:viz[col].name,validName:viz[col].validName||viz[col].name,func:viz[col].func})})}onShowDetailCallback([cdata],{id:e.target.options["data-id"]},e.originalEvent.ctrlKey||e.originalEvent.metaKey)})}circles.push(circleMarker)});if(viz.color&&!viz.colorbucket&&catColorScale.isHighlightColorScale){MapGenerator._moveHighlightedCirclesToBottom(circles,catColorScale)}var circleGroup=L.featureGroup(polylines.concat(circles));circleGroup.addTo(map);if(zoomLevel&&bounds){try{map.setZoom(zoomLevel)}catch(e){console.log(e)}map.fitBounds(bounds)}else if(zoomLevel&&center){try{map.setView(center,zoomLevel)}catch(e){console.log(e)}}else{_bounds=circleGroup.getBounds();if(L.latLngBounds(_bounds).isValid()){map.fitBounds(_bounds)}else{map.setView([0,0],1)}}}else{if(isEasymap&&geoJSON){geoJSONLayer=L.geoJSON(geoJSON,options);geoLayerBounds=geoJSONLayer.getBounds();if(L.latLngBounds(geoLayerBounds).isValid()){map.fitBounds(geoLayerBounds)}else{map.setView([0,0],1)}}else{map.setView([0,0],1)}}break}case"maphmap":{if(viz.x&&viz.y){var heatData=[],circleData=[];var mag=viz.maphmapMagnification?parseFloat(viz.maphmapMagnification):1;var rad=viz.maphmapRadius?parseFloat(viz.maphmapRadius):25;if(data.length>1&&Array.isArray(data[0])&&Array.isArray(data[1])){data=data[1]}data.forEach(function(datum){if(VizUtil.isEmpty(datum[viz.y.label])||VizUtil.isEmpty(datum[viz.x.label])){return}heatData.push([datum[viz.y.label],datum[viz.x.label],viz.color?datum[viz.color.label]*mag:mag]);circleData.push(L.circleMarker(L.latLng(datum[viz.y.label],datum[viz.x.label])))});var heatLayer=L.heatLayer(heatData,{radius:rad});heatLayer.addTo(map);if(zoomLevel&&bounds){try{map.setZoom(zoomLevel)}catch(e){console.log(e)}map.fitBounds(bounds)}else if(zoomLevel&&center){try{map.setView(center,zoomLevel)}catch(e){console.log(e)}}else{var _feat=L.featureGroup(circleData);_bounds=_feat.getBounds();if(L.latLngBounds(_bounds).isValid()){map.fitBounds(_bounds)}else{map.setView([0,0],1)}}}else{map.setView([0,0],1)}break}default:{break}}if(onZoomEndCallback&&typeof onZoomEndCallback==="function"){map.on("zoomend",onZoomEndCallback)}if(onMoveEndCallback&&typeof onMoveEndCallback==="function"){map.on("moveend",onMoveEndCallback)}if(typeof module==="object"&&module.exports&&map&&!noThumbnail){global._leaflet_map_obj=map}if(elTarget.parentNode.classList.contains("markdown-viz-container")){if(!window._leaflet_map_objs)window._leaflet_map_objs={};window._leaflet_map_objs[elTarget.parentNode.getAttribute("data-id").replace(/^div-/,"")]=map}else if(viz._leafletObjectCacheId){if(!global._leaflet_map_objs)global._leaflet_map_objs={};global._leaflet_map_objs[viz._leafletObjectCacheId]=map}};MapGenerator.getRenderFunction=function(viz,data,geojson,onLoadCallback,onErrorCallback,noThumbnail){var func=function(props){viz.width=props.width;viz.height=props.height;var elTarget=props.elem;MapGenerator.render(viz,data,elTarget,geojson,onLoadCallback,onErrorCallback,noThumbnail)};return func};MapGenerator._highlightSelections=function(map,conditions,conditionsToRemove){if(map&&map._layers&&conditions&&conditions.length>0){if(conditionsToRemove){conditionsToRemove.forEach(function(cond){var layer=Object.values(map._layers).find(function(layer){if(layer.options&&!VizUtil.isEmpty(layer.options["data-id"])){return layer.options["data-id"]===cond.id}else if(layer.feature&&layer.feature.properties){return VizUtil.areObjectsEqual(layer.feature.properties,cond)}return false});if(layer){if(layer.feature){layer.setStyle({color:layer.options._orgColor,_orgColor:null,weight:/^(LineString|MultiLineString)$/.test(layer.feature.geometry.type)?mapConfig.lineWidth:layer.feature.geometry.type==="Point"?mapConfig.pointBorderWidth:mapConfig.borderWidth})}else{layer.setStyle({color:layer.options._orgColor,_orgColor:null,weight:3})}layer.bringToFront()}})}conditions.forEach(function(cond){var layer=Object.values(map._layers).find(function(layer){if(layer.options&&!VizUtil.isEmpty(layer.options["data-id"])){return layer.options["data-id"]===cond.id}else if(layer.feature&&layer.feature.properties){return VizUtil.areObjectsEqual(layer.feature.properties,cond)}return false});if(layer){if(layer.feature){layer.setStyle({_orgColor:layer.options.color,color:layer.options.fillColor,weight:/^(LineString|MultiLineString)$/.test(layer.feature.geometry.type)?mapConfig.selectedLineWidth:layer.feature.geometry.type==="Point"?mapConfig.selectedPointBorderWidth:mapConfig.selectedBorderWidth})}else{layer.setStyle({_orgColor:layer.options.color,color:layer.options.fillColor,weight:3})}layer.bringToFront()}})}};if(typeof module==="object"&&module.exports)module.exports=MapGenerator;